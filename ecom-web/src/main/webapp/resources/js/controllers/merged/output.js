"use strict";var BackupController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.success=!1,t.error=!1,t.loading1=!1,t.success1=!1,t.error1=!1,t.uploadme={},t.filepath="",t.uploadme.src="",t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"))},t.takeBackup=function(){t.loading=!0,e.post("backup/takeBakup/"+t._s_tk_com).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success=!0,t.successMessage=e.data,n(function(){t.success=!1},2e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,n(function(){t.error=!1},2e3)):"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=o.systemBusy})},t.reStoreBackup=function(){t.loading1=!0,e.post("backup/reStoreBackup/"+t._s_tk_com).success(function(e){t.loading1=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success1=!0,t.successMessage1=e.data,n(function(){t.success1=!1},2e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus?(t.error1=!0,t.errorMessage1=e.data,n(function(){t.error1=!1},2e3)):"INVALIDSESSION"==t.responseStatus?(t.error1=!0,t.errorMessage1=e.data,r.location=e.layOutPath):(t.error1=!0,t.errorMessage1=e.data)}).error(function(){t.loading1=!1,t.error1=!0,t.errorMessage=o.systemBusy})},t.sessionValidation()}],BrandSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","BrandSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],BrandsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","BrandsControllerPreLoad",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.brandSuccess=!1,t.brandError=!1,t.brandBean={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.brandsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.brandList=t.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},t.showAddBrandPopup=function(){t.brandBean={},t.showNewBrandModal=!0},t.addBrand=function(){t.brandSuccess=!1,t.brandError=!1,t.loading=!0,e.post("brands/addBrand/"+t._s_tk_com,t.brandBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.brandBean={},t.brandSuccess=!0,t.brandSuccessMessage=e.data,t.showNewBrandModal=!1,n(function(){t.brandSuccess=!1,n(function(){s.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.brandError=!0,t.brandErrorMessage=e.data,r.location=e.layOutPath):(t.brandError=!0,t.brandErrorMessage=e.data)}).error(function(){t.loading=!1,t.brandError=!0,t.brandErrorMessage=t.systemBusy})},t.showUpdateBrandPopup=function(e){t.updatebrandBean={},t.updatebrandBean=angular.copy(e),t.showUpdateBrandModal=!0},t.updateBrand=function(){t.brandSuccess=!1,t.brandError=!1,t.loading=!0,e.post("brands/updateBrand/"+t._s_tk_com,t.updatebrandBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updatebrandBean={},t.brandSuccess=!0,t.brandSuccessMessage=e.data,t.showUpdateBrandModal=!1,n(function(){t.brandSuccess=!1,n(function(){s.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.brandError=!0,t.brandErrorMessage=e.data,r.location=e.layOutPath):(t.brandError=!0,t.brandErrorMessage=e.data)}).error(function(){t.loading=!1,t.brandError=!0,t.brandErrorMessage=t.systemBusy})},t.sessionValidation()}],CashManagmentController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","CashManagmentControllerPreLoad","$timeout","$route",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.registerEnableCashStatus=!1,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,t.addCashInFunc=!1,t.addCashOutFunc=!1,t.cashManagmentBean={},t.selectedExpenseType="-1",t.cashModalButtonLabel="",t.expenseTypeFunc=function(e){t.selectedExpenseType=e},t.addCash=function(){t.showCashModal=!0,t.cashModalButtonLabel="Add Cash",t.addCashInFunc=!0},t.removeCash=function(){t.showCashModal=!0,t.cashModalButtonLabel="Remove Cash",t.addCashOutFunc=!0},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.enableCashStatus(),t.data=s.loadControllerData(),t.fetchData())},t.fetchData=function(){o.brandsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):"Please open Register.If you want to check Cash Management."==t.data?(t.error=!0,t.disableMngmnt=!0,t.errorMessage="Please open Register.If you want to check Cash Management."):null!=t.data&&(t.cashManagmentList=t.data.cashManagmentControllerBeans,t.expenseTypes=t.data.expenseTypes),o.cashManagementLoadedFully=!1,o.globalPageLoader=!1},t.addCashIn=function(){t.addCashProcessingButton=!0,t.addCashInFunc?t.cashManagmentBean.cashManagmentType="IN":t.cashManagmentBean.cashManagmentType="OUT",t.cashInOut()},t.cashInOut=function(){t.cashManagmentBean.expenseType=t.selectedExpenseType,e.post("cashManagement/cashInOut/"+t._s_tk_com,t.cashManagmentBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.showCashModal=!1,t.cashManagmentList=e.data,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.enableCashStatus=function(){e.post("cashManagement/enableCashStatus/"+t._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.registerEnableCashStatus=!0:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.cashManagement=function(){e.post("cashManagement/enableCash/"+t._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.registerBean=e.data,a.put("_e_cOr_gra",""),a.put("_e_cOr_gra",t.registerBean.registerId),r.location="/app/#/manageRegister"):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sessionValidation()}],CashSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CashSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],ChangePasswordController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService",function(t,e,r,a,o,n,s){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,t.passwordBean={},t.employeeId=o.get("EmployeeId"),t.userDetailBean={},t.homeContactBean={},t.workContactBean={},t.email=o.get("email"),t.employeeDetailBean=o.get("EmployeeInfo"),t.loading=!1,t.sessionValidation=function(){s.validate()&&(t._s_tk_com=o.get("_s_tk_com"))},t.changePasswordReq=function(){t.success=!1,t.error=!1,t.loading=!0,""!=t.passwordBean.newPassword||""!=t.passwordBean.confirmPassword?t.passwordBean.newPassword==t.passwordBean.confirmPassword?e.post("changePassword/changePasswordReq/"+t._s_tk_com+"/"+t.email+"/"+t.passwordBean.password+"/"+t.passwordBean.newPassword).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?"false"!=e.data.toString()?(t.successMessage="Password has been changed successfully",t.success=!0,r(function(){t.success=!1,t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password="",a.location=e.layOutPath},2e3)):(r(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Current password is not correct",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""):("INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,a.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data),t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password="")}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy,t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""}):(r(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Password does not match the confirm password",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""):(r(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Please enter new password in both fields",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password="")},t.sessionValidation()}],CompanySetupController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService",function(t,e,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.companySuccess=!1,t.companyError=!1,t.systemBusy="System is Busy Please try again",t.companyBean={},t._s_tk_com=a.get("_s_tk_com"),t.fetchAllCurrencies=function(){e.post("companySetup/getAllCurrencies").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.currencyList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.fetchAllCurrencies(),t.fetchAllPrinterFormats=function(){e.post("companySetup/getAllPrinterFormats").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.printerFormatsList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.fetchAllPrinterFormats(),t.fetchAlltimeZones=function(){e.post("companySetup/getAllTimeZones").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.timeZonesList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.fetchAlltimeZones(),t.reloadRoute=function(){r.location.reload()},t.addNewCompany=function(){t.companySuccess=!1,t.companyError=!1,t.loading=!0,t.addNewCompanyloading=!0,""!=t.companyBean.companyName?""!=t.companyBean.email&&""!=t.companyBean.password?t.companyBean.email!=t.userBean.email?e.post("companySetup/addNewCompany/"+t._s_tk_com,t.companyBean).success(function(e){t.loading=!1,t.addNewCompanyloading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.companySuccess=!0,t.companySuccessMessage=e.data,n(function(){t.companySuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.loading=!1,t.addNewCompanyloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy}):(n(function(){t.error=!1,r.location=Response.layOutPath},2e3),t.error=!0,t.errorMessage="Please enter another email,user with same user email already exist ",t.addNewCompanyloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy):(n(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Please enter email and  password in both fields",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""):(n(function(){t.error=!1,r.location=Response.layOutPath},2e3),t.error=!0,t.errorMessage="Please enter another name,Company with same name already exist ",t.addNewCompanyloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy)},s.validate(),o.globalPageLoader=!1}],CompanySetupImagesController=["$scope"," $http","$window","$cookieStore","$rootScope","SessionService","CompanySetupImagesControllerPreLoad","$timeout","$route",function(r,e,t,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.companyImpagesList=[],r.configuration={},r.sessionValidation=function(){n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=s.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(r.companyImpagesList=r.data),o.globalPageLoader=!1},r.showImage=function(e){if(0<r.companyImpagesList.length)for(var t=0;t<r.companyImpagesList.length;t++)e==r.companyImpagesList[t].configurationId&&(r.configuration={},r.configuration=angular.copy(r.companyImpagesList[t]))},r.cashInOut=function(){e.post("cashManagement/cashInOut/"+r._s_tk_com,r.cashManagmentBean).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.showCashModal=!1,r.cashManagmentList=e.data,r.addCashProcessingButton=!1,r.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],CreditCardSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CreditCardSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],CustomerDetailsController=["$scope","$http","$interval","$timeout","$window","$cookieStore","$rootScope","SessionService","CustomerDetailsControllerPreLoad",function(r,t,e,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.customerBean={},r.customerPaymentsBeans=[],r.sessionValidation=function(){i.validate()&&(r._s_tk_com=n.get("_s_tk_com"),r.data=c.loadControllerData(),r.InvoiceMainBeans=localStorage.getItem("salesHistory"),r.InvoiceMainBeans=JSON.parse(r.InvoiceMainBeans),r.fetchData())},r.fetchData=function(){s.customerDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):r.customerBean=r.data,s.globalPageLoader=!1},r.loadPaymentHistory=function(){null!=r.data&&(0<r.customerPaymentsBeans.length?($("#myTable").DataTable().destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"asc"]],bInfo:!0})},10)):(r.customerPaymentsBeans=[],r.customerPaymentsBeans=angular.copy(r.customerBean.customerPaymentsBeans)))},e(function(){n.get("salesHostoryLoaded")&&(r.validate(),n.put("salesHostoryLoaded",!1))},1),r.validate=function(){a(function(){r.canvas=document.getElementById("hirearchyPage"),angular.element(document).injector().invoke(function(e){var t=angular.element(r.canvas).scope();e(r.canvas)(t)})},1)},r.processPayment=function(e){r.success=!1,r.error=!1,r.loading=!0,t.post("salesHistory/processPayment/"+r._s_tk_com+"/"+e).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(localforage.setItem("_s_tk_sell",e.data),o.location=e.layOutPath):"INVALIDSESSION"==r.responseStatus||"SYSTEMBUSY"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,o.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){r.loading=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.updateCustomer=function(){o.location="/app/#/manageCustomer"},r.sessionValidation()}],CustomerGroupController=["$scope","$http","$timeout","$route","$window","$cookieStore","$rootScope","SessionService","CustomerGroupControllerPreLoad",function(t,e,r,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,t.showAddProducTypeModal=!1,t.showUpdateCustomerGroupModal=!1,t.customerGroupBean={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=n.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){s.customerGroupLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):(null!=t.data.customerGroupBeanList&&(t.customerGroupList=t.data.customerGroupBeanList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),null!=t.data.countryListBeans&&(t.countryList=t.data.countryListBeans)),s.globalPageLoader=!1},t.showCustomers=function(e){n.put("_e_ctt_llz",e.customerGroupName),n.put("_t_f_lly","true"),o.location="/app/#/customers"},t.showAddCustomerGroupPopup=function(){t.customerGroupBean={},t.customerGroupBean.countryId="1",t.showAddCustomerGroupModal=!0},t.addCustomerGroup=function(){t.customerGroupSuccess=!1,t.customerGroupError=!1,t.loading=!0,e.post("customerGroup/addCustomerGroup/"+t._s_tk_com,t.customerGroupBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.customerGroupBean={},t.customerGroupSuccess=!0,t.customerGroupSuccessMessage=e.data,t.showAddCustomerGroupModal=!1,r(function(){t.customerGroupSuccess=!1,r(function(){a.reload()},500)},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data,o.location=e.layOutPath):(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data)}).error(function(){t.loading=!1,t.customerGroupError=!0,t.customerGroupErrorMessage=t.systemBusy})},t.showUpdateCustomerGroupPopup=function(e){t.updateCustomerGroupBean={},t.updateCustomerGroupBean=angular.copy(e),t.showUpdateCustomerGroupModal=!0},t.updateCustomerGroup=function(){t.customerGroupSuccess=!1,t.customerGroupError=!1,t.loading=!0,e.post("customerGroup/updateCustomerGroup/"+t._s_tk_com,t.updateCustomerGroupBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updateCustomerGroupBean={},t.customerGroupSuccess=!0,t.customerGroupSuccessMessage=e.data,t.showUpdateCustomerGroupModal=!1,r(function(){t.customerGroupSuccess=!1,r(function(){a.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data,o.location=e.layOutPath):(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data)}).error(function(){t.loading=!1,t.customerGroupError=!0,t.customerGroupErrorMessage=t.systemBusy})},t.sessionValidation()}],CustomerGroupSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CustomerGroupSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],CustomerSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CustomerSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],CustomersController=["$scope","$http","$sce","$timeout","$window","$cookieStore","$rootScope","SessionService","CustomersControllerPreLoad",function(o,r,t,e,n,a,s,i,c){function l(e){if("undefined"!=o.comparisonCustomersList&&null!=o.comparisonCustomersList&&0<o.comparisonCustomersList.length)for(var t=0;t<o.comparisonCustomersList.length;t++)if(o.comparisonCustomersList[t].customerId==e.customerId)return!0;return!1}s.MainSideBarhideit=!1,s.MainHeaderideit=!1,o.sessionValidation=function(){i.validate()&&(o._s_tk_com=a.get("_s_tk_com"),o.data=c.loadControllerData(),o.fetchData(),"true"==a.get("_t_f_lly")&&(o.filterBean={},o.filterBean.search=a.get("_e_ctt_llz"),a.put("_t_f_lly","false"),a.put("_e_ctt_llz","")))},o.fetchData=function(){s.customersLoadedFully=!1,"NORECORDFOUND"==o.data||"No record found !"==o.data?(o.error=!0,o.errorMessage="No record found"):"SYSTEMBUSY"==o.data?(o.error=!0,o.errorMessage=o.systemBusy):"INVALIDSESSION"==o.data?(o.error=!0,o.errorMessage="An exception occured while validating session !",n.location="/app/#/login"):null!=o.data&&(o.customersList=o.data,o.comparisonCustomersList=o.data,o.lodAllCustomersAsynchrnously(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",pageLength:5,buttons:s.buttonsView})},10)),s.globalPageLoader=!1},o.activeInactiveAll=function(e){o.loading=!0,r.get("customers/activeInactiveAllCustomers/"+o._s_tk_com+"/"+e).success(function(e){o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus?(customer=e.data,localforage.setItem("_e_cOt_jir",customer),n.location="/app/#/manageCustomer"):n.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.addCustomer=function(){n.location="/app/#/newCustomer"},o.editCustomer=function(a){r.get("customers/updateSelectedCustomer/"+o._s_tk_com+"/"+a.customerId).success(function(e){if(o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus){for(var t=0;t<o.customersList.length;t++)if(o.customersList[t].customerId==a.customerId){"true"==o.customersList[t].activeIndicator?o.customersList[t].activeIndicator="false":o.customersList[t].activeIndicator="true";break}var r=$("#myTable").DataTable();r&&r.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",pageLength:5,buttons:s.buttonsView})},10)}else n.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.showCustomer=function(t){r.get("customers/getSelectedCustomer/"+o._s_tk_com+"/"+t.customerId).success(function(e){o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus?(t=e.data,a.put("_cD_cDt_gra",t.customerId),localforage.setItem("_e_cOt_jir",t),n.location="/app/#/customerDetails"):n.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.updateCustomer=function(t){r.get("customers/getSelectedCustomer/"+o._s_tk_com+"/"+t.customerId).success(function(e){o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus?(t=e.data,localforage.setItem("_e_cOt_jir",t),n.location="/app/#/manageCustomer"):n.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.lodAllCustomersAsynchrnously=function(){o.dataLoading=!1,r.post("customers/getAllCustomers/"+a.get("_s_tk_com")+"/true").success(function(e){o.data=e.data,o.dataLoading=!0}).error(function(){o.dataLoading=!0,n.location="/app/#/login"}),o.lodAllProductsGraph()},o.lodAllCustomers=function(){o.dataLoading=!1;for(var e=0;e<o.data.length;e++)l(o.data[e])||o.customersList.push(o.data[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",pageLength:5,buttons:s.buttonsView})},1),o.dataLoading=!0},o.lodAllProductsGraph=function(){o.dataLoading=!1,r.post("customers/getCustomerDashBoard/"+a.get("_s_tk_com")).success(function(e){o.data=e.data,o.chartCustomerCount=new CanvasJS.Chart("chartContainerProductCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:o.data.dataPointsCustomerCount}]}),o.chartCustomerCount.render(),o.dataLoadingGraph=!0}).error(function(){})},o.autoCompleteOptionsCustomers={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(o.data,function(e){if(e.contactName)return e.contactName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t)||e.customerBalance.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.contactName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 30%'>"+e.contactName+"</td><td style='width: 10%'>"+e.phoneNumber+"</td><td style='width: 10%'>"+e.customerBalance+"</td></tr></tbody></table>")}},itemSelected:function(e){o.selectedItem=e,o.CustomerName=o.selectedItem,o.showCustomer(o.selectedItem.item)}},o.sessionValidation()}],DownloadProductsController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","DownloadProductsControllerPreLoad",function(r,e,t,a,o,n,s,i){function c(e){if("undefined"!=r.comparisonProductsList&&null!=r.comparisonProductsList&&0<r.comparisonProductsList.length)for(var t=0;t<r.comparisonProductsList.length;t++)if(r.comparisonProductsList[t].productId==e.productId)return!0;return!1}n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.gui={},r.gui.showProductPriceHistory=!1,r.roledId=o.get("_s_tk_rId"),r.dataLoading=!1,r.addProduct=function(){a.location="/app/#/newProduct"},r.addCompositeProduct=function(){a.location="/app/#/newCompositeProduct"},r.showProduct=function(e){o.put("_d_cPi_gra",e.productId),a.location="/app/#/productDetails"},r.editProduct=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cOi_gra",e.outletId),"true"==e.isComposite?a.location="/app/#/manageCompositeProduct":a.location="/app/#/manageProduct"},r.showProductPriceHistory=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cPiN_gra",e.productName),a.location="/app/#/productPriceHistory"},r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.fetchData())},r.fetchData=function(){i.loadControllerData(),"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(r.productsList=null,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/false").success(function(e){r.data=e.data,null!=r.data.productBeanList&&(r.productsList=r.data.productBeanList),null!=r.data.showProductPriceHistory&&("true"==r.data.showProductPriceHistory?r.gui.showProductPriceHistory=!0:r.gui.showProductPriceHistory=!1),r.comparisonProductsList=r.data.productBeanList,r.lodAllProductsAsynchrnously(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,pageLength:5,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:n.buttonsView})},1),r.dataLoading=!0}).error(function(){a.location="/app/#/login"}),r.lodAllProductsGraph()),n.globalPageLoader=!1},r.lodAllProductsGraph=function(){r.dataLoading=!1,e.post("products/getProductDashBoard/"+o.get("_s_tk_com")).success(function(e){r.data=e.data,r.chartCustomerCount=new CanvasJS.Chart("chartContainerProductCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:r.data.dataPointsCustomerCount}]}),r.chartCustomerCount.render(),r.dataLoadingGraph=!0}).error(function(){})},r.lodAllProductsAsynchrnously=function(){r.dataLoading=!1,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/true").success(function(e){r.data=e.data,r.dataLoading=!0}).error(function(){a.location="/app/#/login"})},r.lodAllProducts=function(){r.dataLoading=!1;for(var e=0;e<r.data.productBeanList.length;e++)c(r.data.productBeanList[e])||r.productsList.push(r.data.productBeanList[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:n.buttonsView})},1),r.dataLoading=!0},r.autoCompleteOptionsProducts={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),r.Product=[],_.filter(r.data.productBeanList,function(e){if(e.productName)return e.productName.toLowerCase().includes(t)||e.brandName.toLowerCase().includes(t)||e.createdDate.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.productName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 30%'>"+e.productName+"</td><td style='width: 20%'>"+e.createdDate+"</td><td style='width: 10%'>"+e.brandName+"</td><td style='width: 10%'>"+e.supplierName+"</td><td style='width: 10%'>"+e.varinatsCount+"</td><td style='width: 10%'>"+e.netPrice+"</td><td style='width: 10%'>"+e.inventoryCount+"</td></tr></tbody></table>")}},itemSelected:function(e){r.selectedItem=e,r.CustomerName=r.selectedItem,r.showProduct(r.selectedItem.item)}},r.sessionValidation()}],EcommerceController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","EcommerceControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){o.ecommerceLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data&&(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),o.globalPageLoader=!1},e.sessionValidation()}],EcomProductsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","EcomProductsControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){o.ecomProductsLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data&&(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),o.globalPageLoader=!1},e.sessionValidation(),e.allowSale=!0,e.addProduct=function(){r.location="/app/#/newProduct"},e.showProduct=function(){r.location="/app/#/productDetails"}}],ExpenseReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","ExpenseReportControllerPreLoad",function(a,e,t,r,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.expenseReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),n.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.expenseReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],HomeController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","HomeControllerPreLoad",function(t,e,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.globalPageLoader=!1,t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.homeBean=s.loadControllerData(),t.outletName=t.homeBean.outletName,t.dataPointsRevenue=t.homeBean.dataPointsRevenue,t.dataPointsSaleCount=t.homeBean.dataPointsSaleCount,t.dataPointsCustomerCount=t.homeBean.dataPointsCustomerCount,t.dataPointsDiscount=t.homeBean.dataPointsDiscount,t.dataPointsBasketSize=t.homeBean.dataPointsBasketSize,t.dataPointsGrossProfit=t.homeBean.dataPointsGrossProfit,t.dataPointsBasketValue=t.homeBean.dataPointsBasketValue,t.dataPointsDiscountPercent=t.homeBean.dataPointsDiscountPercent,t.todayRevenue=t.homeBean.todayRevenue,t.revenuePercentage=t.homeBean.revenuePercentage,t.todaySalesCount=t.homeBean.todaySalesCount,t.salesCountPercentage=t.homeBean.salesCountPercentage,t.todayCustomerCount=t.homeBean.todayCustomerCount,t.customerCountPercentage=t.homeBean.customerCountPercentage,t.todayGrossProfit=t.homeBean.todayGrossProfit,t.grossProfitPercentage=t.homeBean.grossProfitPercentage,t.todayDiscount=t.homeBean.todayDiscount,t.discountPercentage=t.homeBean.discountPercentage,t.todayBasketSize=t.homeBean.todayBasketSize,t.basketSizePercentage=t.homeBean.basketSizePercentage,t.todayBasketValue=t.homeBean.todayBasketValue,t.basketValuePercentage=t.homeBean.basketValuePercentage,t.todayDiscountPec=t.homeBean.todayDiscountPec,t.discountPecPercentage=t.homeBean.discountPecPercentage,t.hideSalesDetails=t.homeBean.hideSalesDetails,t.chartRevenue=new CanvasJS.Chart("chartContainerRevenue",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",backgroundColor:"#F5DEB3",dataPoints:t.dataPointsRevenue}]}),t.chartSaleCount=new CanvasJS.Chart("chartContainerSaleCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",backgroundColor:"#F5DEB3",dataPoints:t.dataPointsSaleCount}]}),t.chartCustomerCount=new CanvasJS.Chart("chartContainerCustomerCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsCustomerCount}]}),t.chartGrossProfit=new CanvasJS.Chart("chartContainerGrossProfit",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsGrossProfit}]}),t.chartDiscount=new CanvasJS.Chart("chartContainerDiscount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsDiscount}]}),t.chartDiscountPercent=new CanvasJS.Chart("chartContainerDiscountPercent",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsDiscountPercent}]}),t.chartBasketValue=new CanvasJS.Chart("chartContainerBasketValue",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsBasketValue}]}),t.chartBasketSize=new CanvasJS.Chart("chartContainerBasketSize",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsBasketSize}]}),t.chartRevenue.render(),t.chartSaleCount.render(),t.chartCustomerCount.render(),t.chartGrossProfit.render(),t.chartDiscount.render(),t.chartDiscountPercent.render(),t.chartBasketValue.render(),t.chartBasketSize.render(),o.globalPageLoader=!1)},t.changeChartType=function(e){t.chart.options.data[0].type=e,t.chart.render()},t.sessionValidation()}],InActivePriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","InActivePriceBookControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.priceBookList=e.data,e.roledId=a.get("_s_tk_rId"),setTimeout(function(){$("#myTable").DataTable({responsive:!0,order:[[6,"Created At"]],paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.addPriceBook=function(){r.location="/app/#/newPriceBook"},e.editPriceBook=function(e){a.put("_e_cPri_gra",e.priceBookId),r.location="/app/#/managePriceBook"},e.sessionValidation()}],InventoryCountActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","InventoryCountActionsControllerPreLoad",function(r,e,a,t,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.disableProcess=!1,r.showConfirmCancelPopup=!1,r.inventoryCountDetailBeansList=[],r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.inventoryCountBean=o.get("_ct_sc_ost"),r.data=c.loadControllerData(),r.fetchData(),"3"!=r.inventoryCountBean.statusId&&"8"!=r.inventoryCountBean.statusId||(r.disableProcess=!0),r.isAdmin())},r.fetchData=function(){if(s.inventoryCountActionsLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=r.data&&"No record found !"!=r.data){r.inventoryCountDetailBeansList=r.data;var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Name / Reference: </label> </h4></div><div class="col-md-2 !important;"><h4>'+r.inventoryCountBean.inventoryCountRefNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Type: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.inventoryCountTypeDesc+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Outlet: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Remarks: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.remarks+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Diff in count: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.countDiff+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Diff in Price: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.priceDiff+' </h4></div> <div class="col-md-6"></div> </div><div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.showCancelInventoryCount=function(){r.showConfirmCancelPopup=!0},r.cancelInventoryCount=function(){r.success=!1,r.error=!1,r.loading=!0,r.inventoryCountBean.statusId="8",r.inventoryCountBean.diliveryDueDate=new Date(r.inventoryCountBean.diliveryDueDate),e.post("inventoryCount/updateInventoryCount/"+r._s_tk_com,r.inventoryCountBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.inventoryCountBean.inventoryCountId=e.data,r.showConfirmCancelPopup=!1,t(function(){r.success=!1,a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.inventoryCountEditProducts=function(){a.location="/app/#/inventoryCountEditProducts"},r.inventoryCountEditDetails=function(){a.location="/app/#/inventoryCountEditDetails"},r.sessionValidation(),s.globalPageLoader=!1}],InventoryCountController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","InventoryCountControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sesssionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"))},e.addInventoryCount=function(){r.location="/app/#/inventoryCountCreate"},e.inventoryCountActions=function(e){a.put("_ct_sc_ost",e),r.location="/app/#/inventoryCountActions"},e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.roleId=a.get("_s_tk_rId"),e.userOutletId=a.get("_s_tk_oId"),e.headOffice=a.get("_s_tk_iho"),e.data=s.loadControllerData(),e.fetchData(),e.isAdmin())},e.isAdmin=function(){return null==e.headOffice||""==e.headOffice.toString()||"true"!=e.headOffice.toString()},e.fetchData=function(){o.inventoryCountLoadedFully=!1,"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.inventoryCountBeansList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.sessionValidation()}],InventoryCountCreateController=["$scope","$filter","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","InventoryCountCreateControllerPreLoad",function(r,e,t,a,o,n,s,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.inventoryCountBean={},r.HHMM=e("date")(new Date,"HH:mm"),r.inventoryCountBean.inventoryCountRefNo="SC-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.data=c.loadControllerData(),r.fetchData(),r.inventoryCountBean.outletId=r.userOutletId,r.inventoryCountBean.inventoryCountTypeId="-1")},r.fetchData=function(){n.inventoryCountCreateLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.inventoryCountTypeBeansList&&(r.inventoryCountTypeBeansList=r.data.inventoryCountTypeBeansList),null!=r.data.auditTransfer&&(r.inventoryCountBean.auditTransfer=r.data.auditTransfer)),n.globalPageLoader=!1},r.addInventoryCount=function(){r.success=!1,r.error=!1,r.loading=!0,r.inventoryCountBean.statusId="1",t.post("inventoryCountCreate/addInventoryCount/"+r._s_tk_com,r.inventoryCountBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.inventoryCountBean.inventoryCountId=e.data,s(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.inventoryCountBean.outletId&&(r.inventoryCountBean.outletName=e.outletName)}),angular.forEach(r.inventoryCountTypeBeansList,function(e,t){e.inventoryCountTypeId==r.inventoryCountBean.inventoryCountTypeId&&(r.inventoryCountBean.inventoryCountTypeDesc=e.inventoryCountTypeDesc)}),o.put("_ct_sc_ost",r.inventoryCountBean),a.location=e.layOutPath},3e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==r.responseStatus?(r.warning=!0,r.warningMessage=e.data):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],InventoryCountDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","InventoryCountDetailsControllerPreLoad",function(t,n,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.inventoryCountDetailBean={},n.delInventoryCountDetailBean={},n.productVariantMap=[],n.productMap=[],n.productMap=[],n.allProductMap=[],n.allProductVariantMap=[],n.productSKU="",n.skudisable=!1,n.inventoryCountDetailBeansList=[],n.hideRefValues=!1,n.inputTypeScan=!0,n.counter=1,n.sessionValidation=function(){i.validate()&&(n._s_tk_com=o.get("_s_tk_com"),n.inventoryCountBean=o.get("_ct_sc_ost"),n.inventoryCountBean.itemCountExp=0,n.inventoryCountBean.itemCountCounted=0,"full"==n.inventoryCountBean.inventoryCountTypeDesc.toString().toLowerCase()?n.isFull=!0:n.isFull=!1,n.data=c.loadControllerData(),n.fetchData())},n.fetchData=function(){if(s.inventoryCountDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data){if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}if(null!=n.data.allProductVariantBeansList&&(n.allProductVariantBeansList=n.data.allProductVariantBeansList),null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap),null!=n.data.allProductVariantMap&&(n.allProductVariantMap=n.data.allProductVariantMap),null!=n.data.allProductMap&&(n.allProductMap=n.data.allProductMap),null!=n.data.allProductBeansList){n.allProductBeansList=n.data.allProductBeansList;for(e=0;e<n.allProductVariantBeansList.length;e++)n.allProductBeansList.push(n.allProductVariantBeansList[e]);n.hideTransferInfo=!1}else n.hideTransferInfo=!0;if(null!=n.data.inventoryCountDetailBeansList)n.inventoryCountDetailBeansList=n.data.inventoryCountDetailBeansList;else if("FULL"==n.inventoryCountBean.inventoryCountTypeDesc.toString()){for(e=0;e<n.productBeansList.length;e++)"0"!=n.productBeansList[e].currentInventory&&(n.productVariantBean=n.productBeansList[e],n.inventoryCountDetailBean.countedProdQty=0,n.checkProductStatus(),n.productVariantBean=null,n.inventoryCountDetailBean.countedProdQty=null);n.addInventoryCountDetail()}}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.inventoryCountDetailBean.countedProdQty;if("true"==n.productVariantBean.isVariant.toString())"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct(),n.hit++;else if("true"==n.productVariantBean.auditTransfer)for(var t=0;t<n.allProductVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.allProductVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.allProductVariantBeansList[t]),n.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}else for(t=0;t<n.productVariantBeansList.length;t++){r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.calculateItemCount()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.inventoryCountDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(n.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=n.inventoryCountDetailBeansList.indexOf(e);n.inventoryCountDetailBeansList.splice(r,1),n.inventoryCountDetailBeansList.unshift(o),n.arrangeOrder(),n.dualEntry=!0}}):angular.forEach(n.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(n.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=n.inventoryCountDetailBeansList.indexOf(e);n.inventoryCountDetailBeansList.splice(r,1),n.inventoryCountDetailBeansList.unshift(o),n.arrangeOrder(),n.dualEntry=!0}}),1!=n.dualEntry&&(n.inventoryCountDetailBean.productVariantId=a.productVariantId,n.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.expProdQty="0":n.inventoryCountDetailBean.expProdQty=a.currentInventory,n.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(n.inventoryCountDetailBean.retailPriceExp="",n.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),n.inventoryCountDetailBean.retailPriceExp=n.inventoryCountDetailBean.retailPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.retailPriceCounted)&&(n.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(n.inventoryCountDetailBean.supplyPriceExp="",n.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),n.inventoryCountDetailBean.supplyPriceExp=n.inventoryCountDetailBean.supplyPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.supplyPriceCounted)&&(n.inventoryCountDetailBean.supplyPriceCounted="0"),n.inventoryCountDetailBean.order=n.counter,n.counter++,n.inventoryCountDetailBean.inventoryCountId=n.inventoryCountBean.inventoryCountId,null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(n.inventoryCountDetailBean.countedProdQty)>parseInt(n.inventoryCountDetailBean.expProdQty)?n.inventoryCountDetailBean.auditTransfer=!0:n.inventoryCountDetailBean.auditTransfer=!1,n.inventoryCountDetailBeansList.unshift(n.inventoryCountDetailBean),n.dualEntry=!1)):(n.inventoryCountDetailBean.productVariantId=a.productVariantId,n.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.expProdQty="0":n.inventoryCountDetailBean.expProdQty=a.currentInventory,n.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(n.inventoryCountDetailBean.retailPriceExp="",n.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),n.inventoryCountDetailBean.retailPriceExp=n.inventoryCountDetailBean.retailPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.retailPriceCounted)&&(n.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(n.inventoryCountDetailBean.supplyPriceExp="",n.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),n.inventoryCountDetailBean.supplyPriceExp=n.inventoryCountDetailBean.supplyPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.supplyPriceCounted)&&(n.inventoryCountDetailBean.supplyPriceCounted="0"),n.inventoryCountDetailBean.order=n.counter,n.counter++,n.inventoryCountDetailBean.inventoryCountId=n.inventoryCountBean.inventoryCountId,null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(n.inventoryCountDetailBean.countedProdQty)>parseInt(n.inventoryCountDetailBean.expProdQty)?n.inventoryCountDetailBean.auditTransfer=!0:n.inventoryCountDetailBean.auditTransfer=!1,n.inventoryCountDetailBeansList.unshift(n.inventoryCountDetailBean)),n.calculateTotal(n.productVariantBean),n.inventoryCountDetailBean={},n.airportName=[]},n.changeQuantity=function(e){var t=!1;if("true"==e.isProduct.toString()){for(var r=0;r<n.productBeansList.length;r++){var a=null;if(e.productVariantId==n.productBeansList[r].productVariantId){a=angular.copy(n.productBeansList[r]),n.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<n.allProductBeansList.length;r++){a=null;if(e.productVariantId==n.allProductBeansList[r].productVariantId){a=angular.copy(n.allProductBeansList[r]),n.calculateTotal(a),t=!0;break}}}else{for(r=0;r<n.productVariantBeansList.length;r++){a=null;if(e.productVariantId==n.productVariantBeansList[r].productVariantId){a=angular.copy(n.productVariantBeansList[r]),n.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<n.allProductVariantBeansList.length;r++){a=null;if(e.productVariantId==n.allProductVariantBeansList[r].productVariantId){a=angular.copy(n.allProductVariantBeansList[r]),n.calculateTotal(a),t=!0;break}}}n.calculateItemCount()},n.calculateTotal=function(r){angular.forEach(n.inventoryCountDetailBeansList,function(e,t){e.productVariantId==r.productVariantId&&e.isProduct==r.isProduct&&(null!=e.retailPriceExp&&(e.retailPriceExp=r.retailPriceExclTax*e.expProdQty,isNaN(e.retailPriceExp)&&(e.retailPriceExp="0")),null!=e.retailPriceExp&&(e.retailPriceCounted=r.retailPriceExclTax*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")),null!=e.supplyPriceExp&&(e.supplyPriceExp=r.supplyPriceExclTax*e.expProdQty,isNaN(e.supplyPriceExp)&&(e.supplyPriceExp="0")),null!=e.supplyPriceCounted&&(e.supplyPriceCounted=r.supplyPriceExclTax*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")),null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,e.countDiff=e.countedProdQty-e.expProdQty,e.priceDiff=e.retailPriceCounted-e.retailPriceExp)})},n.calculateItemCount=function(){if(n.inventoryCountBean.itemCountCounted=0,n.inventoryCountBean.itemCountExp=0,n.inventoryCountBean.countDiff=0,n.inventoryCountBean.priceDiff=0,n.inventoryCountBean.retailPriceExp=0,n.inventoryCountBean.retailPriceCounted=0,null!=n.inventoryCountDetailBeansList)for(var e=0;e<n.inventoryCountDetailBeansList.length;e++)n.inventoryCountBean.itemCountCounted=parseInt(n.inventoryCountBean.itemCountCounted)+parseInt(n.inventoryCountDetailBeansList[e].countedProdQty),isNaN(n.inventoryCountBean.itemCountCounted)&&(n.inventoryCountBean.itemCountCounted="0"),n.inventoryCountBean.itemCountExp=parseInt(n.inventoryCountBean.itemCountExp)+parseInt(n.inventoryCountDetailBeansList[e].expProdQty),isNaN(n.inventoryCountBean.itemCountExp)&&(n.inventoryCountBean.itemCountExp="0"),n.inventoryCountBean.countDiff=parseInt(n.inventoryCountBean.countDiff)+parseInt(n.inventoryCountDetailBeansList[e].countDiff),isNaN(n.inventoryCountBean.countDiff)&&(n.inventoryCountBean.countDiff="0"),n.inventoryCountBean.priceDiff=parseInt(n.inventoryCountBean.priceDiff)+parseInt(n.inventoryCountDetailBeansList[e].priceDiff),isNaN(n.inventoryCountBean.priceDiff)&&(n.inventoryCountBean.priceDiff="0"),n.inventoryCountBean.retailPriceExp=parseInt(n.inventoryCountBean.retailPriceExp)+parseInt(n.inventoryCountDetailBeansList[e].retailPriceExp),isNaN(n.inventoryCountBean.retailPriceExp)&&(n.inventoryCountBean.retailPriceExp="0"),n.inventoryCountBean.retailPriceCounted=parseInt(n.inventoryCountBean.retailPriceCounted)+parseInt(n.inventoryCountDetailBeansList[e].retailPriceCounted),isNaN(n.inventoryCountBean.retailPriceCounted)&&(n.inventoryCountBean.retailPriceCounted="0"),n.inventoryCountBean.supplyPriceExp=parseInt(n.inventoryCountBean.supplyPriceExp)+parseInt(n.inventoryCountDetailBeansList[e].supplyPriceExp),isNaN(n.inventoryCountBean.supplyPriceExp)&&(n.inventoryCountBean.supplyPriceExp="0"),n.inventoryCountBean.supplyPriceCounted=parseInt(n.inventoryCountBean.supplyPriceCounted)+parseInt(n.inventoryCountDetailBeansList[e].supplyPriceCounted),isNaN(n.inventoryCountBean.supplyPriceCounted)&&(n.inventoryCountBean.supplyPriceCounted="0"),null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(n.inventoryCountDetailBeansList[e].countedProdQty)>parseInt(n.inventoryCountDetailBeansList[e].expProdQty)?n.inventoryCountDetailBeansList[e].auditTransfer=!0:n.inventoryCountDetailBeansList[e].auditTransfer=!1},n.showConfirmDelete=function(e){n.delInventoryCountDetailBean={},n.delInventoryCountDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delInventoryCountDetail=function(){void 0!==n.delInventoryCountDetailBean.inventoryCountDetailId&&(n.error=!1,n.loading=!0,e.post("inventoryCountDetails/deleteInventoryCountDetail/"+n._s_tk_com,n.delInventoryCountDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==n.delInventoryCountDetailBean.productVariantId&&e.isProduct==n.delInventoryCountDetailBean.isProduct){var r=n.inventoryCountDetailBeansList.indexOf(e);n.inventoryCountDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delInventoryCountDetailBean={},n.arrangeOrder()},n.arrangeOrder=function(){if(n.counter=1,0<n.inventoryCountDetailBeansList.length)for(var e=0;e<n.inventoryCountDetailBeansList.length;e++)n.inventoryCountDetailBeansList[e].order=n.counter,n.counter++},n.checkInventoryCountDetailList=function(){if(n.isFull=!1){if(0<n.inventoryCountDetailBeansList.length){for(var e=0;e<n.inventoryCountDetailBeansList.length;e++)if(""==n.inventoryCountDetailBeansList[e].countedProdQty||null==n.inventoryCountDetailBeansList[e].countedProdQty)return!1;return!0}return!1}return!0},n.addInventoryCountDetail=function(){0<n.inventoryCountDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,n.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(n.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateInventoryCountDetail/"+n._s_tk_com,n.inventoryCountBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,r(function(){n.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==n.responseStatus?(n.warning=!0,n.warningMessage=e.data):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.addAndUpdateInventoryCountDetail=function(){0<n.inventoryCountDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,n.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(n.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateQtyAndUpdateInventoryCountDetail/"+n._s_tk_com,n.inventoryCountBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,o.put("_ct_sc_ost",""),r(function(){n.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==n.responseStatus?(n.warning=!0,n.warningMessage=e.data):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.inventoryCountDetailBean.countedProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.inventoryCountDetailBean.countedProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):null!=n.allProductVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.inventoryCountDetailBean.countedProdQty=1,n.productVariantBean=n.allProductVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],InventoryCountEditDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","InventoryCountEditDetailsControllerPreLoad",function(t,n,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.inventoryCountDetailBean={},n.delInventoryCountDetailBean={},n.inventoryCountDetailBeansList=[],n.productVariantMap=[],n.productMap=[],n.productMap=[],n.allProductMap=[],n.allProductVariantMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.counter=1,n.allCounts=function(){alert("all Counts")},n.matchedCounts=function(){alert("matched Counts")},n.sessionValidation=function(){i.validate()&&(n._s_tk_com=o.get("_s_tk_com"),n.inventoryCountBean=o.get("_ct_sc_ost"),n.inventoryCountBean.itemCountExp=0,n.inventoryCountBean.itemCountCounted=0,n.data=c.loadControllerData(),n.fetchData(),"full"==n.inventoryCountBean.inventoryCountTypeDesc.toString().toLowerCase()?n.isFull=!0:n.isFull=!1)},n.fetchData=function(){if(s.inventoryCountEditDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data){if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}if(null!=n.data.allProductVariantBeansList&&(n.allProductVariantBeansList=n.data.allProductVariantBeansList),null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap),null!=n.data.allProductVariantMap&&(n.allProductVariantMap=n.data.allProductVariantMap),null!=n.data.allProductMap&&(n.allPproductMap=n.data.allProductMap),null!=n.data.allProductBeansList){n.allProductBeansList=n.data.allProductBeansList;for(e=0;e<n.allProductVariantBeansList.length;e++)n.allProductBeansList.push(n.allProductVariantBeansList[e]);n.hideTransferInfo=!1}else n.hideTransferInfo=!0;null!=n.data.inventoryCountDetailBeansList&&(n.inventoryCountDetailBeansList=n.data.inventoryCountDetailBeansList,n.calculateItemCount(),n.changeQuantity(n.inventoryCountDetailBeansList[0]))}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.inventoryCountDetailBean.countedProdQty;if("true"==n.productVariantBean.isVariant.toString())"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct(),n.hit++;else if("true"==n.productVariantBean.auditTransfer)for(var t=0;t<n.allProductVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.allProductVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.allProductVariantBeansList[t]),n.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}else for(t=0;t<n.productVariantBeansList.length;t++){r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.auditTransfer="true":n.inventoryCountDetailBean.auditTransfer="false",n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.calculateItemCount()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.inventoryCountDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(n.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=n.inventoryCountDetailBeansList.indexOf(e);n.inventoryCountDetailBeansList.splice(r,1),n.inventoryCountDetailBeansList.unshift(o),n.arrangeOrder(),n.dualEntry=!0}}):angular.forEach(n.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(n.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=n.inventoryCountDetailBeansList.indexOf(e);n.inventoryCountDetailBeansList.splice(r,1),n.inventoryCountDetailBeansList.unshift(o),n.arrangeOrder(),n.dualEntry=!0}}),1!=n.dualEntry&&(n.inventoryCountDetailBean.productVariantId=a.productVariantId,n.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.expProdQty="0":n.inventoryCountDetailBean.expProdQty=a.currentInventory,n.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(n.inventoryCountDetailBean.retailPriceExp="",n.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),n.inventoryCountDetailBean.retailPriceExp=n.inventoryCountDetailBean.retailPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.retailPriceCounted)&&(n.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(n.inventoryCountDetailBean.supplyPriceExp="",n.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),n.inventoryCountDetailBean.supplyPriceExp=n.inventoryCountDetailBean.supplyPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.supplyPriceCounted)&&(n.inventoryCountDetailBean.supplyPriceCounted="0"),n.inventoryCountDetailBean.order=n.counter,n.counter++,n.inventoryCountDetailBean.inventoryCountId=n.inventoryCountBean.inventoryCountId,null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(n.inventoryCountDetailBean.countedProdQty)>parseInt(n.inventoryCountDetailBean.expProdQty)?n.inventoryCountDetailBean.auditTransfer=!0:n.inventoryCountDetailBean.auditTransfer=!1,n.inventoryCountDetailBeansList.unshift(n.inventoryCountDetailBean),n.dualEntry=!1)):(n.inventoryCountDetailBean.productVariantId=a.productVariantId,n.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==n.productVariantBean.auditTransfer?n.inventoryCountDetailBean.expProdQty="0":n.inventoryCountDetailBean.expProdQty=a.currentInventory,n.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(n.inventoryCountDetailBean.retailPriceExp="",n.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),n.inventoryCountDetailBean.retailPriceExp=n.inventoryCountDetailBean.retailPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.retailPriceCounted)&&(n.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(n.inventoryCountDetailBean.supplyPriceExp="",n.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),n.inventoryCountDetailBean.supplyPriceExp=n.inventoryCountDetailBean.supplyPriceExp*n.inventoryCountDetailBean.expProdQty),n.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*n.inventoryCountDetailBean.countedProdQty,isNaN(n.inventoryCountDetailBean.supplyPriceCounted)&&(n.inventoryCountDetailBean.supplyPriceCounted="0"),n.inventoryCountDetailBean.order=n.counter,n.counter++,n.inventoryCountDetailBean.inventoryCountId=n.inventoryCountBean.inventoryCountId,null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(n.inventoryCountDetailBean.countedProdQty)>parseInt(n.inventoryCountDetailBean.expProdQty)?n.inventoryCountDetailBean.auditTransfer=!0:n.inventoryCountDetailBean.auditTransfer=!1,n.inventoryCountDetailBeansList.unshift(n.inventoryCountDetailBean)),n.calculateTotal(n.productVariantBean),n.inventoryCountDetailBean={},n.arrangeOrder(),n.airportName=[]},n.changeQuantity=function(e){var t=!1;if("true"==e.isProduct.toString()){for(var r=0;r<n.productBeansList.length;r++){var a=null;if(e.productVariantId==n.productBeansList[r].productVariantId){a=angular.copy(n.productBeansList[r]),n.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<n.allProductBeansList.length;r++){a=null;if(e.productVariantId==n.allProductBeansList[r].productVariantId){a=angular.copy(n.allProductBeansList[r]),n.calculateTotal(a),t=!0;break}}}else{for(r=0;r<n.productVariantBeansList.length;r++){a=null;if(e.productVariantId==n.productVariantBeansList[r].productVariantId){a=angular.copy(n.productVariantBeansList[r]),n.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<n.allProductVariantBeansList.length;r++){a=null;if(e.productVariantId==n.allProductVariantBeansList[r].productVariantId){a=angular.copy(n.allProductVariantBeansList[r]),n.calculateTotal(a),t=!0;break}}}n.calculateItemCount()},n.calculateTotal=function(r){angular.forEach(n.inventoryCountDetailBeansList,function(e,t){e.productVariantId==r.productVariantId&&e.isProduct==r.isProduct&&(null!=e.retailPriceExp&&(e.retailPriceExp=r.retailPriceExclTax*e.expProdQty,isNaN(e.retailPriceExp)&&(e.retailPriceExp="0")),null!=e.retailPriceExp&&(e.retailPriceCounted=r.retailPriceExclTax*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")),null!=e.supplyPriceExp&&(e.supplyPriceExp=r.supplyPriceExclTax*e.expProdQty,isNaN(e.supplyPriceExp)&&(e.supplyPriceExp="0")),null!=e.supplyPriceCounted&&(e.supplyPriceCounted=r.supplyPriceExclTax*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")),null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,e.countDiff=e.countedProdQty-e.expProdQty,e.priceDiff=e.retailPriceCounted-e.retailPriceExp)})},n.calculateItemCount=function(){if(n.inventoryCountBean.itemCountCounted=0,n.inventoryCountBean.itemCountExp=0,n.inventoryCountBean.countDiff=0,n.inventoryCountBean.priceDiff=0,n.inventoryCountBean.retailPriceExp=0,n.inventoryCountBean.retailPriceCounted=0,null!=n.inventoryCountDetailBeansList)for(var e=0;e<n.inventoryCountDetailBeansList.length;e++)n.inventoryCountBean.itemCountCounted=parseInt(n.inventoryCountBean.itemCountCounted)+parseInt(n.inventoryCountDetailBeansList[e].countedProdQty),isNaN(n.inventoryCountBean.itemCountCounted)&&(n.inventoryCountBean.itemCountCounted="0"),n.inventoryCountBean.itemCountExp=parseInt(n.inventoryCountBean.itemCountExp)+parseInt(n.inventoryCountDetailBeansList[e].expProdQty),isNaN(n.inventoryCountBean.itemCountExp)&&(n.inventoryCountBean.itemCountExp="0"),n.inventoryCountBean.countDiff=parseInt(n.inventoryCountBean.countDiff)+parseInt(n.inventoryCountDetailBeansList[e].countDiff),isNaN(n.inventoryCountBean.countDiff)&&(n.inventoryCountBean.countDiff="0"),n.inventoryCountBean.priceDiff=parseInt(n.inventoryCountBean.priceDiff)+parseInt(n.inventoryCountDetailBeansList[e].priceDiff),isNaN(n.inventoryCountBean.priceDiff)&&(n.inventoryCountBean.priceDiff="0"),n.inventoryCountBean.retailPriceExp=parseInt(n.inventoryCountBean.retailPriceExp)+parseInt(n.inventoryCountDetailBeansList[e].retailPriceExp),isNaN(n.inventoryCountBean.retailPriceExp)&&(n.inventoryCountBean.retailPriceExp="0"),n.inventoryCountBean.retailPriceCounted=parseInt(n.inventoryCountBean.retailPriceCounted)+parseInt(n.inventoryCountDetailBeansList[e].retailPriceCounted),isNaN(n.inventoryCountBean.retailPriceCounted)&&(n.inventoryCountBean.retailPriceCounted="0"),n.inventoryCountBean.supplyPriceExp=parseInt(n.inventoryCountBean.supplyPriceExp)+parseInt(n.inventoryCountDetailBeansList[e].supplyPriceExp),isNaN(n.inventoryCountBean.supplyPriceExp)&&(n.inventoryCountBean.supplyPriceExp="0"),n.inventoryCountBean.supplyPriceCounted=parseInt(n.inventoryCountBean.supplyPriceCounted)+parseInt(n.inventoryCountDetailBeansList[e].supplyPriceCounted),isNaN(n.inventoryCountBean.supplyPriceCounted)&&(n.inventoryCountBean.supplyPriceCounted="0"),null!=n.inventoryCountBean.auditTransfer&&1==n.inventoryCountBean.auditTransfer&&parseInt(n.inventoryCountDetailBeansList[e].countedProdQty)>parseInt(n.inventoryCountDetailBeansList[e].expProdQty)?n.inventoryCountDetailBeansList[e].auditTransfer=!0:n.inventoryCountDetailBeansList[e].auditTransfer=!1},n.showConfirmDelete=function(e){n.delInventoryCountDetailBean={},n.delInventoryCountDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delInventoryCountDetail=function(){void 0!==n.delInventoryCountDetailBean.inventoryCountDetailId&&(n.error=!1,n.loading=!0,e.post("inventoryCountDetails/deleteInventoryCountDetail/"+n._s_tk_com,n.delInventoryCountDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==n.delInventoryCountDetailBean.productVariantId&&e.isProduct==n.delInventoryCountDetailBean.isProduct){var r=n.inventoryCountDetailBeansList.indexOf(e);n.inventoryCountDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delInventoryCountDetailBean={},n.arrangeOrder()},n.arrangeOrder=function(){if(n.counter=1,0<n.inventoryCountDetailBeansList.length)for(var e=0;e<n.inventoryCountDetailBeansList.length;e++)n.inventoryCountDetailBeansList[e].order=n.counter,n.counter++},n.checkInventoryCountDetailList=function(){if(0<n.inventoryCountDetailBeansList.length){for(var e=0;e<n.inventoryCountDetailBeansList.length;e++)if(""==n.inventoryCountDetailBeansList[e].countedProdQty||null==n.inventoryCountDetailBeansList[e].countedProdQty)return!1;return!0}return!1},n.addInventoryCountDetail=function(){0<n.inventoryCountDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,n.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(n.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateInventoryCountDetail/"+n._s_tk_com,n.inventoryCountBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,o.put("_ct_sc_ost",""),r(function(){n.success=!1},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==n.responseStatus?(n.warning=!0,n.warningMessage=e.data):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.addAndUpdateInventoryCountDetail=function(){0<n.inventoryCountDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,n.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(n.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateQtyAndUpdateInventoryCountDetail/"+n._s_tk_com,n.inventoryCountBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,o.put("_ct_sc_ost",""),r(function(){n.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==n.responseStatus?(n.warning=!0,n.warningMessage=e.data):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.inventoryCountDetailBean.countedProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.inventoryCountDetailBean.countedProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):null!=n.allProductVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.inventoryCountDetailBean.countedProdQty=1,n.productVariantBean=n.allProductVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],InventoryDetailReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","InventoryDetailReportControllerPreLoad",function(a,e,o,t,n,r,s,i,c,l,u){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,a.inventoryReportSuccess=!1,a.inventoryReportError=!1,a.inventoryReportError=!1,a.inventoryReportBean={},a.inventoryReport=[],a.outlets=[],a.outletSelected=n.inventoryReportOutletName,a.sesssionValidation=function(){r.validate()&&(a._s_tk_com=t.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){if("NORECORDFOUND"==a.data||"No record found !"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else if(null!=a.data){if(a.hideSalesDetails=a.data.hideSalesDetails,null!=a.data.inventoryReportBeansList&&(a.inventoryReport=a.data.inventoryReportBeansList,0<a.inventoryReport.length)){for(var e=0,t=0,r=0;r<a.inventoryReport.length;r++)e+=parseFloat(a.inventoryReport[r].currentStock),t+=parseFloat(a.inventoryReport[r].stockValue);a.totalCurrentStock=e+"",a.totalCurrentValue=t+""}null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans)}n.globalPageLoader=!1},a.changeOutletName=function(){n.inventoryReportOutletName=a.outletName,c.reload()},a.sesssionValidation()}],InventoryReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","InventoryReportControllerPreLoad",function(a,e,o,t,n,r,s,i,c,l,u){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,a.inventoryReportSuccess=!1,a.inventoryReportError=!1,a.inventoryReportError=!1,a.inventoryReportBean={},a.inventoryReport=[],a.outlets=[],a.outletSelected=n.inventoryReportOutletName,a.sesssionValidation=function(){r.validate()&&(a._s_tk_com=t.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){if("NORECORDFOUND"==a.data||"No record found !"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else if(null!=a.data){if(a.hideSalesDetails=a.data.hideSalesDetails,null!=a.data.inventoryReportBeansList&&(a.inventoryReport=a.data.inventoryReportBeansList,0<a.inventoryReport.length)){for(var e=0,t=0,r=0;r<a.inventoryReport.length;r++)e+=parseFloat(a.inventoryReport[r].currentStock),t+=parseFloat(a.inventoryReport[r].stockValue);a.totalCurrentStock=e+"",a.totalCurrentValue=t+""}null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans)}n.globalPageLoader=!1},a.changeOutletName=function(){n.inventoryReportOutletName=a.outletName,c.reload()},a.sesssionValidation()}],InventoryReportProductWiseController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","InventoryReportProductWiseControllerPreLoad",function(e,t,r,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.inventoryReportSuccess=!1,e.inventoryReportError=!1,e.inventoryReportError=!1,e.inventoryReportBean={},e.inventoryReport=[],e.outlets=[],e.outletSelected=o.inventoryReportOutletName,e.sesssionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=u.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(null!=e.data.productBeanList&&(e.productBeanList=e.data.productBeanList),null!=e.data.outletBeans&&(e.outlets=e.data.outletBeans)),o.globalPageLoader=!1},e.changeOutletName=function(){o.inventoryReportOutletName=e.outletName,c.reload()},e.sesssionValidation()}],LayoutDesignController=["$timeout","$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","LayoutDesignControllerPreLoad",function(r,a,o,t,n,e,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,a.layoutProducts=[],a.layoutProduct={},a.sesssionValidation=function(){i.validate()&&(a._s_tk_com=e.get("_s_tk_com"),a.layoutDesignControllerBean=c.loadControllerData(),a.allProducts=a.layoutDesignControllerBean.productsBean,s.layoutDesignLoadedFully=!1,a.showProductLayout(),localforage.getItem("_s_tk_sell").then(function(e){a.InvoiceMainBean=e,""!=a.InvoiceMainBean&&void 0!==a.InvoiceMainBean||(a.InvoiceMainBean={})}))},a.allProductsSelected=[],a.saveLayout=function(){a.doneLoading=!0;for(var e=0;e<a.layoutProducts.length;e++)for(var t=0;t<a.allProducts.length;t++)a.allProducts[t].productId===a.layoutProducts[e].id&&(a.allProducts[t].display="true",a.allProductsSelected[a.allProducts[t]]);a.success=!1,o.post("layoutDesign/saveLayout/"+a._s_tk_com,a.allProducts).success(function(e){a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.success=!0,r(function(){a.success=!1},1e3),a.doneLoading=!1,a.successMessage=e.data):"INVALIDSESSION"==a.responseStatus||"SYSTEMBUSY"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,n.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){a.loading=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.showProductLayout=function(){for(var e=0;e<a.allProducts.length;e++)"true"===a.allProducts[e].display&&(a.layoutProduct={},a.layoutProduct.productName=a.allProducts[e].productName,a.layoutProduct.id=a.allProducts[e].productId,a.layoutProducts.push(a.layoutProduct));for(e=a.allProducts.length;e<40-a.allProductsSelected.length;e++)a.layoutProduct={},a.layoutProduct.productName="",a.layoutProduct.id="dummy"+e,a.layoutProducts.push(a.layoutProduct);s.globalPageLoader=!1},a.addProduct=function(e){a.layoutProduct={},a.layoutProduct.id=e.productId,a.layoutProduct.productName=e.productName,a.layoutProducts.push(a.layoutProduct);for(var t=0;t<a.allProducts.length;t++)a.allProducts[t].productId==e.productId&&(a.allProducts[t].display="true")},a.removeProduct=function(e){for(var t=0;t<a.layoutProducts.length;t++)a.layoutProducts[t].id==e.id&&a.layoutProducts.splice(t,1);for(t=0;t<a.allProducts.length;t++)a.allProducts[t].productId==e.id&&(a.allProducts[t].display="false")},a.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),a.productVariantsBeans=[],_.filter(a.allProducts,function(e){return e.productName.toLowerCase().includes(t)&&"true"!=e.display})},renderItem:function(e){return{value:e.productName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.productName+"</td><td style='width: 10%'>"+e.retailPriceExclTax+"</td></tr></tbody></table>")}},itemSelected:function(e){a.selectedItem=e,a.addProduct(a.selectedItem.item),a.airportName=[]}},a.sesssionValidation()}],LoginController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService",function(t,r,a,o,n,s){n.MainSideBarhideit=!0,n.MainHeaderideit=!0,t.loading=!1,t.error=!1,t.userBean={},n.IsLoggedIn=!1,n.isDisabled=!1,s.setSession(""),o.put("_s_tk_com",""),o.put("email",""),o.put("menuMap",""),o.put("isLogin",""),o.put("EmployeeInfo",""),o.put("isUpdateCall",""),o.put("CompanyInfo",""),o.put("isCompanyUpdateCall",""),o.put("WorkplaceInfo",""),o.put("isWorkplaceUpdateCall",""),o.put("departmentsInfo",""),o.put("invoiceNo",""),o.put("ScheduleInfo",""),o.put("isScheduleUpdateCall",""),o.put("ScheduleEmployeesListInfo",""),o.put("ticketBean",""),o.put("ticketActivities",""),o.put("_hirearchy_comp_Id",!1),n.shiftProcessing=!1,o.put("shiftProcessing",n.shiftProcessing),n.locationProcessing=!1,o.put("locationProcessing",n.locationProcessing),n.employeeProcessing=!1,o.put("employeeProcessing",n.employeeProcessing),n.payRollProcessing=!1,o.put("payRollProcessing",n.payRollProcessing),n.reportProcessing=!1,o.put("reportProcessing",n.reportProcessing),n.dashBoardProcessing=!1,o.put("dashBoardProcessing",n.dashBoardProcessing),n.timeLoggingProcessing=!1,o.put("timeLoggingProcessing",n.timeLoggingProcessing),n.supportProcessing=!1,o.put("supportProcessing",n.supportProcessing),n.personalInfoProcessing=!1,o.put("personalInfoProcessing",n.personalInfoProcessing),o.put("_Orig_comp_Id",""),t.systemBusy="System is Busy Please try again",t.manage="Shop",t.worker="Vitals",t.signIn="Sign In",t.enterYourDetailToStartYourSession="Enter your details to start your session",t.signInAsaDifferentUser="Or sign in as a different user",t.emailPlaceholder="Email...",t.PasswordPlaceholder="Password...",t.LoginButtonText="LOGIN",t.LoginText="LOGIN",t.requireLogin="Require Login";var i=["skin-blue","skin-black","skin-red","skin-yellow","skin-purple","skin-green","skin-blue-light","skin-black-light","skin-red-light","skin-yellow-light","skin-purple-light","skin-green-light"];t.changeSkinChange=function(e){$.each(i,function(e){$("body").removeClass(i[e])}),$("body").addClass(e),function(e,t){"undefined"!=typeof Storage?localStorage.setItem(e,t):window.alert("Please use a modern browser to properly view this template!")}("skin",e)},t.clearFields=function(){t.userBean={}},t.changeSkinChange("skin-purple-light"),t.doLogin=function(e){n.isDisabled=!0,t.loading=!0,void 0!==t.userBean.email&&void 0!==t.userBean.password&&r.post("login/doLogin/",e).success(function(e){n.online=!0,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.loginSUccessFUll(e):("SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||t.responseStatus,t.loading=!1,t.error=!0,t.errorMessage=e.data,n.isDisabled=!1)}).error(function(){localforage.getItem("kk_vv").then(function(e){n.userMap=e,window.atob(n.userMap[t.userBean.email])==t.userBean.password?(n.online=!1,s.setUser(t.userBean.email),n.IsSuperUser=!0,n.IsManager=!1,a.location="/app/#/sell"):(t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy,n.isDisabled=!1)})})},t.loginSUccessFUll=function(e){o.put("_s_tk_com",""),o.put("_s_tk_rId",""),o.put("_s_tk_oId",""),o.put("_s_tk_iho",""),o.put("_s_tk_rId",e.data.userRole),o.put("_s_tk_oId",e.data.outletId),o.put("_s_tk_iho",e.data.isHeadOffice),o.put("_s_tk_com",e.data.sessionId),n.userRole=o.get("_s_tk_rId"),s.setSession(e.data.sessionId),o.put("userName",e.data.userName),o.put("email",t.userBean.email),o.put("companyImagePath",e.data.companyImagePath),o.put("termsAndConditions",e.data.termsAndConditions),s.setUser(t.userBean.email),o.put("countNotifications",e.data.countNotifications),n.showNotofications=!1,n.userName=e.data.userName,n.userId=e.data.userId,localforage.setItem("kk_vv",e.data.userMap),o.put("menuMap",""),o.put("menuMap",e.data.mapMenu),n.menuMap=e.data.mapMenu,3==e.data.userRole?(n.IsManager=!0,n.IsSuperUser=!1):(1==e.data.userRole?n.IsSuperUser=!0:n.IsSuperUser=!1,n.IsManager=!1),null!=e.data.countNotifications?n.countNotifications=e.data.countNotifications:n.countNotifications=null,o.put("IsSuperUser",n.IsSuperUser),o.put("IsManager",n.IsManager),n.IsLoggedIn=!0,o.put("isLogin",n.IsLoggedIn),a.location=e.layOutPath,n.userImage="/app/resources/dist/img/avatar5.png"},t.validator=function(e){return e.length<1}}],LoyaltyController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","LoyaltyControllerPreLoad",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loyaltySuccess=!1,t.loyaltyError=!1,t.companyLoyalty={},t.gui={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.loyaltyLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.companyLoyalty=t.data,"true"==t.companyLoyalty.loyaltyEnabled?t.gui.loyaltyEnabled=!0:t.gui.loyaltyEnabled=!1,"true"==t.companyLoyalty.loyaltyBonusEnabled?t.gui.loyaltyBonusEnabled=!0:t.gui.loyaltyBonusEnabled=!1),o.globalPageLoader=!1},t.updateCompanyLoyalty=function(){if(t.loyaltySuccess=!1,t.loyaltyError=!1,t.companyLoyaltyBean=angular.copy(t.companyLoyalty),parseInt(t.companyLoyaltyBean.loyaltyInvoiceAmount)<=parseInt(t.companyLoyaltyBean.loyaltyAmount))return t.loyaltyError=!0,void(t.loyaltyErrorMessage="Loyalty invoice amount should be greater than Loyalty amount.");t.loading=!0,t.companyLoyaltyBean.loyaltyEnabled=t.gui.loyaltyEnabled,t.companyLoyaltyBean.loyaltyBonusEnabled=t.gui.loyaltyBonusEnabled,e.post("loyalty/updateCompanyLoyalty/"+t._s_tk_com,t.companyLoyaltyBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.loyaltySuccess=!0,t.loyaltySuccessMessage=e.data,n(function(){t.loyaltySuccess=!1},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.loyaltyError=!0,t.loyaltyErrorMessage=e.data,r.location=e.layOutPath):(t.loyaltyError=!0,t.loyaltyErrorMessage=e.data)}).error(function(){t.loading=!1,t.loyaltyError=!0,t.loyaltyErrorMessage=t.systemBusy})},t.sessionValidation(),o.globalPageLoader=!1}],ManageCompositeProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","ManageCompositeProductControllerPreLoad",function(i,o,n,e,s,c,a,t,r,l){function u(e,t){if(0<i.productList.length)for(var r=0;r<i.productList.length;r++)if(e){if(i.productList[r].productId==t)return!0}else if(i.productList[r].productVariantId==t)return!0;if(0<i.productDisplayList.length)for(r=0;r<i.productDisplayList.length;r++)if(e){if(i.productDisplayList[r].productId==t)return!0}else if(i.productDisplayList[r].productVariantId==t)return!0;return!1}function d(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function p(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",c(function(){i.variantError=!1},1e3),!0;return!1}function B(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function y(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.tempproductBean={},i.productPriceHistoryBean={},i.compositProduct.compositQunatity="1",i.tagList=[],i.tagDisplayList=[],s.MainSideBarhideit=!1,s.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.gui.compositePrduct=!0,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.hideAddVariantAttributesPanel=!1,i.gui.shwoProductTag=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.gui.isConsumeCompositeQunatity=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productVariantValuesCollectionOldOne=[],i.productVariantValuesCollectionOldTwo=[],i.productVariantValuesCollectionOldThree=[],i.productList=[],i.productDisplayList=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="-1",i.productVariantsCollection.push(i.myObj),i.calculateCompositeProductQuantity=function(){i.gui.compositePrduct&&0<i.productList.length&&i.calculateProductSupplierPrice()},i.addCompositeProductDynamically=function(){if(i.dynamicError=!1,i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)isNaN(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory)||null==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||"null"==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||""==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if("true"==i.productVariantBean.isProduct.toString()){if(i.temp={},u(!0,i.productVariantBean.productId))return i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" already added.",c(function(){i.dynamicError=!1},2e3),i.airportName=[],i.productVariantBean={},void(i.productVariantBean.uniteQunatity="1");if(i.temp=angular.copy(i.productVariantBean),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void c(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){var r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" consume quantity can not be greater than available quantity."+i.productVariantBean.currentInventory,c(function(){i.dynamicError=!1},2e3);else{r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}else for(e=0;e<i.productVariantBeanList.length;e++)if(i.productVariantBean.productVariantId==i.productVariantBeanList[e].productVariantId){if(u(!(i.temp={}),i.productVariantBeanList[e].productVariantId))return i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" already added.",c(function(){i.dynamicError=!1},2e3),i.airportName=[],i.productVariantBean={},void(i.productVariantBean.uniteQunatity="1");if(i.temp=angular.copy(i.productVariantBeanList[e]),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void c(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" cousume quantity can not be great than available quantity."+i.productVariantBean.currentInventory,c(function(){i.dynamicError=!1},2e3);else{var a;r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}i.airportName=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.calculateProductSupplierPrice()},i.removeProduct=function(e){if(0<i.productList.length)for(var t=0;t<i.productList.length;t++)i.productList[t].productVariantId==e.productVariantId&&i.productList.splice(t,1)},i.removeCompositeProduct=function(e){i.loading=!0,o.post("manageCompositeProduct/removeCompositeProduct/"+i._s_tk_com,e).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,c(function(){i.productSuccess=!1,n.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,n.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.calculateProductSupplierPrice=function(){var e=0;if(i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)isNaN(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory)||null==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||"null"==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||""==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if(0<i.productList.length)for(t=0;t<i.productList.length;t++){if(!isNaN(i.productList[t].uniteQunatity))if(i.gui.isConsumeCompositeQunatity&&parseInt(i.productList[t].uniteQunatity)<=parseInt(i.productList[t].currentInventory)&&parseInt(i.productList[t].uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.productList[t].currentInventory))i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity);else if(i.gui.isConsumeCompositeQunatity){i.dynamicError=!0,i.dynamicErrorMessage="Product/Variant "+i.productList[t].variantAttributeName+" cousume quantity can not be great than available quantity..",c(function(){i.dynamicError=!1},2e3),i.productList[t].compositeQunatityConsumed="0",e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].compositeQunatityConsumed)}else{i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity)}}if(0<i.productDisplayList.length)for(t=0;t<i.productDisplayList.length;t++){e+=parseFloat(i.productDisplayList[t].retailPrice)*parseFloat(i.productDisplayList[t].uniteQunatity*i.gui.compositeQunatity)}i.productBean.supplyPriceExclTax=e/i.gui.compositeQunatity,i.evaluateRetailPrice()},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct(),i.verifyVariantsInfoCompleted()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree);var t=function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var n=0;n<t[0].length;n++)r.push(t[0][n]+"/"+a[o]);return r}}(e);i.verifyVariantsInfoCompleted(),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=B();i.temp={},i.temp.uUid=o;var n=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=n[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0])," "!=n[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1])," "!=n[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1]+"/"+n[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={}}if(0<i.productBean.productVariantsBeans.length)for(var s=0;s<i.productBean.productVariantsBeans.length;s++)for(r=0;r<i.productVariantValuesCollection.length;r++)i.productVariantValuesCollection[r].varientName==i.productBean.productVariantsBeans[s].variantAttributeName&&i.productVariantValuesCollection.splice(r,1);i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}(t);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="-1",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(n)&&(n=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var s=(o*(n/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=s.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=y(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(s)&&(s=0),s=y(parseFloat(100*(o-n)/n),2),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=s.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax;i.updateAllProductVariantsPriceByChangeOfProductPrice1()},i.sesssionValidation=function(){r.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.fetchData())},i.fetchData=function(){if(i.data=l.loadControllerData(),"NORECORDFOUND"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",n.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.consumeCompositeQunatity&&(i.data.consumeCompositeQunatity?i.gui.isConsumeCompositeQunatity=!0:i.gui.isConsumeCompositeQunatity=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){null!=i.data.productBean.outletBeans?i.outletList=i.data.productBean.outletBeans:i.outletList=i.data.outletBeans;for(var e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0;if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans;else for(e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]);break}}if(null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap),null!=i.data.productVariantBeanList&&(i.productVariantBeanList=null,i.productVariantBeanList=i.data.productVariantBeanList),null!=i.data.productBeansList&&(i.productBeansList=null,i.productBeansList=i.data.productBeansList),null!=i.data.productBean.productList&&(i.productDisplayList=null,i.productDisplayList=angular.copy(i.data.productBean.productList),null!=i.productDisplayList&&0<i.productDisplayList.length))for(e=0;e<i.productDisplayList.length;e++){var t=parseFloat(i.productDisplayList[e].supplyPriceExclTax),r=t*(parseFloat(i.productDisplayList[e].markupPrct)/100)+t;i.productDisplayList[e].retailPrice=r.toFixed(2).toString()}if(null!=i.data.productBean){if(i.productBean={},i.tempproductBean={},i.productBean=i.data.productBean,i.tempproductBean=angular.copy(i.data.productBean),i.compositProductCollection=angular.copy(i.productBean.compositProductCollection),0<i.productBean.productVariantsBeans.length){var a=d(i.productBean.productVariantsBeans[0].variantAttributeName,"/");if(1==a){i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2;for(e=0;e<i.productBean.productVariantsBeans.length;e++){var o=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");p(i.productVariantValuesCollectionOne,o[0])||(i.tempObject={},i.tempObject.value=o[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),p(i.productVariantValuesCollectionTwo,o[1])||(i.tempObject.value=o[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={})}}else if(2==a){i.addAttributeDynamically(),i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2,i.productVariantsCollection[2].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId3;for(e=0;e<i.productBean.productVariantsBeans.length;e++){o=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");p(i.productVariantValuesCollectionOne,o[0])||(i.tempObject={},i.tempObject.value=o[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),p(i.productVariantValuesCollectionTwo,o[1])||(i.tempObject.value=o[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={}),p(i.productVariantValuesCollectionThree,o[2])||(i.tempObject.value=o[2],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),i.valueCollectionThree.push(i.tempObject.value),i.tempObject={})}}else{i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1;for(e=0;e<i.productBean.productVariantsBeans.length;e++)i.tempObject={},i.tempObject.value=i.productBean.productVariantsBeans[e].variantAttributeName,i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}}}i.productVariantValuesCollectionOldOne=angular.copy(i.productVariantValuesCollectionOne),i.productVariantValuesCollectionOldTwo=angular.copy(i.productVariantValuesCollectionTwo),i.productVariantValuesCollectionOldThree=angular.copy(i.productVariantValuesCollectionThree),"true"==i.productBean.productCanBeSold?i.gui.productCanBeSold=!0:i.gui.productCanBeSold=!1,"true"==i.productBean.trackingProduct?i.gui.trackingProduct=!0:i.gui.trackingProduct=!1,"true"==i.productBean.varientProducts?i.gui.varientProducts=!0:i.gui.varientProducts=!1,"true"==i.productBean.standardProduct?i.gui.standardProduct=!0:i.gui.standardProduct=!1,"true"==i.productBean.isComposite?i.gui.compositePrduct=!0:i.gui.compositePrduct=!1,null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productBean.productTagBeanList&&(i.tagDisplayList=i.data.productBean.productTagBeanList),i.evaluateRetailPrice(!1)}}s.manageProductLoadedFully=!1,s.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.standardProduct=!1,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="",i.selectedItem.item.productId="-1";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||(i.tagDisplayList.push(i.selectedItem.item),i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addProductTag/"+i._s_tk_com+"/"+i.productBean.productId,i.tagDisplayList).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,c(function(){i.tagSuccess=!1,c(function(){a.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy}))}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++){if(i.tagDisplayList[t].tagId==e.tagId&&"-1"==i.tagDisplayList[t].productId){i.tagDisplayList.splice(t,1);break}if(i.tagDisplayList[t].tagId==e.tagId&&"-1"!=i.tagDisplayList[t].productId){i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/deleteProductTag/"+i._s_tk_com,i.tagDisplayList[t]).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,c(function(){i.tagSuccess=!1,c(function(){a.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy});break}}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.tagError=!0,i.tagErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void c(function(){i.tagError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",c(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void c(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,o.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),c(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){o.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,n.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){o.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,n.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,o.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.productBean.productTypeId=i.tempproductBean.productTypeId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,n.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,o.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){i.loading=!1,i.productBean.supplierId=i.tempproductBean.supplierId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.supplierBean={},i.supplierList=null,i.supplierList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,c(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,n.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,o.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.productBean.brandId=i.tempproductBean.brandId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",c(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,n.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(e){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0,i.productBean.markupPrct="0");parseFloat(i.productBean.retailPriceExclTax);var a=t*(r/100)+t;if(i.productBean.retailPriceExclTax=a.toFixed(2).toString(),null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var n=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=n.toFixed(2).toString(),i.outletList[o].retailPrice=(n+a).toFixed(2).toString()}e&&i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=y(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var n=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=n.toFixed(2).toString(),i.outletList[o].retailPrice=(n+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.evaluateVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),a=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(a)&&(a=0,i.productBean.productVariantsBeans[t].markupPrct="0");var o=(r*(a/100)+r).toFixed(2);i.productBean.productVariantsBeans[t].retailPriceExclTax=o.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].retailPriceExclTax);if(!isNaN(r)){var a=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),o=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(o)&&(o=0),o=y(100*(r-a)/a,5),i.productBean.productVariantsBeans[t].markupPrct=o.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice1=function(){if(null!=i.productBean.productVariantsBeans&&0<i.productBean.productVariantsBeans.length)for(var e=0;e<i.productBean.productVariantsBeans.length;e++)i.productBean.productVariantsBeans[e].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productBean.productVariantsBeans[e].markupPrct=i.productBean.markupPrct,i.productBean.productVariantsBeans[e].retailPriceExclTax=i.productBean.retailPriceExclTax},i.deleteProductVariant=function(e){i.productVariantId=angular.copy(e.productVariantId),i.alertMessage="Are you sure,you want to delete Product Variant?",$("#alertBox1").modal("show")},i.markInActiveProductVariant=function(){o.post("manageProduct/markInActiveProductVariant/"+i._s_tk_com+"/"+i.productVariantId).success(function(e){$("#alertBox1").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1,a.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,n.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox1").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.deleteCompositeProductVariant=function(e){i.compositeProductVariantUuid=angular.copy(e.uuid),i.alertMessage="Are you sure,you want to delete Composite product Variant?",$("#alertBox2").modal("show")},i.markInActiveCompositeProductVariant=function(){o.post("manageProduct/markInActiveCompositeProductVariant/"+i._s_tk_com+"/"+i.compositeProductVariantUuid).success(function(e){$("#alertBox2").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1,a.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,n.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox2").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.updateProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(0<i.productBean.productVariantsBeans.length){i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree;for(var r=0;r<i.productBean.productVariantsBeans.length;r++)for(var a=0;a<i.productVariantValuesCollection.length;a++)i.productVariantValuesCollection[a].varientName==i.productBean.productVariantsBeans[r].variantAttributeName&&i.productVariantValuesCollection.splice(a,1);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection}else i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection;i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.isComposite=i.gui.compositePrduct,i.productBean.productList=i.productList,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.setDefaultDutyCalcuation(),i.loading=!0,o.post("manageCompositeProduct/updateCompositeProduct/"+i._s_tk_com,i.productBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1,n.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,n.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.fetchAllProducts=function(){o.post("newProduct/getAllProductsForDropDown/"+i._s_tk_com).success(function(e){i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productsList=null,i.productsList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,n.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=y(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=y(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.addAverageSupplierPrice=function(){var e=y(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2);i.productBean.supplyPriceExclTax=y(parseFloat(i.productBean.supplyPriceExclTax+e)/2,2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),i.productVariantBean={},i.productVariantBean.uniteQunatity="1";var e=_.filter(i.productVariantBeanList,function(e){return e.variantAttributeName.toLowerCase().includes(t)}),r=_.filter(i.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)});return e.concat(r)},renderItem:function(e){return{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}},itemSelected:function(e){i.productVariantBean=e.item,i.productVariantBean.uniteQunatity="1"}},i.sesssionValidation()}],ManageCustomerController=["$scope","$http","$filter","$timeout","$window","$cookieStore","$rootScope","SessionService","ManageCustomerControllerPreLoad",function(t,e,r,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,t.loading=!1,t.customerBean={},t.customerBean.addressBeanList=[],t.customerBean.addressBeanList[0]={},t.customerBean.addressBeanList[1]={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=n.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){s.manageCustomerLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):null!=t.data&&(t.customerGroupList=t.data,t.customerBean=t.data.value),s.globalPageLoader=!1},t.populatePosatlAddress=function(){angular.copy(t.customerBean.addressBeanList[0],t.customerBean.addressBeanList[1])},t.updateCustomer=function(){t.manageCustomerSuccess=!1,t.manageCustomerError=!1,t.loading=!0,t.customerBean.addressBeanList[0].addressType="Physical Address",t.customerBean.addressBeanList[1].addressType="Postal Address",e.post("manageCustomer/updateCustomer/"+t._s_tk_com,t.customerBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.customerBean={},t.manageCustomerSuccess=!0,t.manageCustomerSuccessMessage=e.data,a(function(){t.manageCustomerSuccess=!1,o.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.manageCustomerError=!0,t.manageCustomerErrorMessage=e.data,o.location=e.layOutPath):(t.manageCustomerError=!0,t.manageCustomerErrorMessage=e.data)}).error(function(){t.loading=!1,t.manageCustomerError=!0,t.manageCustomerErrorMessage=t.systemBusy})},t.sessionValidation(),s.globalPageLoader=!1}],ManageOutletController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","ManageOutletControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.outletSuccess=!1,t.outletError=!1,t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.manageOutletLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(null!=t.data.timeZoneBeans&&(t.timeZonesList=t.data.timeZoneBeans),null!=t.data.countryListBeans&&(t.countryList=t.data.countryListBeans),null!=t.data.salesTaxListBeans&&(t.salesTaxList=t.data.salesTaxListBeans),null!=t.data.outletBean&&(t.outletBean=t.data.outletBean)),o.globalPageLoader=!1},t.updateOutlet=function(){t.outletSuccess=!1,t.outletError=!1,t.loading=!0,e.post("manageOutlet/updateOutlet/"+t._s_tk_com,t.outletBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.outletSuccess=!0,t.outletSuccessMessage=e.data,n(function(){t.outletSuccess=!1,r.location=e.layOutPath},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.outletError=!0,t.outletErrorMessage=e.data,r.location=e.layOutPath):(t.outletError=!0,t.outletErrorMessage=e.data)}).error(function(){t.loading=!1,t.outletError=!0,t.outletErrorMessage=t.systemBusy})},t.sessionValidation(),o.globalPageLoader=!1}],ManagePriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","$filter","$route","$timeout","$sce","SessionService","ManagePriceBookControllerPreLoad",function(s,o,n,e,t,i,r,c,a,l,u){function d(e){if(0<s.productList.length)for(var t=0;t<s.productList.length;t++)if(s.productList[t].productVariantId==e)return!0;return!1}function p(e){if(0<s.productList.length)for(var t=0;t<s.productList.length;t++)if(s.productList[t].productId==e)return!0;return!1}t.MainSideBarhideit=!1,t.MainHeaderideit=!1,s.priceBookSuccess=!1,s.priceBookError=!1,s.priceBookBean={},s.productVariantBean={},s.productList=[],s.chanageForAll={},s.gui={},s.gui.shwoProductTag=!1,s.validOn={value:"Yes"},s.name="World",s.cars=[{id:1,name:"Audi"},{id:2,name:"BMW"},{id:1,name:"Honda"}],s.selectedCar=[],s.fruits=[{id:1,name:"Apple"},{id:2,name:"Orange"},{id:3,name:"Banana"}],s.selectedFruit=null,s.sessionValidation=function(){l.validate()&&(s._s_tk_com=e.get("_s_tk_com"),s.data=u.loadControllerData(),s.fetchData())},s.fetchData=function(){"NORECORDFOUND"==s.data||"No record found !"==s.data?(s.error=!0,s.errorMessage="No record found"):"SYSTEMBUSY"==s.data||"System is busy while handling request, Please try later !"==s.data?(s.error=!0,s.errorMessage=s.data):"INVALIDSESSION"==s.data?(s.error=!0,s.errorMessage="An exception occured while validating session !",n.location="/app/#/login"):null!=s.data&&(null!=s.data.outletBeans&&(s.outletsList=s.data.outletBeans),null!=s.data.showProductTag&&("true"==s.data.showProductTag?s.gui.shwoProductTag=!0:s.gui.shwoProductTag=!1),null!=s.data.customerGroupBeansList&&(s.customerGroupList=s.data.customerGroupBeansList),null!=s.data.priceBookBean&&(s.priceBookBean=angular.copy(s.data.priceBookBean),"true"!=s.priceBookBean.isValidOnStore&&(s.validOn.value="No"),"true"==s.priceBookBean.flatSale?s.gui.flatSale=!0:s.gui.flatSale=!1,"true"==s.priceBookBean.active?s.gui.activePriceBook=!0:s.gui.activePriceBook=!1),null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.priceBookProductVariantBeansList&&(s.productList=s.data.priceBookProductVariantBeansList,s.setRetailPrice()),null!=s.data.productBeansList&&(s.productBeansList=s.data.productBeansList),null!=s.data.productTagBeanList&&(s.productTagBeanList=s.data.productTagBeanList),null!=s.data.tagBeanList&&(s.tagBeanList=s.data.tagBeanList)),t.globalPageLoader=!1},s.toggle=function(){if(i("date")(new Date,"yyyy-MM-dd")>i("date")(s.data.priceBookBean.validFrom,"yyyy-MM-dd"))return s.alertMessage="You can not update Flat sale info as Valid From Date is before today Date.",$("#alertBox").modal("show"),void("true"==s.data.priceBookBean.flatSale?s.gui.flatSale=!0:s.gui.flatSale=!1)},$("#startDate").on("change",function(e){var t=document.getElementById("startDate1").value;s.priceBookBean.validFrom=t,s.$apply()}),$("#endDate").on("change",function(e){var t=document.getElementById("endDate1").value;s.priceBookBean.validTo=t,s.$apply()}),s.updatePriceBook=function(){if(s.priceBookSuccess=!1,s.priceBookError=!1,i("date")(new Date,"yyyy-MM-dd")>i("date")(s.data.priceBookBean.validFrom,"yyyy-MM-dd")&&i("date")(s.data.priceBookBean.validFrom,"yyyy-MM-dd")!=i("date")(s.priceBookBean.validFrom,"yyyy-MM-dd")){s.alertMessage="You can not update Valid From date as its before today date.",$("#alertBox").modal("show");var e=s.data.priceBookBean.validFrom;s.priceBookBean.validFrom=e}else if(i("date")(s.priceBookBean.validFrom,"yyyy-MM-dd")>i("date")(s.priceBookBean.validTo,"yyyy-MM-dd")){s.alertMessage="From Date should be before Valid To Date.",$("#alertBox").modal("show");var t=s.data.priceBookBean.validTo;s.priceBookBean.validTo=t;e=s.data.priceBookBean.validFrom;s.priceBookBean.validFrom=e}else if(i("date")(s.priceBookBean.validTo,"yyyy-MM-dd")<i("date")(new Date,"yyyy-MM-dd")){s.alertMessage="Valid To Date should be today or future Date.",$("#alertBox").modal("show");t=s.data.priceBookBean.validTo;s.priceBookBean.validTo=t}else if(i("date")(new Date,"yyyy-MM-dd")>i("date")(s.data.priceBookBean.validFrom,"yyyy-MM-dd")&&s.priceBookBean.outletId!=s.data.priceBookBean.outletId){s.alertMessage="You can not update outlet as Valid From Date is before today Date.",$("#alertBox").modal("show");var r=s.data.priceBookBean.outletId;s.priceBookBean.outletId=r}else{if("Yes"==s.validOn.value?(s.priceBookBean.isValidOnStore="true",s.priceBookBean.isValidOnEcom="false"):(s.priceBookBean.isValidOnStore="false",s.priceBookBean.isValidOnEcom="true"),s.gui.flatSale?s.priceBookBean.flatSale="true":s.priceBookBean.flatSale="false",s.gui.activePriceBook){if(s.priceBookBean.active="true",s.gui.flatSale){var a=parseFloat(s.priceBookBean.flatDiscount);if(isNaN(a))return s.alertMessage="Discount not in valid format. Valid formats e.g (1.00,1)",void $("#alertBox").modal("show")}}else s.priceBookBean.active="false";s.loading=!0,o.post("managePriceBook/updatePriceBook/"+s._s_tk_com,s.priceBookBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.loading=!0,s.priceBookSuccess=!0,s.priceBookSuccessMessage=e.data,c(function(){s.priceBookSuccess=!1,s.loading=!1,s.priceBookBean={},n.location=e.layOutPath},1e3)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus||"ADDRESTRICATION"==s.responseStatus?(s.priceBookError=!0,s.priceBookErrorMessage=e.data,"INVALIDSESSION"==s.responseStatus&&(n.location=e.layOutPath)):(s.priceBookError=!0,s.priceBookErrorMessage=e.data)}).error(function(){s.loading=!1,s.priceBookError=!0,s.priceBookErrorMessage=s.systemBusy})}},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),s.productVariantsBeans=[],_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.variantAttributeName,label:a.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}},itemSelected:function(e){s.productVariantBean=e.item}},s.autoCompleteTagOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(s.tagBeanList,function(e){return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:a.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td></tr></tbody></table>")}},itemSelected:function(e){s.productTagBean=e.item,s.isTagSelected=!0}},s.addProductByTag=function(){if(s.isTagSelected)for(var e=0;e<s.productTagBeanList.length;e++)if(s.productTagBeanList[e].tagId==s.productTagBean.tagId)for(var t=0;t<s.productBeansList.length;t++)s.productVariantBean={},s.productBeansList[t].productUuid==s.productTagBeanList[e].productUuid&&(s.productVariantBean=s.productBeansList[t],s.addProductByDiscount());s.productTagBean=[],s.airportName1=[]},s.addProduct=function(){if("true"==s.productVariantBean.isProduct.toString()){if(s.temp={},!p(s.productVariantBean.productId)){s.temp=angular.copy(s.productVariantBean);var e=(r=parseFloat(s.temp.supplyPriceExclTax))*(parseFloat(s.temp.markupPrct)/100)+r;s.temp.retailPrice=e.toFixed(2).toString(),s.temp.discount="0.00",s.productList.push(s.temp),s.temp={}}}else for(var t=0;t<s.productVariantBeansList.length;t++)if(s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(s.temp={},!d(s.productVariantBeansList[t].productVariantId))){s.temp=angular.copy(s.productVariantBeansList[t]);var r;e=(r=parseFloat(s.temp.supplyPriceExclTax))*(parseFloat(s.temp.markupPrct)/100)+r;s.temp.retailPrice=e.toFixed(2).toString(),s.temp.discount="0.00",s.productList.push(s.temp),s.temp={}}s.airportName=[],s.productVariantBean={}},s.addProductByDiscount=function(){if("true"==s.productVariantBean.isProduct.toString()){if(s.temp={},!p(s.productVariantBean.productId)){s.temp=angular.copy(s.productVariantBean);var e=parseFloat(s.temp.supplyPriceExclTax),t=parseFloat(s.temp.markupPrct),r=parseFloat(s.productTagBean.discount);if(isNaN(r)){a=e*(t/100)+e;s.temp.retailPrice=a.toFixed(2).toString(),s.temp.discount="0.00"}else{s.temp.discount=r.toString();var a=e*(t/100)+e;a-=a*(r/100),s.temp.retailPrice=a.toFixed(2).toString()}s.productList.push(s.temp),s.temp={}}}else for(var o=0;o<s.productVariantBeansList.length;o++)if(s.productVariantBean.productVariantId==s.productVariantBeansList[o].productId&&(s.temp={},!d(s.productVariantBeansList[o].productVariantId))){s.temp=angular.copy(s.productVariantBeansList[o]);e=parseFloat(s.temp.supplyPriceExclTax),t=parseFloat(s.temp.markupPrct),r=parseFloat(s.productTagBean.discount);if(isNaN(r)){a=e*(t/100)+e;s.temp.retailPrice=a.toFixed(2).toString(),s.temp.discount="0.00"}else{s.temp.discount=r.toString();var a=e*(t/100)+e;a-=a*(r/100),s.temp.retailPrice=a.toFixed(2).toString()}s.productList.push(s.temp),s.temp={}}s.airportName=[],s.productVariantBean={}},s.deleteProdcutFromList=function(e){s.deleteProdcut=e,s.alertMessage="Are you sure, you want to delete selective product/variant?",$("#alertBox1").modal("show")},s.markInactiveSelectiveProduct=function(){if(s.priceBookSuccess=!1,s.priceBookError=!1,null==s.deleteProdcut.priceBookId||null==s.deleteProdcut.priceBookDetailId){if("true"==s.deleteProdcut.isProduct.toString()){for(var e=0;e<s.productList.length;e++)if(s.productList[e].productId==s.deleteProdcut.productId)return s.productList.splice(e,1),void $("#alertBox1").modal("hide")}else for(e=0;e<s.productList.length;e++)if(s.productList[e].productVariantId==s.deleteProdcut.productVariantId)return s.productList.splice(e,1),void $("#alertBox1").modal("hide")}else s.loading=!0,o.post("managePriceBook/deleteProductOrVariantInPriceBookDetail/"+s._s_tk_com,s.deleteProdcut).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.loading=!0,$("#alertBox1").modal("hide"),s.priceBookSuccess=!0,s.priceBookSuccessMessage=e.data,c(function(){s.priceBookSuccess=!1,s.loading=!1,s.deleteProdcut={},r.reload()},1e3)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?(s.priceBookError=!0,s.priceBookErrorMessage=e.data,n.location=e.layOutPath):(s.priceBookError=!0,s.priceBookErrorMessage=e.data)}).error(function(){s.loading=!1,s.priceBookError=!0,s.priceBookErrorMessage=s.systemBusy})},s.changeMarkUpForAll=function(){var e=parseFloat(s.chanageForAll.markupPrct);if(!isNaN(e))for(var t=0;t<s.productList.length;t++){var r=parseFloat(s.productList[t].supplyPriceExclTax);s.productList[t].markupPrct=e.toString();var a=r*(e/100)+r,o=s.productList[t].discount;isNaN(o)||(a-=a*(o/100)),s.productList[t].retailPrice=a.toFixed(2).toString(),s.productList[t].indivisualUpdate=!0}},s.changeDiscountForAll=function(){var e=parseFloat(s.chanageForAll.discount);if(!isNaN(e))for(var t=0;t<s.productList.length;t++){var r=parseFloat(s.productList[t].supplyPriceExclTax),a=parseFloat(s.productList[t].markupPrct);if(!isNaN(a)){s.productList[t].discount=e.toString();var o=r*(a/100)+r;o-=o*(e/100),s.productList[t].retailPrice=o.toFixed(2).toString(),s.productList[t].indivisualUpdate=!0}}},s.changeMarkUpAndDiscount=function(e){for(var t=0;t<s.productList.length;t++)if(e.variantAttributeName==s.productList[t].variantAttributeName||e.productId==s.productList[t].productId){var r=parseFloat(e.markupPrct);if(!isNaN(r)){var a=parseFloat(s.productList[t].supplyPriceExclTax);s.productList[t].markupPrct=r.toString();var o=a*(r/100)+a,n=e.discount;isNaN(n)||(o-=o*(n/100),s.productList[t].discount=n),s.productList[t].retailPrice=o.toFixed(2).toString(),s.productList[t].indivisualUpdate=!0}}},s.setRetailPrice=function(){for(var e=0;e<s.productList.length;e++){var t=parseFloat(s.productList[e].markupPrct);if(!isNaN(t)){var r=parseFloat(s.productList[e].supplyPriceExclTax);s.productList[e].markupPrct=t.toString();var a=r*(t/100)+r,o=s.productList[e].discount;isNaN(o)||(a-=a*(o/100)),s.productList[e].retailPrice=a.toFixed(2).toString()}}},s.manageProductsInPriceBook=function(){s.priceBookSuccess=!1,s.priceBookError=!1,s.loading=!0,o.post("managePriceBook/manageProductsInPriceBook/"+s._s_tk_com+"/"+s.priceBookBean.priceBookId,s.productList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.loading=!0,s.priceBookSuccess=!0,s.priceBookSuccessMessage=e.data,c(function(){s.priceBookSuccess=!1,s.loading=!1,s.priceBookBean={},n.location=e.layOutPath},1e3)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?(s.priceBookError=!0,s.priceBookErrorMessage=e.data,n.location=e.layOutPath):(s.priceBookError=!0,s.priceBookErrorMessage=e.data)}).error(function(){s.loading=!1,s.priceBookError=!0,s.priceBookErrorMessage=s.systemBusy})},s.sessionValidation()}],ManageProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","ManageProductControllerPreLoad",function(i,o,n,e,a,s,c,t,r,l){function u(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function d(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",s(function(){i.variantError=!1},1e3),!0;return!1}function p(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function B(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.tempproductBean={},i.productPriceHistoryBean={},i.compositProduct.compositQunatity="1",i.tagList=[],i.tagDisplayList=[],a.MainSideBarhideit=!1,a.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.hideAddVariantAttributesPanel=!1,i.gui.shwoProductTag=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productVariantValuesCollectionOldOne=[],i.productVariantValuesCollectionOldTwo=[],i.productVariantValuesCollectionOldThree=[],i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="-1",i.productVariantsCollection.push(i.myObj),i.addCompositProductDynamically=function(){i.compositProductTemp={};for(var e=i.compositProduct.productId.split(":"),t=!1,r=0;r<i.compositProductCollection.length;r++)e[2]==i.compositProductCollection[r].productVariantName&&(t=!0);t?alert("Product already added."):(i.compositProductTemp.id=(i.compositProductCollection.length+1).toString(),i.compositProductTemp.productId=e[0],i.compositProductTemp.productName=e[1],i.compositProductTemp.productVariantName=e[2],i.compositProductTemp.productVariantId=e[3],i.compositProductTemp.uuid=p(),i.compositProductTemp.compositQunatity=i.compositProduct.compositQunatity,i.compositProductCollection.push(i.compositProductTemp),i.compositProductTemp={},i.compositProduct={},i.compositProduct.compositQunatity="1",i.compositProduct.productId="0")},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct(),i.verifyVariantsInfoCompleted()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree);var t=function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var n=0;n<t[0].length;n++)r.push(t[0][n]+"/"+a[o]);return r}}(e);i.verifyVariantsInfoCompleted(),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=p();i.temp={},i.temp.uUid=o;var n=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=n[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0])," "!=n[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1])," "!=n[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1]+"/"+n[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={}}if(0<i.productBean.productVariantsBeans.length)for(var s=0;s<i.productBean.productVariantsBeans.length;s++)for(r=0;r<i.productVariantValuesCollection.length;r++)i.productVariantValuesCollection[r].varientName==i.productBean.productVariantsBeans[s].variantAttributeName&&i.productVariantValuesCollection.splice(r,1);i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}(t);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="-1",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(n)&&(n=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var s=(o*(n/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=s.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=B(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(s)&&(s=0),s=B(parseFloat(100*(o-n)/n),2),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=s.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax;i.updateAllProductVariantsPriceByChangeOfProductPrice1()},i.sesssionValidation=function(){r.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.fetchData())},i.fetchData=function(){if(i.data=l.loadControllerData(),"NORECORDFOUND"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",n.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){null!=i.data.productBean.outletBeans?i.outletList=i.data.productBean.outletBeans:i.outletList=i.data.outletBeans;for(var e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0;if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans;else for(e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]);break}}if(null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap),null!=i.data.productBean){if(i.productBean={},i.tempproductBean={},i.productBean=i.data.productBean,i.tempproductBean=angular.copy(i.data.productBean),i.compositProductCollection=angular.copy(i.productBean.compositProductCollection),0<i.productBean.productVariantsBeans.length){var t=u(i.productBean.productVariantsBeans[0].variantAttributeName,"/");if(1==t){i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2;for(e=0;e<i.productBean.productVariantsBeans.length;e++){var r=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,r[0])||(i.tempObject={},i.tempObject.value=r[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,r[1])||(i.tempObject.value=r[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={})}}else if(2==t){i.addAttributeDynamically(),i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2,i.productVariantsCollection[2].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId3;for(e=0;e<i.productBean.productVariantsBeans.length;e++){r=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,r[0])||(i.tempObject={},i.tempObject.value=r[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,r[1])||(i.tempObject.value=r[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionThree,r[2])||(i.tempObject.value=r[2],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),i.valueCollectionThree.push(i.tempObject.value),i.tempObject={})}}else{i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1;for(e=0;e<i.productBean.productVariantsBeans.length;e++)i.tempObject={},i.tempObject.value=i.productBean.productVariantsBeans[e].variantAttributeName,i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}}}i.productVariantValuesCollectionOldOne=angular.copy(i.productVariantValuesCollectionOne),i.productVariantValuesCollectionOldTwo=angular.copy(i.productVariantValuesCollectionTwo),i.productVariantValuesCollectionOldThree=angular.copy(i.productVariantValuesCollectionThree),"true"==i.productBean.productCanBeSold?i.gui.productCanBeSold=!0:i.gui.productCanBeSold=!1,"true"==i.productBean.trackingProduct?i.gui.trackingProduct=!0:i.gui.trackingProduct=!1,"true"==i.productBean.varientProducts?i.gui.varientProducts=!0:i.gui.varientProducts=!1,"true"==i.productBean.standardProduct?i.gui.standardProduct=!0:i.gui.standardProduct=!1,null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productBean.productTagBeanList&&(i.tagDisplayList=i.data.productBean.productTagBeanList),i.evaluateRetailPrice(!1)}}a.manageProductLoadedFully=!1,a.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.standardProduct=!1,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="",i.selectedItem.item.productId="-1";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||(i.tagDisplayList.push(i.selectedItem.item),i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addProductTag/"+i._s_tk_com+"/"+i.productBean.productId,i.tagDisplayList).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,s(function(){i.tagSuccess=!1,s(function(){c.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy}))}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++){if(i.tagDisplayList[t].tagId==e.tagId&&"-1"==i.tagDisplayList[t].productId){i.tagDisplayList.splice(t,1);break}if(i.tagDisplayList[t].tagId==e.tagId&&"-1"!=i.tagDisplayList[t].productId){i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/deleteProductTag/"+i._s_tk_com,i.tagDisplayList[t]).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,s(function(){i.tagSuccess=!1,s(function(){c.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy});break}}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.tagError=!0,i.tagErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void s(function(){i.tagError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",s(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void s(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,o.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),s(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){o.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,n.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){a.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){o.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,n.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,o.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.productBean.productTypeId=i.tempproductBean.productTypeId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,n.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,o.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){i.loading=!1,i.productBean.supplierId=i.tempproductBean.supplierId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.supplierBean={},i.supplierList=null,i.supplierList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,s(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,n.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,o.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.productBean.brandId=i.tempproductBean.brandId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",s(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,n.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(e){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0,i.productBean.markupPrct="0");parseFloat(i.productBean.retailPriceExclTax);var a=t*(r/100)+t;if(i.productBean.retailPriceExclTax=a.toFixed(2).toString(),null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var n=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=n.toFixed(2).toString(),i.outletList[o].retailPrice=(n+a).toFixed(2).toString()}e&&i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=B(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var n=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=n.toFixed(2).toString(),i.outletList[o].retailPrice=(n+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.evaluateVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),a=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(a)&&(a=0,i.productBean.productVariantsBeans[t].markupPrct="0");var o=(r*(a/100)+r).toFixed(2);i.productBean.productVariantsBeans[t].retailPriceExclTax=o.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].retailPriceExclTax);if(!isNaN(r)){var a=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),o=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(o)&&(o=0),o=B(100*(r-a)/a,5),i.productBean.productVariantsBeans[t].markupPrct=o.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice1=function(){if(null!=i.productBean.productVariantsBeans&&0<i.productBean.productVariantsBeans.length)for(var e=0;e<i.productBean.productVariantsBeans.length;e++)i.productBean.productVariantsBeans[e].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productBean.productVariantsBeans[e].markupPrct=i.productBean.markupPrct,i.productBean.productVariantsBeans[e].retailPriceExclTax=i.productBean.retailPriceExclTax},i.deleteProductVariant=function(e){i.productVariantId=angular.copy(e.productVariantId),i.alertMessage="Are you sure,you want to delete Product Variant?",$("#alertBox1").modal("show")},i.markInActiveProductVariant=function(){o.post("manageProduct/markInActiveProductVariant/"+i._s_tk_com+"/"+i.productVariantId).success(function(e){$("#alertBox1").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1,c.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,n.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox1").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.deleteCompositeProductVariant=function(e){i.compositeProductVariantUuid=angular.copy(e.uuid),i.alertMessage="Are you sure,you want to delete Composite product Variant?",$("#alertBox2").modal("show")},i.markInActiveCompositeProductVariant=function(){o.post("manageProduct/markInActiveCompositeProductVariant/"+i._s_tk_com+"/"+i.compositeProductVariantUuid).success(function(e){$("#alertBox2").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1,c.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,n.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox2").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.updateProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(0<i.productBean.productVariantsBeans.length){i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree;for(var r=0;r<i.productBean.productVariantsBeans.length;r++)for(var a=0;a<i.productVariantValuesCollection.length;a++)i.productVariantValuesCollection[a].varientName==i.productBean.productVariantsBeans[r].variantAttributeName&&i.productVariantValuesCollection.splice(a,1);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection}else i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection;i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.setDefaultDutyCalcuation(),i.loading=!0,o.post("manageProduct/updateProduct/"+i._s_tk_com,i.productBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1,n.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,n.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.fetchAllProducts=function(){o.post("newProduct/getAllProductsForDropDown/"+i._s_tk_com).success(function(e){i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productsList=null,i.productsList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,n.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=B(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=B(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.addAverageSupplierPrice=function(){var e=B(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2);i.productBean.supplyPriceExclTax=B(parseFloat(i.productBean.supplyPriceExclTax+e)/2,2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.sesssionValidation()}],ManageRegisterController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","ManageRegisterControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.registerSuccess=!1,t.registerError=!1,t.registerBean={},t.systemBusy="System is Busy Please try again",t.cashManagement={value:"No"},t.userNextSale={value:"No"},t.receiptEmail={value:"No"},t.receiptPrint={value:"Yes"},t.receiptPrintNotes={value:"No"},t.discountsOnReceipt={value:"Yes"},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.manageRegisterLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.registerBean=t.data,t.cashManagement.value=t.registerBean.cacheManagementEnable,t.userNextSale.value=t.registerBean.selectNextUserForSale,t.receiptEmail.value=t.registerBean.emailReceipt,t.receiptPrint.value=t.registerBean.printReceipt,t.receiptPrintNotes.value=t.registerBean.printNotesOnReceipt,t.discountsOnReceipt.value=t.registerBean.showDiscountOnReceipt),o.globalPageLoader=!1},t.sesstionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.registerBean=a.get("_e_cOr_gra"),t.cashManagement.value=t.registerBean.cacheManagementEnable,t.userNextSale.value=t.registerBean.selectNextUserForSale,t.receiptEmail.value=t.registerBean.emailReceipt,t.receiptPrint.value=t.registerBean.printReceipt,t.receiptPrintNotes.value=t.registerBean.printNotesOnReceipt,t.discountsOnReceipt.value=t.registerBean.showDiscountOnReceipt)},t.updateRegister=function(){t.registerSuccess=!1,t.registerError=!1,t.loading=!0,t.registerBean.cacheManagementEnable=t.cashManagement.value,t.registerBean.selectNextUserForSale=t.userNextSale.value,t.registerBean.emailReceipt=t.receiptEmail.value,t.registerBean.printReceipt=t.receiptPrint.value,t.registerBean.printNotesOnReceipt=t.receiptPrintNotes.value,t.registerBean.showDiscountOnReceipt=t.discountsOnReceipt.value,e.post("manageRegister/updateRegister/"+t._s_tk_com,t.registerBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.registerSuccess=!0,t.registerSuccessMessage=e.data,n(function(){t.registerSuccess=!1,r.location=e.layOutPath},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.registerError=!0,t.registerErrorMessage=e.data,r.location=e.layOutPath):(t.registerError=!0,t.registerErrorMessage=e.data)}).error(function(){t.loading=!1,t.registerError=!0,t.registerErrorMessage=t.systemBusy})},t.sessionValidation()}],ManageRoleController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","ManageRoleControllerPreLoad",function(r,e,t,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.showAddSalesTaxModal=!1,r.manageRoleSuccess=!1,r.manageRoleError=!1,r.isCashAdded=!1,r.isCreditCardAdded=!1,r.manageRoleAddError=!1,r.loadingUpdate=!1,r.loading=!1,r.manageRoleBean={},r.systemBusy="System is Busy Please try again",r.sessionValidation=function(){if(i.validate()){r._s_tk_com=a.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData();var e=a.get("_m_rd_gra");"1"==e&&(r.roleName="Administrator"),"2"==e&&(r.roleName="Manager"),"3"==e&&(r.roleName="Cashier")}},r.fetchData=function(){o.manageRoleLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(r.menuBeanList=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},r.selectUnselectAll=function(e){if(null!=r.menuBeanList&&0<r.menuBeanList.length)for(var t=0;t<r.menuBeanList.length;t++)r.menuBeanList[t].activeIndicatior=e},r.updatePageRights=function(){r.manageRoleSuccess=!1,r.manageRoleError=!1,r.loadingUpdate=!0,e.post("manageRole/updatePageRightsByRoleId/"+r._s_tk_com,r.menuBeanList).success(function(e){r.loadingUpdate=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.companyBean={},r.manageRoleSuccess=!0,r.manageRoleSuccessMessage=e.data,r.showUpdatemanageRoleModal=!1,n(function(){r.manageRoleSuccess=!1,n(function(){s.reload()},500)},2e3)):"INVALIDSESSION"==r.responseStatus||"SYSTEMBUSY"==r.responseStatus?(r.manageRoleError=!0,r.manageRoleErrorMessage=e.data,t.location=e.layOutPath):(r.manageRoleError=!0,r.manageRoleErrorMessage=e.data)}).error(function(){r.loadingUpdate=!1,r.manageRoleError=!0,r.manageRoleErrorMessage=r.systemBusy})},r.sessionValidation()}],ManageUserController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","ManageUserControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.userSuccess=!1,t.userError=!1,t.userBean={},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.outletBeans&&(t.outletsList=t.data.outletBeans),null!=t.data.rolesBeanList&&(t.rolesList=t.data.rolesBeanList),null!=t.data.userBean&&(t.userBean=t.data.userBean)),o.globalPageLoader=!1},t.updateUser=function(){t.userSuccess=!1,t.userError=!1,t.loading=!0,e.post("manageUser/updateUser/"+t._s_tk_com,t.userBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.userBean={},t.userSuccess=!0,t.userSuccessMessage=e.data,n(function(){t.userSuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.userError=!0,t.userErrorMessage=e.data,r.location=e.layOutPath):(t.userError=!0,t.userErrorMessage=e.data)}).error(function(){t.loading=!1,t.userError=!0,t.userErrorMessage=t.systemBusy})},t.sessionValidation()}],NewCompositeProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","NewCompositeProductControllerPreLoad",function(i,r,a,e,o,n,t,s,c,l){function u(e,t){if(0<i.productList.length)for(var r=0;r<i.productList.length;r++)if(e){if(i.productList[r].productId==t)return!0}else if(i.productList[r].productVariantId==t)return!0;return!1}function d(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function p(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",n(function(){i.variantError=!1},1e3),!0;return!1}function B(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function y(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.productBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.productPriceHistoryBean={},i.compositProduct.compositeQunatity="1",i.tagList=[],i.tagDisplayList=[],o.MainSideBarhideit=!1,o.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.gui.shwoProductTag=!1,i.gui.compositeQunatity=0,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.gui.isConsumeCompositeQunatity=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.outletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productList=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="",i.productVariantsCollection.push(i.myObj),i.dynamicError=!1,i.calculateCompositeProductQuantity=function(){i.gui.compositePrduct&&0<i.productList.length&&i.calculateProductSupplierPrice()},i.addCompositeProductDynamically=function(){if(i.dynamicError=!1,i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)isNaN(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory)||null==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||"null"==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||""==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if("true"==i.productVariantBean.isProduct.toString())if(i.temp={},u(!0,i.productVariantBean.productId))i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" already added.",n(function(){i.dynamicError=!1},2e3);else{if(i.temp=angular.copy(i.productVariantBean),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void n(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){var r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" cousume quantity can not be greater than available quantity."+i.productVariantBean.currentInventory,n(function(){i.dynamicError=!1},2e3);else{r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}else for(e=0;e<i.productVariantBeanList.length;e++)if(i.productVariantBean.productVariantId==i.productVariantBeanList[e].productVariantId)if(u(!(i.temp={}),i.productVariantBeanList[e].productVariantId))i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" already added.",n(function(){i.dynamicError=!1},2e3);else{if(i.temp=angular.copy(i.productVariantBeanList[e]),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void n(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" cousume quantity can not be great than available quantity."+i.productVariantBean.currentInventory,n(function(){i.dynamicError=!1},2e3);else{var a;r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}i.airportName=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.calculateProductSupplierPrice()},i.removeProduct=function(e){if(0<i.productList.length)for(var t=0;t<i.productList.length;t++)i.productList[t].productVariantId==e.productVariantId&&i.productList.splice(t,1)},i.calculateProductSupplierPrice=function(){var e=0;if(i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)isNaN(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory)||null==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||"null"==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||""==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if(0<i.productList.length)for(t=0;t<i.productList.length;t++){if(!isNaN(i.productList[t].uniteQunatity))if(i.gui.isConsumeCompositeQunatity&&parseInt(i.productList[t].uniteQunatity)<=parseInt(i.productList[t].currentInventory)&&parseInt(i.productList[t].uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.productList[t].currentInventory))i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity);else if(i.gui.isConsumeCompositeQunatity){i.dynamicError=!0,i.dynamicErrorMessage="Product/Variant "+i.productList[t].variantAttributeName+" cousume quantity can not be great than available quantity..",n(function(){i.dynamicError=!1},2e3),i.productList[t].compositeQunatityConsumed="0",e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].compositeQunatityConsumed)}else{i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity)}}i.productBean.supplyPriceExclTax=e/i.gui.compositeQunatity,i.evaluateRetailPrice()},i.addCompositProductDynamically_old=function(){i.compositProductTemp={};for(var e=i.compositProduct.productId.split(":"),t=!1,r=0;r<i.compositProductCollection.length;r++)e[2]==i.compositProductCollection[r].productVariantName&&(t=!0);t?alert("Product already added."):(i.compositProductTemp.id=(i.compositProductCollection.length+1).toString(),i.compositProductTemp.productId=e[0],i.compositProductTemp.productName=e[1],i.compositProductTemp.productVariantName=e[2],i.compositProductTemp.productVariantId=e[3],i.compositProductTemp.uuid=B(),i.compositProductTemp.compositeQunatity=i.compositProduct.compositeQunatity,i.compositProductCollection.push(i.compositProductTemp),i.compositProductTemp={},i.compositProduct={},i.compositProduct.compositeQunatity="1",i.compositProduct.productId="0")},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.sku=e.productName,i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){p(i.tagList,e)||(i.tempTag={},i.tempTag.value=e,i.tempTag.tagId=(i.tagList.length+1).toString(),i.tagList.push(i.tempTag),i.tempTag={},i.tagBean={})},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=B();i.temp={},i.temp.uUid=o;var n=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=n[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0])," "!=n[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1])," "!=n[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1]+"/"+n[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={},i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}}(function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var n=0;n<t[0].length;n++)r.push(t[0][n]+"/"+a[o]);return r}}(e)),i.verifyVariantsInfoCompleted();for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(i.variantError=!1,t.includes("/")||1<e.value.split("/").length)return i.variantError=!0,i.variantErrorMessage="Value never contains '/'",void n(function(){i.variantError=!1},1e3);if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.manageVariantsBarCodePrefix=function(){for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++){var r=i.productVariantValuesCollection[e].varientName.split("/");if(" "!=r[0])if(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",(i.gui.sku+"-"+r[0]).length<=15)i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0];else{var a=i.gui.sku+"-"+r[0];i.productVariantValuesCollection[e].varientsOutletList[t].sku=a.substr(0,14)}" "!=r[1]&&1<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1])," "!=r[2]&&2<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1]+"-"+r[2]),i.checkProductVariantSkuExist(i.productVariantValuesCollection[e].varientsOutletList[t].sku)&&(i.productVariantValuesCollection[e].varientsOutletList[t].isDuplicateBarCode="true")}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(n)&&(n=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var s=(o*(n/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=s.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=y(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(s)&&(s=0),s=y(parseFloat(100*(o-n)/n),5),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=s.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax},i.sesssionValidation=function(){c.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.data=l.loadControllerData(),i.fetchData())},i.fetchData=function(){if("NORECORDFOUND"==i.data||"No record found !"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.consumeCompositeQunatity&&(i.data.consumeCompositeQunatity?i.gui.isConsumeCompositeQunatity=!0:i.gui.isConsumeCompositeQunatity=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans,i.outletList=i.data.outletBeans;else for(var e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]),i.outletList.push(i.data.outletBeans[e]);break}for(e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0}null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantBeanList&&(i.productVariantBeanList=null,i.productVariantBeanList=i.data.productVariantBeanList),null!=i.data.productBeansList&&(i.productBeansList=null,i.productBeansList=i.data.productBeansList),null!=i.data.sku&&(i.sku=1e3,i.sku=i.data.sku,i.productBean.sku=i.sku),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap)}o.newProductLoadedFully=!1,o.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.gui.compositePrduct=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.compositePrduct?i.gui.compositePrduct=!1:i.gui.compositePrduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1,i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:s.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||i.tagDisplayList.push(i.selectedItem.item)}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++)if(i.tagDisplayList[t].tagId==e.tagId){i.tagDisplayList.splice(t,1);break}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.variantError=!0,i.variantErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void n(function(){i.variantError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,r.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",n(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void n(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,r.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),n(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){r.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.getAllSuppliers=function(){r.post("suppliers/getAllSuppliers/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.supplierList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllProductTypes=function(){r.post("productType/getAllProductTypes/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.productTypeList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllBrands=function(){r.post("brands/getAllBrands/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.brandList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchOutlets=function(){r.post("outlets/getOutlets/"+i._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.outletList=e.data,i.verientsOutletList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){r.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,r.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productBean.productTypeId=i.productTypeList[i.productTypeList.length-1].productTypeId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,a.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,r.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.supplierBean={},i.supplierList=null,i.supplierList=e.data;var t=i.supplierList.length;i.productBean.supplierId=i.supplierList[t-1].supplierId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,n(function(){i.productSuccess=!1},1e3)}else"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,a.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,r.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.productBean.brandId=i.brandList[i.brandList.length-1].brandId,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",n(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,a.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(){var e=parseFloat(i.productBean.supplyPriceExclTax),t=parseFloat(i.productBean.markupPrct);isNaN(t)&&(t=0,i.productBean.markupPrct="0");var r=e*(t/100)+e;if(i.productBean.retailPriceExclTax=r.toFixed(2).toString(),null!=i.outletList&&0<r)for(var a=0;a<i.outletList.length;a++){var o=r*(parseFloat(i.outletList[a].defaultTax)/100);i.outletList[a].taxAmount=o.toFixed(2).toString(),i.outletList[a].retailPrice=(o+r).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=y(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var n=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=n.toFixed(2).toString(),i.outletList[o].retailPrice=(n+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.addProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(i.gui.trackingProduct&&("-1"==i.varientAttributeBean.varientAttributeId||"0"==i.varientAttributeBean.varientAttributeId||""==i.varientAttributeBean.varientAttributeId))return i.productAddError=!0,i.productAddErrorMessage="Please chose variant.",void n(function(){i.productAddError=!1},1e3);if(i.gui.compositePrduct&&0==i.productList.length)return i.productAddError=!0,i.productAddErrorMessage="Please add atleast one product to create composite product.",void n(function(){i.productAddError=!1},1e3);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.tagList=i.tagDisplayList,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.isComposite=i.gui.compositePrduct,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.productBean.productList=i.productList,i.setDefaultDutyCalcuation(),i.loading=!0,r.post("newCompositeProduct/addProduct/"+i._s_tk_com,i.productBean).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1,i.loading=!1,a.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data,a.location=e.layOutPath):(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.upload=function(e,t){i.imageData={file:e,id:t},r.post("photo/processImage",i.imageData).success(function(){i.successMsg="Selfie uploaded Succesfuly !",i.photoSuccess=!0,o.userImage="/app/resources/images/selfie_"+i.user+".jpg",a.location.reload()}).error(function(){i.errorMsg="Could not upload selfie !",i.photoError=!0})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=y(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=y(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(),i.showDutyCalculationModal=!1},i.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),i.productVariantBean={},i.productVariantBean.uniteQunatity="1";var e=_.filter(i.productVariantBeanList,function(e){return e.variantAttributeName.toLowerCase().includes(t)}),r=_.filter(i.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)});return e.concat(r)},renderItem:function(e){return{value:e.variantAttributeName,label:s.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}},itemSelected:function(e){i.productVariantBean=e.item,i.productVariantBean.uniteQunatity="1"}},i.sesssionValidation()}],NewCustomerController=["$scope","$http","$filter","$timeout","$window","$cookieStore","$rootScope","SessionService","NewCustomerControllerPreLoad",function(t,e,r,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,t.loading=!1,t.customerBean={},t.customerBean.addressBeanList=[],t.customerBean.addressBeanList[0]={},t.customerBean.addressBeanList[1]={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=n.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){s.newCustomerLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):null!=t.data&&(t.customerGroupList=t.data),s.globalPageLoader=!1},t.populatePosatlAddress=function(){angular.copy(t.customerBean.addressBeanList[0],t.customerBean.addressBeanList[1])},t.fetchAllCustomerGroups=function(){e.post("newCustomer/getAllCustomerGroups").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.customerGroupList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,o.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.addNewCustomer=function(){t.newCustomerSuccess=!1,t.newCustomerError=!1,t.addNewCustomerButton=!0,t.customerBean.addressBeanList[0].addressType="Physical Address",t.customerBean.addressBeanList[1].addressType="Postal Address",t.loading=!0,e.post("newCustomer/addNewCustomer/"+t._s_tk_com,t.customerBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.addNewCustomerButton=!1,t.newCustomerSuccess=!0,t.newCustomerSuccessMessage="Request Processed successfully!",a(function(){t.newCustomerSuccess=!1,t.loading=!1,t.customerBean={},o.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.newCustomerError=!0,t.newCustomerErrorMessage=e.data,o.location=e.layOutPath):(t.newCustomerError=!0,t.newCustomerErrorMessage=e.data)}).error(function(){t.loading=!1,t.newCustomerError=!0,t.newCustomerErrorMessage=t.systemBusy})},t.sessionValidation()}],NewPriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","$filter","$timeout","SessionService","NewPriceBookControllerPreLoad",function(s,t,r,a,e,o,n,i,c){e.MainSideBarhideit=!1,e.MainHeaderideit=!1,s.priceBookSuccess=!1,s.priceBookError=!1,s.priceBookBean={},s.priceBookBean.flatDiscount="0.00",s.gui={},s.displayOutletsList=[],s.gui.flatSale=!1,s.gui.activePriceBook=!0,s.validOn={value:"Yes"},s.sessionValidation=function(){i.validate()&&(s._s_tk_com=a.get("_s_tk_com"),s.data=c.loadControllerData(),s.fetchData(),s.setDefaultDates())},s.toggle=function(){s.gui.flatSale=!s.gui.flatSale},s.fetchData=function(){"NORECORDFOUND"==s.data||"No record found !"==s.data?(s.error=!0,s.errorMessage="No record found"):"SYSTEMBUSY"==s.data?(s.error=!0,s.errorMessage=s.systemBusy):"INVALIDSESSION"==s.data?(s.error=!0,s.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=s.data&&(null!=s.data.outletBeans&&(s.outletsList=angular.copy(s.data.outletBeans)),null!=s.data.customerGroupBeansList&&(s.customerGroupList=s.data.customerGroupBeansList)),e.globalPageLoader=!1},s.setDefaultDates=function(){var e=new Date,t=e.getUTCMonth()+1;t<10&&(t="0"+t);var r=e.getDate();r<10&&(r="0"+r);var a=new Date;a.setDate(a.getDate()+30);var o=a.getUTCMonth()+1;t<10&&(o="0"+o);var n=a.getDate();n<10&&(n="0"+n),s.priceBookBean.validFrom=e.getFullYear()+"-"+t+"-"+r,s.priceBookBean.validTo=a.getFullYear()+"-"+o+"-"+n},$("#startDate").on("change",function(e){var t=document.getElementById("startDate1").value;s.priceBookBean.validFrom=t,s.$apply()}),$("#endDate").on("change",function(e){var t=document.getElementById("endDate1").value;s.priceBookBean.validTo=t,s.$apply()}),s.addPriceBook=function(){if(s.priceBookSuccess=!1,s.priceBookError=!1,o("date")(s.priceBookBean.validFrom,"yyyy-MM-dd")>o("date")(s.priceBookBean.validTo,"yyyy-MM-dd"))return s.alertMessage="From Date should be before Valid To Date.",void $("#alertBox").modal("show");if(o("date")(s.priceBookBean.validFrom,"yyyy-MM-dd")<o("date")(new Date,"yyyy-MM-dd"))return s.alertMessage="From Date should be today or future Date.",void $("#alertBox").modal("show");if("Yes"==s.validOn.value?(s.priceBookBean.isValidOnStore="true",s.priceBookBean.isValidOnEcom="false"):(s.priceBookBean.isValidOnStore="false",s.priceBookBean.isValidOnEcom="true"),s.gui.flatSale?s.priceBookBean.flatSale="true":s.priceBookBean.flatSale="false",s.gui.activePriceBook){if(s.priceBookBean.active="true",s.gui.flatSale){var e=parseFloat(s.priceBookBean.flatDiscount);if(isNaN(e))return s.alertMessage="Discount not in valid format. Valid formats e.g (1.00,1)",void $("#alertBox").modal("show")}}else s.priceBookBean.active="false";s.priceBookBean.outletBeans=angular.copy(s.displayOutletsList),s.loading=!0,t.post("newPriceBook/addPriceBook/"+s._s_tk_com,s.priceBookBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.loading=!0,s.priceBookSuccess=!0,s.priceBookSuccessMessage="Request Processed successfully!",n(function(){s.priceBookSuccess=!1,s.loading=!1,s.priceBookBean={},a.put("_e_cPri_gra",e.data),r.location="/app/#/managePriceBook"},1e3)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus||"ADDRESTRICATION"==s.responseStatus?(s.priceBookError=!0,s.priceBookErrorMessage=e.data,"INVALIDSESSION"==s.responseStatus&&(r.location=e.layOutPath)):(s.priceBookError=!0,s.priceBookErrorMessage=e.data)}).error(function(){s.loading=!1,s.priceBookError=!0,s.priceBookErrorMessage=s.systemBusy})},s.removeOutletFromDisplayOutletList=function(e){for(var t=0;t<s.displayOutletsList.length;t++)if(s.displayOutletsList[t].outletId==e.outletId){s.displayOutletsList.splice(t,1);break}},s.addOutletToDisplayOutletList=function(e){if("-1"==e)return s.displayOutletsList=[],void(s.displayOutletsList=angular.copy(s.outletsList));for(var t=0;t<s.outletsList.length;t++)if(s.outletsList[t].outletId==e){for(var r=0;r<s.displayOutletsList.length;r++)if(s.displayOutletsList[r].outletId==e)return;s.displayOutletsList.push(s.outletsList[t]);break}},s.sessionValidation()}],NewProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","NewProductControllerPreLoad",function(i,r,a,e,o,n,t,s,c,l){function u(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function d(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",n(function(){i.variantError=!1},1e3),!0;return!1}function p(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function B(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.productBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.productPriceHistoryBean={},i.compositProduct.compositQunatity="1",i.tagList=[],i.tagDisplayList=[],o.MainSideBarhideit=!1,o.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.gui.shwoProductTag=!1,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.outletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="",i.productVariantsCollection.push(i.myObj),i.addCompositProductDynamically=function(){i.compositProductTemp={};for(var e=i.compositProduct.productId.split(":"),t=!1,r=0;r<i.compositProductCollection.length;r++)e[2]==i.compositProductCollection[r].productVariantName&&(t=!0);t?alert("Product already added."):(i.compositProductTemp.id=(i.compositProductCollection.length+1).toString(),i.compositProductTemp.productId=e[0],i.compositProductTemp.productName=e[1],i.compositProductTemp.productVariantName=e[2],i.compositProductTemp.productVariantId=e[3],i.compositProductTemp.uuid=p(),i.compositProductTemp.compositQunatity=i.compositProduct.compositQunatity,i.compositProductCollection.push(i.compositProductTemp),i.compositProductTemp={},i.compositProduct={},i.compositProduct.compositQunatity="1",i.compositProduct.productId="0")},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.sku=e.productName,i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){d(i.tagList,e)||(i.tempTag={},i.tempTag.value=e,i.tempTag.tagId=(i.tagList.length+1).toString(),i.tagList.push(i.tempTag),i.tempTag={},i.tagBean={})},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=p();i.temp={},i.temp.uUid=o;var n=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=n[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0])," "!=n[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1])," "!=n[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=n[0]+"/"+n[1]+"/"+n[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={},i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}}(function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var n=0;n<t[0].length;n++)r.push(t[0][n]+"/"+a[o]);return r}}(e)),i.verifyVariantsInfoCompleted();for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(i.variantError=!1,t.includes("/")||1<e.value.split("/").length)return i.variantError=!0,i.variantErrorMessage="Value never contains '/'",void n(function(){i.variantError=!1},1e3);if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.manageVariantsBarCodePrefix=function(){for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++){var r=i.productVariantValuesCollection[e].varientName.split("/");if(" "!=r[0])if(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",(i.gui.sku+"-"+r[0]).length<=15)i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0];else{var a=i.gui.sku+"-"+r[0];i.productVariantValuesCollection[e].varientsOutletList[t].sku=a.substr(0,14)}" "!=r[1]&&1<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1])," "!=r[2]&&2<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1]+"-"+r[2]),i.checkProductVariantSkuExist(i.productVariantValuesCollection[e].varientsOutletList[t].sku)&&(i.productVariantValuesCollection[e].varientsOutletList[t].isDuplicateBarCode="true")}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(n)&&(n=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var s=(o*(n/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=s.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=B(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(s)&&(s=0),s=B(parseFloat(100*(o-n)/n),5),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=s.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax},i.sesssionValidation=function(){c.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.data=l.loadControllerData(),i.fetchData())},i.fetchData=function(){if("NORECORDFOUND"==i.data||"No record found !"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans,i.outletList=i.data.outletBeans;else for(var e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]),i.outletList.push(i.data.outletBeans[e]);break}for(e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0}null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantBeanList&&(i.productVariantBeanList=null,i.productVariantBeanList=i.data.productVariantBeanList),null!=i.data.sku&&(i.sku=1e3,i.sku=i.data.sku,i.productBean.sku=i.sku),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap)}o.newProductLoadedFully=!1,o.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.standardProduct=!1,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1,i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:s.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||i.tagDisplayList.push(i.selectedItem.item)}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++)if(i.tagDisplayList[t].tagId==e.tagId){i.tagDisplayList.splice(t,1);break}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.variantError=!0,i.variantErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void n(function(){i.variantError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,r.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",n(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void n(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,r.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),n(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){r.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.getAllSuppliers=function(){r.post("suppliers/getAllSuppliers/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.supplierList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllProductTypes=function(){r.post("productType/getAllProductTypes/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.productTypeList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllBrands=function(){r.post("brands/getAllBrands/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.brandList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchOutlets=function(){r.post("outlets/getOutlets/"+i._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.outletList=e.data,i.verientsOutletList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){r.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,r.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productBean.productTypeId=i.productTypeList[i.productTypeList.length-1].productTypeId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,a.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,r.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.supplierBean={},i.supplierList=null,i.supplierList=e.data;var t=i.supplierList.length;i.productBean.supplierId=i.supplierList[t-1].supplierId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,n(function(){i.productSuccess=!1},1e3)}else"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,a.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,r.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.productBean.brandId=i.brandList[i.brandList.length-1].brandId,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",n(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,a.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(){var e=parseFloat(i.productBean.supplyPriceExclTax),t=parseFloat(i.productBean.markupPrct);isNaN(t)&&(t=0,i.productBean.markupPrct="0");var r=e*(t/100)+e;if(i.productBean.retailPriceExclTax=r.toFixed(2).toString(),null!=i.outletList&&0<r)for(var a=0;a<i.outletList.length;a++){var o=r*(parseFloat(i.outletList[a].defaultTax)/100);i.outletList[a].taxAmount=o.toFixed(2).toString(),i.outletList[a].retailPrice=(o+r).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=B(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var n=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=n.toFixed(2).toString(),i.outletList[o].retailPrice=(n+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.addProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(i.gui.trackingProduct&&("-1"==i.varientAttributeBean.varientAttributeId||"0"==i.varientAttributeBean.varientAttributeId||""==i.varientAttributeBean.varientAttributeId))return i.productAddError=!0,i.productAddErrorMessage="Please chose variant.",void n(function(){i.productAddError=!1},1e3);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.tagList=i.tagDisplayList,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.setDefaultDutyCalcuation(),i.loading=!0,r.post("newProduct/addProduct/"+i._s_tk_com,i.productBean).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1,i.loading=!1,a.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data,a.location=e.layOutPath):(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.upload=function(e,t){i.imageData={file:e,id:t},r.post("photo/processImage",i.imageData).success(function(){i.successMsg="Selfie uploaded Succesfuly !",i.photoSuccess=!0,o.userImage="/app/resources/images/selfie_"+i.user+".jpg",a.location.reload()}).error(function(){i.errorMsg="Could not upload selfie !",i.photoError=!0})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=B(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=B(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(),i.showDutyCalculationModal=!1},i.sesssionValidation()}],NewSupplierController=["$scope","$http","$window","$cookieStore","$route","$rootScope","SessionService","$timeout","NewSupplierControllerPreLoad",function(t,e,r,a,o,n,s,i,c){function l(e){if("Physical Address"==e.addressType)return e}function u(e){if("Postal Address"==e.addressType)return e}n.MainSideBarhideit=!1,n.MainHeaderideit=!1,t.Success=!1,t.Error=!1,t.supplierBean={},t.addressList=[],t.tempAddress=[],t.physicalAddressBean=null,t.postalAddressBean=null,t.supplierScreenMode="New Supplier",t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData(),t.cookieSupplierBean=a.get("supplier"),t.cookieSupplierBean&&(t.supplierBean=t.cookieSupplierBean,t.supplierScreenMode="Manage Supplier",t.cookieSupplierBean.addresses&&(t.tempAddress=t.cookieSupplierBean.addresses.filter(l),null!=t.tempAddress&&0<t.tempAddress.length&&(t.physicalAddressBean=t.tempAddress[0]),t.tempAddress=[],t.tempAddress=t.cookieSupplierBean.addresses.filter(u),null!=t.tempAddress&&0<t.tempAddress.length&&(t.postalAddressBean=t.tempAddress[0]))))},t.fetchData=function(){n.newSupplierLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data&&(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),n.globalPageLoader=!1},t.sessionValidation(),t.addSupplier=function(){t.Success=!1,t.Error=!1,t.loading=!0,t.physicalAddressBean&&(t.physicalAddressBean.addressType="Physical Address",t.addressList.push(t.physicalAddressBean)),t.postalAddressBean&&(t.postalAddressBean.addressType="Postal Address",t.addressList.push(t.postalAddressBean)),t.supplierBean.addresses=angular.copy(t.addressList),e.post("newSupplier/addSupplier/"+t._s_tk_com,t.supplierBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.Success=!0,t.SuccessMessage=e.data,i(function(){t.loading=!1,t.Success=!1,t.supplierBean={},t.addressList=[],r.location=e.layOutPath},1500),t.physicalAddressBean=null,t.postalAddressBean=null):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.Error=!0,t.ErrorMessage=e.data,r.location=e.layOutPath):(t.Error=!0,t.ErrorMessage=e.data)}).error(function(){t.loading=!1,t.Error=!0,t.ErrorMessage=t.systemBusy})},t.updateSupplier=function(){t.Success=!1,t.Error=!1,t.loading=!0,t.physicalAddressBean&&(t.physicalAddressBean.addressType="Physical Address",t.addressList.push(t.physicalAddressBean)),t.postalAddressBean&&(t.postalAddressBean.addressType="Postal Address",t.addressList.push(t.postalAddressBean)),t.supplierBean.addresses=angular.copy(t.addressList),e.post("newSupplier/updateSupplier/"+t._s_tk_com,t.supplierBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.Success=!0,t.SuccessMessage=e.data,i(function(){t.Success=!1,t.loading=!1,t.supplierBean={},t.addressList=[],r.location=e.layOutPath},1500),t.physicalAddressBean=null,t.postalAddressBean=null):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.Error=!0,t.ErrorMessage=e.data,r.location=e.layOutPath):(t.Error=!0,t.ErrorMessage=e.data)}).error(function(){t.loading=!1,t.Error=!0,t.ErrorMessage=t.systemBusy})},t.cancelClick=function(){r.location="/app/#/suppliers"},t.populatePhysicalAddress=function(){null==t.postalAddressBean&&(t.postalAddressBean={}),t.physicalAddressBean&&(t.postalAddressBean.contactName=t.physicalAddressBean.contactName,t.postalAddressBean.firstName=t.physicalAddressBean.firstName,t.postalAddressBean.lastName=t.physicalAddressBean.lastName,t.postalAddressBean.email=t.physicalAddressBean.email,t.postalAddressBean.phone=t.physicalAddressBean.phone,t.postalAddressBean.fax=t.physicalAddressBean.fax,t.postalAddressBean.website=t.physicalAddressBean.website,t.postalAddressBean.twitter=t.physicalAddressBean.twitter,t.postalAddressBean.street=t.physicalAddressBean.street,t.postalAddressBean.suburb=t.physicalAddressBean.suburb,t.postalAddressBean.city=t.physicalAddressBean.city,t.postalAddressBean.postalCode=t.physicalAddressBean.postalCode,t.postalAddressBean.state=t.physicalAddressBean.state,t.postalAddressBean.countryId=t.physicalAddressBean.countryId,t.postalAddressBean.addressType="Postal Address")}}],NewUserController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","NewUserControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.userSuccess=!1,t.userError=!1,t.userBean={},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.newUserLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.outletBeans&&(t.outletsList=t.data.outletBeans),null!=t.data.rolesBeanList&&(t.rolesList=t.data.rolesBeanList)),o.globalPageLoader=!1},t.addUser=function(){t.userSuccess=!1,t.userError=!1,t.loading=!0,e.post("newUser/addUser/"+t._s_tk_com,t.userBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.userBean={},t.userSuccess=!0,t.userSuccessMessage=e.data,n(function(){t.userSuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.userError=!0,t.userErrorMessage=e.data,r.location=e.layOutPath):(t.userError=!0,t.userErrorMessage=e.data)}).error(function(){t.loading=!1,t.userError=!0,t.userErrorMessage=t.systemBusy})},t.sessionValidation()}],NotificationsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","NotificationsControllerPreLoad",function(r,t,a,e,o,n,s,i,c){function l(e){if("undefined"!=r.comparisonNotificationBeanList&&null!=r.comparisonNotificationBeanList&&0<r.comparisonNotificationBeanList.length)for(var t=0;t<r.comparisonNotificationBeanList.length;t++)if(r.comparisonNotificationBeanList[t].notificationId==e.notificationId)return!0;return!1}o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.success=!1,r.error=!1,r.dataLoading=!1,r.tagBean={},r.notificationBeanList=[],r.comparisonNotificationBeanList=[],r.readLoader=!1,r.notificationsId=null,r.processing=!1,r.userRoll,r.unReadMessagesCount="",r.sessionValidation=function(){i.validate()&&(r._s_tk_com=e.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData(),r.getAllUnReadNotifications())},r.fetchData=function(){o.productTagsLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found",e.put("countNotifications",0),o.countNotifications=e.get("countNotifications")):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.notificationBeanList=r.data,e.put("countNotifications",r.notificationBeanList.length),o.countNotifications=e.get("countNotifications"),r.comparisonNotificationBeanList=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},r.lodAllNotificationsAsynchrnously=function(){t.post("notifications/getAllNotifications/"+e.get("_s_tk_com")+"/true").success(function(e){r.responseStatus=e.status,r.dataLoading=!0,"SUCCESSFUL"==r.responseStatus?(r.data=e.data,r.success=!0,r.sucessMessage=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.activeInactiveAll=function(e){r.loading=!0,t.get("notifications/activeInactiveAllNotifications/"+r._s_tk_com+"/"+e).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(notifications=e.data,localforage.setItem("_e_cOt_jir",notifications),a.location="/app/#/manageNoftifications"):a.location=e.layOutPath}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.editNotification=function(e){r.notificationsId=e.notificationId,r.readLoader=!0,t.get("notifications/updateSelectedNotifications/"+r._s_tk_com+"/"+e.notificationId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.successMessage=e.data,n(function(){r.success=!1,r.readLoader=!1,s.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,n(function(){r.error=!1,s.reload()},1500)):"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){r.loading=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.loadAllNotifications=function(){r.dataLoading=!1;for(var e=0;e<r.data.length;e++)l(r.data[e])||r.notificationBeanList.push(r.data[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:o.buttonsView})},1),r.dataLoading=!0},r.markAllAsRead=function(){r.processing=!0,r.userRoll,t.get("notifications/markAllAsReadByOutletIdCompanyId/"+r._s_tk_com).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.successMessage=e.data,n(function(){r.success=!1,s.reload()},1e3)):a.location=e.layOutPath}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.getAllUnReadNotifications=function(){r.unReadNotifications=0,t.get("notifications/getAllUnReadNotifications/"+r._s_tk_com).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus&&(r.unReadNotifications=e.data)}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.sessionValidation()}],NotificationsReadedController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","NotificationsReadedControllerPreLoad",function(r,t,a,e,o,n,s,i,c){function l(e){if("undefined"!=r.comparisonNotificationBeanList&&null!=r.comparisonNotificationBeanList&&0<r.comparisonNotificationBeanList.length)for(var t=0;t<r.comparisonNotificationBeanList.length;t++)if(r.comparisonNotificationBeanList[t].notificationId==e.notificationId)return!0;return!1}o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.success=!1,r.error=!1,r.dataLoading=!1,r.tagBean={},r.notificationBeanList=[],r.comparisonNotificationBeanList=[],r.readLoader=!1,r.notificationsId=null,r.processing=!1,r.userRoll,r.readedMessagesCount="",r.sessionValidation=function(){i.validate()&&(r._s_tk_com=e.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData(),r.getAllReadedNotifications())},r.fetchData=function(){o.productTagsLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found !"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.notificationBeanList=r.data,r.comparisonNotificationBeanList=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},r.lodAllNotificationsAsynchrnously=function(){t.post("notificationsReaded/getAllNotifications/"+e.get("_s_tk_com")+"/true").success(function(e){r.responseStatus=e.status,r.dataLoading=!0,"SUCCESSFUL"==r.responseStatus?(r.data=e.data,r.success=!0,r.sucessMessage=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.activeInactiveAll=function(e){r.loading=!0,t.get("notificationsReaded/activeInactiveAllNotifications/"+r._s_tk_com+"/"+e).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(notifications=e.data,localforage.setItem("_e_cOt_jir",notifications),a.location="/app/#/manageNoftificationsReaded"):a.location=e.layOutPath}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.loadAllNotifications=function(){r.dataLoading=!1;for(var e=0;e<r.data.length;e++)l(r.data[e])||r.notificationBeanList.push(r.data[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:o.buttonsView})},1),r.dataLoading=!0},r.getAllReadedNotifications=function(){r.readedNotifications=0,t.get("notificationsReaded/getAllReadedNotifications/"+r._s_tk_com).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus&&(r.readedNotifications=e.data)}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.sessionValidation()}],OrdersController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","OrdersControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){o.ordersLoadedFully=!1,"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.orderMainBeansList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.sessionValidation()}],OutletController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","OutletControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.outletSuccess=!1,t.outletError=!1,t.companyBean={},t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.outletLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.timeZoneBeans&&(t.timeZonesList=t.data.timeZoneBeans),null!=t.data.countryListBeans&&(t.countryList=t.data.countryListBeans),null!=t.data.salesTaxListBeans&&(t.salesTaxList=t.data.salesTaxListBeans)),o.globalPageLoader=!1},t.addOutlet=function(){t.outletSuccess=!1,t.outletError=!1,t.loading=!0,e.post("outlet/addOutlet/"+t._s_tk_com,t.outletBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.outletSuccess=!0,t.outletSuccessMessage=e.data,n(function(){t.outletSuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.outletError=!0,t.outletErrorMessage=e.data,r.location=e.layOutPath):(t.outletError=!0,t.outletErrorMessage=e.data)}).error(function(){t.loading=!1,t.outletError=!0,t.outletErrorMessage=t.systemBusy})},t.sessionValidation()}],OutletPaymentDetailsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","OutletPaymentDetailsControllerPreLoad",function(r,e,t,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.stockOrderBeansList=[],r.supplierBean={},r.oId=o.get("sp_oto"),r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=c.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.supplierBean&&(r.supplierBean=r.data.supplierBean,r.sId=r.supplierBean.supplierId),null!=r.data.supplierPaymentsBeanList&&(r.supplierPaymentBeansList=r.data.supplierPaymentsBeanList,setTimeout(function(){$("#myTable1").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"asc"]],bInfo:!0})},10)),null!=r.data.stockOrderBeansList&&(r.stockOrderBeansList=r.data.stockOrderBeansList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"desc"]],bInfo:!0})},10))),s.globalPageLoader=!1},r.isHeadOffice=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.showUpdatePaymentModal=!1,r.addPayment=function(){r.showUpdatePaymentModal=!0,r.supplierPaymentBean={},r.supplierPaymentBean.createdDate=new Date,r.supplierPaymentBean.supplierBalance=angular.copy(r.supplierBean.supplierBalance),r.supplierPaymentBean.supplierNewBalance=r.supplierPaymentBean.supplierBalance,r.supplierPaymentBean.supplier=r.sId,r.supplierPaymentBean.orderRefNum="-1",r.supplierPaymentBean.adjustmentType="Cash In",r.supplierPaymentBean.paymentCash="0",r.supplierPaymentBean.paymentAmount="0",r.supplierPaymentBean.paymentCreditCard="0",r.supplierPaymentBean.paymentOtherType="0",r.supplierPaymentBean.cashReturn="0"},r.addSuppliersPayment=function(){r.success=!1,r.error=!1,r.loading=!0,e.post("supplierDetails/addSupplierPayment/"+r._s_tk_com,r.supplierPaymentBean).success(function(e){r.responseStatus=e.status,r.loading=!1,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage=e.data,r.showUpdatePaymentModal=!1,a(function(){r.success=!1,r.showUpdatePaymentModal=!1,n.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplier=function(){r.success=!1,r.error=!1,e.post("supplierDetails/getSupplier/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierBean=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchStockOrders=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getAllStockOrdersBySupplierId/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.stockOrderBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplierPayments=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getSupplierPayments/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierPaymentBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.populateOrderAmount=function(){angular.forEach(r.stockOrderBeansList,function(e,t){e.stockOrderId==r.supplierPaymentBean.orderRefNum&&(r.supplierPaymentBean.paymentAmount=angular.copy(e.totalCost))})},r.calculateNewBalance=function(){r.totalPayment=parseInt(r.supplierPaymentBean.paymentCash)+parseInt(r.supplierPaymentBean.paymentOtherType)+parseInt(r.supplierPaymentBean.paymentCreditCard)-parseInt(r.supplierPaymentBean.cashReturn),"Cash Out"==r.supplierPaymentBean.adjustmentType?r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)-parseInt(r.totalPayment)).toString():"Cash In"==r.supplierPaymentBean.adjustmentType&&(r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)+parseInt(r.totalPayment)).toString()),isNaN(r.supplierPaymentBean.supplierNewBalance)&&(r.supplierPaymentBean.supplierNewBalance="")},r.sessionValidation()}],OutletSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","OutletSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],OutletsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","OutletsControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.systemBusy="System is Busy Please try again",t.addOutlet=function(){r.location="/app/#/outlet"},t.addRegister=function(e){localforage.setItem("_r_cO_gra",e),r.location="/app/#/register"},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.roleId=a.get("_s_tk_rId"),t.userOutletId=a.get("_s_tk_oId"),t.headOffice=a.get("_s_tk_iho"),t.data=i.loadControllerData(),t.fetchData())},t.isHeadOffice=function(){return null==t.headOffice||""==t.headOffice.toString()||"true"!=t.headOffice.toString()},t.showDetails=function(e){null!=t.headOffice&&""!=t.headOffice.toString()&&"true"==t.headOffice.toString()?(a.put("sp_oto",e.outletId),"false"==e.isHeadOffice&&(r.location="/app/#/outletPaymentDetails")):e.outletId==t.userOutletId&&(a.put("sp_oto",e.outletId),"false"==e.isHeadOffice&&(r.location="/app/#/outletPaymentDetails"))},t.fetchData=function(){o.outletsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.outletsList=t.data),o.globalPageLoader=!1},t.editOutlet=function(e){a.put("_e_cOt_gra",e.outletId),r.location="/app/#/manageOutlet"},t.updateRegister=function(e){a.put("_e_cOr_gra",e.registerId),r.location="/app/#/manageRegister"},t.sessionValidation()}],PaymentReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","PaymentReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],PaymentTypeController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","PaymentTypeControllerPreLoad",function(t,r,a,e,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.showAddSalesTaxModal=!1,t.paymentTypeSuccess=!1,t.paymentTypeError=!1,t.isCashAdded=!1,t.isCreditCardAdded=!1,t.paymentTypeAddError=!1,t.loadingUpdate=!1,t.loading=!1,t.paymentTypeBean={},t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){i.validate()&&(t._s_tk_com=e.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.paymentTypeLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=t.data&&(t.paymentTypeList=t.data),o.globalPageLoader=!1},t.showAddPaymentTypePopup=function(){t.paymentTypeAddError=!1,t.showAddPaymentTypeModal=!0},t.showUpdatePaymentTypePopup=function(e){t.updatePaymentTypeBean=angular.copy(e),t.showUpdatePaymentTypeModal=!0},t.addPaymentType=function(){if(t.paymentTypeSuccess=!1,t.paymentTypeError=!1,t.paymentTypeAddError=!1,null!=t.paymentTypeList)for(var e=0;e<t.paymentTypeList.length;e++){if("Cash"==t.paymentTypeList[e].paymentTypeValue&&"Cash"==t.paymentTypeBean.paymentTypeValue)return t.paymentTypeAddError=!0,t.paymentTypeAddErrorMessage="Payment type Cash already added.",void n(function(){t.paymentTypeAddError=!1},1e3);if("Credit Card"==t.paymentTypeList[e].paymentTypeValue&&"Credit Card"==t.paymentTypeBean.paymentTypeValue)return t.paymentTypeAddError=!0,t.paymentTypeAddErrorMessage="Payment type Credit Card already added.",void n(function(){t.paymentTypeAddError=!1},1e3)}t.loading=!0,r.post("paymentType/addPaymentType/"+t._s_tk_com,t.paymentTypeBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.paymentTypeSuccess=!0,t.paymentTypeSuccessMessage=e.data,t.showAddPaymentTypeModal=!1,n(function(){t.paymentTypeSuccess=!1,s.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data,a.location=e.layOutPath):(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data)}).error(function(){t.loading=!1,t.paymentTypeError=!0,t.paymentTypeErrorMessage=t.systemBusy})},t.updatePaymentType=function(){t.paymentTypeSuccess=!1,t.paymentTypeError=!1,t.loadingUpdate=!0,r.post("paymentType/updatePaymentType/"+t._s_tk_com,t.updatePaymentTypeBean).success(function(e){t.loadingUpdate=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.paymentTypeSuccess=!0,t.paymentTypeSuccessMessage=e.data,t.showUpdatePaymentTypeModal=!1,n(function(){t.paymentTypeSuccess=!1,n(function(){s.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data,a.location=e.layOutPath):(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data)}).error(function(){t.loadingUpdate=!1,t.paymentTypeError=!0,t.paymentTypeErrorMessage=t.systemBusy})},t.sessionValidation()}],POCreateandReceiveController=["$sce","$filter","$scope","$http","$timeout","$window","$route","$cookieStore","$rootScope","SessionService","POCreateandReceiveControllerPreLoad",function(t,e,i,r,a,o,n,s,c,l,u){function d(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",a(function(){i.variantError=!1},1e3),!0;return!1}function p(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function B(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}c.MainSideBarhideit=!1,c.MainHeaderideit=!1,i.stockOrderId="",i.grandTotal="0",i.stockOrderBean={},i.stockOrderBean.diliveryDueDate=new Date,i.HHMM=e("date")(new Date,"HH:mm"),i.stockOrderBean.orderNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+i.HHMM,i.stockOrderBean.stockRefNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+i.HHMM,i.showConfirmDeletePopup=!1,i.productVariantBean={},i.productVariantBeansList=[],i.stockOrderDetailBean={},i.delStockOrderDetailBean={},i.stockOrderDetailBeansList=[],i.counter=1,i.gui={},i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.hideRefValues=!1,i.productVariantMap=[],i.productMap=[],i.productSKU="",i.skudisable=!1,i.inputTypeScan=!0,i.update=!1,i.sessionValidation=function(){l.validate()&&(i._s_tk_com=s.get("_s_tk_com"),i.roleId=s.get("_s_tk_rId"),i.userOutletId=s.get("_s_tk_oId"),i.data=u.loadControllerData(),i.fetchData(),i.stockOrderBean.outletId=i.userOutletId,i.stockOrderBean.itemCount=0,i.itemCountTotal=0,i.stockOrderBean.recItemCount=0,i.AllInOne())},i.fetchData=function(){if(c.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=i.data.productVariantBeansList&&(i.productVariantBeansList=i.data.productVariantBeansList),null!=i.data.productBeansList){i.productBeansList=i.data.productBeansList;for(var e=0;e<i.productVariantBeansList.length;e++)i.productBeansList.push(i.productVariantBeansList[e])}null!=i.data.productVariantMap&&(i.productVariantMap=i.data.productVariantMap),null!=i.data.productMap&&(i.productMap=i.data.productMap),null!=i.data.outletBeansList&&(i.outletList=i.data.outletBeansList),null!=i.data.stockOrderTypeBeansList&&(i.stockOrderTypeBeansList=i.data.stockOrderTypeBeansList),null!=i.data.supplierBeansList&&(i.supplierList=i.data.supplierBeansList)}c.globalPageLoader=!1},i.addStockOrderUpdate=function(){i.success=!1,i.error=!1,i.loading=!0,i.stockOrderBean.statusId="1",i.stockOrderBean.stockOrderTypeId="1",0==i.update?r.post("purchaseOrder/addStockOrder/"+i._s_tk_com,i.stockOrderBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productTypeBean={},i.success=!0,i.successMessage="Request Processed successfully!",i.stockOrderId=e.data,i.stockOrderBean.stockOrderId=angular.copy(i.stockOrderId),s.put("_ct_bl_ost",i.stockOrderBean),i.update=!0,i.updateStockOrderDetail()):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy}):r.post("purchaseOrder/updateStockOrder/"+i._s_tk_com,i.stockOrderBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productTypeBean={},i.success=!0,i.successMessage="Request Processed successfully!",i.stockOrderId=e.data,i.stockOrderBean.stockOrderId=angular.copy(i.stockOrderId),s.put("_ct_bl_ost",i.stockOrderBean),i.updateStockOrderDetail()):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showConfirmReceiveStockOrder=function(){i.showConfirmReceivePopup=!0},i.addStockOrderUpdateandReceive=function(){i.success=!1,i.error=!1,i.loading=!0,i.stockOrderBean.statusId="1",i.stockOrderBean.stockOrderTypeId="1",r.post("purchaseOrder/addStockOrder/"+i._s_tk_com,i.stockOrderBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productTypeBean={},i.success=!0,i.successMessage="Request Processed successfully!",i.stockOrderId=e.data,i.showConfirmReceivePopup=!1,i.stockOrderBean.stockOrderId=angular.copy(i.stockOrderId),s.put("_ct_bl_ost",i.stockOrderBean),i.updateAndReceiveStockOrderDetails()):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.checkProductStatus=function(){var e=i.stockOrderDetailBean.orderProdQty;if("true"==i.productVariantBean.isVariant.toString())i.addProduct();else{if(i.hit=0,"true"==i.productVariantBean.isProduct.toString())i.addProduct(),i.hit++;else for(var t=0;t<i.productVariantBeansList.length;t++){var r=null;i.productVariantBean.productVariantId==i.productVariantBeansList[t].productId&&(r=angular.copy(i.productVariantBean),i.productVariantBean=angular.copy(i.productVariantBeansList[t]),i.stockOrderDetailBean.orderProdQty=angular.copy(e),i.addProduct(),i.productVariantBean=angular.copy(r),i.hit++)}i.hit<1&&(i.productVariantBean.isProduct="true",i.addProduct())}i.AllInOne()},i.addProduct=function(){i.dualEntry=!1;var a=i.productVariantBean,o={};0<i.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(i.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(i.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=i.stockOrderDetailBeansList.indexOf(e);i.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,i.stockOrderDetailBeansList.unshift(o),i.dualEntry=!0}}):angular.forEach(i.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(i.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=i.stockOrderDetailBeansList.indexOf(e);i.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,i.stockOrderDetailBeansList.unshift(o),i.dualEntry=!0}}),1!=i.dualEntry&&(i.stockOrderDetailBean.productVariantId=a.productVariantId,i.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,i.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,i.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(i.stockOrderDetailBean.ordrSupplyPrice="",i.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),i.stockOrderDetailBean.total=i.stockOrderDetailBean.ordrSupplyPrice*i.stockOrderDetailBean.orderProdQty,isNaN(i.stockOrderDetailBean.total)&&(i.stockOrderDetailBean.total="0"),i.stockOrderDetailBean.order=i.counter,i.counter++,i.stockOrderDetailBean.stockOrderId=i.stockOrderBean.stockOrderId,i.stockOrderDetailBean.isDirty=!0,i.stockOrderDetailBeansList.unshift(i.stockOrderDetailBean),i.dualEntry=!1)):(i.stockOrderDetailBean.productVariantId=a.productVariantId,i.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,i.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,i.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(i.stockOrderDetailBean.ordrSupplyPrice="",i.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),i.stockOrderDetailBean.total=i.stockOrderDetailBean.ordrSupplyPrice*i.stockOrderDetailBean.orderProdQty,i.stockOrderDetailBean.order=i.counter,i.counter++,i.stockOrderDetailBean.stockOrderId=i.stockOrderBean.stockOrderId,i.stockOrderDetailBean.isDirty=!0,i.stockOrderDetailBeansList.unshift(i.stockOrderDetailBean)),i.stockOrderDetailBean={},i.airportName=[]},i.showConfirmDelete=function(e){i.delStockOrderDetailBean={},i.delStockOrderDetailBean=angular.copy(e),i.showConfirmDeletePopup=!0},i.delStockOrderDetail=function(){void 0!==i.delStockOrderDetailBean.stockOrderDetailId&&(i.error=!1,i.loading=!0,r.post("purchaseOrderDetails/deleteStockOrderDetail/"+i._s_tk_com,i.delStockOrderDetailBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.loading=!1:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})),angular.forEach(i.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==i.delStockOrderDetailBean.productVariantId&&e.isProduct==i.delStockOrderDetailBean.isProduct){var r=i.stockOrderDetailBeansList.indexOf(e);i.stockOrderDetailBeansList.splice(r,1)}}),i.showConfirmDeletePopup=!1,i.delStockOrderDetailBean={},i.AllInOne()},i.AllInOne=function(){if(i.counter=1,i.stockOrderBean.itemCount=0,i.grandTotal="0",i.stockOrderBean.recItemCount=0,i.grandTotal="0",0<i.stockOrderDetailBeansList.length)for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].order=i.counter,i.counter++,i.stockOrderDetailBeansList[e].total=i.stockOrderDetailBeansList[e].ordrSupplyPrice*i.stockOrderDetailBeansList[e].orderProdQty,isNaN(i.stockOrderDetailBeansList[e].total)&&(i.stockOrderDetailBeansList[e].total="0"),i.stockOrderBean.itemCount=parseInt(i.stockOrderBean.itemCount)+parseInt(i.stockOrderDetailBeansList[e].orderProdQty),isNaN(i.stockOrderBean.itemCount)&&(i.stockOrderBean.itemCount="0"),i.stockOrderDetailBeansList[e].recvTotal=i.stockOrderDetailBeansList[e].recvSupplyPrice*i.stockOrderDetailBeansList[e].recvProdQty,isNaN(i.stockOrderDetailBeansList[e].recvTotal)&&(i.stockOrderDetailBeansList[e].recvTotal="0"),i.stockOrderBean.recItemCount=parseInt(i.stockOrderBean.recItemCount)+parseInt(i.stockOrderDetailBeansList[e].recvProdQty),!isNaN(i.stockOrderBean.recItemCount)&&""!=i.stockOrderBean.recItemCount||(i.stockOrderBean.recItemCount="0"),i.grandTotal=parseFloat(i.grandTotal)+parseFloat(i.stockOrderDetailBeansList[e].recvTotal),isNaN(i.grandTotal)&&(i.grandTotal="0")},i.calculateTotalforItem=function(r){angular.forEach(i.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),e.isDirty=!0)}),i.AllInOne()},i.calculateRecvTotalforItem=function(r){angular.forEach(i.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.recvTotal=e.recvSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),e.isDirty=!0)}),i.AllInOne()},i.checkStockOrderDetailListforRec=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++){if(""==i.stockOrderDetailBeansList[e].recvProdQty||null==i.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==i.stockOrderDetailBeansList[e].recvSupplyPrice||null==i.stockOrderDetailBeansList[e].recvSupplyPrice)return!1}return!0}return!1},i.checkStockOrderDetailList=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++){if(""==i.stockOrderDetailBeansList[e].orderProdQty||null==i.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==i.stockOrderDetailBeansList[e].ordrSupplyPrice||null==i.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},i.markAllReceive=function(){if(0<i.stockOrderDetailBeansList.length)for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].recvProdQty="",i.stockOrderDetailBeansList[e].recvProdQty=angular.copy(i.stockOrderDetailBeansList[e].orderProdQty),i.stockOrderDetailBeansList[e].recvSupplyPrice="",i.stockOrderDetailBeansList[e].recvSupplyPrice=angular.copy(i.stockOrderDetailBeansList[e].ordrSupplyPrice),i.stockOrderDetailBeansList[e].recvTotal=i.stockOrderDetailBeansList[e].recvSupplyPrice*i.stockOrderDetailBeansList[e].recvProdQty,i.stockOrderDetailBeansList[e].isDirty=!0,isNaN(i.stockOrderDetailBeansList[e].total)&&(i.stockOrderDetailBeansList[e].total="0");i.AllInOne()},i.updateStockOrderDetail=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].stockOrderId=i.stockOrderId;i.success=!1,i.error=!1,i.loading=!0,r.post("purchaseOrderDetails/updateStockOrderDetail/"+i._s_tk_com+"/"+i.grandTotal+"/"+i.stockOrderBean.itemCount,i.stockOrderDetailBeansList).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){if(i.success=!0,i.stockOrderDetailBeansList=e.data,0<i.stockOrderDetailBeansList.length)for(var t=0;t<i.stockOrderDetailBeansList.length;t++)i.stockOrderDetailBeansList[t].isDirty=!1;i.AllInOne(),s.put("_e_cOt_pio",""),a(function(){i.success=!1,o.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||i.responseStatus,i.error=!0,i.errorMessage=e.data}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})}},i.updateAndReceiveStockOrderDetails=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].stockOrderId=i.stockOrderId;i.success=!1,i.error=!1,i.loading=!0,r.post("purchaseOrderDetails/updateAndReceiveStockOrderDetails/"+i._s_tk_com+"/"+i.grandTotal+"/"+i.stockOrderBean.recItemCount,i.stockOrderDetailBeansList).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.success=!0,i.successMessage=e.data,s.put("_e_cOt_pio",""),a(function(){i.success=!1,o.location=e.layOutPath},2e3)):("SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||i.responseStatus,i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})}},i.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return i.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();i.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(i.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(i.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(i.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(i.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(i.hideRefValues=!0,i.stockOrderDetailBean.orderProdQty=1,i.productVariantBean=r[0],i.checkProductStatus(),i.selectedItem={},i.selectedItem.item=r[0],i.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(i.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),i.hideRefValues=!1),e},renderItem:function(e){return 0==i.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){i.productVariantBean=e.item}},i.editVariant=function(){console.log(i.productVariantBean),null!=i.productVariantBean&&null!=i.productVariantBean.productId&&null!=i.productVariantBean.outletId&&(i.loading=!0,r.post("newProduct/getNewProductControllerData/"+s.get("_s_tk_com")+"/"+i.productVariantBean.productId+"/"+i.productVariantBean.outletId).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){if(i.response=e.data,i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productVariantValuesCollectionOldOne=[],i.productVariantValuesCollectionOldTwo=[],i.productVariantValuesCollectionOldThree=[],i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="",i.addVariantsEntertained=!1,i.productVariantsCollection.push(i.myObj),null!=i.response){if(null!=i.response.supplierBeans&&(i.supplierList=i.response.supplierBeans),null!=i.response.productTypeBeanList&&(i.productTypeList=i.response.productTypeBeanList),null!=i.response.brandBeanList&&(i.brandList=i.response.brandBeanList),null!=i.response.outletBeans){null!=i.response.productBean.outletBeans?i.outletList=i.response.productBean.outletBeans:i.outletList=i.response.outletBeans;for(var t=0;t<i.outletList.length;t++)i.outletList[t].taxAmount=0,i.outletList[t].retailPrice=0;i.verientsOutletList=i.response.outletBeans}if(null!=i.response.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.response.variantAttributeBeanList),null!=i.response.productBean){if(i.productBean={},i.tempproductBean={},i.productBean=i.response.productBean,i.tempproductBean=angular.copy(i.response.productBean),i.compositProductCollection=angular.copy(i.productBean.compositProductCollection),0<i.productBean.productVariantsBeans.length){var r=function(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}(i.productBean.productVariantsBeans[0].variantAttributeName,"/");if(1==r){i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2;for(t=0;t<i.productBean.productVariantsBeans.length;t++){var a=i.productBean.productVariantsBeans[t].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,a[0])||(i.tempObject={},i.tempObject.value=a[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,a[1])||(i.tempObject.value=a[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={})}}else if(2==r){i.addAttributeDynamically(),i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2,i.productVariantsCollection[2].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId3;for(t=0;t<i.productBean.productVariantsBeans.length;t++){a=i.productBean.productVariantsBeans[t].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,a[0])||(i.tempObject={},i.tempObject.value=a[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,a[1])||(i.tempObject.value=a[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionThree,a[2])||(i.tempObject.value=a[2],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),i.valueCollectionThree.push(i.tempObject.value),i.tempObject={})}}else{i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1;for(t=0;t<i.productBean.productVariantsBeans.length;t++)i.tempObject={},i.tempObject.value=i.productBean.productVariantsBeans[t].variantAttributeName,i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}}}i.productVariantValuesCollectionOldOne=angular.copy(i.productVariantValuesCollectionOne),i.productVariantValuesCollectionOldTwo=angular.copy(i.productVariantValuesCollectionTwo),i.productVariantValuesCollectionOldThree=angular.copy(i.productVariantValuesCollectionThree),"true"==i.productBean.productCanBeSold?i.gui.productCanBeSold=!0:i.gui.productCanBeSold=!1,"true"==i.productBean.trackingProduct?i.gui.trackingProduct=!0:i.gui.trackingProduct=!1,"true"==i.productBean.varientProducts?i.gui.varientProducts=!0:i.gui.varientProducts=!1,"true"==i.productBean.standardProduct?i.gui.standardProduct=!0:i.gui.standardProduct=!1,null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap)}}i.evaluateRetailPrice(),i.variantError=!1,i.showAddVariantsModal=!0}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy}))},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={}},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree),function(e){i.productVariantValuesCollection=[];for(var t=0;t<i.verientsOutletList.length;t++)i.verientsOutletList[t].supplierCode=i.productBean.supplierId,i.verientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.verientsOutletList[t].markupPrct=i.productBean.markupPrct,i.verientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var r=0;r<e.length;r++){var a=p();i.temp={},i.temp.uUid=a;var o=e[r].split("/");for(t=0;t<i.verientsOutletList.length;t++)i.sku=i.sku+1," "!=o[0]&&(i.verientsOutletList[t].sku=i.productBean.sku+"-"+o[0],i.temp.varientName=o[0])," "!=o[1]&&(i.verientsOutletList[t].sku=i.productBean.sku+"-"+o[0]+"-"+o[1],i.temp.varientName=o[0]+"/"+o[1])," "!=o[2]&&(i.verientsOutletList[t].sku=i.productBean.sku+"-"+o[0]+"-"+o[1]+"-"+o[2],i.temp.varientName=o[0]+"/"+o[1]+"/"+o[2]);i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={}}if(0<i.productBean.productVariantsBeans.length)for(var n=0;n<i.productBean.productVariantsBeans.length;n++)for(t=0;t<i.productVariantValuesCollection.length;t++)i.productVariantValuesCollection[t].varientName==i.productBean.productVariantsBeans[n].variantAttributeName&&i.productVariantValuesCollection.splice(t,1);i.addVariantsEntertained=!0}(function e(t){if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var n=0;n<t[0].length;n++)r.push(t[0][n]+"/"+a[o]);return r}(e));for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].value=""},i.updateProduct=function(){if(i.productSuccess=!1,i.productError=!1,i.productAddError=!1,0<i.productBean.productVariantsBeans.length){i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree;for(var e=0;e<i.productBean.productVariantsBeans.length;e++)for(var t=0;t<i.productVariantValuesCollection.length;t++)i.productVariantValuesCollection[t].varientName==i.productBean.productVariantsBeans[e].variantAttributeName&&i.productVariantValuesCollection.splice(t,1);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection}else i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection;i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.tagList=i.tagList,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.loading=!0,r.post("manageProduct/updateProduct/"+i._s_tk_com,i.productBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddVariantsModal=!1,a(function(){i.productSuccess=!1,a(function(){n.reload()},500)},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,o.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(n)&&(n=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var s=(o*(n/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=s.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var n=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=B(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(s)&&(s=0),s=B(100*(o-n)/n,5),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=s.toString()}}},i.evaluateRetailPrice=function(){var e=parseFloat(i.productBean.supplyPriceExclTax),t=parseFloat(i.productBean.markupPrct);isNaN(t)&&(t=0,i.productBean.markupPrct="0");var r=e*(t/100)+e;if(i.productBean.retailPriceExclTax=r.toFixed(2).toString(),null!=i.outletList&&0<r)for(var a=0;a<i.outletList.length;a++){var o=r*(parseFloat(i.outletList[a].defaultTax)/100);i.outletList[a].taxAmount=o.toFixed(2).toString(),i.outletList[a].retailPrice=(o+r).toFixed(2).toString()}},i.skuinput=function(){(i.productSKU.includes("-")||6<i.productSKU.length)&&(null!=i.productVariantMap[i.productSKU.toLowerCase()]?(i.skudisable=!0,i.stockOrderDetailBean.orderProdQty=1,i.productVariantBean=i.productVariantMap[i.productSKU.toLowerCase()],i.checkProductStatus(),i.productSKU="",i.skudisable=!1):15<i.productSKU.length&&(i.productSKU="",i.skudisable=!1))},i.sessionValidation()}],POCreateandReceiveEditController=["$sce","$filter","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","POCreateandReceiveEditControllerPreLoad",function(t,e,n,r,a,o,s,i,c,l){i.MainSideBarhideit=!1,i.MainHeaderideit=!1,n.stockOrderId="",n.grandTotal="0",n.stockOrderBean={},n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){c.validate()&&(n._s_tk_com=s.get("_s_tk_com"),n.data=l.loadControllerData(),n.fetchData(),n.stockOrderBean=s.get("_ct_bl_ost"),n.stockOrderBean.diliveryDueDate=new Date(n.stockOrderBean.diliveryDueDate),n.stockOrderBean.itemCount=0,n.itemCountTotal=0,n.stockOrderBean.recItemCount=0,n.AllInOne())},n.fetchData=function(){if(i.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap),null!=n.data.outletBeansList&&(n.outletList=n.data.outletBeansList),null!=n.data.stockOrderTypeBeansList&&(n.stockOrderTypeBeansList=n.data.stockOrderTypeBeansList),null!=n.data.supplierBeansList&&(n.supplierList=n.data.supplierBeansList),null!=n.data.stockOrderDetailBeansList&&(n.stockOrderDetailBeansList=n.data.stockOrderDetailBeansList)}i.globalPageLoader=!1},n.addStockOrderUpdate=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="2",n.stockOrderBean.stockOrderTypeId="1",r.post("purchaseOrder/updateStockOrder/"+n._s_tk_com,n.stockOrderBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderId=e.data,n.stockOrderBean.stockOrderId=angular.copy(n.stockOrderId),s.put("_ct_bl_ost",n.stockOrderBean),n.updateStockOrderDetail()):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,o.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.showConfirmReceiveStockOrder=function(){n.showConfirmReceivePopup=!0},n.addStockOrderUpdateandReceive=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",n.stockOrderBean.stockOrderTypeId="1",r.post("purchaseOrder/updateStockOrder/"+n._s_tk_com,n.stockOrderBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderId=e.data,n.showConfirmReceivePopup=!1,n.stockOrderBean.stockOrderId=angular.copy(n.stockOrderId),s.put("_ct_bl_ost",n.stockOrderBean),n.updateAndReceiveStockOrderDetails()):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,o.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,r.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,o.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",n.stockOrderBean.recItemCount=0,n.grandTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].recvSupplyPrice*n.stockOrderDetailBeansList[e].recvProdQty,isNaN(n.stockOrderDetailBeansList[e].recvTotal)&&(n.stockOrderDetailBeansList[e].recvTotal="0"),n.stockOrderBean.recItemCount=parseInt(n.stockOrderBean.recItemCount)+parseInt(n.stockOrderDetailBeansList[e].recvProdQty),!isNaN(n.stockOrderBean.recItemCount)&&""!=n.stockOrderBean.recItemCount||(n.stockOrderBean.recItemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].recvTotal),isNaN(n.grandTotal)&&(n.grandTotal="0")},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),e.isDirty=!0)}),n.AllInOne()},n.calculateRecvTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.recvTotal=e.recvSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailListforRec=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].recvProdQty||null==n.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].recvSupplyPrice||null==n.stockOrderDetailBeansList[e].recvSupplyPrice)return!1}return!0}return!1},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},n.markAllReceive=function(){if(0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].recvProdQty="",n.stockOrderDetailBeansList[e].recvProdQty=angular.copy(n.stockOrderDetailBeansList[e].orderProdQty),n.stockOrderDetailBeansList[e].recvSupplyPrice="",n.stockOrderDetailBeansList[e].recvSupplyPrice=angular.copy(n.stockOrderDetailBeansList[e].ordrSupplyPrice),n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].recvSupplyPrice*n.stockOrderDetailBeansList[e].recvProdQty,n.stockOrderDetailBeansList[e].isDirty=!0,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0");n.AllInOne()},n.updateStockOrderDetail=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].stockOrderId=n.stockOrderId;n.success=!1,n.error=!1,n.loading=!0,r.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),s.put("_e_cOt_pio",""),a(function(){n.success=!1},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){i.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})}},n.updateAndReceiveStockOrderDetails=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].stockOrderId=n.stockOrderId;n.success=!1,n.error=!1,n.loading=!0,r.post("purchaseOrderDetails/updateAndReceiveStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.recItemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,s.put("_e_cOt_pio",""),a(function(){n.success=!1,o.location=e.layOutPath},2e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})}},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],PriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","PriceBookControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.priceBookList=e.data,e.roledId=a.get("_s_tk_rId"),setTimeout(function(){$("#myTable").DataTable({responsive:!0,order:[[6,"Created At"]],paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.addPriceBook=function(){r.location="/app/#/newPriceBook"},e.editPriceBook=function(e){a.put("_e_cPri_gra",e.priceBookId),r.location="/app/#/managePriceBook"},e.sessionValidation()}],PrintLabelsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","PrintLabelsControllerPreLoad","$timeout","$sce",function(s,e,t,a,o,n,i,c,r){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,s.products=[],s.product={},s.airportName=[],c(function(){s.printCount=s.printCounting,JsBarcode(".barcode").init()},1500),s.productVaraintDetailBeanList=[],s.sessionValidation=function(){for(var e=0;e<40;e++)s.product={},s.product.id=e,s.products.push(s.product);if(o.globalPageLoader=!1,n.validate()){s._s_tk_com=a.get("_s_tk_com"),s.data=i.loadControllerData(),s.companyName=s.data.companyName,s.allProducts=s.data.productsBean;for(var t=0;t<s.allProducts.length;t++)if(s.allProducts[t].productVariantsBeans)for(var r=0;r<s.allProducts[t].productVariantsBeans.length;r++)s.productVaraintDetailBeanList.push(s.allProducts[t].productVariantsBeans[r])}},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),s.productVariantsBeans=[],_.filter(s.productVaraintDetailBeanList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)})},renderItem:function(e){if(void 0===e.firstName){if(s.variantSkuFound)return void(s.variantSkuFound=!1);var t={value:e.variantAttributeName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 100%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}}else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};return t},itemSelected:function(e){s.selectedItem={},s.selectedItem=e,s.selectProduct=!0,s.printLabelsFunc(s.selectedItem.item)}},s.fetchData=function(){o.roleDetailsLoadedFully=!1,"NORECORDFOUND"==s.data?(s.error=!0,s.errorMessage="No record found"):"SYSTEMBUSY"==s.data?(s.error=!0,s.errorMessage=s.systemBusy):"INVALIDSESSION"==s.data&&(s.error=!0,s.errorMessage="An exception occured while validating session !",t.location="/app/#/login")},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},s.printCountChange=function(){var e=s.selectedItem.item;s.printCount=s.printCounting;for(var t=0;t<s.printCount;t++){if(s.printLabelsProduct={},s.printLabelsProduct.sku=e.sku,e.variantAttributeName){var r=e.variantAttributeName.split("/");s.printLabelsProduct.productName=""+e.variantAttributeName.replaceAll("/","-"),s.printLabelsProduct.productNameOnly=e.productName,s.printLabelsProduct.variantAttributeValue1=r[1],s.printLabelsProduct.variantAttributeValue2=r[2],s.printLabelsProduct.productDesc=e.productDesc}else s.printLabelsProduct.productName=e.productName;s.printLabelsProduct.price=e.netPrice,s.printLabelsProduct.id=t,s.layoutproducts.push(s.printLabelsProduct)}c(function(){JsBarcode(".barcode").init(),s.printLabels=!1,s.printCounting=""},1500)},s.layoutproducts=[],s.layoutproduct={},s.printLoading=!1,s.printList=[],s.printLabelsFunc=function(e){if(s.printLabelsProduct={},s.printLoading=!0,s.printLabelsProduct.sku=e.sku,e.variantAttributeName){var t=e.variantAttributeName.split("/");s.printLabelsProduct.productName=""+e.variantAttributeName.replaceAll("/","-"),s.printLabelsProduct.productNameOnly=e.productName,s.printLabelsProduct.variantAttributeValue1=t[1],s.printLabelsProduct.variantAttributeValue2=t[2],s.printLabelsProduct.productDesc=e.productDesc}else s.printLabelsProduct.productName=e.productName;s.printLabelsProduct.price=e.netPrice,e.varientProducts;for(var r=0;r<1;r++){s.layoutproduct={},s.layoutproduct.id=r;var a=s.layoutproducts.length;0==a&&(s.layoutproducts.push(s.printLabelsProduct),s.printList.push(e.sku));for(var o=!0,n=0;n<a;n++)o=!(!s.layoutproducts[n]||s.layoutproducts[n].productName!=s.printLabelsProduct.productName)}o||(s.layoutproducts.push(s.printLabelsProduct),s.printList.push(e.sku)),c(function(){JsBarcode(".barcode").init(),s.printLabels=!1,s.printLoading=!1},1500)},s.printThisElementA4="printThisElement",s.printOptionsA4=!0,s.changePrinter=function(){"A4"==s.printOptions?(s.printOptionsA4=!0,s.printOptionsContinous=!1,s.printOptionsContinousLarge=!1,s.printOptionsContinousNew=!1,s.printOptionsContinousNewZebra=!1,s.printThisElementA4="printThisElement",s.printThisElementContinous="",s.printThisElementContinousLarge="",s.printThisElementContinousNew="",s.printThisElementContinousNewZebra=""):"Continous"==s.printOptions?(s.printOptionsA4=!1,s.printOptionsContinous=!0,s.printOptionsContinousLarge=!1,s.printOptionsContinousNew=!1,s.printOptionsContinousNewZebra=!1,s.printThisElementA4="",s.printThisElementContinous="printThisElement",s.printThisElementContinousLarge="",s.printThisElementContinousNew="",s.printThisElementContinousNewZebra=""):"ContinousNew"==s.printOptions?(s.printOptionsA4=!1,s.printOptionsContinous=!1,s.printOptionsContinousLarge=!1,s.printOptionsContinousNew=!0,s.printOptionsContinousNewZebra=!1,s.printThisElementA4="",s.printThisElementContinousNew="printThisElement",s.printThisElementContinousLarge="",s.printThisElementContinous="",s.printThisElementContinousNewZebra=""):"ContinousLarge"==s.printOptions?(s.printOptionsA4=!1,s.printOptionsContinous=!1,s.printOptionsContinousLarge=!0,s.printOptionsContinousNew=!1,s.printOptionsContinousNewZebra=!1,s.printThisElementA4="",s.printThisElementContinous="",s.printThisElementContinousLarge="printThisElement",s.printThisElementContinousNew="",s.printThisElementContinousNewZebra=""):"ContinousNewZebra"==s.printOptions&&(s.printOptionsA4=!1,s.printOptionsContinous=!1,s.printOptionsContinousLarge=!1,s.printOptionsContinousNew=!1,s.printOptionsContinousNewZebra=!0,s.printThisElementA4="",s.printThisElementContinousNew="",s.printThisElementContinousLarge="",s.printThisElementContinous="",s.printThisElementContinousNewZebra="printThisElement")},s.sessionValidation()}],ProductDetailsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","ProductDetailsControllerPreLoad","$timeout",function(o,e,r,t,a,n,s,i){a.MainSideBarhideit=!1,a.MainHeaderideit=!1,o.printCount=40,o.roledId=t.get("_s_tk_rId"),o.bc={format:"CODE128",width:1,height:44,displayValue:!1,marginRight:10},o.sesssionValidation=function(){n.validate()&&(o._s_tk_com=t.get("_s_tk_com"),o.fetchData())},o.printLabels=!0,o.fetchData=function(){if(o.data=s.loadControllerData(),a.productDetailsLoadedFully=!1,"NORECORDFOUND"==o.data)o.error=!0,o.errorMessage="No record found";else if("SYSTEMBUSY"==o.data)o.error=!0,o.errorMessage=o.systemBusy;else if("INVALIDSESSION"==o.data)o.error=!0,o.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=o.data){if(null!=o.data.productBean)if(o.product={},o.product=o.data.productBean,null!==o.product.productVariantsBeans&&0<o.product.productVariantsBeans.length){for(var e=0,t=0;t<o.product.productVariantsBeans.length;t++)e+=parseFloat(o.product.productVariantsBeans[t].netPrice);o.averagePrice=(e/o.product.productVariantsBeans.length).toFixed(2).toString()}else o.averagePrice=o.product.netPrice;null!=o.data.productHistoryBeans&&(o.productHistoryBeansList=o.data.productHistoryBeans)}a.globalPageLoader=!1},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},o.editProduct=function(){t.put("_e_cPi_gra",o.product.productId),t.put("_e_cOi_gra",o.product.outletId),r.location="/app/#/manageProduct"},o.printCountChange=function(){o.printCount=o.printCounting,o.layoutproducts=[];for(var e=0;e<o.printCount;e++)o.layoutproduct={},o.layoutproduct.id=e,o.layoutproduct.productName=o.printLabelsProduct.productName,o.layoutproduct.sku=o.printLabelsProduct.sku,o.layoutproduct.price=o.printLabelsProduct.price,o.layoutproducts.push(o.layoutproduct);i(function(){JsBarcode(".barcode").init(),o.printLabels=!1},1500)},o.layoutproducts=[],o.layoutproduct={},o.printLoading=!1,o.printLabelsProduct={},o.printLabelsAll=function(e){o.printLoading=!0;for(var t=0;t<e.productVariantsBeans.length;t++){var r=e.productVariantsBeans[t];r.variantAttributeName&&(r.productName=r.productName+" "+r.variantAttributeName.replaceAll("/","-"));for(var a=0;a<r.printCount;a++)o.layoutproduct={},o.layoutproduct.id=a,o.layoutproduct.productName=r.productName,o.layoutproduct.sku=r.sku,o.layoutproduct.price=r.netPrice,o.layoutproduct.productNameOnly=r.productName,o.layoutproduct.variantAttributeValue1=r.variantAttributeValue1,o.layoutproduct.variantAttributeValue2=r.variantAttributeValue2,o.layoutproducts.push(o.layoutproduct)}i(function(){JsBarcode(".barcode").init(),o.printLabels=!1,o.printLoading=!1,o.hideCount=!0},1500)},o.hideCount=!1,o.printLabels=function(e){o.printLoading=!0,o.printLabelsProduct.sku=e.sku,o.printLabelsProduct.productName=e.productName,e.variantAttributeName&&(o.printLabelsProduct.productName=o.printLabelsProduct.productName+" "+e.variantAttributeName.replaceAll("/","-")),o.printLabelsProduct.price=e.netPrice;for(var t=0;t<e.printCount;t++)o.layoutproduct={},o.layoutproduct.id=t,o.layoutproduct.productName=o.printLabelsProduct.productName,o.layoutproduct.productNameOnly=e.productName,o.layoutproduct.sku=o.printLabelsProduct.sku,o.layoutproduct.price=o.printLabelsProduct.price,o.layoutproduct.variantAttributeValue1=e.variantAttributeValue1,o.layoutproduct.variantAttributeValue2=e.variantAttributeValue2,o.layoutproducts.push(o.layoutproduct);i(function(){JsBarcode(".barcode").init(),o.printLabels=!1,o.printLoading=!1},1500)},o.printThisElementA4="printThisElement",o.printOptionsA4=!0,o.changePrinter=function(){"A4"==o.printOptions?(o.printOptionsA4=!0,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="printThisElement",o.printThisElementContinous="",o.printThisElementContinousLarge="",o.printThisElementContinousNew="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"Continous"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!0,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinous="printThisElement",o.printThisElementContinousLarge="",o.printThisElementContinousNew="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"ContinousNew"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!0,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinousNew="printThisElement",o.printThisElementContinousLarge="",o.printThisElementContinous="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"ContinousLarge"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!0,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinous="",o.printThisElementContinousLarge="printThisElement",o.printThisElementContinousNew="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"ContinousNewZebra"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!0,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinousNew="",o.printThisElementContinousLarge="",o.printThisElementContinous="",o.printThisElementContinousNewZebra="printThisElement",o.printThisElementContinousDouble=""):"ContinousDouble"==o.printOptions&&(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!0,o.printThisElementA4="",o.printThisElementContinousNew="",o.printThisElementContinousLarge="",o.printThisElementContinous="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble="printThisElement")},o.sesssionValidation()}],ProductPriceHistoryController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","ProductPriceHistoryControllerPreLoad",function(e,t,r,a,o,n,s,i){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,e.roledId=o.get("_s_tk_rId"),e.dataLoading=!1,e.sessionValidation=function(){s.validate()&&(e._s_tk_com=o.get("_s_tk_com"),e.productName=o.get("_e_cPiN_gra"),e.data=i.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found",e.dataLoading=!0):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy,e.dataLoading=!0):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=e.data&&(e.productPriceHistoryList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,pageLength:10,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:n.buttonsView})},1)),e.dataLoading=!0),n.globalPageLoader=!1},e.sessionValidation()}],ProductsController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","ProductsControllerPreLoad",function(r,e,t,a,o,n,s,i){function c(e){if("undefined"!=r.comparisonProductsList&&null!=r.comparisonProductsList&&0<r.comparisonProductsList.length)for(var t=0;t<r.comparisonProductsList.length;t++)if(r.comparisonProductsList[t].productId==e.productId)return!0;return!1}n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.gui={},r.gui.showProductPriceHistory=!1,r.roledId=o.get("_s_tk_rId"),r.dataLoading=!1,r.addProduct=function(){a.location="/app/#/newProduct"},r.addCompositeProduct=function(){a.location="/app/#/newCompositeProduct"},r.showProduct=function(e){o.put("_d_cPi_gra",e.productId),a.location="/app/#/productDetails"},r.editProduct=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cOi_gra",e.outletId),"true"==e.isComposite?a.location="/app/#/manageCompositeProduct":a.location="/app/#/manageProduct"},r.showProductPriceHistory=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cPiN_gra",e.productName),a.location="/app/#/productPriceHistory"},r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.fetchData())},r.fetchData=function(){i.loadControllerData(),"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(r.productsList=null,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/false").success(function(e){r.data=e.data,null!=r.data.productBeanList&&(r.productsList=r.data.productBeanList),null!=r.data.showProductPriceHistory&&("true"==r.data.showProductPriceHistory?r.gui.showProductPriceHistory=!0:r.gui.showProductPriceHistory=!1),r.comparisonProductsList=r.data.productBeanList,r.lodAllProductsAsynchrnously(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,pageLength:5,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:n.buttonsView})},1),r.dataLoading=!0}).error(function(){a.location="/app/#/login"}),r.lodAllProductsGraph()),n.globalPageLoader=!1},r.lodAllProductsGraph=function(){r.dataLoading=!1,e.post("products/getProductDashBoard/"+o.get("_s_tk_com")).success(function(e){r.data=e.data,r.chartCustomerCount=new CanvasJS.Chart("chartContainerProductCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:r.data.dataPointsCustomerCount}]}),r.chartCustomerCount.render(),r.dataLoadingGraph=!0}).error(function(){})},r.lodAllProductsAsynchrnously=function(){r.dataLoading=!1,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/true").success(function(e){r.data=e.data,r.dataLoading=!0}).error(function(){a.location="/app/#/login"})},r.lodAllProducts=function(){r.dataLoading=!1;for(var e=0;e<r.data.productBeanList.length;e++)c(r.data.productBeanList[e])||r.productsList.push(r.data.productBeanList[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:n.buttonsView})},1),r.dataLoading=!0},r.autoCompleteOptionsProducts={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),r.Product=[],_.filter(r.data.productBeanList,function(e){if(e.productName)return e.productName.toLowerCase().includes(t)||e.brandName.toLowerCase().includes(t)||e.createdDate.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.productName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 30%'>"+e.productName+"</td><td style='width: 20%'>"+e.createdDate+"</td><td style='width: 10%'>"+e.brandName+"</td><td style='width: 10%'>"+e.supplierName+"</td><td style='width: 10%'>"+e.varinatsCount+"</td><td style='width: 10%'>"+e.netPrice+"</td><td style='width: 10%'>"+e.inventoryCount+"</td></tr></tbody></table>")}},itemSelected:function(e){r.selectedItem=e,r.CustomerName=r.selectedItem,r.showProduct(r.selectedItem.item)}},r.sessionValidation()}],ProductStockHistoryReportController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","ProductStockHistoryReportControllerPreLoad",function(a,r,t,o,n,e,s,i,c,l,u,d){e.MainSideBarhideit=!1,e.MainHeaderideit=!1,a.productStockHistoryReportSuccess=!1,a.productStockHistoryReportError=!1,a.productStockHistoryReportError=!1,a.productStockHistoryReportBean={},a.productBean={},a.productVariantSelList=[],a.productVariantBeansList=[],a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[];var p={buttons:[{extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}},B=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=B,a.sessionValidation=function(){s.validate()&&(a._s_tk_com=n.get("_s_tk_com"),a.data=d.loadControllerData(),a.fetchData())},a.fetchData=function(){if(a.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=a.data.productVariantBeansList&&(a.productVariantBeansList=a.data.productVariantBeansList),null!=a.data.productBeansList){a.productBeansList=a.data.productBeansList;for(var e=0;e<a.productVariantBeansList.length;e++)a.productBeansList.push(a.productVariantBeansList[e])}a.stockOrder=!0,a.stockTransfer=!0,a.stockReturn=!0,a.stockReturnToWarehouse=!0}a.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.checkProductStatus()}),a.changeReportDataType=function(){a.productStockHistoryReportType=a.reportType},a.changeOutletName=function(){a.inventoryReportOutletName=a.outletName},a.checkProductStatus=function(){if(null!=a.productVariantBean)if("true"==a.productVariantBean.isVariant.toString())a.productVariantSelList.push(a.productVariantBean),a.fetchProductStockHistoryReportByDateRange();else{if(a.hit=0,"true"==a.productVariantBean.isProduct.toString())a.productVariantSelList.push(a.productVariantBean),a.fetchProductStockHistoryReportByDateRange(),a.hit++;else{for(var e=0;e<a.productVariantBeansList.length;e++){var t=null;a.productVariantBean.productVariantId==a.productVariantBeansList[e].productId&&(t=angular.copy(a.productVariantBean),a.productVariantBean=angular.copy(a.productVariantBeansList[e]),a.productVariantSelList.push(a.productVariantBean),a.productVariantBean=angular.copy(t),a.hit++)}a.fetchProductStockHistoryReportByDateRange()}a.hit<1&&(a.productVariantBean.isProduct="true",a.fetchProductStockHistoryReportByDateRange())}},a.fetchProductStockHistoryReportByDateRange=function(){if(0<a.productVariantSelList.length&&null!=a.productStockHistoryReportType&&""!=a.productStockHistoryReportType){a.productStockHistoryReportSuccess=!1,a.productStockHistoryReportError=!1,a.loading=!0;var e,t=a.dateRange.split("-");if(a.productStockHistoryReportStartDate=t[0].trim(),a.productStockHistoryReportEndDate=t[1].trim(),a.productBean.totalReceived=0,a.productBean.totalReturn=0,a.productBean.totalTransfered=0,a.productBean.totalRtw=0,a.productBean.totalItems=0,a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[],0==a.stockOrderDetailBeansList.length)(e=$("#myTable").DataTable())&&e.destroy();if(0==a.stockOrderDetailBeansList1.length)(e=$("#myTable2").DataTable())&&e.destroy();if(0==a.stockOrderDetailBeansList2.length)(e=$("#myTable1").DataTable())&&e.destroy();if(0==a.stockOrderDetailBeansList3.length)(e=$("#myTable3").DataTable())&&e.destroy();r.post("productStockHistoryReport/getProductStockHistoryReportByDateRange/"+n.get("_s_tk_com")+"/"+a.productStockHistoryReportStartDate+"/"+a.productStockHistoryReportEndDate+"/"+a.productStockHistoryReportType,a.productVariantSelList).success(function(e){0==a.stockOrderDetailBeansList.length&&(r=$("#myTable").DataTable())&&r.destroy();0==a.stockOrderDetailBeansList1.length&&(r=$("#myTable2").DataTable())&&r.destroy();0==a.stockOrderDetailBeansList2.length&&(r=$("#myTable1").DataTable())&&r.destroy();0==a.stockOrderDetailBeansList3.length&&(r=$("#myTable3").DataTable())&&r.destroy();if("1"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList=e.data,a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[],null!=a.stockOrderDetailBeansList)for(var t=0;t<a.stockOrderDetailBeansList.length;t++)a.productBean.totalReceived=parseInt(a.productBean.totalReceived)+parseInt(a.stockOrderDetailBeansList[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList[t].recvProdQty);a.stockOrder=!1,a.stockTransfer=!0,a.stockReturn=!0,a.stockReturnToWarehouse=!0,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}else if("2"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList1=e.data,a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[],null!=a.stockOrderDetailBeansList1)for(t=0;t<a.stockOrderDetailBeansList1.length;t++)a.productBean.totalReturn=parseInt(a.productBean.totalReturn)+parseInt(a.stockOrderDetailBeansList1[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList1[t].orderProdQty);a.stockOrder=!0,a.stockReturn=!1,a.stockTransfer=!0,a.stockReturnToWarehouse=!0,(r=$("#myTable2").DataTable())&&r.destroy(),setTimeout(function(){$("#myTable2").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}else if("3"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList2=e.data,a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList3=[],null!=a.stockOrderDetailBeansList2)for(t=0;t<a.stockOrderDetailBeansList2.length;t++)a.productBean.totalTransfered=parseInt(a.productBean.totalTransfered)+parseInt(a.stockOrderDetailBeansList2[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList2[t].orderProdQty);a.stockOrder=!0,a.stockReturn=!0,a.stockTransfer=!1,a.stockReturnToWarehouse=!0,(r=$("#myTable1").DataTable())&&r.destroy(),setTimeout(function(){$("#myTable1").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}else if("4"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList3=e.data,a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList=[],null!=a.stockOrderDetailBeansList3)for(t=0;t<a.stockOrderDetailBeansList3.length;t++)a.productBean.totalRtw=parseInt(a.productBean.totalRtw)+parseInt(a.stockOrderDetailBeansList3[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList3[t].orderProdQty);var r;a.stockOrder=!0,a.stockReturn=!0,a.stockTransfer=!0,a.stockReturnToWarehouse=!1,(r=$("#myTable3").DataTable())&&r.destroy(),setTimeout(function(){$("#myTable3").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}a.loading=!1,a.productVariantSelList=[],a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?a.success=!0:"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,o.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){a.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})}},a.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),a.productVariantsBeans=[];var e=_.filter(a.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(a.productBeansList,function(e){return e.sku.toLowerCase()==t});return r&&0<r.length&&(a.productVariantBean=r[0],a.checkProductStatus(),a.selectedItem={},a.selectedItem.item=r[0]),e},renderItem:function(e){return{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}},itemSelected:function(e){a.productVariantBean=e.item}},a.sessionValidation()}],ProductTagsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","ProductTagsControllerPreLoad",function(t,r,a,e,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.tagSuccess=!1,t.tagError=!1,t.tagBean={},t.tagList=[],t.sessionValidation=function(){i.validate()&&(t._s_tk_com=e.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.productTagsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=t.data&&(t.tagList=t.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},t.showAddTagPopup=function(){t.tagBean={},t.showNewTagModal=!0},t.addTag=function(){t.tagSuccess=!1,t.tagError=!1,t.loading=!0;for(var e=0;e<t.tagList.length;e++)if(t.tagList[e].tagName.toLowerCase()==t.tagBean.tagName.toLowerCase())return t.tagError=!0,t.tagErrorMessage="Tag already exist with name: "+t.tagBean.tagName,t.showNewTagModal=!1,t.loading=!1,void n(function(){t.tagError=!1},2e3);r.post("productTags/addTag/"+t._s_tk_com,t.tagBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.tagBean={},t.tagSuccess=!0,t.tagSuccessMessage="Request Processed Successfully!",t.showNewTagModal=!1,n(function(){t.tagSuccess=!1,n(function(){s.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.tagError=!0,t.tagErrorMessage=e.data,a.location=e.layOutPath):(t.tagError=!0,t.tagErrorMessage=e.data)}).error(function(){t.loading=!1,t.tagError=!0,t.tagErrorMessage=t.systemBusy})},t.showUpdateTagPopup=function(e){t.updateTagBean={},t.updateTagBean=angular.copy(e),t.showUpdateTagModal=!0},t.updateTag=function(){t.tagSuccess=!1,t.tagError=!1,t.loading=!0;for(var e=0;e<t.tagList.length;e++)if(t.tagList[e].tagName.toLowerCase()==t.updateTagBean.tagName.toLowerCase())return t.tagError=!0,t.tagErrorMessage="Tag already exist with name: "+t.updateTagBean.tagName,t.showUpdateTagModal=!1,t.loading=!1,void n(function(){t.tagError=!1},2e3);r.post("productTags/updateTag/"+t._s_tk_com,t.updateTagBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updateTagBean={},t.tagSuccess=!0,t.tagSuccessMessage=e.data,t.showUpdateTagModal=!1,n(function(){t.tagSuccess=!1,n(function(){s.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.tagError=!0,t.tagErrorMessage=e.data,a.location=e.layOutPath):(t.tagError=!0,t.tagErrorMessage=e.data)}).error(function(){t.loading=!1,t.tagError=!0,t.tagErrorMessage=t.systemBusy})},t.fetchAllTags=function(){r.post("productTags/getAllTags/"+t._s_tk_com).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.tagList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,a.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sessionValidation()}],ProductTypeController=["$scope","$http","$timeout","$route","$window","$cookieStore","$rootScope","SessionService","ProductTypeControllerPreLoad",function(t,e,r,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,t.showAddProducTypeModal=!1,t.showUpdateProductTypeModal=!1,t.productTypeBean={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=n.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){s.productTypeLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):null!=t.data&&(t.productTypeList=t.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),s.globalPageLoader=!1},t.showAddProductTypePopup=function(){t.productTypeBean={},t.showAddProducTypeModal=!0},t.addProductType=function(){t.productTypeSuccess=!1,t.productTypeError=!1,t.loading=!0,e.post("productType/addProductType/"+t._s_tk_com,t.productTypeBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.productTypeBean={},t.productTypeSuccess=!0,t.productTypeSuccessMessage="Request Processed successfully!",t.showAddProducTypeModal=!1,r(function(){t.productTypeSuccess=!1,r(function(){a.reload()},500)},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.productTypeError=!0,t.productTypeErrorMessage=e.data,o.location=e.layOutPath):(t.productTypeError=!0,t.productTypeErrorMessage=e.data)}).error(function(){t.loading=!1,t.productTypeError=!0,t.productTypeErrorMessage=t.systemBusy})},t.showUpdateProductTypePopup=function(e){t.updateProductTypeBean={},t.updateProductTypeBean=angular.copy(e),t.showUpdateProductTypeModal=!0},t.updateProductType=function(){t.productTypeSuccess=!1,t.productTypeError=!1,t.loading=!0,e.post("productType/updateProductType/"+t._s_tk_com,t.updateProductTypeBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updateProductTypeBean={},t.productTypeSuccess=!0,t.productTypeSuccessMessage=e.data,t.showUpdateProductTypeModal=!1,r(function(){t.productTypeSuccess=!1,r(function(){a.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.productTypeError=!0,t.productTypeErrorMessage=e.data,o.location=e.layOutPath):(t.productTypeError=!0,t.productTypeErrorMessage=e.data)}).error(function(){t.loading=!1,t.productTypeError=!0,t.productTypeErrorMessage=t.systemBusy})},t.sessionValidation()}],ProductTypeSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","ProductTypeSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],PurchaseOrderActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","PurchaseOrderActionsControllerPreLoad",function(r,e,a,t,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.disableProcess=!1,r.showConfirmCancelPopup=!1,r.stockOrderDetailBeansList=[],r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.stockOrderBean=o.get("_ct_bl_ost"),r.data=c.loadControllerData(),r.fetchData(),"3"!=r.stockOrderBean.statusId&&"8"!=r.stockOrderBean.statusId||(r.disableProcess=!0),r.isAdmin(),r.stockOrderBean.itemCount=0,r.stockOrderBean.recItemCount=0,r.calculateItemCount(),r.calculateRecItemCount(),r.calculateGrandrecvTotal())},r.fetchData=function(){if(s.purchaseOrderActionsLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=r.data){"No record found !"!=r.data&&(r.stockOrderDetailBeansList=r.data,r.calculateGrandTotal());var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+r.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Order from: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.supplierName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delievr to: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.calculateGrandTotal=function(){if(r.grandTotal="0",0<r.stockOrderDetailBeansList.length)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)isNaN(r.stockOrderDetailBeansList[e].total)&&(r.stockOrderDetailBeansList[e].total="0"),r.grandTotal=parseFloat(r.grandTotal)+parseFloat(r.stockOrderDetailBeansList[e].total),isNaN(r.grandTotal)&&(r.grandTotal="0")},r.calculateGrandrecvTotal=function(){if(r.grandrecvTotal="0",0<r.stockOrderDetailBeansList.length)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)isNaN(r.stockOrderDetailBeansList[e].recvTotal)&&(r.stockOrderDetailBeansList[e].recvTotal="0"),r.grandrecvTotal=parseFloat(r.grandrecvTotal)+parseFloat(r.stockOrderDetailBeansList[e].recvTotal),isNaN(r.grandrecvTotal)&&(r.grandrecvTotal="0")},r.calculateItemCount=function(){if(r.stockOrderBean.itemCount=0,null!=r.stockOrderDetailBeansList)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)r.stockOrderBean.itemCount=parseInt(r.stockOrderBean.itemCount)+parseInt(r.stockOrderDetailBeansList[e].orderProdQty),isNaN(r.stockOrderBean.itemCount)&&(r.stockOrderBean.itemCount="0")},r.calculateRecItemCount=function(){if(r.stockOrderBean.recItemCount=0,null!=r.stockOrderDetailBeansList)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)r.stockOrderBean.recItemCount=parseInt(r.stockOrderBean.recItemCount)+parseInt(r.stockOrderDetailBeansList[e].recvProdQty),isNaN(r.stockOrderBean.recItemCount)&&(r.stockOrderBean.recItemCount="0")},r.showCancelStockOrder=function(){r.showConfirmCancelPopup=!0},r.cancelStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="8",r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,r.showConfirmCancelPopup=!1,t(function(){r.success=!1,a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.purchaseOrderReceive=function(){a.location="/app/#/poCreateandReceiveEdit"},r.purchaseOrderEditProducts=function(){a.location="/app/#/purchaseOrderEditProducts"},r.purchaseOrderEditDetails=function(){a.location="/app/#/poCreateandReceiveEdit"},r.sessionValidation(),s.globalPageLoader=!1}],PurchaseOrderController=["$scope","$filter","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","PurchaseOrderControllerPreLoad",function(r,e,t,a,o,n,s,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=e("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.data=c.loadControllerData(),r.fetchData(),r.stockOrderBean.outletId=r.userOutletId)},r.fetchData=function(){n.purchaseOrderLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),n.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="1",t.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,s(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],PurchaseOrderDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderDetailsControllerPreLoad",function(t,n,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.hideRefValues=!1,n.counter=1,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.data=c.loadControllerData(),n.fetchData(),n.stockOrderBean=o.get("_e_cOt_pio");var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},n.fetchData=function(){if(s.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data&&(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList)){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}s.globalPageLoader=!1},n.addProduct=function(){n.dualEntry=!1;var a={},o=JSON.parse(n.productVariantBean);0<n.stockOrderDetailBeansList.length?("true"!=o.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"!=e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(a),n.arrangeOrder(),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(a),n.arrangeOrder(),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=o.productVariantId,n.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,n.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=o.productVariantId,n.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,n.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={}},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.arrangeOrder()},n.arrangeOrder=function(){if(n.counter=1,0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++},n.calculateTotal=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"))})},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},n.addStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),r(function(){n.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.sessionValidation()}],PurchaseOrderEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderEditDetailsControllerPreLoad",function(r,e,t,a,o,n,s,i){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.data=i.loadControllerData(),r.fetchData(),r.stockOrderBean=o.get("_ct_bl_ost"),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate))},r.fetchData=function(){n.purchaseOrderEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),n.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="1",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],PurchaseOrderEditProductsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderEditProductsControllerPreLoad",function(n,e,t,r,o,a,s,i){a.MainSideBarhideit=!1,a.MainHeaderideit=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.hideRefValues=!1,n.sessionValidation=function(){if(s.validate()){n._s_tk_com=o.get("_s_tk_com"),n.data=i.loadControllerData(),n.fetchData(),n.stockOrderBean=o.get("_ct_bl_ost");var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},n.fetchData=function(){a.purchaseOrderEditProductsLoadedFully=!1,"NORECORDFOUND"==n.data?(n.error=!0,n.errorMessage="No record found"):"SYSTEMBUSY"==n.data?(n.error=!0,n.errorMessage=n.systemBusy):"INVALIDSESSION"==n.data?(n.error=!0,n.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=n.data.stockOrderDetailBeansList&&(n.stockOrderDetailBeansList=n.data.stockOrderDetailBeansList,n.arrangeOrder()),null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList)),a.globalPageLoader=!1},n.addProduct=function(){n.dualEntry=!1;var a={},o=JSON.parse(n.productVariantBean);0<n.stockOrderDetailBeansList.length?("true"!=o.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"!=e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(a),n.arrangeOrder(),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(a),n.arrangeOrder(),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=o.productVariantId,n.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,n.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=o.productVariantId,n.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,n.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={}},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.arrangeOrder()},n.arrangeOrder=function(){if(n.counter=1,0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++},n.calculateTotal=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"))})},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},n.updateStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,o.put("_e_cOt_pio",""),t(function(){n.success=!1},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,r.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){a.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.sessionValidation()}],PurchaseOrderReceiveController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderReceiveControllerPreLoad",function(n,t,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.counter=1,n.hideRefValues=!1,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.data=c.loadControllerData(),n.fetchData(),n.stockOrderBean=o.get("_ct_bl_ost");var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}n.grandTotal="0"},n.fetchData=function(){if(s.purchaseOrderReceiveLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}null!=n.data.outletBeansList&&(n.outletList=n.data.outletBeansList),null!=n.data.stockOrderTypeBeansList&&(n.stockOrderTypeBeansList=n.data.stockOrderTypeBeansList),null!=n.data.supplierBeansList&&(n.supplierList=n.data.supplierBeansList),null!=n.data.stockOrderDetailBeansList&&(n.stockOrderDetailBeansList=n.data.stockOrderDetailBeansList,n.arrangeOrder(),n.calculateGrandTotal())}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}},n.addProduct=function(){n.dualEntry=!1;var a={},o=n.productVariantBean;0<n.stockOrderDetailBeansList.length?("true"!=o.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"!=e.isProduct&&"true"!=o.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(a),n.arrangeOrder(),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(a),n.arrangeOrder(),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=o.productVariantId,n.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,n.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=o.productVariantId,n.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,n.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.calculateItemCount(),n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.arrangeOrder(),n.calculateGrandTotal(),n.calculateItemCount(),n.calculateRecItemCount()},n.arrangeOrder=function(){if(n.counter=1,0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++},n.calculateTotal=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"))}),n.calculateItemCount()},n.calculateItemCount=function(){if(n.stockOrderBean.itemCount=0,null!=n.stockOrderDetailBeansList)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0")},n.calculateRecItemCount=function(){if(n.stockOrderBean.recItemCount=0,null!=n.stockOrderDetailBeansList)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderBean.recItemCount=parseInt(n.stockOrderBean.recItemCount)+parseInt(n.stockOrderDetailBeansList[e].recvProdQty),isNaN(n.stockOrderBean.recItemCount)&&(n.stockOrderBean.recItemCount="0")},n.calculateRecvTotal=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.recvTotal=e.recvSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"))}),n.calculateGrandTotal()},n.calculateGrandTotal=function(){if(n.grandTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)isNaN(n.stockOrderDetailBeansList[e].recvTotal)&&(n.stockOrderDetailBeansList[e].recvTotal="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].recvTotal),isNaN(n.grandTotal)&&(n.grandTotal="0");n.calculateRecItemCount()},n.checkStockOrderDetailListforRec=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].recvProdQty||null==n.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].recvSupplyPrice||null==n.stockOrderDetailBeansList[e].recvSupplyPrice)return!1}return!0}return!1},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},n.markAllReceive=function(){if(0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].recvProdQty="",n.stockOrderDetailBeansList[e].recvProdQty=angular.copy(n.stockOrderDetailBeansList[e].orderProdQty),n.stockOrderDetailBeansList[e].recvSupplyPrice="",n.stockOrderDetailBeansList[e].recvSupplyPrice=angular.copy(n.stockOrderDetailBeansList[e].ordrSupplyPrice),n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].recvSupplyPrice*n.stockOrderDetailBeansList[e].recvProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0");n.calculateGrandTotal()},n.updateStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,r(function(){n.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.showConfirmReceiveStockOrder=function(){n.showConfirmReceivePopup=!0},n.updateAndReceiveStockOrderDetails=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateAndReceiveStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,n.showConfirmReceivePopup=!1,o.put("_e_cOt_pio",""),r(function(){n.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.sessionValidation()}],RegisterCloseController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RegisterCloseControllerPreLoad","$timeout","$route",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.registerOpen=!1,t.sesssionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.controllerBean=s.loadControllerData(),"No record found !"==t.controllerBean?t.registerOpen=!0:(t.dailyRegisterBean=t.controllerBean.dailyRegisterBean,t.cashManagmenBeans=t.controllerBean.cashManagmenBeans,t.lastDayilyRegisterExist=t.controllerBean.lastDayilyRegisterExist,t.registerOpen=!t.controllerBean.openDayilyRegisterExist,o.registerCloseLoadedFully=!1),o.globalPageLoader=!1)},t.closeRegister=function(){t.success=!1,t.error=!1,t.loading=!0,e.post("registerClose/closeRegister/"+t._s_tk_com,t.dailyRegisterBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success=!0,t.success=!0,t.successMessage=e.data,i(function(){t.success=!1,c.reload()},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.openRegister=function(){t.success=!1,t.error=!1,t.loadingOpenRegister=!0,e.post("sell/openRegister/"+t._s_tk_com).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.successOpen=!0,t.registerOpen=!1,t.loadingOpenRegister=!1,t.successMessage=e.data,i(function(){t.successOpen=!1,t.showCashModal=!0},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sesssionValidation(),t.cashManagmentBean={},t.cashManagmentBean.cashType="Cash",t.cashManagmentBean.cashManagmentType="IN",t.cashManagmentBean.notes="Opening float",t.cashInOut=function(){t.addCashProcessingButton=!0,e.post("cashManagement/cashInOut/"+t._s_tk_com,t.cashManagmentBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.showCashModal=!1,t.cashManagmentList=e.data,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.error=!0,t.errorMessage=t.systemBusy})}}],RegisterController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","RegisterControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.registerSuccess=!1,t.registerError=!1,t.registerBean={},t.outletBean={},t.systemBusy="System is Busy Please try again",t._s_tk_com=a.get("_s_tk_com"),t.cashManagement={value:"No"},t.userNextSale={value:"No"},t.receiptEmail={value:"No"},t.receiptPrint={value:"Yes"},t.receiptPrintNotes={value:"No"},t.discountsOnReceipt={value:"Yes"},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),o.registerLoadedFully=!1,t.outletBean=t.data)},t.addRegister=function(){t.registerSuccess=!1,t.registerError=!1,t.loading=!0,t.registerBean.outletId=t.outletBean.outletId,t.registerBean.cacheManagementEnable=t.cashManagement.value,t.registerBean.selectNextUserForSale=t.userNextSale.value,t.registerBean.emailReceipt=t.receiptEmail.value,t.registerBean.printReceipt=t.receiptPrint.value,t.registerBean.printNotesOnReceipt=t.receiptPrintNotes.value,t.registerBean.showDiscountOnReceipt=t.discountsOnReceipt.value,e.post("register/addRegister/"+t._s_tk_com,t.registerBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.registerSuccess=!0,t.registerSuccessMessage=e.data,n(function(){t.registerSuccess=!1,r.location=e.layOutPath},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.registerError=!0,t.registerErrorMessage=e.data,r.location=e.layOutPath):(t.registerError=!0,t.registerErrorMessage=e.data)}).error(function(){t.loading=!1,t.registerError=!0,t.registerErrorMessage=t.systemBusy})},t.sessionValidation(),o.globalPageLoader=!1}],RegisterDetailController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RegisterDetailControllerPreLoad","$timeout","$route",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.registerOpen=!1,t.sesssionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.controllerBean=s.loadControllerData(),"No record found !"==t.controllerBean?t.registerOpen=!0:(t.dailyRegisterBean=t.controllerBean.dailyRegisterBean,t.cashManagmenBeans=t.controllerBean.cashManagmenBeans,t.lastDayilyRegisterExist=t.controllerBean.lastDayilyRegisterExist,t.registerOpen=!t.controllerBean.openDayilyRegisterExist,o.registerCloseLoadedFully=!1),o.globalPageLoader=!1)},t.closeRegister=function(){t.success=!1,t.error=!1,t.loading=!0,e.post("registerClose/closeRegister/"+t._s_tk_com,t.dailyRegisterBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success=!0,t.success=!0,t.successMessage=e.data,i(function(){t.success=!1,c.reload()},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.openRegister=function(){t.success=!1,t.error=!1,t.loadingOpenRegister=!0,e.post("sell/openRegister/"+t._s_tk_com).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.successOpen=!0,t.registerOpen=!1,t.loadingOpenRegister=!1,t.successMessage=e.data,i(function(){t.successOpen=!1,t.showCashModal=!0},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sesssionValidation(),t.cashManagmentBean={},t.cashManagmentBean.cashType="Cash",t.cashManagmentBean.cashManagmentType="IN",t.cashManagmentBean.notes="Opening float",t.cashInOut=function(){t.addCashProcessingButton=!0,e.post("cashManagement/cashInOut/"+t._s_tk_com,t.cashManagmentBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.showCashModal=!1,t.cashManagmentList=e.data,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.error=!0,t.errorMessage=t.systemBusy})}}],RegisterReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","RegisterReportControllerPreLoad",function(e,t,r,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.inventoryReportSuccess=!1,e.inventoryReportError=!1,e.inventoryReportError=!1,e.isHeadOffice=!1,e.registerReport=[],e.outlets=[],e.outletSelected=o.inventoryReportOutletName,e.sesssionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=u.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(null!=e.data.registerReportBeansList&&(e.registerReport=e.data.registerReportBeansList),null!=e.data.outletBeans&&(e.outlets=e.data.outletBeans),null!=e.data.headOffice&&(e.isHeadOffice=e.data.headOffice)),o.globalPageLoader=!1},e.changeOutletName=function(){o.inventoryReportOutletName=e.outletName,c.reload()},e.showRegisterDetail=function(e){a.put("_d_Ri_gra",e.dailyRegisterId),r.location="/app/#/registerDetail"},e.sesssionValidation()}],RoleDetailsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RoleDetailsControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){o.roleDetailsLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data&&(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),o.globalPageLoader=!1},e.sessionValidation()}],RolesController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RolesControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,n.validate(),e.roleDetails=function(e){a.put("_m_rd_gra",e),r.location="/app/#/manageRole"},e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){o.rolesLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.rolesList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.sessionValidation()}],SalesDetailReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesDetailReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],SalesLedgerController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","SalesLedgerControllerPreLoad",function(e,t,r,a,o,n,s,i,c,l){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sesssionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),l.loadControllerData(),o.globalPageLoader=!1)},e.sesssionValidation(),e.LoadAllSales=function(){o.limit=0,c.reload()}}],SalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesReportControllerPreLoad",function(a,e,t,r,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.salesReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),n.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.salesReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],SalesReportWithOutSaleController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesReportWithOutSaleControllerPreLoad",function(a,e,t,r,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.salesReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),n.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.salesReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],SalesReportWithSaleController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesReportWithSaleControllerPreLoad",function(a,e,t,r,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.salesReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),n.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.salesReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],SalesTaxController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","SalesTaxControllerPreLoad",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.showAddSalesTaxModal=!1,t.showUpdateSalesTaxModal=!1,t.salesTaxSuccess=!1,t.salesTaxError=!1,t.salesTaxBean={},t.updateSalesTax={},t.roledId=a.get("_s_tk_rId"),t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.salesTaxLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(null!=t.data.salesTaxListBeans&&(t.salesTaxList=t.data.salesTaxListBeans),null!=t.data.outletBeans&&(t.outletsList=t.data.outletBeans,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!1,searching:!1,bInfo:!1})},10))),o.globalPageLoader=!1},t.showModalForAddSalesTax=function(){t.showAddSalesTaxModal=!0},t.showModalForUpdateSalesTax=function(e){t.updateSalesTax=angular.copy(e),t.showUpdateSalesTaxModal=!0},t.addSalesTax=function(){t.salesTaxSuccess=!1,t.salesTaxError=!1,t.loading=!0,e.post("salesTax/addSalesTax/"+t._s_tk_com,t.salesTaxBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.salesTaxSuccess=!0,t.salesTaxSuccessMessage=e.data,t.showAddSalesTaxModal=!1,n(function(){t.salesTaxSuccess=!1,n(function(){s.reload()},500)},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data,r.location=e.layOutPath):(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data)}).error(function(){t.loading=!1,t.salesTaxError=!0,t.salesTaxErrorMessage=t.systemBusy})},t.editSalesTax=function(){t.salesTaxSuccess=!1,t.salesTaxError=!1,t.loading=!0,e.post("salesTax/updateSalesTax/"+t._s_tk_com,t.updateSalesTax).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.salesTaxSuccess=!0,t.salesTaxSuccessMessage=e.data,t.showUpdateSalesTaxModal=!1,n(function(){t.salesTaxSuccess=!1,r.location=e.layOutPath,n(function(){s.reload()},500)},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data,r.location=e.layOutPath):(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data)}).error(function(){t.loading=!1,t.salesTaxError=!0,t.salesTaxErrorMessage=t.systemBusy})},t.editOutlet=function(e){a.put("_e_cOt_gra",e.outletId),r.location="/app/#/manageOutlet"},t.sessionValidation()}],SellController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$sce","SellControllerPreLoad","$route",function(n,s,i,e,c,t,l,r,a,o){n.printReceipt=!0,n.cashloading=!1,n.creditloading=!1,n.laybyloading=!1,n.showPaymentSale=!1,n.readonlyInvoiceDiscount=!1,n.addCustomerProcessingButton=!1,c.MainSideBarhideit=!1,c.MainHeaderideit=!1,n.makePayment=!1,n.parkDiscard=!0,n.changeamount=0,n.parkDiscard=!0,n.showDiscount=!1,n.success=!1,n.error=!1,n.itemDetailDisable=!1,n.returnvalue=parseFloat(1),n.listPayments=[],n.payment={},n.gobackenable=!0,n.InvoiceMainBean={},n.InvoiceMainBean.invoiceDetails=[],n.InvoiceMainBean.invoiceGivenAmt=parseFloat(0),n.InvoiceMainBean.invoiceNetAmt=parseFloat(0),n.InvoiceMainBean.invoiceAmt=parseFloat(0),n.InvoiceMainBean.invoiceTax=parseFloat(0),n.InvoiceMainBean.invoiceSubTotal=parseFloat(0),n.productVaraintDetailBeanList=[],n.pricebook={},n.isReturnEnableonSell=!0,n.totallineItemDiscount=parseFloat(0),n.isInvoiceLevelDiscountEnable=!1,n.isInvoiceDetailLevelDiscountEnable=!0,c.globalPageLoader=!0,n.InvoiceMainBean.itemsCount=parseFloat(0),n.isValidInvoice=!0,n.outletId=e.get("_s_tk_oId"),console.log("$scope.outletId"+n.outletId),Number.prototype.padLeft=function(e,t){var r=String(e||10).length-String(this).length+1;return 0<r?new Array(r).join(t||"0")+this:this};var u=["January","February","March","April","May","June","July","August","September","October","November","December"];n.sesssionValidation=function(){n._s_tk_com=e.get("_s_tk_com"),n.sellControllerBean=a.loadControllerData(),n.getAllProducts(),c.globalPageLoader=!1,n.loadSalesDataAjax()},n.processData=function(t){c.sellLoadedFully=!1,"true"==n.sellControllerBean.isReturnEnableonSell?n.isReturnEnableonSell=!0:n.isReturnEnableonSell=!1,"true"==n.sellControllerBean.isInvoiceLevelDiscountEnable?n.isInvoiceLevelDiscountEnable=!0:n.isInvoiceLevelDiscountEnable=!1,"true"==n.sellControllerBean.isInvoiceDetailLevelDiscountEnable?n.isInvoiceDetailLevelDiscountEnable=!0:n.isInvoiceDetailLevelDiscountEnable=!1,null!=n.sellControllerBean.priceBookBean&&0<n.sellControllerBean.priceBookBean.length?n.pricebook=n.sellControllerBean.priceBookBean[0]:n.pricebook=null,n.allProducts=n.sellControllerBean.productsBean,n.allCustomers=n.sellControllerBean.customersBean,n.allUsers=n.sellControllerBean.users,n.displayProductsBean=n.sellControllerBean.displayProductsBean,n.customerGroupBeansList=n.sellControllerBean.customerGroupBeansList,n.companyName=n.sellControllerBean.companyName,n.companyAddress=n.sellControllerBean.companyAddress,n.outletAddress=n.sellControllerBean.outletAddress,n.phoneNumber=n.sellControllerBean.phoneNumber;for(var e=0;e<n.allProducts.length;e++)if(n.allProducts[e].productVariantsBeans)for(var r=0;r<n.allProducts[e].productVariantsBeans.length;r++)n.productVaraintDetailBeanList.push(n.allProducts[e].productVariantsBeans[r]);n.showProductLayout(),n.invoiceDetails=[],localforage.getItem("_s_tk_sell").then(function(e){e&&(n.InvoiceMainBean=e),localforage.setItem("_s_tk_sell",""),n.InvoiceMainBean&&(n.InvoiceMainBean.settledAmt=n.InvoiceMainBean.settledAmt?n.InvoiceMainBean.settledAmt:0,n.InvoiceMainBean.invoiceGivenAmt=parseFloat(n.InvoiceMainBean.invoiceNetAmt)-parseFloat(n.InvoiceMainBean.settledAmt),n.invoiceDetails=n.InvoiceMainBean.invoiceDetails,n.InvoiceMainBean.customerId&&(n.selectCustomer=!0,n.selectCustomerName=n.InvoiceMainBean.customername,n.InvoiceMainBean.laybyamount=parseFloat(n.InvoiceMainBean.laybyamount))),n.InvoiceMainBean&&"10"==n.InvoiceMainBean.status&&"false"==t&&(n.returnvalue=parseFloat(-1),n.InvoiceMainBean.invoiceGivenAmt=n.returnvalue*parseFloat(n.InvoiceMainBean.invoiceNetAmt),n.itemDetailDisable=!0,n.readonlyInvoiceDiscount=!0),n.InvoiceMainBean&&"9"==n.InvoiceMainBean.status&&(n.itemDetailDisable=!0,n.showPaymentSale=!0,n.readonlyInvoiceDiscount=!0,n.isReturnEnableonSell=!1),n.returnvalue<0&&(n.isReturnEnableonSell=!1),""!=n.InvoiceMainBean&&void 0!==n.InvoiceMainBean||(n.InvoiceMainBean={})}),n.loadingSalePageComplete=!1,c.globalPageLoader=!1},n.loadSalesDataAjax=function(){n.loadingSalePageComplete=!0,c.globalPageLoader=!0,c.online?s.get("sell/getAllProductsOnly/"+n._s_tk_com).success(function(e){n.sellControllerBean=e,localforage.removeItem("allProducts").then(function(){localforage.setItem("allProducts",n.sellControllerBean),console.log("allProducts is cleared!"),n.fetchAllCustomers()}).catch(function(e){console.log(e)}),n.processData("false")}).error(function(e){n.loading=!1,n.error=!0,n.errorMessage=n.systemBusy}):n.processData("false")},n.loadSalesProductDataOnlyAjax=function(){console.log("$scope.loadSalesProductDataOnlyAjax"),c.online?s.get("sell/getAllProductsOnly/"+n._s_tk_com).success(function(e){n.sellControllerBean=e,localforage.removeItem("allProducts").then(function(){localforage.setItem("allProducts",n.sellControllerBean),console.log("allProducts is cleared!")}).catch(function(e){console.log(e)}),n.processData("true")}).error(function(e){n.loading=!1,n.error=!0,n.errorMessage=n.systemBusy}):n.processData("true")},n.systemBusy="System is Busy Please try again",n.parkSale=function(){localforage.setItem("_s_tk_sell",""),i.location="/app/#/salesLedger"},n.showCustomerModal=!1,n.customerModal=function(){n.showCustomerModal=!0,n.searchCustomer=!0},n.createNewCustomerShow=function(){n.searchCustomer=!1},n.discounts=function(){n.showDiscount?n.showDiscount=!1:n.showDiscount=!0},n.layoutProducts=[],n.layoutProduct={},n.showProductLayout=function(){n.layoutProducts=[],n.layoutProduct={};for(var e=0;e<n.displayProductsBean.length;e++)n.layoutProduct={},n.layoutProduct.productName=n.displayProductsBean[e].productName,n.layoutProduct.productId=n.displayProductsBean[e].productId,n.layoutProduct.currentInventory=n.displayProductsBean[e].currentInventory,n.layoutProduct.supplyPriceExclTax=n.displayProductsBean[e].supplyPriceExclTax,n.layoutProduct.retailPriceExclTax=n.displayProductsBean[e].retailPriceExclTax,n.layoutProduct.retailPriceInclTax=n.displayProductsBean[e].retailPriceInclTax,n.layoutProduct.orignalPrice=n.displayProductsBean[e].orignalPrice,n.layoutProduct.taxAmount=n.displayProductsBean[e].taxAmount,n.layoutProduct.varientProducts=n.displayProductsBean[e].varientProducts,n.layoutProduct.css=n.displayProductsBean[e].css,n.layoutProducts.push(n.layoutProduct)},n.showProductItemDetails=function(e){for(var t=0;t<n.InvoiceMainBean.invoiceDetails.length;t++)n.InvoiceMainBean.invoiceDetails[t].productVarientName==e.productVarientName&&(n.InvoiceMainBean.invoiceDetails[t].showDetails?n.InvoiceMainBean.invoiceDetails[t].showDetails=!1:n.InvoiceMainBean.invoiceDetails[t].showDetails=!0)},n.invoiceDetail={},n.selectProductFunc=function(e){for(var t=0;t<n.displayProductsBean.length;t++)e.productId==n.displayProductsBean[t].productId&&(n.productVaraintDetailBean=n.displayProductsBean[t].productVaraintDetailBean,n.productVariantsBeans=n.displayProductsBean[t].productVariantsBeans,n.productVariantsBeans?n.selectProduct=!0:n.addProduct(e))},n.addProduct=function(e){n.duplicateProduct=!1,n.invoiceDetail={},n.parkDiscard=!1,n.invoiceDetail={},n.invoiceDetail.productName=e.productName,n.invoiceDetail.productVarientName=e.variantAttributeName,n.invoiceDetail.productVarientId=e.productVariantId,n.invoiceDetail.productId=e.productId,n.invoiceDetail.productInventoryCount=e.currentInventory,n.invoiceDetail.productQuantity=1,n.invoiceDetail.itemDiscountPrct=0,n.invoiceDetail.itemNetPrice=0,"false"==e.varientProducts&&(e.tax=e.taxAmount),n.invoiceDetail.itemTaxAmount=e.tax,n.invoiceDetail.itemRetailPrice=e.retailPriceExclTax,n.invoiceDetail.itemSalePrice=n.invoiceDetail.itemRetailPrice,n.invoiceDetail.itemNetPrice=n.invoiceDetail.itemSalePrice,n.invoiceDetail.orignalPrice=e.orignalPrice,n.applyPriceBook(n.invoiceDetail,e);for(var t=0;t<n.InvoiceMainBean.invoiceDetails.length;t++){if("false"==e.varientProducts&&n.invoiceDetails[t].productId==e.productId){n.invoiceDetails[t].productQuantity=parseFloat(n.invoiceDetails[t].productQuantity)+1,n.invoiceDetail=n.invoiceDetails[t],n.duplicateProduct=!0;break}if("true"==e.varientProducts&&n.invoiceDetails[t].productVarientId==e.productVariantId){n.invoiceDetails[t].productQuantity=parseFloat(n.invoiceDetails[t].productQuantity)+1,n.invoiceDetail=n.invoiceDetails[t],n.duplicateProduct=!0;break}}0==n.duplicateProduct&&(n.invoiceDetails.push(n.invoiceDetail),n.InvoiceMainBean.invoiceDetails=n.invoiceDetails),n.calculateBill(!0,n.invoiceDetail,"add"),n.productquantityzero=!1},n.applyPriceBook=function(e,t){if(null!=n.pricebook&&null!=n.pricebook.priceBookDetailBeans&&0<n.pricebook.priceBookDetailBeans.length){n.productBookDetail={},n.productBookDetail=null;for(var r=0;r<n.pricebook.priceBookDetailBeans.length;r++){if(null!=n.pricebook.priceBookDetailBeans[r].productVariantId&&""!=n.pricebook.priceBookDetailBeans[r].productVariantId&&n.pricebook.priceBookDetailBeans[r].uuId==t.productVariantUuid){n.productBookDetail=n.pricebook.priceBookDetailBeans[r];break}if(n.pricebook.priceBookDetailBeans[r].uuId==t.productUuid){n.productBookDetail=n.pricebook.priceBookDetailBeans[r];break}}null!=n.productBookDetail?n.invoiceDetail.itemDiscountPrct=parseFloat(n.productBookDetail.discount).toFixed(2):"true"==n.pricebook.flatSale&&(n.invoiceDetail.itemDiscountPrct=parseFloat(n.pricebook.flatDiscount).toFixed(2))}else null!=n.pricebook&&"true"==n.pricebook.flatSale?n.invoiceDetail.itemDiscountPrct=parseFloat(n.pricebook.flatDiscount).toFixed(2):n.invoiceDetail.itemDiscountPrct=0},n.CalculateReturn=function(e){0==e.isreturn?(n.calculateBill(!0,e,"add"),n.InvoiceMainBean.invcTypeCde=""):(n.calculateBill(!1,e,"remove"),n.InvoiceMainBean.invcTypeCde="00000")},n.calculateBill=function(e,t,r){if(n.InvoiceMainBean.itemsCount=parseFloat(0),n.totallineItemDiscount=parseFloat(0),Number(t.productInventoryCount)<Number(t.productQuantity)&&"add"==r&&(void 0===t.isreturn||0==t.isreturn))t.productQuantity=t.productInventoryCount,n.productquantityzero=!0,n.produtquantitymsg="Available Product Quantiy is : "+t.productQuantity,l(function(){n.productquantityzero=!1},1500);else if(Number(t.productInventoryCount)>=Number(t.productQuantity)||"remove"==r||-1==n.returnvalue||1==t.isreturn){n.InvoiceMainBean.invoiceAmt=parseFloat(0),n.InvoiceMainBean.invoiceDiscountAmt=n.InvoiceMainBean.invoiceDiscountAmt?n.InvoiceMainBean.invoiceDiscountAmt:parseFloat(0),n.InvoiceMainBean.invoiceTax=parseFloat(0),n.InvoiceMainBean.invoiceSubTotal=parseFloat(0),n.InvoiceMainBean.invoiceNetAmt=n.InvoiceMainBean.invoiceGivenAmt=parseFloat(0);for(var a=0,o=0;o<n.InvoiceMainBean.invoiceDetails.length;o++)n.InvoiceMainBean.invoiceDetails[o].productVarientName==t.productVarientName&&(a+=parseFloat(n.InvoiceMainBean.invoiceDetails[o].orignalPrice),n.InvoiceMainBean.invoiceDetails[o].itemSalePrice||(n.InvoiceMainBean.invoiceDetails[o].itemSalePrice=0),n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice||(n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice=0),n.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct||(n.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct=0),n.InvoiceMainBean.invoiceDetails[o].productQuantity&&0!=n.InvoiceMainBean.invoiceDetails[o].productQuantity||(n.InvoiceMainBean.invoiceDetails[o].productQuantity=1),1==e||1==n.InvoiceMainBean.invoiceDetails[o].isreturn?n.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct?(n.InvoiceMainBean.invoiceDetails[o].itemSalePrice=parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)-(parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)*parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct)/100).toFixed(2),n.InvoiceMainBean.invoiceDetails[o].itemDiscountAmount=parseFloat((parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)*parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct)/100).toFixed(2))*parseFloat(n.InvoiceMainBean.invoiceDetails[o].productQuantity)):n.InvoiceMainBean.invoiceDetails[o].itemSalePrice=parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice).toFixed(2):n.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct=(100-(100*parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemSalePrice)/parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)).toFixed(2)).toFixed(2),n.InvoiceMainBean.invoiceDetails[o].itemNetPrice=(parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemSalePrice)*parseFloat(n.InvoiceMainBean.invoiceDetails[o].productQuantity)).toFixed(2),1==n.InvoiceMainBean.invoiceDetails[o].isreturn&&(n.InvoiceMainBean.invoiceDetails[o].itemNetPrice=-1*n.InvoiceMainBean.invoiceDetails[o].itemNetPrice,n.InvoiceMainBean.invoiceDetails[o].itemSalePrice=-1*n.InvoiceMainBean.invoiceDetails[o].itemSalePrice)),0<parseFloat(n.InvoiceMainBean.invoiceDetails[o].productQuantity)&&(n.InvoiceMainBean.invoiceAmt=(parseFloat(n.InvoiceMainBean.invoiceAmt)+parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemNetPrice)).toFixed(2)),n.InvoiceMainBean.invoiceSubTotal=((parseFloat(n.InvoiceMainBean.invoiceSubTotal)+parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemRetailPrice))*parseFloat(n.InvoiceMainBean.invoiceDetails[o].productQuantity)).toFixed(2),n.InvoiceMainBean.invoiceTax=((parseFloat(n.InvoiceMainBean.invoiceTax)+parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemTaxAmount))*parseFloat(n.InvoiceMainBean.invoiceDetails[o].productQuantity)).toFixed(2),n.InvoiceMainBean.invoiceNetAmt=(parseFloat(n.InvoiceMainBean.invoiceAmt)-parseFloat(n.InvoiceMainBean.invoiceDiscountAmt)+parseFloat(n.InvoiceMainBean.invoiceTax)).toFixed(2),n.InvoiceMainBean.settledAmt=n.InvoiceMainBean.settledAmt?n.InvoiceMainBean.settledAmt:0,n.InvoiceMainBean.invoiceGivenAmt=parseFloat(n.InvoiceMainBean.invoiceNetAmt)-parseFloat(n.InvoiceMainBean.settledAmt),"remove"!=r&&-1!=n.returnvalue||(n.InvoiceMainBean.invoiceGivenAmt=n.returnvalue*parseFloat(n.InvoiceMainBean.invoiceNetAmt),Number(t.productQuantity)>Number(t.orignalProductQuantity)?(n.returnerrormsg="Cannot return more than purchased items.",n.returnerrormsgvisible=!0,l(function(){n.returnerrormsgvisible=!1},1500),t.productQuantity=t.orignalProductQuantity):n.returnerrormsgvisible=!1);for(o=0;o<n.InvoiceMainBean.invoiceDetails.length;o++)null!=n.InvoiceMainBean.invoiceDetails[o].itemDiscountAmount&&(n.totallineItemDiscount=parseFloat(n.totallineItemDiscount)+parseFloat(n.InvoiceMainBean.invoiceDetails[o].itemDiscountAmount));n.InvoiceMainBean.orignalPrice=a,n.InvoiceMainBean.invoiceDiscountAmt||(n.InvoiceMainBean.invoiceDiscountAmt=0),n.totallineItemDiscount||(n.totallineItemDiscount=0)}for(o=0;o<n.InvoiceMainBean.invoiceDetails.length;o++)1!=n.InvoiceMainBean.invoiceDetails[o].isreturn&&(n.InvoiceMainBean.itemsCount=parseFloat(n.InvoiceMainBean.itemsCount)+parseFloat(n.InvoiceMainBean.invoiceDetails[o].productQuantity))},n.pay=function(){n.makePayment?n.makePayment=!1:(n.ValidateInvoiceItems(),n.isValidInvoice&&(n.makePayment=!0))},n.ResetSale=function(){n.InvoiceMainBean&&(n.InvoiceMainBean={},n.InvoiceMainBean.invoiceDetails=[],n.listPayments=[],n.InvoiceMainBean.invoiceNetAmt=0,n.InvoiceMainBean.invoiceAmt=0,n.InvoiceMainBean.invoiceGivenAmt=0,n.InvoiceMainBean.settledAmt=0,n.InvoiceMainBean.invoiceTax=0,n.InvoiceMainBean.invoiceSubTotal=parseFloat(0)),n.InvoiceMainBean.itemsCount=parseFloat(0),n.invoiceDetails=[],n.airportName=[],localforage.setItem("_s_tk_sell",""),n.returnvalue=parseFloat(1),n.itemDetailDisable=!1,n.gobackenable=!0,n.searchCustomerSelected=!1,n.selectCustomer=!1,n.searchCustomer=!0,n.selectCustomerName="",n.InvoiceMainBean.customerId="",n.readonlyInvoiceDiscount=!1,"true"==n.sellControllerBean.isReturnEnableonSell?n.isReturnEnableonSell=!0:n.isReturnEnableonSell=!1},n.ReceiptingDone=function(){n.ResetSale(),n.makePayment=!1,n.salesComplete=!1,n.error=!1,n.success=!1,n.showDiscount=!1,n.invoiceGenerationDteFE="",n.fetchAllCustomers()},n.calculateDiscount=function(e){1==e?void 0!==n.InvoiceMainBean.invoiceDiscount&&n.InvoiceMainBean.invoiceDiscount?n.InvoiceMainBean.invoiceDiscountAmt=(parseFloat(n.InvoiceMainBean.invoiceAmt)*parseFloat(n.InvoiceMainBean.invoiceDiscount)/100).toFixed(2):(n.InvoiceMainBean.invoiceDiscount=parseFloat(0),n.InvoiceMainBean.invoiceDiscountAmt=parseFloat(0)):0==e&&(n.InvoiceMainBean.invoiceDiscountAmt&&void 0!==n.InvoiceMainBean.invoiceDiscountAmt||(n.InvoiceMainBean.invoiceDiscountAmt=parseFloat(0)),n.InvoiceMainBean.invoiceDiscount=(parseFloat(n.InvoiceMainBean.invoiceDiscountAmt)/parseFloat(n.InvoiceMainBean.invoiceAmt)*100).toFixed(2)),n.InvoiceMainBean.invoiceNetAmt=(parseFloat(n.InvoiceMainBean.invoiceAmt)-parseFloat(n.InvoiceMainBean.invoiceDiscountAmt)+parseFloat(n.InvoiceMainBean.invoiceTax)).toFixed(2),n.InvoiceMainBean.invoiceGivenAmt=n.InvoiceMainBean.invoiceNetAmt-parseFloat(n.InvoiceMainBean.settledAmt)},n.removeProduct=function(t){t&&(n.InvoiceMainBean.invoiceDetails=n.InvoiceMainBean.invoiceDetails.filter(function(e){return e!==t}),n.invoiceDetails=n.invoiceDetails.filter(function(e){return e!==t}),n.calculateBill(!1,t,"remove"))},n.salesComplete=!1,n.barcodeValues={selectproduct:""},n.InvoiceMainBeanList=[],n.payCash=function(t){if(n.success=!1,n.error=!1,n.loading=!0,n.InvoiceMainBean.dailyRegesterId=n.dailyRegesterId,n.InvoiceMainBean.settledAmt=n.InvoiceMainBean.settledAmt?n.InvoiceMainBean.settledAmt:0,parseFloat(n.InvoiceMainBean.invoiceGivenAmt)>parseFloat(n.InvoiceMainBean.invoiceNetAmt)-parseFloat(n.InvoiceMainBean.settledAmt)?(n.InvoiceMainBean.settledAmt=parseFloat(n.InvoiceMainBean.invoiceNetAmt)-parseFloat(n.InvoiceMainBean.settledAmt),n.balance=0):parseFloat(n.InvoiceMainBean.invoiceGivenAmt)<=parseFloat(n.InvoiceMainBean.invoiceNetAmt)-parseFloat(n.InvoiceMainBean.settledAmt)&&(n.InvoiceMainBean.settledAmt=parseFloat(n.InvoiceMainBean.invoiceGivenAmt)),n.payment={},!n.InvoiceMainBean.invoiceRefNbr){var e=new Date,r="SAL-"+e.getDate()+ +(e.getMonth()+1)+ +e.getFullYear()+ +e.getHours()+ +e.getMinutes()+ +e.getSeconds();n.InvoiceMainBean.invoiceRefNbr=r;var a=new Date,o=[u[a.getMonth()],a.getDate().padLeft(),a.getFullYear()].join(", ")+" "+[a.getHours()%12==0?12:a.getHours()%12,a.getMinutes().padLeft(),a.getSeconds().padLeft(),12<=a.getHours()?"PM":"AM"].join(":");n.invoiceGenerationDteFE=o}"cash"==t?(n.payment.type="Payment (Cash)",n.InvoiceMainBean.paymentTypeId=1,n.cashloading=!0):"creditcard"==t&&(n.payment.type="Payment (Credit Card)",n.InvoiceMainBean.paymentTypeId=2,n.creditloading=!0),n.payment.amount=parseFloat(n.InvoiceMainBean.invoiceGivenAmt),n.listPayments.push(n.payment),n.returnvalue<=0?(n.InvoiceMainBean.returnvalue="returnsale",n.salesComplete=!0,n.InvoiceMainBean.invoiceNetAmt=n.InvoiceMainBean.invoiceGivenAmt,n.InvoiceMainBean.settledAmt=n.InvoiceMainBean.invoiceNetAmt,n.InvoiceMainBean.invoiceGivenAmt=n.InvoiceMainBean.invoiceGivenAmt,n.InvoiceMainBean.invoiceAmt=n.InvoiceMainBean.invoiceGivenAmt):n.InvoiceMainBean.returnvalue="sale",s.post("sell/payCash/"+n._s_tk_com,n.InvoiceMainBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.payCashSuccess(e),n.loadSalesProductDataOnlyAjax(),"cash"==t?n.cashloading=!1:"creditcard"==t&&(n.creditloading=!1),n.sendMessage(n.InvoiceMainBean.invoiceNetAmt)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,i.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(e){var t;c.online=!1,n.InvoiceMainBean.status="Completed",t=(t=new Date).getUTCFullYear()+"-"+("00"+(t.getUTCMonth()+1)).slice(-2)+"-"+("00"+t.getUTCDate()).slice(-2)+" "+("00"+t.getUTCHours()).slice(-2)+":"+("00"+t.getUTCMinutes()).slice(-2)+":"+("00"+t.getUTCSeconds()).slice(-2),n.InvoiceMainBean.invoiceGenerationDte=t,n.invoiceGenerationDteFE=t,localforage.getItem("InvoiceMainBeanList").then(function(e){n.InvoiceMainBeanList=null==e?[]:e,n.InvoiceMainBeanList.push(n.InvoiceMainBean),localforage.setItem("InvoiceMainBeanList",n.InvoiceMainBeanList),localforage.setItem("invoiceMainBeanNewList",n.InvoiceMainBeanList),c.InvoiceMainBeanList=e}),n.payCashSuccess(e),n.cashloading=!1,n.creditloading=!1,n.loading=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.payCashSuccess=function(e){n.gobackenable=!1,null!=e&&(n.successMessage=e.data,n.InvoiceMainBean=e.data),localforage.setItem("_s_tk_sell",""),n.balance=parseFloat(n.InvoiceMainBean.invoiceNetAmt)-parseFloat(n.InvoiceMainBean.settledAmt),n.change=parseFloat(n.InvoiceMainBean.invoiceGivenAmt)-parseFloat(n.InvoiceMainBean.settledAmt),n.InvoiceMainBean.invoiceGivenAmt=parseFloat(n.balance),0==n.balance?n.salesComplete=!0:n.salesComplete=!1,n.barcodeValues.selectproduct=n.InvoiceMainBean.invoiceRefNbr,JsBarcode(".barcode").init()},n.salenoncash=function(e){if(n.success=!1,n.error=!1,n.laybyloading=!0,n.InvoiceMainBean.dailyRegesterId=n.dailyRegesterId,n.InvoiceMainBean.transactionType=e,n.InvoiceMainBean.laybyamount=parseFloat(n.InvoiceMainBean.invoiceNetAmt)-parseFloat(n.InvoiceMainBean.settledAmt),null!=n.InvoiceMainBean.laybyamount||0<n.selectedItem.item.customerBalance?n.totalBalance=parseFloat(n.InvoiceMainBean.laybyamount)+parseFloat(n.selectedItem.item.customerBalance):null==n.InvoiceMainBean.laybyamount?n.totalBalance=n.selectedItem.item.customerBalance:null==n.selectedItem.item.customerBalance&&(n.selectedItem.item.customerBalance=0),n.InvoiceMainBean.settledAmt=0,!n.InvoiceMainBean.invoiceRefNbr){var t=new Date,r="SAL-"+t.getDate()+ +(t.getMonth()+1)+ +t.getFullYear()+ +t.getHours()+ +t.getMinutes()+ +t.getSeconds();n.InvoiceMainBean.invoiceRefNbr=r;var a=new Date,o=[u[a.getMonth()+1],a.getDate().padLeft(),a.getFullYear()].join(", ")+" "+[a.getHours()%12,a.getMinutes().padLeft(),a.getSeconds().padLeft(),12<=a.getHours()?"PM":"AM"].join(":");n.invoiceGenerationDteFE=o}s.post("sell/salenoncash/"+n._s_tk_com,n.InvoiceMainBean).success(function(e){n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.salenoncashSuccess(e),n.loadSalesProductDataOnlyAjax(),n.laybyloading=!1,n.sendMessage(n.InvoiceMainBean.invoiceNetAmt)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,i.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(e){c.online&&(n.InvoiceMainBeanList.push(n.InvoiceMainBean),localforage.setItem("InvoiceMainBeanList",n.InvoiceMainBeanList),localforage.setItem("invoiceMainBeanNewList",n.InvoiceMainBeanList),n.salenoncashSuccess(e)),n.loading=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.salenoncashSuccess=function(e){n.gobackenable=!1,localforage.setItem("_s_tk_sell",""),n.salesComplete=!0,n.balance=parseFloat(n.InvoiceMainBean.invoiceGivenAmt),null!=e&&(n.InvoiceMainBean=e.data),n.listPayments=[],n.barcodeValues.selectproduct=n.InvoiceMainBean.invoiceMainId,JsBarcode(".barcode").init()},n.parkSale=function(){if(n.success=!1,n.error=!1,n.loading=!0,n.InvoiceMainBean.dailyRegesterId=n.dailyRegesterId,!n.InvoiceMainBean.invoiceRefNbr){var e=new Date,t="SAL-"+e.getDate()+ +(e.getMonth()+1)+ +e.getFullYear()+ +e.getHours()+ +e.getMinutes()+ +e.getSeconds();n.InvoiceMainBean.invoiceRefNbr=t}s.post("sell/parkSale/"+n._s_tk_com,n.InvoiceMainBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.success=!0,n.successMessage=e.data,n.ResetSale(),l(function(){n.success=!1,i.location=e.layOutPath},1500)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,i.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){c.online&&(n.InvoiceMainBeanList.push(n.InvoiceMainBean),localforage.setItem("InvoiceMainBeanList",n.InvoiceMainBeanList),localforage.setItem("invoiceMainBeanNewList",n.InvoiceMainBeanList),n.success=!0,n.successMessage=Response.data,n.ResetSale(),l(function(){n.success=!1,i.location=Response.layOutPath},1500)),n.loading=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.openRegister=function(){n.success=!1,n.error=!1,n.loadingOpenRegister=!0,n.showCashModal=!1,s.post("sell/openRegister/"+n._s_tk_com).success(function(e){n.loading=!1,n.responseData=e.data,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.getAllProducts(),n.registerOpen=!0,n.loadingOpenRegister=!1,localforage.setItem("_s_tk_sell",""),"You don't have rights to perform current operation!"!=n.responseData&&(n.showCashModal=!0)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,i.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){n.loading=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.allProducts=[],n.registerOpen=!1,n.dailyRegesterId="",n.getAllProducts=function(){void 0!==n.sellControllerBean.registerStatus&&("true"==n.sellControllerBean.registerStatus?(n.dailyRegesterId=n.sellControllerBean.dailyRegisterId,n.registerOpen=!0):n.registerOpen=!1)},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},n.productVaraintDetailBean={},n.productVaraintAttrName="",n.attribute1Level=!1,n.attribute2Level=!0,n.attribute3Level=!0,n.attribute1LevelFunc=function(e){if(n.productVaraintAttrName=e+"/",n.attribute1Level=!0,n.attribute2Level=!1,n.attribute3Level=!0,null==n.productVaraintDetailBean.arrtibute2Values||0==n.productVaraintDetailBean.arrtibute2Values.length){for(var t=0;t<n.productVariantsBeans.length;t++)n.productVariantsBeans[t].variantAttributeName.replaceAll("/","").replaceAll(" ","")==n.productVaraintAttrName.replaceAll("/","").replaceAll(" ","")&&(n.addProduct(n.productVariantsBeans[t]),n.attribute2Level=!0,n.attribute1Level=!1),n.selectProduct=!1;n.attribute2Level||(n.attribute2Level=!0,n.attribute1Level=!1,n.produtquantitymsg="Product not avilable, please contact Admin!",n.productquantityzero=!0,l(function(){n.productquantityzero=!1},2e3))}},n.attribute1Leve2Func=function(e){if(n.productVaraintAttrName=n.productVaraintAttrName+e+"/",n.attribute1Level=!0,n.attribute2Level=!0,n.attribute3Level=!1,null==n.productVaraintDetailBean.arrtibute3Values||0==n.productVaraintDetailBean.arrtibute3Values.length){for(var t=0;t<n.productVariantsBeans.length;t++)n.productVariantsBeans[t].variantAttributeName.replaceAll("/","").replaceAll(" ","")==n.productVaraintAttrName.replaceAll("/","").replaceAll(" ","")&&(n.addProduct(n.productVariantsBeans[t]),n.attribute3Level=!0,n.attribute1Level=!1),n.selectProduct=!1;n.attribute3Level||(n.attribute3Level=!0,n.attribute1Level=!1,n.produtquantitymsg="Product not avilable, please contact Admin!",n.productquantityzero=!0,l(function(){n.productquantityzero=!1},2e3))}},n.aattribute1Leve3Func=function(e){n.attribute1Level=!1,n.attribute2Level=!0,n.attribute3Level=!0,n.productNotFound=!0,n.productVaraintAttrName=n.productVaraintAttrName+e;for(var t=0;t<n.productVariantsBeans.length;t++)n.productVariantsBeans[t].variantAttributeName.replaceAll("/","").replaceAll(" ","")==n.productVaraintAttrName.replaceAll("/","").replaceAll(" ","")&&(n.addProduct(n.productVariantsBeans[t]),n.productNotFound=!1),n.selectProduct=!1;n.productNotFound&&(n.produtquantitymsg="Product not avilable, please contact Admin!",n.productquantityzero=!0,l(function(){n.productquantityzero=!1},2e3))},n.productVariantsBeans=[],n.variantSkuFound=!1,n.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),n.productVariantsBeans=[];var e=_.filter(n.allProducts,function(e){return e.productName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allCustomers,function(e){return e.phoneNumber?e.firstName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t):e.firstName?e.firstName.toLowerCase().includes(t):void 0}),a=_.filter(n.productVaraintDetailBeanList,function(e){return e.sku.toLowerCase()==t});return a&&0<a.length&&(n.addProduct(a[0]),n.variantSkuFound=!0,n.airportName=[]),e.concat(r).concat(a)},renderItem:function(e){if(void 0===e.firstName){if(n.variantSkuFound)return void(n.variantSkuFound=!1);var t={value:e.productName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.productName+"</td><td style='width: 10%'>"+e.retailPriceExclTax+"</td></tr></tbody></table>")}}else if(e.firstName&&e.lastName&&e.phoneNumber)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else if(e.firstName&&e.lastName)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+" "+e.lastName+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};return t},itemSelected:function(e){if(n.selectedItem=e,void 0===n.selectedItem.item.firstName){for(var t=0;t<n.allProducts.length;t++)n.selectedItem.item.productId==n.allProducts[t].productId&&(n.productVaraintDetailBean=n.allProducts[t].productVaraintDetailBean,n.productVariantsBeans=n.allProducts[t].productVariantsBeans);if(n.airport=e,null==n.productVaraintDetailBean.arrtibute1Values||0==n.productVaraintDetailBean.arrtibute1Values.length)for(t=0;t<n.allProducts.length;t++)n.allProducts[t].productName.replaceAll(" ","")==n.selectedItem.item.productName.replaceAll(" ","")&&n.addProduct(n.allProducts[t]);else"true"==n.sellControllerBean.autoCreateStandardVariant&&n.productVaraintDetailBean.arrtibute1Values[0]==n.sellControllerBean.defaultVariantName?n.addProduct(n.productVariantsBeans[0]):n.selectProduct=!0}else n.selectCustomer=!0,n.selectCustomerName=n.selectedItem.item.firstName+" "+n.selectedItem.item.lastName,n.selectCustomerPhoneNumber=n.selectedItem.item.phoneNumber,n.InvoiceMainBean.customerId=n.selectedItem.item.customerId;n.airportName=[]}},n.selectCustomer=!1,n.autoCompleteOptionsCustomers={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),n.productVariantsBeans=[],_.filter(n.allCustomers,function(e){return e.phoneNumber?e.firstName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t):e.firstName.toLowerCase().includes(t)})},renderItem:function(e){if(e.firstName&&e.lastName&&e.phoneNumber)var t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else if(e.firstName&&e.lastName)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+" "+e.lastName+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};return t},itemSelected:function(e){n.selectedItem=e,n.CustomerName="",n.selectCustomer=!0,n.selectCustomerName=n.selectedItem.item.firstName+" "+n.selectedItem.item.lastName,n.selectCustomerPhoneNumber=n.selectedItem.item.phoneNumber,n.InvoiceMainBean.customerId=n.selectedItem.item.customerId,n.customerBalance=n.selectedItem.item.customerBalance,n.customerLayBy=n.selectedItem.item.customerlaybyAmount,null!=n.selectedItem.item.customerBalance&&0<n.selectedItem.item.customerBalance?n.totalPayable=parseFloat(n.InvoiceMainBean.invoiceNetAmt)+parseFloat(n.selectedItem.item.customerBalance)-parseFloat(n.InvoiceMainBean.invoiceGivenAmt):(n.selectedItem.item.customerBalance=null)&&(n.totalPayable=parseFloat(n.selectedItem.item.invoiceNetAmt))}},n.salesUserBean=[],n.autoCompleteOptionsUsers={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(n.allUsers,function(e){return e.firstName.toLowerCase().includes(t)||e.lastName.toLowerCase().includes(t)})},renderItem:function(e){if(e.firstName&&e.lastName&&e.phoneNumber)var t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else if(e.firstName&&e.lastName)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+" "+e.lastName+"</td><td style='width: 10%'>User</td></tr></tbody></table>")};else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>User</td></tr></tbody></table>")};return t},itemSelected:function(e){n.selectedItem=e,n.selectUserName=n.selectedItem.item.firstName+" "+n.selectedItem.item.lastName,n.InvoiceMainBean.salesUser=n.selectedItem.item.userId,n.salesUserBean=[]}},n.cancelCustomer=function(){n.showCustomerModal=!1},n.cancelUserAdd=function(){n.showUserModal=!1},n.sesssionValidation(),n.newCustomerSuccessMessage="Customer Added Successfuly!",n.customerBean={},n.customerBean.addressBeanList=[],n.customerBean.addressBeanList[0]={},n.customerBean.addressBeanList[1]={},n.searchCustomerSelected=!0,n.addNewUserSelected=function(){n.showUserModal=!1},n.addNewCustomerSelected=function(){n.customerBean={},n.customerBean.addressBeanList=[],n.customerBean.addressBeanList[0]={},n.customerBean.addressBeanList[1]={},n.newCustomerSuccess=!0,n.showCustomerModal=!1,l(function(){n.newCustomerSuccess=!1},2e3)},n.addNewCustomer=function(){n.newCustomerSuccess=!1,n.newCustomerError=!1,n.loading=!0,n.customerFound=!1,n.addCustomerProcessingButton=!0;for(var e=0;e<n.allCustomers.length;e++)n.allCustomers[e].phoneNumber==n.customerBean.addressBeanList[0].phone&&(n.customerFound=!0);n.customerFound?(n.newCustomerError=!0,n.newCustomerErrorMessage="Customer already exist with same Phone Number!",l(function(){n.newCustomerError=!1,n.searchCustomer=!0,n.addCustomerProcessingButton=!1,n.loading=!1,n.customerBean={},n.customerBean.addressBeanList=[],n.customerBean.addressBeanList[0]={},n.customerBean.addressBeanList[1]={}},2e3)):(n.customerBean.addressBeanList[0].addressType="Physical Address",n.customerBean.addressBeanList[1].addressType="Postal Address",s.post("newCustomer/addNewCustomer/"+n._s_tk_com,n.customerBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(""!=n.InvoiceMainBean&&void 0!==n.InvoiceMainBean||(n.InvoiceMainBean={}),n.newCustomerSuccess=!0,n.fetchAllCustomers(),n.selectCustomer=!0,n.selectCustomerName=n.customerBean.firstName+" "+n.customerBean.lastName,n.selectCustomerPhoneNumber=n.customerBean.addressBeanList[0].phone,"undefined undefined"==n.selectCustomerName&&(n.selectCustomerName="Customer"),n.InvoiceMainBean.customerId=e.data.customerId,n.customerBean={},n.customerBean.addressBeanList=[],n.customerBean.addressBeanList[0]={},n.customerBean.addressBeanList[1]={},l(function(){n.newCustomerSuccess=!1,n.showCustomerModal=!1,n.searchCustomerSelected=!1,n.addCustomerProcessingButton=!1,n.searchCustomer=!0},2e3)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?(n.newCustomerError=!0,n.addCustomerProcessingButton=!1,n.newCustomerErrorMessage=e.data,i.location=e.layOutPath):(n.newCustomerError=!0,n.addCustomerProcessingButton=!1,n.newCustomerErrorMessage=e.data)}).error(function(){n.loading=!1,n.addCustomerProcessingButton=!1,n.newCustomerError=!0,n.newCustomerErrorMessage=n.systemBusy}))},n.fetchAllCustomers=function(){s.post("customers/getAllCustomersOrderBYPhone/"+n._s_tk_com).success(function(e){n.allCustomers=e.data,localforage.getItem("allProducts").then(function(e){var t=e;t.customersBean=n.allCustomers,localforage.removeItem("allProducts").then(function(){localforage.setItem("allProducts",t),console.log("allProducts customer added!")}).catch(function(e){console.log(e)}),c.InvoiceMainBeanList=e})}).error(function(){})},n.selectCustomerOrCreate=function(){n.searchCustomer=!0,n.showCustomerModal=!0},n.selectSalesUser=function(){n.showUserModal=!0},n.cashManagmentBean={},n.cashManagmentBean.cashType="Cash",n.cashManagmentBean.cashManagmentType="IN",n.cashManagmentBean.notes="Opening float",n.cashInOut=function(){s.post("cashManagement/cashInOut/"+n._s_tk_com,n.cashManagmentBean).success(function(e){n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.showCashModal=!1,n.cashManagmentList=e.data,n.addCashProcessingButton=!1,n.removeCashProcessingButton=!1,l(function(){o.reload()},1e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,i.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){n.error=!0,n.errorMessage=n.systemBusy})},n.ValidateInvoiceItems=function(){n.isValidInvoice=!0;for(var e=0;e<n.InvoiceMainBean.invoiceDetails.length;e++)if(0==n.InvoiceMainBean.invoiceDetails[e].productQuantity){n.isValidInvoice=!1;break}n.isValidInvoice||(n.productquantityzero=!0,n.produtquantitymsg="Sale of Product with Zero Quantity Not Allowed",l(function(){n.productquantityzero=!1},1500))},n.sendMessage=function(e){n.loading=!0,n.sendSMSBean={},n.sendSMSBean.customerSmsBeans=n.selectedCustomers,n.sendSMSBean.message=n.message,n.sendSMSBean.sendAllSms=n.sendAllSms,n.sendSingleSmsBean={},n.sendSingleSmsBean.customerId=n.InvoiceMainBean.customerId,n.sendSingleSmsBean.amount=e,n.sendSingleSmsBean.user=c.clientName,n.InvoiceMainBean.customerId&&s.post("sendSms/sendSingleMessage/"+n._s_tk_com,n.sendSingleSmsBean).success(function(e){n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus||("INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?i.location=e.layOutPath:n.newCustomerErrorMessage=e.data)}).error(function(){n.newCustomerErrorMessage=n.systemBusy})},n.deleteCustomerOrCreate=function(){n.selectCustomer=!1,n.CustomerName=[],n.selectCustomerName=""}}],SendSmsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$sce","SendSmsControllerPreLoad","$route",function(r,e,t,a,o,n,s,i,c,l){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.successMessage="Message Sent Successfuly!",r.errorMessage="Message Sent Error Occurred!",r.success=!1,r.error=!1,r.message="",r.sendAllSms=!1,r.sesssionValidation=function(){r._s_tk_com=a.get("_s_tk_com"),r.controllerBean=c.loadControllerData(),o.globalPageLoader=!1,r.smsUsedCount=r.controllerBean.smsUsedCount,r.smsRemained=r.controllerBean.smsRemained,r.isExpired=r.controllerBean.isExpired},r.selectedCustomers=[],r.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(r.controllerBean.customersBean,function(e){return e.firstName?e.firstName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t):e.phoneNumber?e.phoneNumber.toLowerCase().includes(t):void 0})},renderItem:function(e){return{value:e.firstName,label:i.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")}},itemSelected:function(e){if(r.selectedItem=e,r.selectedCustomer={},r.selectedCustomer.customerId=r.selectedItem.item.customerId,r.selectedCustomer.firstName=r.selectedItem.item.firstName,r.selectedCustomer.lastName=r.selectedItem.item.lastName,r.selectedCustomer.companyId=r.selectedItem.item.companyId,r.selectedCustomer.phoneNumber=r.selectedItem.item.phoneNumber,0==r.selectedCustomers.length)r.selectedCustomers.push(r.selectedCustomer);else for(var t=0;t<r.selectedCustomers.length;t++)r.selectedCustomers[t].customerId!=r.selectedCustomer.customerId&&r.selectedCustomers.push(r.selectedCustomer);r.airportName=[]}},r.loading=!1,r.removeCustomer=function(e){for(var t=0;t<r.selectedCustomers.length;t++)r.selectedCustomers[t].customerId==e&&r.selectedCustomers.splice(t,1)},r.sendMessage=function(){r.loading=!0,r.sendSMSBean={},r.sendSMSBean.customerSmsBeans=r.selectedCustomers,r.sendSMSBean.message=r.message,r.sendSMSBean.sendAllSms=r.sendAllSms,r.sendSMSBean.user=o.clientName,"true"==r.isExpired?(r.error=!0,r.loading=!1,r.message="",r.selectedCustomers=[],s(function(){r.error=!1},2500),r.errorMessage="Message Package Time Expired!"):r.sendAllSms?r.controllerBean.customersBean.length>r.smsRemained?(r.error=!0,r.loading=!1,r.message="",r.selectedCustomers=[],s(function(){r.error=!1},2500),r.errorMessage="Message Package Limit Expired!"):(s(function(){r.loading=!1,r.sendAllSms=!1,r.message="",r.success=!0,r.selectedCustomers=[],r.smsUsedCount=r.controllerBean.customersBean.length+parseInt(r.smsUsedCount),r.smsRemained=r.smsRemained-r.controllerBean.customersBean.length},2500),s(function(){r.success=!1},4500)):r.sendSMSBean.customerSmsBeans.length>r.smsRemained?(r.error=!0,r.loading=!1,r.message="",r.selectedCustomers=[],s(function(){r.error=!1},2500),r.errorMessage="Message Package Limit Expired!"):(s(function(){r.loading=!1,r.sendAllSms=!1,r.message="",r.success=!0,r.selectedCustomers=[],r.smsUsedCount=r.sendSMSBean.customerSmsBeans.length+parseInt(r.smsUsedCount),r.smsRemained=r.smsRemained-r.sendSMSBean.customerSmsBeans.length},2500),s(function(){r.success=!1},4500)),e.post("sendSms/sendMessage/"+r._s_tk_com,r.sendSMSBean).success(function(e){r.responseStatus=e.status,r.responseStatus}).error(function(){r.error=!0,r.loading=!1,r.newCustomerErrorMessage=r.systemBusy})},r.sesssionValidation()}],SmsDetailController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","SmsDetailControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.roledId=a.get("_s_tk_rId"),e.addProduct=function(){r.location="/app/#/newProduct"},e.showProduct=function(e){a.put("_d_cPi_gra",e.productId),r.location="/app/#/productDetails"},e.editProduct=function(e){a.put("_e_cPi_gra",e.productId),a.put("_e_cOi_gra",e.outletId),r.location="/app/#/manageProduct"},e.sesssionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.fetchData())},e.fetchData=function(){e.data=s.loadControllerData(),"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.productsList=null,e.productsList=e.data.smsReportBeanList,e.smsUsedCount=e.data.smsUsedCount,e.smsRemained=e.data.smsRemained),o.globalPageLoader=!1},e.sesssionValidation()}],SmsReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SmsReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],StatusController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","StatusControllerPreLoad",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.brandSuccess=!1,t.brandError=!1,t.brandBean={},t.sessionValidation=function(){t.fetchData()},t.fetchData=function(){t._s_tk_com=a.get("_s_tk_com"),t.invoiceMainBeanStatusList=c.loadControllerData(),null==t.invoiceMainBeanStatusList&&localforage.getItem("invoiceMainBeanNewList").then(function(e){t.invoiceMainBeanStatusList=e,localforage.setItem("InvoiceMainBeanList",t.invoiceMainBeanStatusList),null!=e&&s.reload()}),o.globalPageLoader=!1},t.showAddBrandPopup=function(){t.brandBean={},t.showNewBrandModal=!0},t.sessionValidation()}],StockControlController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","StockControlControllerPreLoad",function(r,e,a,o,t,n,s){t.MainSideBarhideit=!1,t.MainHeaderideit=!1,r.dataLoading=!1,r.loadAll=!0,r.sesssionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"))},r.addReceiveOrder=function(){a.location="/app/#/poCreateandReceive"},r.addPurchaseOrder=function(){a.location="/app/#/purchaseOrder"},r.addStockReturn=function(){a.location="/app/#/stockReturn"},r.addStockSupplierTransfer=function(){a.location="/app/#/stockSupplierTransfer"},r.addStockTransfer=function(){a.location="/app/#/stockTransfer"},r.addStockReturntoWarehouse=function(){a.location="/app/#/stockReturntoWarehouse"},r.addInventoryCount=function(){a.location="/app/#/inventoryCount"},r.purchaseOrderActions=function(e){if(o.put("_ct_bl_ost",e),"1"==e.stockOrderTypeId)a.location="/app/#/purchaseOrderActions";else if("2"==e.stockOrderTypeId||"7"==e.stockOrderTypeId){if(1!=r.roleId){var t=e.outletName;e.outletName=e.supplierName,e.supplierName=t}o.put("_ct_bl_ost",e),a.location="/app/#/stockReturnActions"}else if("5"==e.stockOrderTypeId){if(1!=r.roleId){t=e.outletName;e.outletName=e.supplierName,e.supplierName=t}o.put("_ct_bl_ost",e),a.location="/app/#/stockSupplierTransferActions"}else"3"==e.stockOrderTypeId?a.location="/app/#/stockTransferActions":"4"==e.stockOrderTypeId&&(a.location="/app/#/stockReturntoWarehouseActions")},r.purchaseOrderEditDetails=function(e){if("3"==e.statusId||"8"==e.statusId);else if("1"==e.stockOrderTypeId)o.put("_ct_bl_ost",e),a.location="/app/#/poCreateandReceiveEdit";else if("2"==e.stockOrderTypeId){if(1!=r.roleId){var t=e.outletName;e.outletName=e.supplierName,e.supplierName=t}o.put("_ct_bl_ost",e),a.location="/app/#/stockReturnEditDetails"}else"3"==e.stockOrderTypeId?(o.put("_ct_bl_ost",e),a.location="/app/#/stockTransferEditDetails"):"4"==e.stockOrderTypeId&&(o.put("_ct_bl_ost",e),a.location="/app/#/stockReturntoWarehouseEditDetails")},r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=s.loadControllerData(),r.fetchData(),r.isAdmin())},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.fetchData=function(){t.stockControlLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.stockTransferToSupplier=r.data.stockTransferToSupplier,r.stockOrderBeansList=r.data.stockOrderBeansList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),r.lodAllStockOrdersAsynchrnously(),t.globalPageLoader=!1},r.lodAllStockOrdersAsynchrnously=function(){r.dataLoading=!1,e.post("stockControl/getAllStockOrders/"+o.get("_s_tk_com")+"/true").success(function(e){r.data=e.data,r.dataLoading=!0}).error(function(){a.location="/app/#/login"})},r.loadAllStockOrders=function(){r.dataLoading=!1,r.stockOrderBeansList=[],r.stockOrderBeansList=r.data.stockOrderBeansList;var e=$("#myTable").DataTable();e&&e.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10),r.dataLoading=!0,r.loadAll=!1},r.sessionValidation()}],StockReturnActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockReturnActionsControllerPreLoad",function(a,e,r,t,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),"true"==a.stockOrderBean.retailPriceBill?a.stockOrderBean.retailPriceBill=!0:a.stockOrderBean.retailPriceBill=!1,a.isAdmin(),a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null!=a.headOffice&&""!=a.headOffice.toString()&&"false"==a.headOffice.toString()},a.fetchData=function(){if(s.stockReturnActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll()),null!=a.stockOrderBean.sourceOutletAddress&&"null"!=a.stockOrderBean.sourceOutletAddress||(a.stockOrderBean.sourceOutletAddress=" ");var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.supplierName+' </h4></div> <div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Return from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}s.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.showSendReturnStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockReturnEditProducts":a.showConfirmSendReturnPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return a.calculateGrandTotal(),!0}return!1},a.returnStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+a._s_tk_com+"/"+a.grandTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendReturnPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockReturnEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockReturnEditDetails"},a.sessionValidation()}],StockReturnController=["$scope","$http","$filter","$window","$cookieStore","$rootScope","$timeout","SessionService","StockReturnControllerPreLoad",function(r,e,t,a,o,n,s,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=t("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="SR-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="SR-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=c.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),"1"!=r.sReturn?a.location="/app/#/home":(r.stockOrderBean.supplierId="-1",r.stockOrderBean.outletId=r.userOutletId))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){n.stockReturnLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),n.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="2",e.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,s(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_e_cOt_pio",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturnDetailsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturnDetailsControllerPreLoad",function(n,t,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.itemCountTotal=0,n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.stockOrderBean=o.get("_e_cOt_pio"),n.roleId=o.get("_s_tk_rId"),n.headOffice=o.get("_s_tk_iho"),n.stockOrderBean.itemCount=0,n.data=c.loadControllerData(),n.fetchData(),n.isAdmin();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},n.isAdmin=function(){return null!=n.headOffice&&""!=n.headOffice.toString()&&"false"==n.headOffice.toString()},n.fetchData=function(){if(s.stockReturnDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data){if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap)}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0")},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.addStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.showSendReturnStockOrder=function(){n.showConfirmSendReturnPopup=!0},n.returnStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendReturnPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StockReturnEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturnEditDetailsControllerPreLoad",function(r,e,t,a,o,n,s,i){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate),"1"!=r.sReturn&&(a.location="/app/#/home"))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){n.stockReturnEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),n.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="2",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturnEditProductsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturnEditProductsControllerPreLoad",function(t,n,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.roleId=o.get("_s_tk_rId"),n.stockOrderBean=o.get("_ct_bl_ost"),n.stockOrderBean.itemCount=0,null!=n.stockOrderBean.retailPriceBill&&("true"==n.stockOrderBean.retailPriceBill.toString()?n.stockOrderBean.retailPriceBill=!0:n.stockOrderBean.retailPriceBill=!1),n.data=c.loadControllerData(),n.fetchData();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),n.stockOrderBean.itemCount=0,n.AllInOne()}},n.fetchData=function(){if(s.stockReturnEditProductsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=n.data.stockOrderDetailBeansList&&(n.stockOrderDetailBeansList=n.data.stockOrderDetailBeansList),null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap)}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0")},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.updateStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,o.put("_e_cOt_pio",""),0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.showSendTransferStockOrder=function(){n.showConfirmSendTransferPopup=!0},n.transferStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendTransferPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.showSendReturnStockOrder=function(){n.showConfirmSendReturnPopup=!0},n.returnStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendReturnPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StockReturntoWarehouseActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockReturntoWarehouseActionsControllerPreLoad",function(a,e,r,t,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),"true"==a.stockOrderBean.retailPriceBill?a.stockOrderBean.retailPriceBill=!0:a.stockOrderBean.retailPriceBill=!1,a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.isAdmin(),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null==a.headOffice||""==a.headOffice.toString()||"true"!=a.headOffice.toString()},a.fetchData=function(){if(s.stockReturntoWarehouseActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll()),0==a.isAdmin()&&a.calculateTotalAllAdmin();var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Order from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}s.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.calculateItemCountAdmin=function(){if(a.stockOrderBean.itemCountRecv=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCountRecv=parseInt(a.stockOrderBean.itemCountRecv)+parseInt(a.stockOrderDetailBeansList[e].recvProdQty),!isNaN(a.stockOrderBean.itemCountRecv)&&""!=a.stockOrderBean.itemCountRecv||(a.stockOrderBean.itemCountRecv="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAdmin=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.recvProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateItemCountAdmin(),a.calculateGrandrecvTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateTotalAllAdmin=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotalAdmin(a.stockOrderDetailBeansList[e].productVariantId);a.calculateItemCountAdmin()},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.calculateGrandrecvTotal=function(){if(a.grandrecvTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].recvTotal)&&(a.stockOrderDetailBeansList[e].recvTotal="0"),a.grandrecvTotal=parseFloat(a.grandrecvTotal)+parseFloat(a.stockOrderDetailBeansList[e].recvTotal),isNaN(a.grandrecvTotal)&&(a.grandrecvTotal="0")},a.showSendTransferStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockReturntoWarehouseEditProducts":a.showConfirmSendTransferPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},a.transferStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.calculateGrandTotal(),a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturntoHeadOffice/"+a._s_tk_com+"/"+a.grandrecvTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendTransferPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockReturntoWarehouseEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockReturntoWarehouseEditDetails"},a.sessionValidation()}],StockReturntoWarehouseController=["$scope","$filter","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseControllerPreLoad",function(r,e,t,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=e("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="SRW-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="SRW-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){if(i.validate()){r._s_tk_com=n.get("_s_tk_com"),r.roleId=n.get("_s_tk_rId"),r.userOutletId=n.get("_s_tk_oId"),r.headOffice=n.get("_s_tk_iho"),null!=r.headOffice&&""!=r.headOffice.toString()?"true"==r.headOffice.toString()&&(o.location="/app/#/home"):o.location="/app/#/home",r.data=c.loadControllerData(),r.fetchData(),r.stockOrderBean.sourceOutletId=r.userOutletId,r.isAdmin();for(var e=0;e<r.destOutletList.length;e++)null!=r.destOutletList[e].isHeadOffice&&""!=r.destOutletList[e].isHeadOffice&&"null"!=r.destOutletList[e].isHeadOffice.toString()&&"true"==r.destOutletList[e].isHeadOffice.toString()&&(r.stockOrderBean.outletId=r.destOutletList[e].outletId)}},r.fetchData=function(){if(s.stockReturntoWarehouseLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=r.data.outletBeansList){r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList);for(var e=0;e<r.destOutletList.length;e++)r.destOutletList[e].outletId==r.userOutletId&&r.destOutletList.splice(e,1)}null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList),null!=r.data.retailPriceBill&&("true"==r.data.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1)}s.globalPageLoader=!1},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="4",t.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,a(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),n.put("_e_cOt_pio",r.stockOrderBean),e.layOutPath="/app/#/stockReturntoWarehouseDetails",o.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,o.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturntoWarehouseDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseDetailsControllerPreLoad",function(t,n,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.stockTransferDetailBeansList=[],n.stockTransferOrderBean={},n.counter=1,n.returnAllProducts=!1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.stockOrderBean=o.get("_e_cOt_pio"),n.roleId=o.get("_s_tk_rId"),n.headOffice=o.get("_s_tk_iho"),n.data=c.loadControllerData(),n.fetchData();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),n.AllInOne()}},n.isAdmin=function(){return null==n.headOffice||""==n.headOffice.toString()||"true"!=n.headOffice.toString()},n.fetchData=function(){if(s.stockReturntoWarehouseDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data){if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}if(null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap),null!=n.data.stockTransferOrderBeansList){n.stockTransferOrderBeansList=n.data.stockTransferOrderBeansList;for(e=0;e<n.stockTransferOrderBeansList.length;e++)n.stockOrderBean.stockOrderId==n.stockTransferOrderBeansList[e].stockOrderId&&n.stockTransferOrderBeansList.splice(e,1)}}s.globalPageLoader=!1},n.returnAllProducts=function(){"1"==n.returnAllProductsBean?(n.stockOrderDetailBeansList=[],n.copyAllProducts()):n.stockOrderDetailBeansList=[]},n.copyAllProducts=function(){if(n.globalPageLoader=!0,null!=n.productVariantBeansList&&0<n.productVariantBeansList.length){n.counter=1;for(var e=0;e<n.productVariantBeansList.length;e++)null!=n.productVariantBeansList[e].productVariantId&&(n.productVariantBean={},n.productVariantBean=angular.copy(n.productVariantBeansList[e]),n.stockOrderDetailBean.orderProdQty=angular.copy(n.productVariantBeansList[e].currentInventory),n.checkProductStatusAllProducts());for(e=0;e<n.productBeansList.length;e++)if(null!=n.productBeansList[e].productVariantId){n.productVariantBean={},n.productVariantBean.productVariantId=angular.copy(n.productBeansList[e].productId),n.hitVariant=!1;for(var t=0;t<n.productVariantBeansList.length;t++)n.productVariantBeansList[t].productId==n.productVariantBean.productVariantId&&(n.hitVariant=!0);0==n.hitVariant&&(n.productVariantBean={},n.productVariantBean=angular.copy(n.productBeansList[e]),n.stockOrderDetailBean.orderProdQty=angular.copy(n.productBeansList[e].currentInventory),n.checkProductStatusAllProducts())}n.globalPageLoader=!1}else n.globalPageLoader=!1;n.AllInOne()},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.checkProductStatusAllProducts=function(){n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var e=0;e<n.productVariantBeansList.length;e++){var t=null;n.productVariantBean.productVariantId==n.productVariantBeansList[e].productId&&(t=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[e]),n.stockOrderDetailBean.orderProdQty=n.productVariantBeansList[e].currentInventory,n.addProduct(),n.productVariantBean=angular.copy(t),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",n.stockOrderBean.itemCountRecv=0,n.grandrecvTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0"),0==n.isAdmin()&&(1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].recvProdQty:n.stockOrderDetailBeansList[e].recvTotal=value.ordrSupplyPrice*n.stockOrderDetailBeansList[e].recvProdQty,isNaN(n.stockOrderDetailBeansList[e].recvTotal)&&(n.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].recvProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCountRecv=parseInt(n.stockOrderBean.itemCountRecv)+parseInt(n.stockOrderDetailBeansList[e].recvProdQty),!isNaN(n.stockOrderBean.itemCountRecv)&&""!=n.stockOrderBean.itemCountRecv||(n.stockOrderBean.itemCountRecv="0"),n.grandrecvTotal=parseFloat(n.grandrecvTotal)+parseFloat(n.stockOrderDetailBeansList[e].recvTotal),isNaN(n.grandrecvTotal)&&(n.grandrecvTotal="0"))},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.calculateTotalAdminforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.recvProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.checkStockOrderDetailListAdmin=function(){if("true"!=n.headOffice.toString())return!1;if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.addStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),n.isAdmin()},n.showSendTransferStockOrder=function(){n.showConfirmSendTransferPopup=!0},n.transferStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturntoHeadOffice/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendTransferPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StockReturntoWarehouseEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseEditDetailsControllerPreLoad",function(r,e,t,a,o,n,s,i){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate))},r.fetchData=function(){n.stockReturntoWarehouseEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList)),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),n.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="4",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),e.layOutPath="/app/#/stockReturntoWarehouseEditProducts",a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturntoWarehouseEditProductsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseEditProductsControllerPreLoad",function(n,t,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.loading=!1,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.roleId=o.get("_s_tk_rId"),n.stockOrderBean=o.get("_ct_bl_ost"),n.headOffice=o.get("_s_tk_iho"),null!=n.stockOrderBean.retailPriceBill&&("true"==n.stockOrderBean.retailPriceBill.toString()?n.stockOrderBean.retailPriceBill=!0:n.stockOrderBean.retailPriceBill=!1),n.data=c.loadControllerData(),n.fetchData();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),n.isAdmin(),n.AllInOne()}},n.isAdmin=function(){return null==n.headOffice||""==n.headOffice.toString()||"true"!=n.headOffice.toString()},n.fetchData=function(){if(s.stockReturntoWarehouseEditProductsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=n.data.stockOrderDetailBeansList&&(n.stockOrderDetailBeansList=n.data.stockOrderDetailBeansList),null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap)}s.globalPageLoader=!1},n.checkProductStatus=function(){if(1==n.isAdmin()){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}}else{e=n.stockOrderDetailBean.orderProdQty;if(n.stockOrderDetailBean.recvProdQty=n.stockOrderDetailBean.orderProdQty,"true"==n.productVariantBean.isVariant.toString())n.addProductAdmin();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProductAdmin(),n.hit++;else for(t=0;t<n.productVariantBeansList.length;t++){r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.recvProdQty=angular.copy(e),n.addProductAdmin(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProductAdmin())}}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.addProductAdmin=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.recvProdQty)&&(e.recvProdQty="0"),e.recvProdQty=parseInt(e.recvProdQty)+parseInt(n.stockOrderDetailBean.recvProdQty),0<e.ordrSupplyPrice?(e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,1==n.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.total)&&(e.recvTotal="0")):e.recvTotal="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.recvTotal=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.recvProdQty:n.stockOrderDetailBean.recvTotal=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.recvProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.recvTotal="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.orderProdQty="0",n.stockOrderDetailBean.total="0",n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.recvProdQty)&&(e.recvProdQty="0"),e.recvProdQty=parseInt(e.recvProdQty)+parseInt(n.stockOrderDetailBean.recvProdQty),0<e.ordrSupplyPrice?(e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,1==n.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0")):e.recvTotal="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.recvTotal=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.recvProdQty:n.stockOrderDetailBean.recvTotal=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.recvProdQty,isNaN(n.stockOrderDetailBean.recvTotal)&&(n.stockOrderDetailBean.recvTotal="0"),n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.orderProdQty="0",n.stockOrderDetailBean.total="0",n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.recvTotal=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.recvProdQty:n.stockOrderDetailBean.recvTotal=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.recvProdQty,n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.orderProdQty="0",n.stockOrderDetailBean.total="0",n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.stockOrderDetailBean.isDirty=!0,n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",n.stockOrderBean.itemCountRecv=0,n.grandrecvTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0"),0==n.isAdmin()&&(1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].recvProdQty:n.stockOrderDetailBeansList[e].recvTotal=value.ordrSupplyPrice*n.stockOrderDetailBeansList[e].recvProdQty,isNaN(n.stockOrderDetailBeansList[e].recvTotal)&&(n.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].recvProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCountRecv=parseInt(n.stockOrderBean.itemCountRecv)+parseInt(n.stockOrderDetailBeansList[e].recvProdQty),!isNaN(n.stockOrderBean.itemCountRecv)&&""!=n.stockOrderBean.itemCountRecv||(n.stockOrderBean.itemCountRecv="0"),n.grandrecvTotal=parseFloat(n.grandrecvTotal)+parseFloat(n.stockOrderDetailBeansList[e].recvTotal),isNaN(n.grandrecvTotal)&&(n.grandrecvTotal="0"))},n.markAllReceive=function(){if(0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].recvProdQty="",n.stockOrderDetailBeansList[e].recvProdQty=angular.copy(n.stockOrderDetailBeansList[e].orderProdQty),n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].recvProdQty,n.stockOrderDetailBeansList[e].isDirty=!0,isNaN(n.stockOrderDetailBeansList[e].recvTotal)&&(n.stockOrderDetailBeansList[e].recvTotal="0");n.AllInOne()},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.calculateTotalAdminforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.recvProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.checkStockOrderDetailListAdmin=function(){if("true"!=n.headOffice.toString())return!1;if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].recvProdQty||null==n.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.updateStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,o.put("_e_cOt_pio",""),0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),n.isAdmin()},n.showSendTransferStockOrder=function(){n.showConfirmSendTransferPopup=!0},n.transferStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.AllInOne(),n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturntoHeadOffice/"+n._s_tk_com+"/"+n.grandrecvTotal+"/"+n.stockOrderBean.itemCountRecv,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendTransferPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StockSupplierTransferActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockSupplierTransferActionsControllerPreLoad",function(a,e,r,t,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),a.stockOrderBean.retailPriceBill=!0,a.isAdmin(),a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null!=a.headOffice&&""!=a.headOffice.toString()&&"false"==a.headOffice.toString()},a.fetchData=function(){if(s.stockReturnActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll()),null!=a.stockOrderBean.sourceOutletAddress&&"null"!=a.stockOrderBean.sourceOutletAddress||(a.stockOrderBean.sourceOutletAddress=" ");var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.supplierName+' </h4></div> <div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Return from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Remarks: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.remarks+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}s.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.showSendReturnStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockReturnEditProducts":a.showConfirmSendReturnPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return a.calculateGrandTotal(),!0}return!1},a.returnStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+a._s_tk_com+"/"+a.grandTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendReturnPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockSupplierTransferEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockSupplierTransferEditDetails"},a.sessionValidation()}],StockSupplierTransferController=["$scope","$http","$filter","$window","$cookieStore","$rootScope","$timeout","SessionService","StockSupplierTransferControllerPreLoad",function(r,e,t,a,o,n,s,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=t("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="SST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="SST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=c.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),"1"!=r.sReturn?a.location="/app/#/home":(r.stockOrderBean.supplierId="-1",r.stockOrderBean.outletId=r.userOutletId))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){n.stockReturnLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList),r.stockOrderBean.stockOrderTypeId="5",e.post("purchaseOrder/stockSupplierTransferRetailPrice/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?null!=e.data&&"true"==e.data?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1:"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})),n.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="5",e.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,s(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_e_cOt_pio",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockSupplierTransferDetailsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockSupplierTransferDetailsControllerPreLoad",function(n,t,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.stockOrderBean=o.get("_e_cOt_pio"),n.roleId=o.get("_s_tk_rId"),n.headOffice=o.get("_s_tk_iho"),n.data=c.loadControllerData(),n.fetchData(),n.isAdmin();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),n.AllInOne()}},n.isAdmin=function(){return null!=n.headOffice&&""!=n.headOffice.toString()&&"false"==n.headOffice.toString()},n.fetchData=function(){if(s.stockReturnDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data){if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap)}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",n.stockOrderBean.itemCountRecv=0,n.grandrecvTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0"),0==n.isAdmin()&&(1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].recvProdQty:n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].recvProdQty,isNaN(n.stockOrderDetailBeansList[e].recvTotal)&&(n.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].recvProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCountRecv=parseInt(n.stockOrderBean.itemCountRecv)+parseInt(n.stockOrderDetailBeansList[e].recvProdQty),!isNaN(n.stockOrderBean.itemCountRecv)&&""!=n.stockOrderBean.itemCountRecv||(n.stockOrderBean.itemCountRecv="0"),n.grandrecvTotal=parseFloat(n.grandrecvTotal)+parseFloat(n.stockOrderDetailBeansList[e].recvTotal),isNaN(n.grandrecvTotal)&&(n.grandrecvTotal="0"))},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.addStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.showSendReturnStockOrder=function(){n.showConfirmSendReturnPopup=!0},n.returnStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferToSupplierStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendReturnPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"205px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StockSupplierTransferEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockSupplierTransferEditDetailsController",function(r,e,t,a,o,n,s,i){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate),"1"!=r.sReturn&&(a.location="/app/#/home"))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){n.stockReturnEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),n.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="5",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockSupplierTransferEditProductsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockSupplierTransferEditProductsControllerPreLoad",function(t,n,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.roleId=o.get("_s_tk_rId"),n.stockOrderBean=o.get("_ct_bl_ost"),null!=n.stockOrderBean.retailPriceBill&&("true"==n.stockOrderBean.retailPriceBill.toString()?n.stockOrderBean.retailPriceBill=!0:n.stockOrderBean.retailPriceBill=!1),n.data=c.loadControllerData(),n.fetchData();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),n.AllInOne()}},n.isAdmin=function(){return null!=n.headOffice&&""!=n.headOffice.toString()&&"false"==n.headOffice.toString()},n.fetchData=function(){if(s.stockReturnEditProductsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=n.data.stockOrderDetailBeansList&&(n.stockOrderDetailBeansList=n.data.stockOrderDetailBeansList),null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap)}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",n.stockOrderBean.itemCountRecv=0,n.grandrecvTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0"),0==n.isAdmin()&&(1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].recvProdQty:n.stockOrderDetailBeansList[e].recvTotal=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].recvProdQty,isNaN(n.stockOrderDetailBeansList[e].recvTotal)&&(n.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].recvProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCountRecv=parseInt(n.stockOrderBean.itemCountRecv)+parseInt(n.stockOrderDetailBeansList[e].recvProdQty),!isNaN(n.stockOrderBean.itemCountRecv)&&""!=n.stockOrderBean.itemCountRecv||(n.stockOrderBean.itemCountRecv="0"),n.grandrecvTotal=parseFloat(n.grandrecvTotal)+parseFloat(n.stockOrderDetailBeansList[e].recvTotal),isNaN(n.grandrecvTotal)&&(n.grandrecvTotal="0"))},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.updateStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,o.put("_e_cOt_pio",""),0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.showSendTransferStockOrder=function(){n.showConfirmSendTransferPopup=!0},n.transferStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferToSupplierStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendTransferPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.showSendReturnStockOrder=function(){n.showConfirmSendReturnPopup=!0},n.returnStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferToSupplierStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendReturnPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StockTransferActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockTransferActionsControllerPreLoad",function(a,e,r,t,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),"true"==a.stockOrderBean.retailPriceBill?a.stockOrderBean.retailPriceBill=!0:a.stockOrderBean.retailPriceBill=!1,a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.isAdmin(),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null==a.headOffice||""==a.headOffice.toString()||"true"!=a.headOffice.toString()},a.fetchData=function(){if(s.stockTransferActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll());var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Order from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}s.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.showSendTransferStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockTransferEditProducts":a.showConfirmSendTransferPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},a.transferStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.calculateGrandTotal(),a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+a._s_tk_com+"/"+a.grandTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendTransferPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockTransferEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockTransferEditDetails"},a.sessionValidation()}],StockTransferController=["$scope","$filter","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferControllerPreLoad",function(r,e,t,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=e("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="ST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="ST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=n.get("_s_tk_com"),r.roleId=n.get("_s_tk_rId"),r.userOutletId=n.get("_s_tk_oId"),r.data=c.loadControllerData(),r.fetchData(),r.stockOrderBean.sourceOutletId=r.userOutletId)},r.fetchData=function(){if(s.stockTransferLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=r.data.outletBeansList){r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList);for(var e=0;e<r.destOutletList.length;e++)r.destOutletList[e].outletId==r.userOutletId&&r.destOutletList.splice(e,1)}null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList),null!=r.data.retailPriceBill&&("true"==r.data.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1)}s.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="3",t.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,a(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),n.put("_e_cOt_pio",r.stockOrderBean),o.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,o.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockTransferDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferDetailsControllerPreLoad",function(t,n,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.showConfirmDeletePopup=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.stockTransferDetailBeansList=[],n.stockTransferOrderBean={},n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.stockOrderBean=o.get("_e_cOt_pio"),n.roleId=o.get("_s_tk_rId"),n.headOffice=o.get("_s_tk_iho"),n.data=c.loadControllerData(),n.fetchData();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},n.isAdmin=function(){return null==n.headOffice||""==n.headOffice.toString()||"true"!=n.headOffice.toString()},n.fetchData=function(){if(s.stockTransferDetailsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data){if(null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}if(null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap),null!=n.data.stockTransferOrderBeansList){n.stockTransferOrderBeansList=n.data.stockTransferOrderBeansList;for(e=0;e<n.stockTransferOrderBeansList.length;e++)n.stockOrderBean.stockOrderId==n.stockTransferOrderBeansList[e].stockOrderId&&n.stockTransferOrderBeansList.splice(e,1)}}s.globalPageLoader=!1},n.copyPreviousStockOrderDetails=function(){null!=n.stockTransferOrderBean&&(angular.forEach(n.stockTransferOrderBeansList,function(e,t){e.stockOrderId==n.stockTransferOrderBean.stockOrderId&&(n.stockTransferOrderBean.stockOrderTypeId=angular.copy(e.stockOrderTypeId))}),"3"==n.stockTransferOrderBean.stockOrderTypeId&&"-1"!=n.stockTransferOrderBean.stockOrderId.toString()&&(n.globalPageLoader=!0,e.post("purchaseOrderActions/getAllDetailsByStockOrderId/"+n._s_tk_com,n.stockTransferOrderBean).success(function(e){if(n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.stockOrderDetailBeansList=[],n.stockTransferDetailBeansList=e.data,null!=n.stockTransferDetailBeansList&&0<n.stockTransferDetailBeansList.length){n.counter=1;for(var t=0;t<n.stockTransferDetailBeansList.length;t++)if(null!=n.stockTransferDetailBeansList[t].productVariantId){if(n.productVariantBean={},n.productVariantBean.productVariantId=angular.copy(n.stockTransferDetailBeansList[t].productVariantId),n.stockOrderDetailBean.orderProdQty=angular.copy(n.stockTransferDetailBeansList[t].orderProdQty),n.productVariantBean.isProduct=angular.copy(n.stockTransferDetailBeansList[t].isProduct),1==n.productVariantBean.isProduct){for(var r=0;r<n.productBeansList.length;r++)if(n.productVariantBean.productVariantId==n.productBeansList[r].productVariantId){n.productVariantBean=angular.copy(n.productBeansList[r]);break}}else for(r=0;r<n.productVariantBeansList.length;r++)if(n.productVariantBean.productVariantId==n.productVariantBeansList[r].productVariantId){n.productVariantBean=angular.copy(n.productVariantBeansList[r]);break}n.addProduct()}n.globalPageLoader=!1}else n.globalPageLoader=!1;n.AllInOne()}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):"NORECORDFOUND"==n.responseStatus?n.globalPageLoader=!1:(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),"4"==n.stockTransferOrderBean.stockOrderTypeId&&"-1"!=n.stockTransferOrderBean.stockOrderId.toString()&&(n.globalPageLoader=!0,e.post("purchaseOrderActions/getAllDetailsByStockOrderIdforWarehouse/"+n._s_tk_com,n.stockTransferOrderBean).success(function(e){if(n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus)if(n.stockOrderDetailBeansList=[],n.stockTransferDetailBeansList=e.data,null!=n.stockTransferDetailBeansList&&0<n.stockTransferDetailBeansList.length){n.counter=1;for(var t=0;t<n.stockTransferDetailBeansList.length;t++)if(null!=n.stockTransferDetailBeansList[t].productVariantId){if(n.productVariantBean={},n.productVariantBean.productVariantId=angular.copy(n.stockTransferDetailBeansList[t].productVariantId),n.stockOrderDetailBean.orderProdQty=angular.copy(n.stockTransferDetailBeansList[t].orderProdQty),n.productVariantBean.isProduct=angular.copy(n.stockTransferDetailBeansList[t].isProduct),1==n.productVariantBean.isProduct){for(var r=0;r<n.productBeansList.length;r++)if(n.productVariantBean.productVariantId==n.productBeansList[r].productVariantId){n.productVariantBean=angular.copy(n.productBeansList[r]);break}}else for(r=0;r<n.productVariantBeansList.length;r++)if(n.productVariantBean.productVariantId==n.productVariantBeansList[r].productVariantId){n.productVariantBean=angular.copy(n.productVariantBeansList[r]);break}n.addProduct()}n.globalPageLoader=!1}else n.globalPageLoader=!1;else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):"NORECORDFOUND"==n.responseStatus?n.globalPageLoader=!1:(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})))},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBean.isDirty=!0,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0")},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.addStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,n.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.saveAndTransferStockOrderDetail=function(){n.addStockOrderDetail(),a.location="/app/#/stockTransfer"},n.showSendTransferStockOrder=function(){n.showConfirmSendTransferPopup=!0},n.transferStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendTransferPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StockTransferEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferEditDetailsControllerPreLoad",function(r,e,t,a,o,n,s,i){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate))},r.fetchData=function(){if(n.stockTransferEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=r.data.outletBeansList){r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList);for(var e=0;e<r.destOutletList.length;e++)r.destOutletList[e].outletId==r.userOutletId&&r.destOutletList.splice(e,1)}null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)}n.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="3",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockTransferEditProductsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferEditProductsControllerPreLoad",function(n,t,e,r,a,o,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,n.productVariantBean={},n.productVariantBeansList=[],n.stockOrderDetailBean={},n.delStockOrderDetailBean={},n.stockOrderDetailBeansList=[],n.counter=1,n.hideRefValues=!1,n.productVariantMap=[],n.productMap=[],n.productSKU="",n.skudisable=!1,n.inputTypeScan=!0,n.sessionValidation=function(){if(i.validate()){n._s_tk_com=o.get("_s_tk_com"),n.roleId=o.get("_s_tk_rId"),n.stockOrderBean=o.get("_ct_bl_ost"),n.headOffice=o.get("_s_tk_iho"),null!=n.stockOrderBean.retailPriceBill&&("true"==n.stockOrderBean.retailPriceBill.toString()?n.stockOrderBean.retailPriceBill=!0:n.stockOrderBean.retailPriceBill=!1),n.data=c.loadControllerData(),n.fetchData();var e=new Date(n.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();n.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),n.isAdmin(),n.stockOrderBean.itemCount=0,n.AllInOne()}},n.isAdmin=function(){return null==n.headOffice||""==n.headOffice.toString()||"true"!=n.headOffice.toString()},n.fetchData=function(){if(s.stockTransferEditProductsLoadedFully=!1,"NORECORDFOUND"==n.data)n.error=!0,n.errorMessage="No record found";else if("SYSTEMBUSY"==n.data)n.error=!0,n.errorMessage=n.systemBusy;else if("INVALIDSESSION"==n.data)n.error=!0,n.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=n.data.stockOrderDetailBeansList&&(n.stockOrderDetailBeansList=n.data.stockOrderDetailBeansList),null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.productVariantMap&&(n.productVariantMap=n.data.productVariantMap),null!=n.data.productMap&&(n.productMap=n.data.productMap),null!=n.data.productBeansList){n.productBeansList=n.data.productBeansList;for(var e=0;e<n.productVariantBeansList.length;e++)n.productBeansList.push(n.productVariantBeansList[e])}s.globalPageLoader=!1},n.checkProductStatus=function(){var e=n.stockOrderDetailBean.orderProdQty;if("true"==n.productVariantBean.isVariant.toString())n.addProduct();else{if(n.hit=0,"true"==n.productVariantBean.isProduct.toString())n.addProduct(),n.hit++;else for(var t=0;t<n.productVariantBeansList.length;t++){var r=null;n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(r=angular.copy(n.productVariantBean),n.productVariantBean=angular.copy(n.productVariantBeansList[t]),n.stockOrderDetailBean.orderProdQty=angular.copy(e),n.addProduct(),n.productVariantBean=angular.copy(r),n.hit++)}n.hit<1&&(n.productVariantBean.isProduct="true",n.addProduct())}n.AllInOne()},n.addProduct=function(){n.dualEntry=!1;var a=n.productVariantBean,o={};0<n.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}):angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(n.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1),n.stockOrderDetailBeansList.unshift(o),n.dualEntry=!0}}),1!=n.dualEntry&&(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,isNaN(n.stockOrderDetailBean.total)&&(n.stockOrderDetailBean.total="0"),n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean),n.dualEntry=!1)):(n.stockOrderDetailBean.productVariantId=a.productVariantId,n.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,n.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,n.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,n.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(n.stockOrderDetailBean.ordrSupplyPrice="",n.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(n.stockOrderDetailBean.retailPrice="",n.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBean.total=n.stockOrderDetailBean.retailPrice*n.stockOrderDetailBean.orderProdQty:n.stockOrderDetailBean.total=n.stockOrderDetailBean.ordrSupplyPrice*n.stockOrderDetailBean.orderProdQty,n.stockOrderDetailBean.order=n.counter,n.stockOrderDetailBean.isDirty=!0,n.counter++,n.stockOrderDetailBean.stockOrderId=n.stockOrderBean.stockOrderId,n.stockOrderDetailBeansList.unshift(n.stockOrderDetailBean)),n.stockOrderDetailBean={},n.airportName=[]},n.showConfirmDelete=function(e){n.delStockOrderDetailBean={},n.delStockOrderDetailBean=angular.copy(e),n.showConfirmDeletePopup=!0},n.delStockOrderDetail=function(){void 0!==n.delStockOrderDetailBean.stockOrderDetailId&&(n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+n._s_tk_com,n.delStockOrderDetailBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?n.loading=!1:"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||"INVALIDSESSION"==n.responseStatus?(n.error=!0,n.errorMessage=e.data,a.location=e.layOutPath):(n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})),angular.forEach(n.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==n.delStockOrderDetailBean.productVariantId&&e.isProduct==n.delStockOrderDetailBean.isProduct){var r=n.stockOrderDetailBeansList.indexOf(e);n.stockOrderDetailBeansList.splice(r,1)}}),n.showConfirmDeletePopup=!1,n.delStockOrderDetailBean={},n.AllInOne()},n.AllInOne=function(){if(n.counter=1,n.stockOrderBean.itemCount=0,n.grandTotal="0",0<n.stockOrderDetailBeansList.length)for(var e=0;e<n.stockOrderDetailBeansList.length;e++)n.stockOrderDetailBeansList[e].order=n.counter,n.counter++,1==n.stockOrderBean.retailPriceBill?n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].retailPrice*n.stockOrderDetailBeansList[e].orderProdQty:n.stockOrderDetailBeansList[e].total=n.stockOrderDetailBeansList[e].ordrSupplyPrice*n.stockOrderDetailBeansList[e].orderProdQty,isNaN(n.stockOrderDetailBeansList[e].total)&&(n.stockOrderDetailBeansList[e].total="0"),parseInt(n.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(n.stockOrderDetailBeansList[e].orderProdQty)?n.stockOrderDetailBeansList[e].greaterThanStock=!0:n.stockOrderDetailBeansList[e].greaterThanStock=!1,n.stockOrderBean.itemCount=parseInt(n.stockOrderBean.itemCount)+parseInt(n.stockOrderDetailBeansList[e].orderProdQty),isNaN(n.stockOrderBean.itemCount)&&(n.stockOrderBean.itemCount="0"),n.grandTotal=parseFloat(n.grandTotal)+parseFloat(n.stockOrderDetailBeansList[e].total),isNaN(n.grandTotal)&&(n.grandTotal="0")},n.calculateTotalforItem=function(r){angular.forEach(n.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==n.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),n.AllInOne()},n.checkStockOrderDetailList=function(){if(0<n.stockOrderDetailBeansList.length){for(var e=0;e<n.stockOrderDetailBeansList.length;e++){if(""==n.stockOrderDetailBeansList[e].orderProdQty||null==n.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==n.stockOrderDetailBeansList[e].ordrSupplyPrice||null==n.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==n.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},n.updateStockOrderDetail=function(){0<n.stockOrderDetailBeansList.length&&(n.success=!1,n.error=!1,n.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){if(n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus){if(n.success=!0,o.put("_e_cOt_pio",""),n.stockOrderDetailBeansList=e.data,0<n.stockOrderDetailBeansList.length)for(var t=0;t<n.stockOrderDetailBeansList.length;t++)n.stockOrderDetailBeansList[t].isDirty=!1;n.AllInOne(),r(function(){n.success=!1},2e3)}else"SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy}))},n.saveAndTransferStockOrderDetail=function(){n.updateStockOrderDetail(),a.location="/app/#/stockTransfer"},n.showSendTransferStockOrder=function(){n.showConfirmSendTransferPopup=!0},n.transferStockOrder=function(){n.success=!1,n.error=!1,n.loading=!0,n.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+n._s_tk_com+"/"+n.grandTotal+"/"+n.stockOrderBean.itemCount,n.stockOrderDetailBeansList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.productTypeBean={},n.success=!0,n.successMessage="Request Processed successfully!",n.stockOrderBean.stockOrderId=e.data,n.showConfirmSendTransferPopup=!1,r(function(){n.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==n.responseStatus||"INVALIDUSER"==n.responseStatus||"ERROR"==n.responseStatus||n.responseStatus,n.error=!0,n.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,n.error=!0,n.errorMessage=n.systemBusy})},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return n.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();n.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(n.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(n.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(n.hideRefValues=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=r[0],n.checkProductStatus(),n.selectedItem={},n.selectedItem.item=r[0],n.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(n.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),n.hideRefValues=!1),e},renderItem:function(e){return 0==n.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){n.productVariantBean=e.item}},n.skuinput=function(){(n.productSKU.includes("-")||6<n.productSKU.length)&&(null!=n.productVariantMap[n.productSKU.toLowerCase()]?(n.skudisable=!0,n.stockOrderDetailBean.orderProdQty=1,n.productVariantBean=n.productVariantMap[n.productSKU.toLowerCase()],n.checkProductStatus(),n.productSKU="",n.skudisable=!1):15<n.productSKU.length&&(n.productSKU="",n.skudisable=!1))},n.sessionValidation()}],StoreController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$route","StoreControllerPreLoad",function(t,e,r,a,o,n,s,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.companyBean={},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.storeLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.timeZoneBeans&&(t.timeZonesList=t.data.timeZoneBeans),null!=t.data.currencyBeans&&(t.currencyList=t.data.currencyBeans),null!=t.data.printerFormatBeans&&(t.printerFormatsList=t.data.printerFormatBeans),null!=t.data.companyBean&&(t.companyBean=t.data.companyBean)),o.globalPageLoader=!1},t.updateCompany=function(){t.companySuccess=!1,t.companyError=!1,t.loading=!0,e.post("store/updateCompany/"+t._s_tk_com,t.companyBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companySuccess=!0,t.companyBean={},t.companyBean=e.data,t.companySuccessMessage="Request Processed successfully!",s(function(){t.companySuccess=!1,i.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.loading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy})},t.updateContactInformation=function(){t.companySuccess=!1,t.companyError=!1,t.contactInformationloading=!0,e.post("store/updateContactInformation/"+t._s_tk_com,t.companyBean).success(function(e){t.contactInformationloading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companySuccess=!0,t.companySuccessMessage="Request Processed successfully!",s(function(){t.companySuccess=!1,i.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.contactInformationloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy})},t.updateAddress=function(){t.companySuccess=!1,t.companyError=!1,t.addressInformationloading=!0,e.post("store/updateAddress/"+t._s_tk_com,t.companyBean).success(function(e){t.addressInformationloading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companySuccess=!0,t.companySuccessMessage="Request Processed successfully!",s(function(){t.companySuccess=!1,i.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.addressInformationloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy})},t.cancelClick=function(){r.location="/app/#"},t.populatePhysicalAddress=function(){null!=t.companyBean&&null!=t.companyBean.addresses&&0<t.companyBean.addresses.length&&(t.companyBean.addresses[1].contactName=t.companyBean.addresses[0].contactName,t.companyBean.addresses[1].firstName=t.companyBean.addresses[0].firstName,t.companyBean.addresses[1].lastName=t.companyBean.addresses[0].lastName,t.companyBean.addresses[1].email=t.companyBean.addresses[0].email,t.companyBean.addresses[1].phone=t.companyBean.addresses[0].phone,t.companyBean.addresses[1].fax=t.companyBean.addresses[0].fax,t.companyBean.addresses[1].website=t.companyBean.addresses[0].website,t.companyBean.addresses[1].twitter=t.companyBean.addresses[0].twitter,t.companyBean.addresses[1].street=t.companyBean.addresses[0].street,t.companyBean.addresses[1].suburb=t.companyBean.addresses[0].suburb,t.companyBean.addresses[1].city=t.companyBean.addresses[0].city,t.companyBean.addresses[1].postalCode=t.companyBean.addresses[0].postalCode,t.companyBean.addresses[1].state=t.companyBean.addresses[0].state,t.companyBean.addresses[1].countryId=t.companyBean.addresses[0].countryId,t.companyBean.addresses[1].addressType="Physcial Address")},t.sessionValidation()}],StoreCreditController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","StoreCreditControllerPreLoad",function(t,e,r,a,o,n,s,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.companyBean={},t.enableStoreCreditShow={},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.storeCreditLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.companyBean=t.data,"true"==t.companyBean.enableStoresCredit?t.enableStoreCreditShow.value=!0:t.enableStoreCreditShow.value=!1),o.globalPageLoader=!1},t.updateStoreCredit=function(){t.storeCreditSuccess=!1,t.storeCreditError=!1,t.companyBean.enableStoresCredit=t.enableStoreCreditShow.value,t.loading=!0,e.post("storeCredit/updateStoreCreditbyCompany/"+t._s_tk_com,t.companyBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.storeCreditSuccess=!0,t.storeCreditSuccessMessage=e.data,n(function(){t.storeCreditSuccess=!1},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.storeCreditError=!0,t.storeCreditErrorMessage=e.data,r.location=e.layOutPath):(t.storeCreditError=!0,t.storeCreditErrorMessage=e.data)}).error(function(){t.loading=!1,t.storeCreditError=!0,t.storeCreditErrorMessage=t.systemBusy})},t.sessionValidation()}],SupplierDetailsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","SupplierDetailsControllerPreLoad",function(r,e,t,a,o,n,s,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.stockOrderBeansList=[],r.supplierBean={},r.sId=o.get("sp_cto"),r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.supplierBean&&(r.supplierBean=r.data.supplierBean),null!=r.data.supplierPaymentsBeanList&&(r.supplierPaymentBeansList=r.data.supplierPaymentsBeanList,setTimeout(function(){$("#myTable1").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"asc"]],bInfo:!0})},10)),null!=r.data.stockOrderBeansList&&(r.stockOrderBeansList=r.data.stockOrderBeansList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"desc"]],bInfo:!0})},10))),s.globalPageLoader=!1},r.showUpdatePaymentModal=!1,r.addPayment=function(){r.showUpdatePaymentModal=!0,r.supplierPaymentBean={},r.supplierPaymentBean.createdDate=new Date,r.supplierPaymentBean.supplierBalance=angular.copy(r.supplierBean.supplierBalance),r.supplierPaymentBean.supplierNewBalance=r.supplierPaymentBean.supplierBalance,r.supplierPaymentBean.supplier=r.sId,r.supplierPaymentBean.orderRefNum="-1",r.supplierPaymentBean.adjustmentType="Cash Out",r.supplierPaymentBean.paymentCash="0",r.supplierPaymentBean.paymentAmount="0",r.supplierPaymentBean.paymentCreditCard="0",r.supplierPaymentBean.paymentOtherType="0",r.supplierPaymentBean.cashReturn="0"},r.addSuppliersPayment=function(){r.success=!1,r.error=!1,r.loading=!0,e.post("supplierDetails/addSupplierPayment/"+r._s_tk_com,r.supplierPaymentBean).success(function(e){r.responseStatus=e.status,r.loading=!1,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage=e.data,r.showUpdatePaymentModal=!1,a(function(){r.success=!1,r.showUpdatePaymentModal=!1,n.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplier=function(){r.success=!1,r.error=!1,e.post("supplierDetails/getSupplier/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierBean=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchStockOrders=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getAllStockOrdersBySupplierId/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.stockOrderBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplierPayments=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getSupplierPayments/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierPaymentBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.populateOrderAmount=function(){angular.forEach(r.stockOrderBeansList,function(e,t){e.stockOrderId==r.supplierPaymentBean.orderRefNum&&(r.supplierPaymentBean.paymentAmount=angular.copy(e.totalCost))})},r.calculateNewBalance=function(){r.totalPayment=parseInt(r.supplierPaymentBean.paymentCash)+parseInt(r.supplierPaymentBean.paymentOtherType)+parseInt(r.supplierPaymentBean.paymentCreditCard)-parseInt(r.supplierPaymentBean.cashReturn),"Cash Out"==r.supplierPaymentBean.adjustmentType?r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)-parseInt(r.totalPayment)).toString():"Cash In"==r.supplierPaymentBean.adjustmentType&&(r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)+parseInt(r.totalPayment)).toString()),isNaN(r.supplierPaymentBean.supplierNewBalance)&&(r.supplierPaymentBean.supplierNewBalance="")},r.sessionValidation()}],SupplierSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SupplierSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],SuppliersController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$route","SuppliersControllerPreLoad",function(r,t,a,o,n,e,s,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.showUpdatePaymentModal=!1,o.put("supplier",""),r.supplierBean={},r.sessionValidation=function(){e.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData())},r.showDetails=function(e){o.put("sp_cto",e),a.location="/app/#/supplierDetails"},r.fetchData=function(){n.suppliersLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.supplierBean=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),n.globalPageLoader=!1},r.addSupplier=function(){a.location="/app/#/newSupplier"},r.EditRecord=function(e){o.put("supplier",e),a.location="/app/#/newSupplier"},r.showUpdatePaymentModal=!1,r.addPayment=function(e,t){r.fetchStockOrders(e),r.showUpdatePaymentModal=!0,r.supplierPaymentBean={},r.supplierPaymentBean.createdDate=new Date,r.supplierPaymentBean.supplierBalance=angular.copy(t),r.supplierPaymentBean.supplierNewBalance=r.supplierPaymentBean.supplierBalance,r.supplierPaymentBean.supplier=e,r.supplierPaymentBean.orderRefNum="-1",r.supplierPaymentBean.adjustmentType="Cash Out",r.supplierPaymentBean.paymentCash="0",r.supplierPaymentBean.paymentAmount="0",r.supplierPaymentBean.paymentCreditCard="0",r.supplierPaymentBean.paymentOtherType="0",r.supplierPaymentBean.cashReturn="0"},r.addSuppliersPayment=function(){r.success=!1,r.error=!1,r.loading=!0,t.post("supplierDetails/addSupplierPayment/"+r._s_tk_com,r.supplierPaymentBean).success(function(e){r.responseStatus=e.status,r.loading=!1,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.successMessage=e.data,r.showUpdatePaymentModal=!1,s(function(){r.success=!1,r.showUpdatePaymentModal=!1,i.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchStockOrders=function(e){r.success=!1,r.error=!1,t.post("supplierDetails/getAllStockOrdersBySupplierId/"+r._s_tk_com+"/"+e).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?r.stockOrderBeansList=e.data:"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.populateOrderAmount=function(){angular.forEach(r.stockOrderBeansList,function(e,t){e.stockOrderId==r.supplierPaymentBean.orderRefNum&&(r.supplierPaymentBean.paymentAmount=angular.copy(e.totalCost))})},r.calculateNewBalance=function(){r.totalPayment=parseInt(r.supplierPaymentBean.paymentCash)+parseInt(r.supplierPaymentBean.paymentOtherType)+parseInt(r.supplierPaymentBean.paymentCreditCard)-parseInt(r.supplierPaymentBean.cashReturn),"Cash Out"==r.supplierPaymentBean.adjustmentType?r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)-parseInt(r.totalPayment)).toString():"Cash In"==r.supplierPaymentBean.adjustmentType&&(r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)+parseInt(r.totalPayment)).toString()),isNaN(r.supplierPaymentBean.supplierNewBalance)&&(r.supplierPaymentBean.supplierNewBalance="")},r.sessionValidation()}],SupportController=["$scope","$http","$window","$cookieStore","$rootScope","$route","SessionService","SupportControllerPreLoad",function(t,r,a,o,e,n,s,i){e.MainSideBarhideit=!1,e.MainHeaderideit=!1,t.showProcessing=!1,t.dasBoard="Documentation",t.controlPanel="Product Help",t.home="Home",t.pageName="Support",t.manageTicket="Manage Tickets",t.addOrManageTickets="Add or Manage Ticket",t.createTicket="Create Ticket",t.selectSeverityText="Select Severity",t.describeIssuePlaceHolder="Ticket Detail...",t.ticketNamePlaceHolder="Ticket Description...",t.ticketButtonText="Add Ticket",t.systemBusy="System is Busy Please try again",t.ticketId="Id",t.ticketName="Ticket Description",t.severity="Severity",t.status="Status",t.createdBy="Created By",t.createdDate="Created Date",t.tickets=[],t.ticket={},o.put("redirectedThroughManageEmployee",!1),t.sessionValidation=function(){s.validate()&&(t._s_tk_com=o.get("_s_tk_com"),e.supportProcessing=!1,o.put("supportProcessing",e.supportProcessing),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){e.supportLoadedFully=!1,e.supportProcessing=!1,o.put("supportProcessing",e.supportProcessing),"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage="System Busy"):"INVALIDSESSION"==t.data?(t.error=!0,a.location="/app/#/login"):null!=t.data&&(null!=t.data.ticketsList&&(t.tickets=t.data.ticketsList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),null!=t.data.severityList&&(t.severities=t.data.severityList)),e.globalPageLoader=!1},t.addTicket=function(e){if("-1"==e.severityAssociationId)return t.alertMessage="Please select severity.",void $("#alertBox").modal("show");t.showProcessing=!0,r.post("support/addTicket/"+t._s_tk_com,e).success(function(e){t.showProcessing=!1,t.ticket={},t.ticket.severityAssociationId="-1",t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?n.reload():"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.showProcessing=!1,t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.getTicketActivities=function(e){o.put("_t_tob_gra",e.ticketId),a.location="/app/#/ticketActivity"},t.sessionValidation()}],TagSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","TagSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],TicketActivityController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","TicketActivityControllerPreLoad",function(t,r,a,e,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.dasBoard="Documentation",t.controlPanel="Product Help",t.home="Home",t.support="Support",t.pageName="Ticket Activity",t.manageTicketActivity="Manage Ticket",t.addOrManageTickets="Ticket Activities",t.ticketInfo="Ticket Information",t.selectSeverityText="Select Severity",t.describeIssue="Describe Issue...",t.ticketButtonText="Close Ticket",t.ticketReOpenButtonText="Reopen Ticket",t.severityText="Severity",t.statusText="Status",t.ticketDetailText="Detail",t.systemBusy="System is Busy Please try again",e.put("redirectedThroughManageEmployee",!1),e.put("isLogin",""),e.put("EmployeeInfo",""),e.put("isUpdateCall",""),e.put("CompanyInfo",""),e.put("isCompanyUpdateCall",""),e.put("WorkplaceInfo",""),e.put("isWorkplaceUpdateCall",""),e.put("departmentsInfo",""),e.put("invoiceNo",""),e.put("ScheduleInfo",""),e.put("isScheduleUpdateCall",""),e.put("ScheduleEmployeesListInfo",""),t.sessionValidation=function(){n.validate()&&(t._s_tk_com=e.get("_s_tk_com"),o.ticketActivityLoadedFully=!0,t.data=s.loadControllerData(),o.ticketActivityLoadedFully=!1,t.fetchData())},t.fetchData=function(){o.supportLoadedFully=!1,o.supportProcessing=!1,e.put("supportProcessing",o.supportProcessing),"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage="System Busy"):"INVALIDSESSION"==t.data?(t.error=!0,a.location="/app/#/login"):null!=t.data&&(null!=t.data.ticketActivitiesList&&(t.ticketActivities=t.data.ticketActivitiesList),null!=t.data.ticketBean&&(t.ticketBean=t.data.ticketBean,t.ticketBeanTemp=angular.copy(t.data.ticketBean))),o.globalPageLoader=!1},t.addTicketActivity=function(e){if("Closed"==t.ticketBean.ticketStatus)return t.alertMessage="Please reopen ticket if you want to add ticket activity.",void $("#myAlertBox").modal("show");t.ticketBeanTemp.description=e,t.description="",r.post("ticketActivity/addTicketActivity/"+t._s_tk_com,t.ticketBeanTemp).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.getTicketActivities(t.ticketBean.ticketId):"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.getTicketActivities=function(e){r.post("ticketActivity/getTicketActivitiesByTicketId/"+t._s_tk_com+"/"+e).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.ticketActivities=e.data:"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.closeTicketConfirmation=function(){t.alertMessage="Are you sure you want to close the ticket.",$("#alertBox").modal("show")},t.closeTicket=function(){r.post("ticketActivity/closeTicket/"+t._s_tk_com,t.ticketBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.getTicketActivities(t.ticketBean.ticketId),t.ticketBean.ticketStatus="Closed"):"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.reOpenTicketConformation=function(){t.alertMessage="Are you sure you want to reopn the ticket.",$("#reOpenAlertBox").modal("show")},t.reOpenTicket=function(){r.post("ticketActivity/reOpenTicket/"+t._s_tk_com,t.ticketBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.getTicketActivities(t.ticketBean.ticketId),t.ticketBean.ticketStatus="Open"):"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.sessionValidation()}],UserSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","UserSalesReportControllerPreLoad",function(r,e,t,a,o,n,s,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),n.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],UsersController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","UsersControllerPreLoad",function(e,t,r,a,o,n,s){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,n.validate(),e.newUsers=function(){r.location="/app/#/newUser"},e.sessionValidation=function(){n.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=s.loadControllerData(),e.fetchData())},e.fetchData=function(){o.usersLoadedFully=!1,"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.usersList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.editUser=function(e){a.put("_e_uob_gra",e.userId),r.location="/app/#/manageUser"},e.sessionValidation()}];
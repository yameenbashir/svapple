"use strict";var BackupController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.success=!1,t.error=!1,t.loading1=!1,t.success1=!1,t.error1=!1,t.uploadme={},t.filepath="",t.uploadme.src="",t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"))},t.takeBackup=function(){t.loading=!0,e.post("backup/takeBakup/"+t._s_tk_com).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success=!0,t.successMessage=e.data,s(function(){t.success=!1},2e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,s(function(){t.error=!1},2e3)):"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=o.systemBusy})},t.reStoreBackup=function(){t.loading1=!0,e.post("backup/reStoreBackup/"+t._s_tk_com).success(function(e){t.loading1=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success1=!0,t.successMessage1=e.data,s(function(){t.success1=!1},2e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus?(t.error1=!0,t.errorMessage1=e.data,s(function(){t.error1=!1},2e3)):"INVALIDSESSION"==t.responseStatus?(t.error1=!0,t.errorMessage1=e.data,r.location=e.layOutPath):(t.error1=!0,t.errorMessage1=e.data)}).error(function(){t.loading1=!1,t.error1=!0,t.errorMessage=o.systemBusy})},t.sessionValidation()}],BrandSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","BrandSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],BrandsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","BrandsControllerPreLoad",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.brandSuccess=!1,t.brandError=!1,t.brandBean={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.brandsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.brandList=t.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},t.showAddBrandPopup=function(){t.brandBean={},t.showNewBrandModal=!0},t.addBrand=function(){t.brandSuccess=!1,t.brandError=!1,t.loading=!0,e.post("brands/addBrand/"+t._s_tk_com,t.brandBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.brandBean={},t.brandSuccess=!0,t.brandSuccessMessage=e.data,t.showNewBrandModal=!1,s(function(){t.brandSuccess=!1,s(function(){n.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.brandError=!0,t.brandErrorMessage=e.data,r.location=e.layOutPath):(t.brandError=!0,t.brandErrorMessage=e.data)}).error(function(){t.loading=!1,t.brandError=!0,t.brandErrorMessage=t.systemBusy})},t.showUpdateBrandPopup=function(e){t.updatebrandBean={},t.updatebrandBean=angular.copy(e),t.showUpdateBrandModal=!0},t.updateBrand=function(){t.brandSuccess=!1,t.brandError=!1,t.loading=!0,e.post("brands/updateBrand/"+t._s_tk_com,t.updatebrandBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updatebrandBean={},t.brandSuccess=!0,t.brandSuccessMessage=e.data,t.showUpdateBrandModal=!1,s(function(){t.brandSuccess=!1,s(function(){n.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.brandError=!0,t.brandErrorMessage=e.data,r.location=e.layOutPath):(t.brandError=!0,t.brandErrorMessage=e.data)}).error(function(){t.loading=!1,t.brandError=!0,t.brandErrorMessage=t.systemBusy})},t.sessionValidation()}],CashManagmentController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","CashManagmentControllerPreLoad","$timeout","$route",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.registerEnableCashStatus=!1,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,t.addCashInFunc=!1,t.addCashOutFunc=!1,t.cashManagmentBean={},t.selectedExpenseType="-1",t.cashModalButtonLabel="",t.expenseTypeFunc=function(e){t.selectedExpenseType=e},t.addCash=function(){t.showCashModal=!0,t.cashModalButtonLabel="Add Cash",t.addCashInFunc=!0},t.removeCash=function(){t.showCashModal=!0,t.cashModalButtonLabel="Remove Cash",t.addCashOutFunc=!0},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.enableCashStatus(),t.data=n.loadControllerData(),t.fetchData())},t.fetchData=function(){o.brandsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):"Please open Register.If you want to check Cash Management."==t.data?(t.error=!0,t.disableMngmnt=!0,t.errorMessage="Please open Register.If you want to check Cash Management."):null!=t.data&&(t.cashManagmentList=t.data.cashManagmentControllerBeans,t.expenseTypes=t.data.expenseTypes),o.cashManagementLoadedFully=!1,o.globalPageLoader=!1},t.addCashIn=function(){t.addCashProcessingButton=!0,t.addCashInFunc?t.cashManagmentBean.cashManagmentType="IN":t.cashManagmentBean.cashManagmentType="OUT",t.cashInOut()},t.cashInOut=function(){t.cashManagmentBean.expenseType=t.selectedExpenseType,e.post("cashManagement/cashInOut/"+t._s_tk_com,t.cashManagmentBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.showCashModal=!1,t.cashManagmentList=e.data,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.enableCashStatus=function(){e.post("cashManagement/enableCashStatus/"+t._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.registerEnableCashStatus=!0:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.cashManagement=function(){e.post("cashManagement/enableCash/"+t._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.registerBean=e.data,a.put("_e_cOr_gra",""),a.put("_e_cOr_gra",t.registerBean.registerId),r.location="/app/#/manageRegister"):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sessionValidation()}],CashSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CashSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],ChangePasswordController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService",function(t,e,r,a,o,s,n){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,t.passwordBean={},t.employeeId=o.get("EmployeeId"),t.userDetailBean={},t.homeContactBean={},t.workContactBean={},t.email=o.get("email"),t.employeeDetailBean=o.get("EmployeeInfo"),t.loading=!1,t.sessionValidation=function(){n.validate()&&(t._s_tk_com=o.get("_s_tk_com"))},t.changePasswordReq=function(){t.success=!1,t.error=!1,t.loading=!0,""!=t.passwordBean.newPassword||""!=t.passwordBean.confirmPassword?t.passwordBean.newPassword==t.passwordBean.confirmPassword?e.post("changePassword/changePasswordReq/"+t._s_tk_com+"/"+t.email+"/"+t.passwordBean.password+"/"+t.passwordBean.newPassword).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?"false"!=e.data.toString()?(t.successMessage="Password has been changed successfully",t.success=!0,r(function(){t.success=!1,t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password="",a.location=e.layOutPath},2e3)):(r(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Current password is not correct",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""):("INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,a.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data),t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password="")}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy,t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""}):(r(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Password does not match the confirm password",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""):(r(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Please enter new password in both fields",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password="")},t.sessionValidation()}],CompanySetupController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService",function(t,e,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.companySuccess=!1,t.companyError=!1,t.systemBusy="System is Busy Please try again",t.companyBean={},t.companiesList=[],t.userBean={},t._s_tk_com=a.get("_s_tk_com"),t.fetchAllCurrencies=function(){e.post("companySetup/getAllCurrencies").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.currencyList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.fetchAllCurrencies(),t.fetchAllPrinterFormats=function(){e.post("companySetup/getAllPrinterFormats").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.printerFormatsList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.fetchAllPrinterFormats(),t.fetchAlltimeZones=function(){e.post("companySetup/getAllTimeZones").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.timeZonesList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.fetchAlltimeZones(),t.reloadRoute=function(){r.location.reload()},t.addNewCompany=function(){t.companySuccess=!1,t.companyError=!1,t.loading=!0,t.addNewCompanyloading=!0,""!=t.companyBean.companyName?""!=t.companyBean.email&&""!=t.companyBean.password?t.companyBean.email!=t.userBean.email?e.post("companySetup/addNewCompany/"+t._s_tk_com,t.companyBean).success(function(e){t.loading=!1,t.addNewCompanyloading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.companySuccess=!0,t.companySuccessMessage=e.data,s(function(){t.companySuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.loading=!1,t.addNewCompanyloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy}):(s(function(){t.error=!1,r.location=Response.layOutPath},2e3),t.error=!0,t.errorMessage="Please enter another email,user with same user email already exist ",t.addNewCompanyloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy):(s(function(){t.error=!1},3e3),t.error=!0,t.errorMessage="Please enter email and  password in both fields",t.passwordBean.newPassword="",t.passwordBean.confirmPassword="",t.passwordBean.password=""):(s(function(){t.error=!1,r.location=Response.layOutPath},2e3),t.error=!0,t.errorMessage="Please enter another name,Company with same name already exist ",t.addNewCompanyloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy)},n.validate(),o.globalPageLoader=!1}],CompanySetupImagesController=["$scope"," $http","$window","$cookieStore","$rootScope","SessionService","CompanySetupImagesControllerPreLoad","$timeout","$route",function(r,e,t,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.companyImpagesList=[],r.configuration={},r.sessionValidation=function(){s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=n.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(r.companyImpagesList=r.data),o.globalPageLoader=!1},r.showImage=function(e){if(0<r.companyImpagesList.length)for(var t=0;t<r.companyImpagesList.length;t++)e==r.companyImpagesList[t].configurationId&&(r.configuration={},r.configuration=angular.copy(r.companyImpagesList[t]))},r.cashInOut=function(){e.post("cashManagement/cashInOut/"+r._s_tk_com,r.cashManagmentBean).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.showCashModal=!1,r.cashManagmentList=e.data,r.addCashProcessingButton=!1,r.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],CreditCardSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CreditCardSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],CustomerDetailsController=["$scope","$http","$interval","$timeout","$window","$cookieStore","$rootScope","SessionService","CustomerDetailsControllerPreLoad",function(r,t,e,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.customerBean={},r.customerPaymentsBeans=[],r.sessionValidation=function(){i.validate()&&(r._s_tk_com=s.get("_s_tk_com"),r.data=c.loadControllerData(),r.InvoiceMainBeans=localStorage.getItem("salesHistory"),r.InvoiceMainBeans=JSON.parse(r.InvoiceMainBeans),r.fetchData())},r.fetchData=function(){n.customerDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):r.customerBean=r.data,n.globalPageLoader=!1},r.loadPaymentHistory=function(){null!=r.data&&(0<r.customerPaymentsBeans.length?($("#myTable").DataTable().destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"asc"]],bInfo:!0})},10)):(r.customerPaymentsBeans=[],r.customerPaymentsBeans=angular.copy(r.customerBean.customerPaymentsBeans)))},e(function(){s.get("salesHostoryLoaded")&&(r.validate(),s.put("salesHostoryLoaded",!1))},1),r.validate=function(){a(function(){r.canvas=document.getElementById("hirearchyPage"),angular.element(document).injector().invoke(function(e){var t=angular.element(r.canvas).scope();e(r.canvas)(t)})},1)},r.processPayment=function(e){r.success=!1,r.error=!1,r.loading=!0,t.post("salesHistory/processPayment/"+r._s_tk_com+"/"+e).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(localforage.setItem("_s_tk_sell",e.data),o.location=e.layOutPath):"INVALIDSESSION"==r.responseStatus||"SYSTEMBUSY"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,o.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){r.loading=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.updateCustomer=function(){o.location="/app/#/manageCustomer"},r.sessionValidation()}],CustomerGroupController=["$scope","$http","$timeout","$route","$window","$cookieStore","$rootScope","SessionService","CustomerGroupControllerPreLoad",function(t,e,r,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,t.showAddProducTypeModal=!1,t.showUpdateCustomerGroupModal=!1,t.customerGroupBean={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=s.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){n.customerGroupLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):(null!=t.data.customerGroupBeanList&&(t.customerGroupList=t.data.customerGroupBeanList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),null!=t.data.countryListBeans&&(t.countryList=t.data.countryListBeans)),n.globalPageLoader=!1},t.showCustomers=function(e){s.put("_e_ctt_llz",e.customerGroupName),s.put("_t_f_lly","true"),o.location="/app/#/customers"},t.showAddCustomerGroupPopup=function(){t.customerGroupBean={},t.customerGroupBean.countryId="1",t.showAddCustomerGroupModal=!0},t.addCustomerGroup=function(){t.customerGroupSuccess=!1,t.customerGroupError=!1,t.loading=!0,e.post("customerGroup/addCustomerGroup/"+t._s_tk_com,t.customerGroupBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.customerGroupBean={},t.customerGroupSuccess=!0,t.customerGroupSuccessMessage=e.data,t.showAddCustomerGroupModal=!1,r(function(){t.customerGroupSuccess=!1,r(function(){a.reload()},500)},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data,o.location=e.layOutPath):(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data)}).error(function(){t.loading=!1,t.customerGroupError=!0,t.customerGroupErrorMessage=t.systemBusy})},t.showUpdateCustomerGroupPopup=function(e){t.updateCustomerGroupBean={},t.updateCustomerGroupBean=angular.copy(e),t.showUpdateCustomerGroupModal=!0},t.updateCustomerGroup=function(){t.customerGroupSuccess=!1,t.customerGroupError=!1,t.loading=!0,e.post("customerGroup/updateCustomerGroup/"+t._s_tk_com,t.updateCustomerGroupBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updateCustomerGroupBean={},t.customerGroupSuccess=!0,t.customerGroupSuccessMessage=e.data,t.showUpdateCustomerGroupModal=!1,r(function(){t.customerGroupSuccess=!1,r(function(){a.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data,o.location=e.layOutPath):(t.customerGroupError=!0,t.customerGroupErrorMessage=e.data)}).error(function(){t.loading=!1,t.customerGroupError=!0,t.customerGroupErrorMessage=t.systemBusy})},t.sessionValidation()}],CustomerGroupSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CustomerGroupSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],CustomerSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","CustomerSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],CustomersController=["$scope","$http","$sce","$timeout","$window","$cookieStore","$rootScope","SessionService","CustomersControllerPreLoad",function(o,r,t,e,s,a,n,i,c){function l(e){if("undefined"!=o.comparisonCustomersList&&null!=o.comparisonCustomersList&&0<o.comparisonCustomersList.length)for(var t=0;t<o.comparisonCustomersList.length;t++)if(o.comparisonCustomersList[t].customerId==e.customerId)return!0;return!1}n.MainSideBarhideit=!1,n.MainHeaderideit=!1,o.sessionValidation=function(){i.validate()&&(o._s_tk_com=a.get("_s_tk_com"),o.data=c.loadControllerData(),o.fetchData(),"true"==a.get("_t_f_lly")&&(o.filterBean={},o.filterBean.search=a.get("_e_ctt_llz"),a.put("_t_f_lly","false"),a.put("_e_ctt_llz","")))},o.fetchData=function(){n.customersLoadedFully=!1,"NORECORDFOUND"==o.data||"No record found !"==o.data?(o.error=!0,o.errorMessage="No record found"):"SYSTEMBUSY"==o.data?(o.error=!0,o.errorMessage=o.systemBusy):"INVALIDSESSION"==o.data?(o.error=!0,o.errorMessage="An exception occured while validating session !",s.location="/app/#/login"):null!=o.data&&(o.customersList=o.data,o.comparisonCustomersList=o.data,o.lodAllCustomersAsynchrnously(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",pageLength:5,buttons:n.buttonsView})},10)),n.globalPageLoader=!1},o.activeInactiveAll=function(e){o.loading=!0,r.get("customers/activeInactiveAllCustomers/"+o._s_tk_com+"/"+e).success(function(e){o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus?(customer=e.data,localforage.setItem("_e_cOt_jir",customer),s.location="/app/#/manageCustomer"):s.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.addCustomer=function(){s.location="/app/#/newCustomer"},o.editCustomer=function(a){r.get("customers/updateSelectedCustomer/"+o._s_tk_com+"/"+a.customerId).success(function(e){if(o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus){for(var t=0;t<o.customersList.length;t++)if(o.customersList[t].customerId==a.customerId){"true"==o.customersList[t].activeIndicator?o.customersList[t].activeIndicator="false":o.customersList[t].activeIndicator="true";break}var r=$("#myTable").DataTable();r&&r.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",pageLength:5,buttons:n.buttonsView})},10)}else s.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.showCustomer=function(t){r.get("customers/getSelectedCustomer/"+o._s_tk_com+"/"+t.customerId).success(function(e){o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus?(t=e.data,a.put("_cD_cDt_gra",t.customerId),localforage.setItem("_e_cOt_jir",t),s.location="/app/#/customerDetails"):s.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.updateCustomer=function(t){r.get("customers/getSelectedCustomer/"+o._s_tk_com+"/"+t.customerId).success(function(e){o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus?(t=e.data,localforage.setItem("_e_cOt_jir",t),s.location="/app/#/manageCustomer"):s.location=e.layOutPath}).error(function(){o.loading=!1,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.lodAllCustomersAsynchrnously=function(){o.dataLoading=!1,r.post("customers/getAllCustomers/"+a.get("_s_tk_com")+"/true").success(function(e){o.data=e.data,o.dataLoading=!0}).error(function(){o.dataLoading=!0,s.location="/app/#/login"}),o.lodAllProductsGraph()},o.lodAllCustomers=function(){o.dataLoading=!1;for(var e=0;e<o.data.length;e++)l(o.data[e])||o.customersList.push(o.data[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",pageLength:5,buttons:n.buttonsView})},1),o.dataLoading=!0},o.lodAllProductsGraph=function(){o.dataLoading=!1,r.post("customers/getCustomerDashBoard/"+a.get("_s_tk_com")).success(function(e){o.data=e.data,o.chartCustomerCount=new CanvasJS.Chart("chartContainerProductCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:o.data.dataPointsCustomerCount}]}),o.chartCustomerCount.render(),o.dataLoadingGraph=!0}).error(function(){})},o.autoCompleteOptionsCustomers={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(o.data,function(e){if(e.contactName)return e.contactName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t)||e.customerBalance.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.contactName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 30%'>"+e.contactName+"</td><td style='width: 10%'>"+e.phoneNumber+"</td><td style='width: 10%'>"+e.customerBalance+"</td></tr></tbody></table>")}},itemSelected:function(e){o.selectedItem=e,o.CustomerName=o.selectedItem,o.showCustomer(o.selectedItem.item)}},o.sessionValidation()}],DownloadProductsController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","DownloadProductsControllerPreLoad",function(r,e,t,a,o,s,n,i){function c(e){if("undefined"!=r.comparisonProductsList&&null!=r.comparisonProductsList&&0<r.comparisonProductsList.length)for(var t=0;t<r.comparisonProductsList.length;t++)if(r.comparisonProductsList[t].productId==e.productId)return!0;return!1}s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.gui={},r.gui.showProductPriceHistory=!1,r.roledId=o.get("_s_tk_rId"),r.dataLoading=!1,r.addProduct=function(){a.location="/app/#/newProduct"},r.addCompositeProduct=function(){a.location="/app/#/newCompositeProduct"},r.showProduct=function(e){o.put("_d_cPi_gra",e.productId),a.location="/app/#/productDetails"},r.editProduct=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cOi_gra",e.outletId),"true"==e.isComposite?a.location="/app/#/manageCompositeProduct":a.location="/app/#/manageProduct"},r.showProductPriceHistory=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cPiN_gra",e.productName),a.location="/app/#/productPriceHistory"},r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.fetchData())},r.fetchData=function(){i.loadControllerData(),"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(r.productsList=null,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/false").success(function(e){r.data=e.data,null!=r.data.productBeanList&&(r.productsList=r.data.productBeanList),null!=r.data.showProductPriceHistory&&("true"==r.data.showProductPriceHistory?r.gui.showProductPriceHistory=!0:r.gui.showProductPriceHistory=!1),r.comparisonProductsList=r.data.productBeanList,r.lodAllProductsAsynchrnously(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,pageLength:5,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:s.buttonsView})},1),r.dataLoading=!0}).error(function(){a.location="/app/#/login"}),r.lodAllProductsGraph()),s.globalPageLoader=!1},r.lodAllProductsGraph=function(){r.dataLoading=!1,e.post("products/getProductDashBoard/"+o.get("_s_tk_com")).success(function(e){r.data=e.data,r.chartCustomerCount=new CanvasJS.Chart("chartContainerProductCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:r.data.dataPointsCustomerCount}]}),r.chartCustomerCount.render(),r.dataLoadingGraph=!0}).error(function(){})},r.lodAllProductsAsynchrnously=function(){r.dataLoading=!1,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/true").success(function(e){r.data=e.data,r.dataLoading=!0}).error(function(){a.location="/app/#/login"})},r.lodAllProducts=function(){r.dataLoading=!1;for(var e=0;e<r.data.productBeanList.length;e++)c(r.data.productBeanList[e])||r.productsList.push(r.data.productBeanList[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:s.buttonsView})},1),r.dataLoading=!0},r.autoCompleteOptionsProducts={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),r.Product=[],_.filter(r.data.productBeanList,function(e){if(e.productName)return e.productName.toLowerCase().includes(t)||e.brandName.toLowerCase().includes(t)||e.createdDate.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.productName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 30%'>"+e.productName+"</td><td style='width: 20%'>"+e.createdDate+"</td><td style='width: 10%'>"+e.brandName+"</td><td style='width: 10%'>"+e.supplierName+"</td><td style='width: 10%'>"+e.varinatsCount+"</td><td style='width: 10%'>"+e.netPrice+"</td><td style='width: 10%'>"+e.inventoryCount+"</td></tr></tbody></table>")}},itemSelected:function(e){r.selectedItem=e,r.CustomerName=r.selectedItem,r.showProduct(r.selectedItem.item)}},r.sessionValidation()}],EcommerceController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","EcommerceControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){o.ecommerceLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data&&(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),o.globalPageLoader=!1},e.sessionValidation()}],EcomProductsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","EcomProductsControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){o.ecomProductsLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data&&(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),o.globalPageLoader=!1},e.sessionValidation(),e.allowSale=!0,e.addProduct=function(){r.location="/app/#/newProduct"},e.showProduct=function(){r.location="/app/#/productDetails"}}],ExpenseReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","ExpenseReportControllerPreLoad",function(a,e,t,r,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.expenseReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),s.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.expenseReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],HomeController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","HomeControllerPreLoad",function(t,e,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.globalPageLoader=!1,t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.homeBean=n.loadControllerData(),t.outletName=t.homeBean.outletName,t.dataPointsRevenue=t.homeBean.dataPointsRevenue,t.dataPointsSaleCount=t.homeBean.dataPointsSaleCount,t.dataPointsCustomerCount=t.homeBean.dataPointsCustomerCount,t.dataPointsDiscount=t.homeBean.dataPointsDiscount,t.dataPointsBasketSize=t.homeBean.dataPointsBasketSize,t.dataPointsGrossProfit=t.homeBean.dataPointsGrossProfit,t.dataPointsBasketValue=t.homeBean.dataPointsBasketValue,t.dataPointsDiscountPercent=t.homeBean.dataPointsDiscountPercent,t.todayRevenue=t.homeBean.todayRevenue,t.revenuePercentage=t.homeBean.revenuePercentage,t.todaySalesCount=t.homeBean.todaySalesCount,t.salesCountPercentage=t.homeBean.salesCountPercentage,t.todayCustomerCount=t.homeBean.todayCustomerCount,t.customerCountPercentage=t.homeBean.customerCountPercentage,t.todayGrossProfit=t.homeBean.todayGrossProfit,t.grossProfitPercentage=t.homeBean.grossProfitPercentage,t.todayDiscount=t.homeBean.todayDiscount,t.discountPercentage=t.homeBean.discountPercentage,t.todayBasketSize=t.homeBean.todayBasketSize,t.basketSizePercentage=t.homeBean.basketSizePercentage,t.todayBasketValue=t.homeBean.todayBasketValue,t.basketValuePercentage=t.homeBean.basketValuePercentage,t.todayDiscountPec=t.homeBean.todayDiscountPec,t.discountPecPercentage=t.homeBean.discountPecPercentage,t.hideSalesDetails=t.homeBean.hideSalesDetails,t.chartRevenue=new CanvasJS.Chart("chartContainerRevenue",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",backgroundColor:"#F5DEB3",dataPoints:t.dataPointsRevenue}]}),t.chartSaleCount=new CanvasJS.Chart("chartContainerSaleCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",backgroundColor:"#F5DEB3",dataPoints:t.dataPointsSaleCount}]}),t.chartCustomerCount=new CanvasJS.Chart("chartContainerCustomerCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsCustomerCount}]}),t.chartGrossProfit=new CanvasJS.Chart("chartContainerGrossProfit",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsGrossProfit}]}),t.chartDiscount=new CanvasJS.Chart("chartContainerDiscount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsDiscount}]}),t.chartDiscountPercent=new CanvasJS.Chart("chartContainerDiscountPercent",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsDiscountPercent}]}),t.chartBasketValue=new CanvasJS.Chart("chartContainerBasketValue",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsBasketValue}]}),t.chartBasketSize=new CanvasJS.Chart("chartContainerBasketSize",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:t.dataPointsBasketSize}]}),t.chartRevenue.render(),t.chartSaleCount.render(),t.chartCustomerCount.render(),t.chartGrossProfit.render(),t.chartDiscount.render(),t.chartDiscountPercent.render(),t.chartBasketValue.render(),t.chartBasketSize.render(),o.globalPageLoader=!1)},t.changeChartType=function(e){t.chart.options.data[0].type=e,t.chart.render()},t.sessionValidation()}],InActivePriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","InActivePriceBookControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.priceBookList=e.data,e.roledId=a.get("_s_tk_rId"),setTimeout(function(){$("#myTable").DataTable({responsive:!0,order:[[6,"Created At"]],paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.addPriceBook=function(){r.location="/app/#/newPriceBook"},e.editPriceBook=function(e){a.put("_e_cPri_gra",e.priceBookId),r.location="/app/#/managePriceBook"},e.sessionValidation()}],InventoryCountActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","InventoryCountActionsControllerPreLoad",function(r,e,a,t,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.disableProcess=!1,r.showConfirmCancelPopup=!1,r.inventoryCountDetailBeansList=[],r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.inventoryCountBean=o.get("_ct_sc_ost"),r.data=c.loadControllerData(),r.fetchData(),"3"!=r.inventoryCountBean.statusId&&"8"!=r.inventoryCountBean.statusId||(r.disableProcess=!0),r.isAdmin())},r.fetchData=function(){if(n.inventoryCountActionsLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=r.data&&"No record found !"!=r.data){r.inventoryCountDetailBeansList=r.data;var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Name / Reference: </label> </h4></div><div class="col-md-2 !important;"><h4>'+r.inventoryCountBean.inventoryCountRefNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Type: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.inventoryCountTypeDesc+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Outlet: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Remarks: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.remarks+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Diff in count: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.countDiff+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Diff in Price: </label> </h4></div><div class="col-md-2"><h4>'+r.inventoryCountBean.priceDiff+' </h4></div> <div class="col-md-6"></div> </div><div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.showCancelInventoryCount=function(){r.showConfirmCancelPopup=!0},r.cancelInventoryCount=function(){r.success=!1,r.error=!1,r.loading=!0,r.inventoryCountBean.statusId="8",r.inventoryCountBean.diliveryDueDate=new Date(r.inventoryCountBean.diliveryDueDate),e.post("inventoryCount/updateInventoryCount/"+r._s_tk_com,r.inventoryCountBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.inventoryCountBean.inventoryCountId=e.data,r.showConfirmCancelPopup=!1,t(function(){r.success=!1,a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.inventoryCountEditProducts=function(){a.location="/app/#/inventoryCountEditProducts"},r.inventoryCountEditDetails=function(){a.location="/app/#/inventoryCountEditDetails"},r.sessionValidation(),n.globalPageLoader=!1}],InventoryCountController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","InventoryCountControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sesssionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"))},e.addInventoryCount=function(){r.location="/app/#/inventoryCountCreate"},e.inventoryCountActions=function(e){a.put("_ct_sc_ost",e),r.location="/app/#/inventoryCountActions"},e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.roleId=a.get("_s_tk_rId"),e.userOutletId=a.get("_s_tk_oId"),e.headOffice=a.get("_s_tk_iho"),e.data=n.loadControllerData(),e.fetchData(),e.isAdmin())},e.isAdmin=function(){return null==e.headOffice||""==e.headOffice.toString()||"true"!=e.headOffice.toString()},e.fetchData=function(){o.inventoryCountLoadedFully=!1,"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.inventoryCountBeansList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.sessionValidation()}],InventoryCountCreateController=["$scope","$filter","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","InventoryCountCreateControllerPreLoad",function(r,e,t,a,o,s,n,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.inventoryCountBean={},r.HHMM=e("date")(new Date,"HH:mm"),r.inventoryCountBean.inventoryCountRefNo="SC-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.data=c.loadControllerData(),r.fetchData(),r.inventoryCountBean.outletId=r.userOutletId,r.inventoryCountBean.inventoryCountTypeId="-1")},r.fetchData=function(){s.inventoryCountCreateLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.inventoryCountTypeBeansList&&(r.inventoryCountTypeBeansList=r.data.inventoryCountTypeBeansList),null!=r.data.auditTransfer&&(r.inventoryCountBean.auditTransfer=r.data.auditTransfer)),s.globalPageLoader=!1},r.addInventoryCount=function(){r.success=!1,r.error=!1,r.loading=!0,r.inventoryCountBean.statusId="1",t.post("inventoryCountCreate/addInventoryCount/"+r._s_tk_com,r.inventoryCountBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.inventoryCountBean.inventoryCountId=e.data,n(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.inventoryCountBean.outletId&&(r.inventoryCountBean.outletName=e.outletName)}),angular.forEach(r.inventoryCountTypeBeansList,function(e,t){e.inventoryCountTypeId==r.inventoryCountBean.inventoryCountTypeId&&(r.inventoryCountBean.inventoryCountTypeDesc=e.inventoryCountTypeDesc)}),o.put("_ct_sc_ost",r.inventoryCountBean),a.location=e.layOutPath},3e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==r.responseStatus?(r.warning=!0,r.warningMessage=e.data):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],InventoryCountDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","InventoryCountDetailsControllerPreLoad",function(t,s,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.inventoryCountDetailBean={},s.delInventoryCountDetailBean={},s.productVariantMap=[],s.productMap=[],s.productMap=[],s.allProductMap=[],s.allProductVariantMap=[],s.productSKU="",s.skudisable=!1,s.inventoryCountDetailBeansList=[],s.hideRefValues=!1,s.inputTypeScan=!0,s.counter=1,s.sessionValidation=function(){i.validate()&&(s._s_tk_com=o.get("_s_tk_com"),s.inventoryCountBean=o.get("_ct_sc_ost"),s.inventoryCountBean.itemCountExp=0,s.inventoryCountBean.itemCountCounted=0,"full"==s.inventoryCountBean.inventoryCountTypeDesc.toString().toLowerCase()?s.isFull=!0:s.isFull=!1,s.data=c.loadControllerData(),s.fetchData())},s.fetchData=function(){if(n.inventoryCountDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data){if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}if(null!=s.data.allProductVariantBeansList&&(s.allProductVariantBeansList=s.data.allProductVariantBeansList),null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap),null!=s.data.allProductVariantMap&&(s.allProductVariantMap=s.data.allProductVariantMap),null!=s.data.allProductMap&&(s.allProductMap=s.data.allProductMap),null!=s.data.allProductBeansList){s.allProductBeansList=s.data.allProductBeansList;for(e=0;e<s.allProductVariantBeansList.length;e++)s.allProductBeansList.push(s.allProductVariantBeansList[e]);s.hideTransferInfo=!1}else s.hideTransferInfo=!0;if(null!=s.data.inventoryCountDetailBeansList)s.inventoryCountDetailBeansList=s.data.inventoryCountDetailBeansList;else if("FULL"==s.inventoryCountBean.inventoryCountTypeDesc.toString()){for(e=0;e<s.productBeansList.length;e++)"0"!=s.productBeansList[e].currentInventory&&(s.productVariantBean=s.productBeansList[e],s.inventoryCountDetailBean.countedProdQty=0,s.checkProductStatus(),s.productVariantBean=null,s.inventoryCountDetailBean.countedProdQty=null);s.addInventoryCountDetail()}}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.inventoryCountDetailBean.countedProdQty;if("true"==s.productVariantBean.isVariant.toString())"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct(),s.hit++;else if("true"==s.productVariantBean.auditTransfer)for(var t=0;t<s.allProductVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.allProductVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.allProductVariantBeansList[t]),s.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}else for(t=0;t<s.productVariantBeansList.length;t++){r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.calculateItemCount()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.inventoryCountDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(s.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=s.inventoryCountDetailBeansList.indexOf(e);s.inventoryCountDetailBeansList.splice(r,1),s.inventoryCountDetailBeansList.unshift(o),s.arrangeOrder(),s.dualEntry=!0}}):angular.forEach(s.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(s.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=s.inventoryCountDetailBeansList.indexOf(e);s.inventoryCountDetailBeansList.splice(r,1),s.inventoryCountDetailBeansList.unshift(o),s.arrangeOrder(),s.dualEntry=!0}}),1!=s.dualEntry&&(s.inventoryCountDetailBean.productVariantId=a.productVariantId,s.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.expProdQty="0":s.inventoryCountDetailBean.expProdQty=a.currentInventory,s.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(s.inventoryCountDetailBean.retailPriceExp="",s.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),s.inventoryCountDetailBean.retailPriceExp=s.inventoryCountDetailBean.retailPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.retailPriceCounted)&&(s.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(s.inventoryCountDetailBean.supplyPriceExp="",s.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),s.inventoryCountDetailBean.supplyPriceExp=s.inventoryCountDetailBean.supplyPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.supplyPriceCounted)&&(s.inventoryCountDetailBean.supplyPriceCounted="0"),s.inventoryCountDetailBean.order=s.counter,s.counter++,s.inventoryCountDetailBean.inventoryCountId=s.inventoryCountBean.inventoryCountId,null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(s.inventoryCountDetailBean.countedProdQty)>parseInt(s.inventoryCountDetailBean.expProdQty)?s.inventoryCountDetailBean.auditTransfer=!0:s.inventoryCountDetailBean.auditTransfer=!1,s.inventoryCountDetailBeansList.unshift(s.inventoryCountDetailBean),s.dualEntry=!1)):(s.inventoryCountDetailBean.productVariantId=a.productVariantId,s.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.expProdQty="0":s.inventoryCountDetailBean.expProdQty=a.currentInventory,s.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(s.inventoryCountDetailBean.retailPriceExp="",s.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),s.inventoryCountDetailBean.retailPriceExp=s.inventoryCountDetailBean.retailPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.retailPriceCounted)&&(s.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(s.inventoryCountDetailBean.supplyPriceExp="",s.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),s.inventoryCountDetailBean.supplyPriceExp=s.inventoryCountDetailBean.supplyPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.supplyPriceCounted)&&(s.inventoryCountDetailBean.supplyPriceCounted="0"),s.inventoryCountDetailBean.order=s.counter,s.counter++,s.inventoryCountDetailBean.inventoryCountId=s.inventoryCountBean.inventoryCountId,null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(s.inventoryCountDetailBean.countedProdQty)>parseInt(s.inventoryCountDetailBean.expProdQty)?s.inventoryCountDetailBean.auditTransfer=!0:s.inventoryCountDetailBean.auditTransfer=!1,s.inventoryCountDetailBeansList.unshift(s.inventoryCountDetailBean)),s.calculateTotal(s.productVariantBean),s.inventoryCountDetailBean={},s.airportName=[]},s.changeQuantity=function(e){var t=!1;if("true"==e.isProduct.toString()){for(var r=0;r<s.productBeansList.length;r++){var a=null;if(e.productVariantId==s.productBeansList[r].productVariantId){a=angular.copy(s.productBeansList[r]),s.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<s.allProductBeansList.length;r++){a=null;if(e.productVariantId==s.allProductBeansList[r].productVariantId){a=angular.copy(s.allProductBeansList[r]),s.calculateTotal(a),t=!0;break}}}else{for(r=0;r<s.productVariantBeansList.length;r++){a=null;if(e.productVariantId==s.productVariantBeansList[r].productVariantId){a=angular.copy(s.productVariantBeansList[r]),s.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<s.allProductVariantBeansList.length;r++){a=null;if(e.productVariantId==s.allProductVariantBeansList[r].productVariantId){a=angular.copy(s.allProductVariantBeansList[r]),s.calculateTotal(a),t=!0;break}}}s.calculateItemCount()},s.calculateTotal=function(r){angular.forEach(s.inventoryCountDetailBeansList,function(e,t){e.productVariantId==r.productVariantId&&e.isProduct==r.isProduct&&(null!=e.retailPriceExp&&(e.retailPriceExp=r.retailPriceExclTax*e.expProdQty,isNaN(e.retailPriceExp)&&(e.retailPriceExp="0")),null!=e.retailPriceExp&&(e.retailPriceCounted=r.retailPriceExclTax*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")),null!=e.supplyPriceExp&&(e.supplyPriceExp=r.supplyPriceExclTax*e.expProdQty,isNaN(e.supplyPriceExp)&&(e.supplyPriceExp="0")),null!=e.supplyPriceCounted&&(e.supplyPriceCounted=r.supplyPriceExclTax*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")),null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,e.countDiff=e.countedProdQty-e.expProdQty,e.priceDiff=e.retailPriceCounted-e.retailPriceExp)})},s.calculateItemCount=function(){if(s.inventoryCountBean.itemCountCounted=0,s.inventoryCountBean.itemCountExp=0,s.inventoryCountBean.countDiff=0,s.inventoryCountBean.priceDiff=0,s.inventoryCountBean.retailPriceExp=0,s.inventoryCountBean.retailPriceCounted=0,null!=s.inventoryCountDetailBeansList)for(var e=0;e<s.inventoryCountDetailBeansList.length;e++)s.inventoryCountBean.itemCountCounted=parseInt(s.inventoryCountBean.itemCountCounted)+parseInt(s.inventoryCountDetailBeansList[e].countedProdQty),isNaN(s.inventoryCountBean.itemCountCounted)&&(s.inventoryCountBean.itemCountCounted="0"),s.inventoryCountBean.itemCountExp=parseInt(s.inventoryCountBean.itemCountExp)+parseInt(s.inventoryCountDetailBeansList[e].expProdQty),isNaN(s.inventoryCountBean.itemCountExp)&&(s.inventoryCountBean.itemCountExp="0"),s.inventoryCountBean.countDiff=parseInt(s.inventoryCountBean.countDiff)+parseInt(s.inventoryCountDetailBeansList[e].countDiff),isNaN(s.inventoryCountBean.countDiff)&&(s.inventoryCountBean.countDiff="0"),s.inventoryCountBean.priceDiff=parseInt(s.inventoryCountBean.priceDiff)+parseInt(s.inventoryCountDetailBeansList[e].priceDiff),isNaN(s.inventoryCountBean.priceDiff)&&(s.inventoryCountBean.priceDiff="0"),s.inventoryCountBean.retailPriceExp=parseInt(s.inventoryCountBean.retailPriceExp)+parseInt(s.inventoryCountDetailBeansList[e].retailPriceExp),isNaN(s.inventoryCountBean.retailPriceExp)&&(s.inventoryCountBean.retailPriceExp="0"),s.inventoryCountBean.retailPriceCounted=parseInt(s.inventoryCountBean.retailPriceCounted)+parseInt(s.inventoryCountDetailBeansList[e].retailPriceCounted),isNaN(s.inventoryCountBean.retailPriceCounted)&&(s.inventoryCountBean.retailPriceCounted="0"),s.inventoryCountBean.supplyPriceExp=parseInt(s.inventoryCountBean.supplyPriceExp)+parseInt(s.inventoryCountDetailBeansList[e].supplyPriceExp),isNaN(s.inventoryCountBean.supplyPriceExp)&&(s.inventoryCountBean.supplyPriceExp="0"),s.inventoryCountBean.supplyPriceCounted=parseInt(s.inventoryCountBean.supplyPriceCounted)+parseInt(s.inventoryCountDetailBeansList[e].supplyPriceCounted),isNaN(s.inventoryCountBean.supplyPriceCounted)&&(s.inventoryCountBean.supplyPriceCounted="0"),null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(s.inventoryCountDetailBeansList[e].countedProdQty)>parseInt(s.inventoryCountDetailBeansList[e].expProdQty)?s.inventoryCountDetailBeansList[e].auditTransfer=!0:s.inventoryCountDetailBeansList[e].auditTransfer=!1},s.showConfirmDelete=function(e){s.delInventoryCountDetailBean={},s.delInventoryCountDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delInventoryCountDetail=function(){void 0!==s.delInventoryCountDetailBean.inventoryCountDetailId&&(s.error=!1,s.loading=!0,e.post("inventoryCountDetails/deleteInventoryCountDetail/"+s._s_tk_com,s.delInventoryCountDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==s.delInventoryCountDetailBean.productVariantId&&e.isProduct==s.delInventoryCountDetailBean.isProduct){var r=s.inventoryCountDetailBeansList.indexOf(e);s.inventoryCountDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delInventoryCountDetailBean={},s.arrangeOrder()},s.arrangeOrder=function(){if(s.counter=1,0<s.inventoryCountDetailBeansList.length)for(var e=0;e<s.inventoryCountDetailBeansList.length;e++)s.inventoryCountDetailBeansList[e].order=s.counter,s.counter++},s.checkInventoryCountDetailList=function(){if(s.isFull=!1){if(0<s.inventoryCountDetailBeansList.length){for(var e=0;e<s.inventoryCountDetailBeansList.length;e++)if(""==s.inventoryCountDetailBeansList[e].countedProdQty||null==s.inventoryCountDetailBeansList[e].countedProdQty)return!1;return!0}return!1}return!0},s.addInventoryCountDetail=function(){0<s.inventoryCountDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,s.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(s.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateInventoryCountDetail/"+s._s_tk_com,s.inventoryCountBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,r(function(){s.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==s.responseStatus?(s.warning=!0,s.warningMessage=e.data):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.addAndUpdateInventoryCountDetail=function(){0<s.inventoryCountDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,s.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(s.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateQtyAndUpdateInventoryCountDetail/"+s._s_tk_com,s.inventoryCountBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,o.put("_ct_sc_ost",""),r(function(){s.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==s.responseStatus?(s.warning=!0,s.warningMessage=e.data):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.inventoryCountDetailBean.countedProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.inventoryCountDetailBean.countedProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):null!=s.allProductVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.inventoryCountDetailBean.countedProdQty=1,s.productVariantBean=s.allProductVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],InventoryCountEditDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","InventoryCountEditDetailsControllerPreLoad",function(t,s,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.inventoryCountDetailBean={},s.delInventoryCountDetailBean={},s.inventoryCountDetailBeansList=[],s.productVariantMap=[],s.productMap=[],s.productMap=[],s.allProductMap=[],s.allProductVariantMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.counter=1,s.allCounts=function(){alert("all Counts")},s.matchedCounts=function(){alert("matched Counts")},s.sessionValidation=function(){i.validate()&&(s._s_tk_com=o.get("_s_tk_com"),s.inventoryCountBean=o.get("_ct_sc_ost"),s.inventoryCountBean.itemCountExp=0,s.inventoryCountBean.itemCountCounted=0,s.data=c.loadControllerData(),s.fetchData(),"full"==s.inventoryCountBean.inventoryCountTypeDesc.toString().toLowerCase()?s.isFull=!0:s.isFull=!1)},s.fetchData=function(){if(n.inventoryCountEditDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data){if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}if(null!=s.data.allProductVariantBeansList&&(s.allProductVariantBeansList=s.data.allProductVariantBeansList),null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap),null!=s.data.allProductVariantMap&&(s.allProductVariantMap=s.data.allProductVariantMap),null!=s.data.allProductMap&&(s.allPproductMap=s.data.allProductMap),null!=s.data.allProductBeansList){s.allProductBeansList=s.data.allProductBeansList;for(e=0;e<s.allProductVariantBeansList.length;e++)s.allProductBeansList.push(s.allProductVariantBeansList[e]);s.hideTransferInfo=!1}else s.hideTransferInfo=!0;null!=s.data.inventoryCountDetailBeansList&&(s.inventoryCountDetailBeansList=s.data.inventoryCountDetailBeansList,s.calculateItemCount(),s.changeQuantity(s.inventoryCountDetailBeansList[0]))}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.inventoryCountDetailBean.countedProdQty;if("true"==s.productVariantBean.isVariant.toString())"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct(),s.hit++;else if("true"==s.productVariantBean.auditTransfer)for(var t=0;t<s.allProductVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.allProductVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.allProductVariantBeansList[t]),s.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}else for(t=0;t<s.productVariantBeansList.length;t++){r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.inventoryCountDetailBean.countedProdQty=angular.copy(e),"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.auditTransfer="true":s.inventoryCountDetailBean.auditTransfer="false",s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.calculateItemCount()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.inventoryCountDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(s.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=s.inventoryCountDetailBeansList.indexOf(e);s.inventoryCountDetailBeansList.splice(r,1),s.inventoryCountDetailBeansList.unshift(o),s.arrangeOrder(),s.dualEntry=!0}}):angular.forEach(s.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.countedProdQty)&&(e.countedProdQty="0"),e.countedProdQty=parseInt(e.countedProdQty)+parseInt(s.inventoryCountDetailBean.countedProdQty),0<e.retailPriceCounted?(e.retailPriceCounted=e.retailPriceCounted*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")):e.retailPriceCounted="0",0<e.supplyPriceCounted?(e.supplyPriceCounted=e.supplyPriceCounted*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")):e.supplyPriceCounted="0",null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,o=angular.copy(e);var r=s.inventoryCountDetailBeansList.indexOf(e);s.inventoryCountDetailBeansList.splice(r,1),s.inventoryCountDetailBeansList.unshift(o),s.arrangeOrder(),s.dualEntry=!0}}),1!=s.dualEntry&&(s.inventoryCountDetailBean.productVariantId=a.productVariantId,s.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.expProdQty="0":s.inventoryCountDetailBean.expProdQty=a.currentInventory,s.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(s.inventoryCountDetailBean.retailPriceExp="",s.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),s.inventoryCountDetailBean.retailPriceExp=s.inventoryCountDetailBean.retailPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.retailPriceCounted)&&(s.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(s.inventoryCountDetailBean.supplyPriceExp="",s.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),s.inventoryCountDetailBean.supplyPriceExp=s.inventoryCountDetailBean.supplyPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.supplyPriceCounted)&&(s.inventoryCountDetailBean.supplyPriceCounted="0"),s.inventoryCountDetailBean.order=s.counter,s.counter++,s.inventoryCountDetailBean.inventoryCountId=s.inventoryCountBean.inventoryCountId,null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(s.inventoryCountDetailBean.countedProdQty)>parseInt(s.inventoryCountDetailBean.expProdQty)?s.inventoryCountDetailBean.auditTransfer=!0:s.inventoryCountDetailBean.auditTransfer=!1,s.inventoryCountDetailBeansList.unshift(s.inventoryCountDetailBean),s.dualEntry=!1)):(s.inventoryCountDetailBean.productVariantId=a.productVariantId,s.inventoryCountDetailBean.variantAttributeName=a.variantAttributeName,"true"==s.productVariantBean.auditTransfer?s.inventoryCountDetailBean.expProdQty="0":s.inventoryCountDetailBean.expProdQty=a.currentInventory,s.inventoryCountDetailBean.isProduct=a.isProduct,null!=a.retailPriceExclTax&&(s.inventoryCountDetailBean.retailPriceExp="",s.inventoryCountDetailBean.retailPriceExp=angular.copy(a.retailPriceExclTax),s.inventoryCountDetailBean.retailPriceExp=s.inventoryCountDetailBean.retailPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.retailPriceCounted=a.retailPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.retailPriceCounted)&&(s.inventoryCountDetailBean.retailPriceCounted="0"),null!=a.supplyPriceExclTax&&(s.inventoryCountDetailBean.supplyPriceExp="",s.inventoryCountDetailBean.supplyPriceExp=angular.copy(a.supplyPriceExclTax),s.inventoryCountDetailBean.supplyPriceExp=s.inventoryCountDetailBean.supplyPriceExp*s.inventoryCountDetailBean.expProdQty),s.inventoryCountDetailBean.supplyPriceCounted=a.supplyPriceExclTax*s.inventoryCountDetailBean.countedProdQty,isNaN(s.inventoryCountDetailBean.supplyPriceCounted)&&(s.inventoryCountDetailBean.supplyPriceCounted="0"),s.inventoryCountDetailBean.order=s.counter,s.counter++,s.inventoryCountDetailBean.inventoryCountId=s.inventoryCountBean.inventoryCountId,null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(s.inventoryCountDetailBean.countedProdQty)>parseInt(s.inventoryCountDetailBean.expProdQty)?s.inventoryCountDetailBean.auditTransfer=!0:s.inventoryCountDetailBean.auditTransfer=!1,s.inventoryCountDetailBeansList.unshift(s.inventoryCountDetailBean)),s.calculateTotal(s.productVariantBean),s.inventoryCountDetailBean={},s.arrangeOrder(),s.airportName=[]},s.changeQuantity=function(e){var t=!1;if("true"==e.isProduct.toString()){for(var r=0;r<s.productBeansList.length;r++){var a=null;if(e.productVariantId==s.productBeansList[r].productVariantId){a=angular.copy(s.productBeansList[r]),s.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<s.allProductBeansList.length;r++){a=null;if(e.productVariantId==s.allProductBeansList[r].productVariantId){a=angular.copy(s.allProductBeansList[r]),s.calculateTotal(a),t=!0;break}}}else{for(r=0;r<s.productVariantBeansList.length;r++){a=null;if(e.productVariantId==s.productVariantBeansList[r].productVariantId){a=angular.copy(s.productVariantBeansList[r]),s.calculateTotal(a),t=!0;break}}if(0==t)for(r=0;r<s.allProductVariantBeansList.length;r++){a=null;if(e.productVariantId==s.allProductVariantBeansList[r].productVariantId){a=angular.copy(s.allProductVariantBeansList[r]),s.calculateTotal(a),t=!0;break}}}s.calculateItemCount()},s.calculateTotal=function(r){angular.forEach(s.inventoryCountDetailBeansList,function(e,t){e.productVariantId==r.productVariantId&&e.isProduct==r.isProduct&&(null!=e.retailPriceExp&&(e.retailPriceExp=r.retailPriceExclTax*e.expProdQty,isNaN(e.retailPriceExp)&&(e.retailPriceExp="0")),null!=e.retailPriceExp&&(e.retailPriceCounted=r.retailPriceExclTax*e.countedProdQty,isNaN(e.retailPriceCounted)&&(e.retailPriceCounted="0")),null!=e.supplyPriceExp&&(e.supplyPriceExp=r.supplyPriceExclTax*e.expProdQty,isNaN(e.supplyPriceExp)&&(e.supplyPriceExp="0")),null!=e.supplyPriceCounted&&(e.supplyPriceCounted=r.supplyPriceExclTax*e.countedProdQty,isNaN(e.supplyPriceCounted)&&(e.supplyPriceCounted="0")),null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(e.countedProdQty)>parseInt(e.expProdQty)?e.auditTransfer=!0:e.auditTransfer=!1,e.countDiff=e.countedProdQty-e.expProdQty,e.priceDiff=e.retailPriceCounted-e.retailPriceExp)})},s.calculateItemCount=function(){if(s.inventoryCountBean.itemCountCounted=0,s.inventoryCountBean.itemCountExp=0,s.inventoryCountBean.countDiff=0,s.inventoryCountBean.priceDiff=0,s.inventoryCountBean.retailPriceExp=0,s.inventoryCountBean.retailPriceCounted=0,null!=s.inventoryCountDetailBeansList)for(var e=0;e<s.inventoryCountDetailBeansList.length;e++)s.inventoryCountBean.itemCountCounted=parseInt(s.inventoryCountBean.itemCountCounted)+parseInt(s.inventoryCountDetailBeansList[e].countedProdQty),isNaN(s.inventoryCountBean.itemCountCounted)&&(s.inventoryCountBean.itemCountCounted="0"),s.inventoryCountBean.itemCountExp=parseInt(s.inventoryCountBean.itemCountExp)+parseInt(s.inventoryCountDetailBeansList[e].expProdQty),isNaN(s.inventoryCountBean.itemCountExp)&&(s.inventoryCountBean.itemCountExp="0"),s.inventoryCountBean.countDiff=parseInt(s.inventoryCountBean.countDiff)+parseInt(s.inventoryCountDetailBeansList[e].countDiff),isNaN(s.inventoryCountBean.countDiff)&&(s.inventoryCountBean.countDiff="0"),s.inventoryCountBean.priceDiff=parseInt(s.inventoryCountBean.priceDiff)+parseInt(s.inventoryCountDetailBeansList[e].priceDiff),isNaN(s.inventoryCountBean.priceDiff)&&(s.inventoryCountBean.priceDiff="0"),s.inventoryCountBean.retailPriceExp=parseInt(s.inventoryCountBean.retailPriceExp)+parseInt(s.inventoryCountDetailBeansList[e].retailPriceExp),isNaN(s.inventoryCountBean.retailPriceExp)&&(s.inventoryCountBean.retailPriceExp="0"),s.inventoryCountBean.retailPriceCounted=parseInt(s.inventoryCountBean.retailPriceCounted)+parseInt(s.inventoryCountDetailBeansList[e].retailPriceCounted),isNaN(s.inventoryCountBean.retailPriceCounted)&&(s.inventoryCountBean.retailPriceCounted="0"),s.inventoryCountBean.supplyPriceExp=parseInt(s.inventoryCountBean.supplyPriceExp)+parseInt(s.inventoryCountDetailBeansList[e].supplyPriceExp),isNaN(s.inventoryCountBean.supplyPriceExp)&&(s.inventoryCountBean.supplyPriceExp="0"),s.inventoryCountBean.supplyPriceCounted=parseInt(s.inventoryCountBean.supplyPriceCounted)+parseInt(s.inventoryCountDetailBeansList[e].supplyPriceCounted),isNaN(s.inventoryCountBean.supplyPriceCounted)&&(s.inventoryCountBean.supplyPriceCounted="0"),null!=s.inventoryCountBean.auditTransfer&&1==s.inventoryCountBean.auditTransfer&&parseInt(s.inventoryCountDetailBeansList[e].countedProdQty)>parseInt(s.inventoryCountDetailBeansList[e].expProdQty)?s.inventoryCountDetailBeansList[e].auditTransfer=!0:s.inventoryCountDetailBeansList[e].auditTransfer=!1},s.showConfirmDelete=function(e){s.delInventoryCountDetailBean={},s.delInventoryCountDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delInventoryCountDetail=function(){void 0!==s.delInventoryCountDetailBean.inventoryCountDetailId&&(s.error=!1,s.loading=!0,e.post("inventoryCountDetails/deleteInventoryCountDetail/"+s._s_tk_com,s.delInventoryCountDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.inventoryCountDetailBeansList,function(e,t){if(e.productVariantId==s.delInventoryCountDetailBean.productVariantId&&e.isProduct==s.delInventoryCountDetailBean.isProduct){var r=s.inventoryCountDetailBeansList.indexOf(e);s.inventoryCountDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delInventoryCountDetailBean={},s.arrangeOrder()},s.arrangeOrder=function(){if(s.counter=1,0<s.inventoryCountDetailBeansList.length)for(var e=0;e<s.inventoryCountDetailBeansList.length;e++)s.inventoryCountDetailBeansList[e].order=s.counter,s.counter++},s.checkInventoryCountDetailList=function(){if(0<s.inventoryCountDetailBeansList.length){for(var e=0;e<s.inventoryCountDetailBeansList.length;e++)if(""==s.inventoryCountDetailBeansList[e].countedProdQty||null==s.inventoryCountDetailBeansList[e].countedProdQty)return!1;return!0}return!1},s.addInventoryCountDetail=function(){0<s.inventoryCountDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,s.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(s.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateInventoryCountDetail/"+s._s_tk_com,s.inventoryCountBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,o.put("_ct_sc_ost",""),r(function(){s.success=!1},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==s.responseStatus?(s.warning=!0,s.warningMessage=e.data):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.addAndUpdateInventoryCountDetail=function(){0<s.inventoryCountDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,s.inventoryCountBean.inventoryCountDetailBeansList=angular.copy(s.inventoryCountDetailBeansList),e.post("inventoryCountDetails/updateQtyAndUpdateInventoryCountDetail/"+s._s_tk_com,s.inventoryCountBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,o.put("_ct_sc_ost",""),r(function(){s.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):"WARNING"==s.responseStatus?(s.warning=!0,s.warningMessage=e.data):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.inventoryCountDetailBean.countedProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.inventoryCountDetailBean.countedProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):null!=s.allProductVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.inventoryCountDetailBean.countedProdQty=1,s.productVariantBean=s.allProductVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],InventoryDetailReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","InventoryDetailReportControllerPreLoad",function(a,e,o,t,s,r,n,i,c,l,u){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,a.inventoryReportSuccess=!1,a.inventoryReportError=!1,a.inventoryReportError=!1,a.inventoryReportBean={},a.inventoryReport=[],a.outlets=[],a.outletSelected=s.inventoryReportOutletName,a.sesssionValidation=function(){r.validate()&&(a._s_tk_com=t.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){if("NORECORDFOUND"==a.data||"No record found !"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else if(null!=a.data){if(a.hideSalesDetails=a.data.hideSalesDetails,null!=a.data.inventoryReportBeansList&&(a.inventoryReport=a.data.inventoryReportBeansList,0<a.inventoryReport.length)){for(var e=0,t=0,r=0;r<a.inventoryReport.length;r++)e+=parseFloat(a.inventoryReport[r].currentStock),t+=parseFloat(a.inventoryReport[r].stockValue);a.totalCurrentStock=e+"",a.totalCurrentValue=t+""}null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans)}s.globalPageLoader=!1},a.changeOutletName=function(){s.inventoryReportOutletName=a.outletName,c.reload()},a.sesssionValidation()}],InventoryReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","InventoryReportControllerPreLoad",function(a,e,o,t,s,r,n,i,c,l,u){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,a.inventoryReportSuccess=!1,a.inventoryReportError=!1,a.inventoryReportError=!1,a.inventoryReportBean={},a.inventoryReport=[],a.outlets=[],a.outletSelected=s.inventoryReportOutletName,a.sesssionValidation=function(){r.validate()&&(a._s_tk_com=t.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){if("NORECORDFOUND"==a.data||"No record found !"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else if(null!=a.data){if(a.hideSalesDetails=a.data.hideSalesDetails,null!=a.data.inventoryReportBeansList&&(a.inventoryReport=a.data.inventoryReportBeansList,0<a.inventoryReport.length)){for(var e=0,t=0,r=0;r<a.inventoryReport.length;r++)e+=parseFloat(a.inventoryReport[r].currentStock),t+=parseFloat(a.inventoryReport[r].stockValue);a.totalCurrentStock=e+"",a.totalCurrentValue=t+""}null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans)}s.globalPageLoader=!1},a.changeOutletName=function(){s.inventoryReportOutletName=a.outletName,c.reload()},a.sesssionValidation()}],InventoryReportProductWiseController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","InventoryReportProductWiseControllerPreLoad",function(e,t,r,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.inventoryReportSuccess=!1,e.inventoryReportError=!1,e.inventoryReportError=!1,e.inventoryReportBean={},e.inventoryReport=[],e.outlets=[],e.outletSelected=o.inventoryReportOutletName,e.sesssionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=u.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(null!=e.data.productBeanList&&(e.productBeanList=e.data.productBeanList),null!=e.data.outletBeans&&(e.outlets=e.data.outletBeans)),o.globalPageLoader=!1},e.changeOutletName=function(){o.inventoryReportOutletName=e.outletName,c.reload()},e.sesssionValidation()}],LayoutDesignController=["$timeout","$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","LayoutDesignControllerPreLoad",function(r,a,o,t,s,e,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,a.layoutProducts=[],a.layoutProduct={},a.sesssionValidation=function(){i.validate()&&(a._s_tk_com=e.get("_s_tk_com"),a.layoutDesignControllerBean=c.loadControllerData(),a.allProducts=a.layoutDesignControllerBean.productsBean,n.layoutDesignLoadedFully=!1,a.showProductLayout(),localforage.getItem("_s_tk_sell").then(function(e){a.InvoiceMainBean=e,""!=a.InvoiceMainBean&&void 0!==a.InvoiceMainBean||(a.InvoiceMainBean={})}))},a.allProductsSelected=[],a.saveLayout=function(){a.doneLoading=!0;for(var e=0;e<a.layoutProducts.length;e++)for(var t=0;t<a.allProducts.length;t++)a.allProducts[t].productId===a.layoutProducts[e].id&&(a.allProducts[t].display="true",a.allProductsSelected[a.allProducts[t]]);a.success=!1,o.post("layoutDesign/saveLayout/"+a._s_tk_com,a.allProducts).success(function(e){a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.success=!0,r(function(){a.success=!1},1e3),a.doneLoading=!1,a.successMessage=e.data):"INVALIDSESSION"==a.responseStatus||"SYSTEMBUSY"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,s.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){a.loading=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.showProductLayout=function(){for(var e=0;e<a.allProducts.length;e++)"true"===a.allProducts[e].display&&(a.layoutProduct={},a.layoutProduct.productName=a.allProducts[e].productName,a.layoutProduct.id=a.allProducts[e].productId,a.layoutProducts.push(a.layoutProduct));for(e=a.allProducts.length;e<40-a.allProductsSelected.length;e++)a.layoutProduct={},a.layoutProduct.productName="",a.layoutProduct.id="dummy"+e,a.layoutProducts.push(a.layoutProduct);n.globalPageLoader=!1},a.addProduct=function(e){a.layoutProduct={},a.layoutProduct.id=e.productId,a.layoutProduct.productName=e.productName,a.layoutProducts.push(a.layoutProduct);for(var t=0;t<a.allProducts.length;t++)a.allProducts[t].productId==e.productId&&(a.allProducts[t].display="true")},a.removeProduct=function(e){for(var t=0;t<a.layoutProducts.length;t++)a.layoutProducts[t].id==e.id&&a.layoutProducts.splice(t,1);for(t=0;t<a.allProducts.length;t++)a.allProducts[t].productId==e.id&&(a.allProducts[t].display="false")},a.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),a.productVariantsBeans=[],_.filter(a.allProducts,function(e){return e.productName.toLowerCase().includes(t)&&"true"!=e.display})},renderItem:function(e){return{value:e.productName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.productName+"</td><td style='width: 10%'>"+e.retailPriceExclTax+"</td></tr></tbody></table>")}},itemSelected:function(e){a.selectedItem=e,a.addProduct(a.selectedItem.item),a.airportName=[]}},a.sesssionValidation()}],LoginController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService",function(t,r,a,o,s,n){s.MainSideBarhideit=!0,s.MainHeaderideit=!0,t.loading=!1,t.error=!1,t.userBean={},s.IsLoggedIn=!1,s.isDisabled=!1,n.setSession(""),o.put("_s_tk_com",""),o.put("email",""),o.put("menuMap",""),o.put("isLogin",""),o.put("EmployeeInfo",""),o.put("isUpdateCall",""),o.put("CompanyInfo",""),o.put("isCompanyUpdateCall",""),o.put("WorkplaceInfo",""),o.put("isWorkplaceUpdateCall",""),o.put("departmentsInfo",""),o.put("invoiceNo",""),o.put("ScheduleInfo",""),o.put("isScheduleUpdateCall",""),o.put("ScheduleEmployeesListInfo",""),o.put("ticketBean",""),o.put("ticketActivities",""),o.put("_hirearchy_comp_Id",!1),s.shiftProcessing=!1,o.put("shiftProcessing",s.shiftProcessing),s.locationProcessing=!1,o.put("locationProcessing",s.locationProcessing),s.employeeProcessing=!1,o.put("employeeProcessing",s.employeeProcessing),s.payRollProcessing=!1,o.put("payRollProcessing",s.payRollProcessing),s.reportProcessing=!1,o.put("reportProcessing",s.reportProcessing),s.dashBoardProcessing=!1,o.put("dashBoardProcessing",s.dashBoardProcessing),s.timeLoggingProcessing=!1,o.put("timeLoggingProcessing",s.timeLoggingProcessing),s.supportProcessing=!1,o.put("supportProcessing",s.supportProcessing),s.personalInfoProcessing=!1,o.put("personalInfoProcessing",s.personalInfoProcessing),o.put("_Orig_comp_Id",""),t.systemBusy="System is Busy Please try again",t.manage="Shop",t.worker="Vitals",t.signIn="Sign In",t.enterYourDetailToStartYourSession="Enter your details to start your session",t.signInAsaDifferentUser="Or sign in as a different user",t.emailPlaceholder="Email...",t.PasswordPlaceholder="Password...",t.LoginButtonText="LOGIN",t.LoginText="LOGIN",t.requireLogin="Require Login";var i=["skin-blue","skin-black","skin-red","skin-yellow","skin-purple","skin-green","skin-blue-light","skin-black-light","skin-red-light","skin-yellow-light","skin-purple-light","skin-green-light"];t.changeSkinChange=function(e){$.each(i,function(e){$("body").removeClass(i[e])}),$("body").addClass(e),function(e,t){"undefined"!=typeof Storage?localStorage.setItem(e,t):window.alert("Please use a modern browser to properly view this template!")}("skin",e)},t.clearFields=function(){t.userBean={}},t.changeSkinChange("skin-purple-light"),t.doLogin=function(e){s.isDisabled=!0,t.loading=!0,void 0!==t.userBean.email&&void 0!==t.userBean.password&&r.post("login/doLogin/",e).success(function(e){s.online=!0,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.loginSUccessFUll(e):("SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||t.responseStatus,t.loading=!1,t.error=!0,t.errorMessage=e.data,s.isDisabled=!1)}).error(function(){localforage.getItem("kk_vv").then(function(e){s.userMap=e,window.atob(s.userMap[t.userBean.email])==t.userBean.password?(s.online=!1,n.setUser(t.userBean.email),s.IsSuperUser=!0,s.IsManager=!1,a.location="/app/#/sell"):(t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy,s.isDisabled=!1)})})},t.loginSUccessFUll=function(e){o.put("_s_tk_com",""),o.put("_s_tk_rId",""),o.put("_s_tk_oId",""),o.put("_s_tk_iho",""),o.put("_s_tk_rId",e.data.userRole),o.put("_s_tk_oId",e.data.outletId),o.put("_s_tk_iho",e.data.isHeadOffice),o.put("_s_tk_com",e.data.sessionId),s.userRole=o.get("_s_tk_rId"),n.setSession(e.data.sessionId),o.put("userName",e.data.userName),o.put("email",t.userBean.email),o.put("companyImagePath",e.data.companyImagePath),o.put("termsAndConditions",e.data.termsAndConditions),n.setUser(t.userBean.email),o.put("countNotifications",e.data.countNotifications),s.showNotofications=!1,s.userName=e.data.userName,s.userId=e.data.userId,localforage.setItem("kk_vv",e.data.userMap),o.put("menuMap",""),o.put("menuMap",e.data.mapMenu),s.menuMap=e.data.mapMenu,3==e.data.userRole?(s.IsManager=!0,s.IsSuperUser=!1):(1==e.data.userRole?s.IsSuperUser=!0:s.IsSuperUser=!1,s.IsManager=!1),null!=e.data.countNotifications?s.countNotifications=e.data.countNotifications:s.countNotifications=null,o.put("IsSuperUser",s.IsSuperUser),o.put("IsManager",s.IsManager),s.IsLoggedIn=!0,o.put("isLogin",s.IsLoggedIn),a.location=e.layOutPath,s.userImage="/app/resources/dist/img/avatar5.png"},t.validator=function(e){return e.length<1}}],LoyaltyController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","LoyaltyControllerPreLoad",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loyaltySuccess=!1,t.loyaltyError=!1,t.companyLoyalty={},t.gui={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.loyaltyLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.companyLoyalty=t.data,"true"==t.companyLoyalty.loyaltyEnabled?t.gui.loyaltyEnabled=!0:t.gui.loyaltyEnabled=!1,"true"==t.companyLoyalty.loyaltyBonusEnabled?t.gui.loyaltyBonusEnabled=!0:t.gui.loyaltyBonusEnabled=!1),o.globalPageLoader=!1},t.updateCompanyLoyalty=function(){if(t.loyaltySuccess=!1,t.loyaltyError=!1,t.companyLoyaltyBean=angular.copy(t.companyLoyalty),parseInt(t.companyLoyaltyBean.loyaltyInvoiceAmount)<=parseInt(t.companyLoyaltyBean.loyaltyAmount))return t.loyaltyError=!0,void(t.loyaltyErrorMessage="Loyalty invoice amount should be greater than Loyalty amount.");t.loading=!0,t.companyLoyaltyBean.loyaltyEnabled=t.gui.loyaltyEnabled,t.companyLoyaltyBean.loyaltyBonusEnabled=t.gui.loyaltyBonusEnabled,e.post("loyalty/updateCompanyLoyalty/"+t._s_tk_com,t.companyLoyaltyBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.loyaltySuccess=!0,t.loyaltySuccessMessage=e.data,s(function(){t.loyaltySuccess=!1},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.loyaltyError=!0,t.loyaltyErrorMessage=e.data,r.location=e.layOutPath):(t.loyaltyError=!0,t.loyaltyErrorMessage=e.data)}).error(function(){t.loading=!1,t.loyaltyError=!0,t.loyaltyErrorMessage=t.systemBusy})},t.sessionValidation(),o.globalPageLoader=!1}],ManageCompositeProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","ManageCompositeProductControllerPreLoad",function(i,o,s,e,n,c,a,t,r,l){function u(e,t){if(0<i.productList.length)for(var r=0;r<i.productList.length;r++)if(e){if(i.productList[r].productId==t)return!0}else if(i.productList[r].productVariantId==t)return!0;if(0<i.productDisplayList.length)for(r=0;r<i.productDisplayList.length;r++)if(e){if(i.productDisplayList[r].productId==t)return!0}else if(i.productDisplayList[r].productVariantId==t)return!0;return!1}function d(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function p(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",c(function(){i.variantError=!1},1e3),!0;return!1}function B(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function y(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.tempproductBean={},i.productPriceHistoryBean={},i.compositProduct.compositQunatity="1",i.tagList=[],i.tagDisplayList=[],n.MainSideBarhideit=!1,n.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.gui.compositePrduct=!0,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.hideAddVariantAttributesPanel=!1,i.gui.shwoProductTag=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.gui.isConsumeCompositeQunatity=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productVariantValuesCollectionOldOne=[],i.productVariantValuesCollectionOldTwo=[],i.productVariantValuesCollectionOldThree=[],i.productList=[],i.productDisplayList=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="-1",i.productVariantsCollection.push(i.myObj),i.calculateCompositeProductQuantity=function(){i.gui.compositePrduct&&0<i.productList.length&&i.calculateProductSupplierPrice()},i.addCompositeProductDynamically=function(){if(i.dynamicError=!1,i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)isNaN(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory)||null==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||"null"==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||""==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if("true"==i.productVariantBean.isProduct.toString()){if(i.temp={},u(!0,i.productVariantBean.productId))return i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" already added.",c(function(){i.dynamicError=!1},2e3),i.airportName=[],i.productVariantBean={},void(i.productVariantBean.uniteQunatity="1");if(i.temp=angular.copy(i.productVariantBean),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void c(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){var r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" consume quantity can not be greater than available quantity."+i.productVariantBean.currentInventory,c(function(){i.dynamicError=!1},2e3);else{r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}else for(e=0;e<i.productVariantBeanList.length;e++)if(i.productVariantBean.productVariantId==i.productVariantBeanList[e].productVariantId){if(u(!(i.temp={}),i.productVariantBeanList[e].productVariantId))return i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" already added.",c(function(){i.dynamicError=!1},2e3),i.airportName=[],i.productVariantBean={},void(i.productVariantBean.uniteQunatity="1");if(i.temp=angular.copy(i.productVariantBeanList[e]),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void c(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" cousume quantity can not be great than available quantity."+i.productVariantBean.currentInventory,c(function(){i.dynamicError=!1},2e3);else{var a;r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}i.airportName=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.calculateProductSupplierPrice()},i.removeProduct=function(e){if(0<i.productList.length)for(var t=0;t<i.productList.length;t++)i.productList[t].productVariantId==e.productVariantId&&i.productList.splice(t,1)},i.removeCompositeProduct=function(e){i.loading=!0,o.post("manageCompositeProduct/removeCompositeProduct/"+i._s_tk_com,e).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,c(function(){i.productSuccess=!1,s.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,s.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.calculateProductSupplierPrice=function(){var e=0;if(i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)isNaN(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory)||null==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||"null"==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||""==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if(0<i.productList.length)for(t=0;t<i.productList.length;t++){if(!isNaN(i.productList[t].uniteQunatity))if(i.gui.isConsumeCompositeQunatity&&parseInt(i.productList[t].uniteQunatity)<=parseInt(i.productList[t].currentInventory)&&parseInt(i.productList[t].uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.productList[t].currentInventory))i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity);else if(i.gui.isConsumeCompositeQunatity){i.dynamicError=!0,i.dynamicErrorMessage="Product/Variant "+i.productList[t].variantAttributeName+" cousume quantity can not be great than available quantity..",c(function(){i.dynamicError=!1},2e3),i.productList[t].compositeQunatityConsumed="0",e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].compositeQunatityConsumed)}else{i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity)}}if(0<i.productDisplayList.length)for(t=0;t<i.productDisplayList.length;t++){e+=parseFloat(i.productDisplayList[t].retailPrice)*parseFloat(i.productDisplayList[t].uniteQunatity*i.gui.compositeQunatity)}i.productBean.supplyPriceExclTax=e/i.gui.compositeQunatity,i.evaluateRetailPrice()},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct(),i.verifyVariantsInfoCompleted()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree);var t=function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var s=0;s<t[0].length;s++)r.push(t[0][s]+"/"+a[o]);return r}}(e);i.verifyVariantsInfoCompleted(),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=B();i.temp={},i.temp.uUid=o;var s=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=s[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0])," "!=s[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1])," "!=s[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1]+"/"+s[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={}}if(0<i.productBean.productVariantsBeans.length)for(var n=0;n<i.productBean.productVariantsBeans.length;n++)for(r=0;r<i.productVariantValuesCollection.length;r++)i.productVariantValuesCollection[r].varientName==i.productBean.productVariantsBeans[n].variantAttributeName&&i.productVariantValuesCollection.splice(r,1);i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}(t);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="-1",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(s)&&(s=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var n=(o*(s/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=n.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=y(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(n)&&(n=0),n=y(parseFloat(100*(o-s)/s),2),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=n.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax;i.updateAllProductVariantsPriceByChangeOfProductPrice1()},i.sesssionValidation=function(){r.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.fetchData())},i.fetchData=function(){if(i.data=l.loadControllerData(),"NORECORDFOUND"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",s.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.consumeCompositeQunatity&&(i.data.consumeCompositeQunatity?i.gui.isConsumeCompositeQunatity=!0:i.gui.isConsumeCompositeQunatity=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){null!=i.data.productBean.outletBeans?i.outletList=i.data.productBean.outletBeans:i.outletList=i.data.outletBeans;for(var e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0;if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans;else for(e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]);break}}if(null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap),null!=i.data.productVariantBeanList&&(i.productVariantBeanList=null,i.productVariantBeanList=i.data.productVariantBeanList),null!=i.data.productBeansList&&(i.productBeansList=null,i.productBeansList=i.data.productBeansList),null!=i.data.productBean.productList&&(i.productDisplayList=null,i.productDisplayList=angular.copy(i.data.productBean.productList),null!=i.productDisplayList&&0<i.productDisplayList.length))for(e=0;e<i.productDisplayList.length;e++){var t=parseFloat(i.productDisplayList[e].supplyPriceExclTax),r=t*(parseFloat(i.productDisplayList[e].markupPrct)/100)+t;i.productDisplayList[e].retailPrice=r.toFixed(2).toString()}if(null!=i.data.productBean){if(i.productBean={},i.tempproductBean={},i.productBean=i.data.productBean,i.tempproductBean=angular.copy(i.data.productBean),i.compositProductCollection=angular.copy(i.productBean.compositProductCollection),0<i.productBean.productVariantsBeans.length){var a=d(i.productBean.productVariantsBeans[0].variantAttributeName,"/");if(1==a){i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2;for(e=0;e<i.productBean.productVariantsBeans.length;e++){var o=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");p(i.productVariantValuesCollectionOne,o[0])||(i.tempObject={},i.tempObject.value=o[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),p(i.productVariantValuesCollectionTwo,o[1])||(i.tempObject.value=o[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={})}}else if(2==a){i.addAttributeDynamically(),i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2,i.productVariantsCollection[2].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId3;for(e=0;e<i.productBean.productVariantsBeans.length;e++){o=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");p(i.productVariantValuesCollectionOne,o[0])||(i.tempObject={},i.tempObject.value=o[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),p(i.productVariantValuesCollectionTwo,o[1])||(i.tempObject.value=o[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={}),p(i.productVariantValuesCollectionThree,o[2])||(i.tempObject.value=o[2],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),i.valueCollectionThree.push(i.tempObject.value),i.tempObject={})}}else{i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1;for(e=0;e<i.productBean.productVariantsBeans.length;e++)i.tempObject={},i.tempObject.value=i.productBean.productVariantsBeans[e].variantAttributeName,i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}}}i.productVariantValuesCollectionOldOne=angular.copy(i.productVariantValuesCollectionOne),i.productVariantValuesCollectionOldTwo=angular.copy(i.productVariantValuesCollectionTwo),i.productVariantValuesCollectionOldThree=angular.copy(i.productVariantValuesCollectionThree),"true"==i.productBean.productCanBeSold?i.gui.productCanBeSold=!0:i.gui.productCanBeSold=!1,"true"==i.productBean.trackingProduct?i.gui.trackingProduct=!0:i.gui.trackingProduct=!1,"true"==i.productBean.varientProducts?i.gui.varientProducts=!0:i.gui.varientProducts=!1,"true"==i.productBean.standardProduct?i.gui.standardProduct=!0:i.gui.standardProduct=!1,"true"==i.productBean.isComposite?i.gui.compositePrduct=!0:i.gui.compositePrduct=!1,null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productBean.productTagBeanList&&(i.tagDisplayList=i.data.productBean.productTagBeanList),i.evaluateRetailPrice(!1)}}n.manageProductLoadedFully=!1,n.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.standardProduct=!1,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="",i.selectedItem.item.productId="-1";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||(i.tagDisplayList.push(i.selectedItem.item),i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addProductTag/"+i._s_tk_com+"/"+i.productBean.productId,i.tagDisplayList).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,c(function(){i.tagSuccess=!1,c(function(){a.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy}))}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++){if(i.tagDisplayList[t].tagId==e.tagId&&"-1"==i.tagDisplayList[t].productId){i.tagDisplayList.splice(t,1);break}if(i.tagDisplayList[t].tagId==e.tagId&&"-1"!=i.tagDisplayList[t].productId){i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/deleteProductTag/"+i._s_tk_com,i.tagDisplayList[t]).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,c(function(){i.tagSuccess=!1,c(function(){a.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy});break}}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.tagError=!0,i.tagErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void c(function(){i.tagError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",c(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void c(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,o.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),c(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){o.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,s.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){o.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,s.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,o.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.productBean.productTypeId=i.tempproductBean.productTypeId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,s.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,o.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){i.loading=!1,i.productBean.supplierId=i.tempproductBean.supplierId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.supplierBean={},i.supplierList=null,i.supplierList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,c(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,s.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,o.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.productBean.brandId=i.tempproductBean.brandId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",c(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,s.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(e){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0,i.productBean.markupPrct="0");parseFloat(i.productBean.retailPriceExclTax);var a=t*(r/100)+t;if(i.productBean.retailPriceExclTax=a.toFixed(2).toString(),null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var s=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=s.toFixed(2).toString(),i.outletList[o].retailPrice=(s+a).toFixed(2).toString()}e&&i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=y(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var s=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=s.toFixed(2).toString(),i.outletList[o].retailPrice=(s+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.evaluateVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),a=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(a)&&(a=0,i.productBean.productVariantsBeans[t].markupPrct="0");var o=(r*(a/100)+r).toFixed(2);i.productBean.productVariantsBeans[t].retailPriceExclTax=o.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].retailPriceExclTax);if(!isNaN(r)){var a=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),o=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(o)&&(o=0),o=y(100*(r-a)/a,5),i.productBean.productVariantsBeans[t].markupPrct=o.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice1=function(){if(null!=i.productBean.productVariantsBeans&&0<i.productBean.productVariantsBeans.length)for(var e=0;e<i.productBean.productVariantsBeans.length;e++)i.productBean.productVariantsBeans[e].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productBean.productVariantsBeans[e].markupPrct=i.productBean.markupPrct,i.productBean.productVariantsBeans[e].retailPriceExclTax=i.productBean.retailPriceExclTax},i.deleteProductVariant=function(e){i.productVariantId=angular.copy(e.productVariantId),i.alertMessage="Are you sure,you want to delete Product Variant?",$("#alertBox1").modal("show")},i.markInActiveProductVariant=function(){o.post("manageProduct/markInActiveProductVariant/"+i._s_tk_com+"/"+i.productVariantId).success(function(e){$("#alertBox1").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1,a.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,s.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox1").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.deleteCompositeProductVariant=function(e){i.compositeProductVariantUuid=angular.copy(e.uuid),i.alertMessage="Are you sure,you want to delete Composite product Variant?",$("#alertBox2").modal("show")},i.markInActiveCompositeProductVariant=function(){o.post("manageProduct/markInActiveCompositeProductVariant/"+i._s_tk_com+"/"+i.compositeProductVariantUuid).success(function(e){$("#alertBox2").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1,a.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,s.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox2").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.updateProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(0<i.productBean.productVariantsBeans.length){i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree;for(var r=0;r<i.productBean.productVariantsBeans.length;r++)for(var a=0;a<i.productVariantValuesCollection.length;a++)i.productVariantValuesCollection[a].varientName==i.productBean.productVariantsBeans[r].variantAttributeName&&i.productVariantValuesCollection.splice(a,1);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection}else i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection;i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.isComposite=i.gui.compositePrduct,i.productBean.productList=i.productList,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.setDefaultDutyCalcuation(),i.loading=!0,o.post("manageCompositeProduct/updateCompositeProduct/"+i._s_tk_com,i.productBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,c(function(){i.productSuccess=!1,s.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,s.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.fetchAllProducts=function(){o.post("newProduct/getAllProductsForDropDown/"+i._s_tk_com).success(function(e){i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productsList=null,i.productsList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,s.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=y(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=y(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.addAverageSupplierPrice=function(){var e=y(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2);i.productBean.supplyPriceExclTax=y(parseFloat(i.productBean.supplyPriceExclTax+e)/2,2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),i.productVariantBean={},i.productVariantBean.uniteQunatity="1";var e=_.filter(i.productVariantBeanList,function(e){return e.variantAttributeName.toLowerCase().includes(t)}),r=_.filter(i.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)});return e.concat(r)},renderItem:function(e){return{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}},itemSelected:function(e){i.productVariantBean=e.item,i.productVariantBean.uniteQunatity="1"}},i.sesssionValidation()}],ManageCustomerController=["$scope","$http","$filter","$timeout","$window","$cookieStore","$rootScope","SessionService","ManageCustomerControllerPreLoad",function(t,e,r,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,t.loading=!1,t.customerBean={},t.customerBean.addressBeanList=[],t.customerBean.addressBeanList[0]={},t.customerBean.addressBeanList[1]={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=s.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){n.manageCustomerLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):null!=t.data&&(t.customerGroupList=t.data,t.customerBean=t.data.value),n.globalPageLoader=!1},t.populatePosatlAddress=function(){angular.copy(t.customerBean.addressBeanList[0],t.customerBean.addressBeanList[1])},t.updateCustomer=function(){t.manageCustomerSuccess=!1,t.manageCustomerError=!1,t.loading=!0,t.customerBean.addressBeanList[0].addressType="Physical Address",t.customerBean.addressBeanList[1].addressType="Postal Address",e.post("manageCustomer/updateCustomer/"+t._s_tk_com,t.customerBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.customerBean={},t.manageCustomerSuccess=!0,t.manageCustomerSuccessMessage=e.data,a(function(){t.manageCustomerSuccess=!1,o.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.manageCustomerError=!0,t.manageCustomerErrorMessage=e.data,o.location=e.layOutPath):(t.manageCustomerError=!0,t.manageCustomerErrorMessage=e.data)}).error(function(){t.loading=!1,t.manageCustomerError=!0,t.manageCustomerErrorMessage=t.systemBusy})},t.sessionValidation(),n.globalPageLoader=!1}],ManageOutletController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","ManageOutletControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.outletSuccess=!1,t.outletError=!1,t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.manageOutletLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(null!=t.data.timeZoneBeans&&(t.timeZonesList=t.data.timeZoneBeans),null!=t.data.countryListBeans&&(t.countryList=t.data.countryListBeans),null!=t.data.salesTaxListBeans&&(t.salesTaxList=t.data.salesTaxListBeans),null!=t.data.outletBean&&(t.outletBean=t.data.outletBean)),o.globalPageLoader=!1},t.updateOutlet=function(){t.outletSuccess=!1,t.outletError=!1,t.loading=!0,e.post("manageOutlet/updateOutlet/"+t._s_tk_com,t.outletBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.outletSuccess=!0,t.outletSuccessMessage=e.data,s(function(){t.outletSuccess=!1,r.location=e.layOutPath},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.outletError=!0,t.outletErrorMessage=e.data,r.location=e.layOutPath):(t.outletError=!0,t.outletErrorMessage=e.data)}).error(function(){t.loading=!1,t.outletError=!0,t.outletErrorMessage=t.systemBusy})},t.sessionValidation(),o.globalPageLoader=!1}],ManagePriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","$filter","$route","$timeout","$sce","SessionService","ManagePriceBookControllerPreLoad",function(n,o,s,e,t,i,r,c,a,l,u){function d(e){if(0<n.productList.length)for(var t=0;t<n.productList.length;t++)if(n.productList[t].productVariantId==e)return!0;return!1}function p(e){if(0<n.productList.length)for(var t=0;t<n.productList.length;t++)if(n.productList[t].productId==e)return!0;return!1}t.MainSideBarhideit=!1,t.MainHeaderideit=!1,n.priceBookSuccess=!1,n.priceBookError=!1,n.priceBookBean={},n.productVariantBean={},n.productList=[],n.chanageForAll={},n.gui={},n.gui.shwoProductTag=!1,n.validOn={value:"Yes"},n.name="World",n.cars=[{id:1,name:"Audi"},{id:2,name:"BMW"},{id:1,name:"Honda"}],n.selectedCar=[],n.fruits=[{id:1,name:"Apple"},{id:2,name:"Orange"},{id:3,name:"Banana"}],n.selectedFruit=null,n.sessionValidation=function(){l.validate()&&(n._s_tk_com=e.get("_s_tk_com"),n.data=u.loadControllerData(),n.fetchData())},n.fetchData=function(){"NORECORDFOUND"==n.data||"No record found !"==n.data?(n.error=!0,n.errorMessage="No record found"):"SYSTEMBUSY"==n.data||"System is busy while handling request, Please try later !"==n.data?(n.error=!0,n.errorMessage=n.data):"INVALIDSESSION"==n.data?(n.error=!0,n.errorMessage="An exception occured while validating session !",s.location="/app/#/login"):null!=n.data&&(null!=n.data.outletBeans&&(n.outletsList=n.data.outletBeans),null!=n.data.showProductTag&&("true"==n.data.showProductTag?n.gui.shwoProductTag=!0:n.gui.shwoProductTag=!1),null!=n.data.customerGroupBeansList&&(n.customerGroupList=n.data.customerGroupBeansList),null!=n.data.priceBookBean&&(n.priceBookBean=angular.copy(n.data.priceBookBean),"true"!=n.priceBookBean.isValidOnStore&&(n.validOn.value="No"),"true"==n.priceBookBean.flatSale?n.gui.flatSale=!0:n.gui.flatSale=!1,"true"==n.priceBookBean.active?n.gui.activePriceBook=!0:n.gui.activePriceBook=!1),null!=n.data.productVariantBeansList&&(n.productVariantBeansList=n.data.productVariantBeansList),null!=n.data.priceBookProductVariantBeansList&&(n.productList=n.data.priceBookProductVariantBeansList,n.setRetailPrice()),null!=n.data.productBeansList&&(n.productBeansList=n.data.productBeansList),null!=n.data.productTagBeanList&&(n.productTagBeanList=n.data.productTagBeanList),null!=n.data.tagBeanList&&(n.tagBeanList=n.data.tagBeanList)),t.globalPageLoader=!1},n.toggle=function(){if(i("date")(new Date,"yyyy-MM-dd")>i("date")(n.data.priceBookBean.validFrom,"yyyy-MM-dd"))return n.alertMessage="You can not update Flat sale info as Valid From Date is before today Date.",$("#alertBox").modal("show"),void("true"==n.data.priceBookBean.flatSale?n.gui.flatSale=!0:n.gui.flatSale=!1)},$("#startDate").on("change",function(e){var t=document.getElementById("startDate1").value;n.priceBookBean.validFrom=t,n.$apply()}),$("#endDate").on("change",function(e){var t=document.getElementById("endDate1").value;n.priceBookBean.validTo=t,n.$apply()}),n.updatePriceBook=function(){if(n.priceBookSuccess=!1,n.priceBookError=!1,i("date")(new Date,"yyyy-MM-dd")>i("date")(n.data.priceBookBean.validFrom,"yyyy-MM-dd")&&i("date")(n.data.priceBookBean.validFrom,"yyyy-MM-dd")!=i("date")(n.priceBookBean.validFrom,"yyyy-MM-dd")){n.alertMessage="You can not update Valid From date as its before today date.",$("#alertBox").modal("show");var e=n.data.priceBookBean.validFrom;n.priceBookBean.validFrom=e}else if(i("date")(n.priceBookBean.validFrom,"yyyy-MM-dd")>i("date")(n.priceBookBean.validTo,"yyyy-MM-dd")){n.alertMessage="From Date should be before Valid To Date.",$("#alertBox").modal("show");var t=n.data.priceBookBean.validTo;n.priceBookBean.validTo=t;e=n.data.priceBookBean.validFrom;n.priceBookBean.validFrom=e}else if(i("date")(n.priceBookBean.validTo,"yyyy-MM-dd")<i("date")(new Date,"yyyy-MM-dd")){n.alertMessage="Valid To Date should be today or future Date.",$("#alertBox").modal("show");t=n.data.priceBookBean.validTo;n.priceBookBean.validTo=t}else if(i("date")(new Date,"yyyy-MM-dd")>i("date")(n.data.priceBookBean.validFrom,"yyyy-MM-dd")&&n.priceBookBean.outletId!=n.data.priceBookBean.outletId){n.alertMessage="You can not update outlet as Valid From Date is before today Date.",$("#alertBox").modal("show");var r=n.data.priceBookBean.outletId;n.priceBookBean.outletId=r}else{if("Yes"==n.validOn.value?(n.priceBookBean.isValidOnStore="true",n.priceBookBean.isValidOnEcom="false"):(n.priceBookBean.isValidOnStore="false",n.priceBookBean.isValidOnEcom="true"),n.gui.flatSale?n.priceBookBean.flatSale="true":n.priceBookBean.flatSale="false",n.gui.activePriceBook){if(n.priceBookBean.active="true",n.gui.flatSale){var a=parseFloat(n.priceBookBean.flatDiscount);if(isNaN(a))return n.alertMessage="Discount not in valid format. Valid formats e.g (1.00,1)",void $("#alertBox").modal("show")}}else n.priceBookBean.active="false";n.loading=!0,o.post("managePriceBook/updatePriceBook/"+n._s_tk_com,n.priceBookBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.loading=!0,n.priceBookSuccess=!0,n.priceBookSuccessMessage=e.data,c(function(){n.priceBookSuccess=!1,n.loading=!1,n.priceBookBean={},s.location=e.layOutPath},1e3)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus||"ADDRESTRICATION"==n.responseStatus?(n.priceBookError=!0,n.priceBookErrorMessage=e.data,"INVALIDSESSION"==n.responseStatus&&(s.location=e.layOutPath)):(n.priceBookError=!0,n.priceBookErrorMessage=e.data)}).error(function(){n.loading=!1,n.priceBookError=!0,n.priceBookErrorMessage=n.systemBusy})}},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),n.productVariantsBeans=[],_.filter(n.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.variantAttributeName,label:a.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}},itemSelected:function(e){n.productVariantBean=e.item}},n.autoCompleteTagOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(n.tagBeanList,function(e){return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:a.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td></tr></tbody></table>")}},itemSelected:function(e){n.productTagBean=e.item,n.isTagSelected=!0}},n.addProductByTag=function(){if(n.isTagSelected)for(var e=0;e<n.productTagBeanList.length;e++)if(n.productTagBeanList[e].tagId==n.productTagBean.tagId)for(var t=0;t<n.productBeansList.length;t++)n.productVariantBean={},n.productBeansList[t].productUuid==n.productTagBeanList[e].productUuid&&(n.productVariantBean=n.productBeansList[t],n.addProductByDiscount());n.productTagBean=[],n.airportName1=[]},n.addProduct=function(){if("true"==n.productVariantBean.isProduct.toString()){if(n.temp={},!p(n.productVariantBean.productId)){n.temp=angular.copy(n.productVariantBean);var e=(r=parseFloat(n.temp.supplyPriceExclTax))*(parseFloat(n.temp.markupPrct)/100)+r;n.temp.retailPrice=e.toFixed(2).toString(),n.temp.discount="0.00",n.productList.push(n.temp),n.temp={}}}else for(var t=0;t<n.productVariantBeansList.length;t++)if(n.productVariantBean.productVariantId==n.productVariantBeansList[t].productId&&(n.temp={},!d(n.productVariantBeansList[t].productVariantId))){n.temp=angular.copy(n.productVariantBeansList[t]);var r;e=(r=parseFloat(n.temp.supplyPriceExclTax))*(parseFloat(n.temp.markupPrct)/100)+r;n.temp.retailPrice=e.toFixed(2).toString(),n.temp.discount="0.00",n.productList.push(n.temp),n.temp={}}n.airportName=[],n.productVariantBean={}},n.addProductByDiscount=function(){if("true"==n.productVariantBean.isProduct.toString()){if(n.temp={},!p(n.productVariantBean.productId)){n.temp=angular.copy(n.productVariantBean);var e=parseFloat(n.temp.supplyPriceExclTax),t=parseFloat(n.temp.markupPrct),r=parseFloat(n.productTagBean.discount);if(isNaN(r)){a=e*(t/100)+e;n.temp.retailPrice=a.toFixed(2).toString(),n.temp.discount="0.00"}else{n.temp.discount=r.toString();var a=e*(t/100)+e;a-=a*(r/100),n.temp.retailPrice=a.toFixed(2).toString()}n.productList.push(n.temp),n.temp={}}}else for(var o=0;o<n.productVariantBeansList.length;o++)if(n.productVariantBean.productVariantId==n.productVariantBeansList[o].productId&&(n.temp={},!d(n.productVariantBeansList[o].productVariantId))){n.temp=angular.copy(n.productVariantBeansList[o]);e=parseFloat(n.temp.supplyPriceExclTax),t=parseFloat(n.temp.markupPrct),r=parseFloat(n.productTagBean.discount);if(isNaN(r)){a=e*(t/100)+e;n.temp.retailPrice=a.toFixed(2).toString(),n.temp.discount="0.00"}else{n.temp.discount=r.toString();var a=e*(t/100)+e;a-=a*(r/100),n.temp.retailPrice=a.toFixed(2).toString()}n.productList.push(n.temp),n.temp={}}n.airportName=[],n.productVariantBean={}},n.deleteProdcutFromList=function(e){n.deleteProdcut=e,n.alertMessage="Are you sure, you want to delete selective product/variant?",$("#alertBox1").modal("show")},n.markInactiveSelectiveProduct=function(){if(n.priceBookSuccess=!1,n.priceBookError=!1,null==n.deleteProdcut.priceBookId||null==n.deleteProdcut.priceBookDetailId){if("true"==n.deleteProdcut.isProduct.toString()){for(var e=0;e<n.productList.length;e++)if(n.productList[e].productId==n.deleteProdcut.productId)return n.productList.splice(e,1),void $("#alertBox1").modal("hide")}else for(e=0;e<n.productList.length;e++)if(n.productList[e].productVariantId==n.deleteProdcut.productVariantId)return n.productList.splice(e,1),void $("#alertBox1").modal("hide")}else n.loading=!0,o.post("managePriceBook/deleteProductOrVariantInPriceBookDetail/"+n._s_tk_com,n.deleteProdcut).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.loading=!0,$("#alertBox1").modal("hide"),n.priceBookSuccess=!0,n.priceBookSuccessMessage=e.data,c(function(){n.priceBookSuccess=!1,n.loading=!1,n.deleteProdcut={},r.reload()},1e3)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?(n.priceBookError=!0,n.priceBookErrorMessage=e.data,s.location=e.layOutPath):(n.priceBookError=!0,n.priceBookErrorMessage=e.data)}).error(function(){n.loading=!1,n.priceBookError=!0,n.priceBookErrorMessage=n.systemBusy})},n.changeMarkUpForAll=function(){var e=parseFloat(n.chanageForAll.markupPrct);if(!isNaN(e))for(var t=0;t<n.productList.length;t++){var r=parseFloat(n.productList[t].supplyPriceExclTax);n.productList[t].markupPrct=e.toString();var a=r*(e/100)+r,o=n.productList[t].discount;isNaN(o)||(a-=a*(o/100)),n.productList[t].retailPrice=a.toFixed(2).toString(),n.productList[t].indivisualUpdate=!0}},n.changeDiscountForAll=function(){var e=parseFloat(n.chanageForAll.discount);if(!isNaN(e))for(var t=0;t<n.productList.length;t++){var r=parseFloat(n.productList[t].supplyPriceExclTax),a=parseFloat(n.productList[t].markupPrct);if(!isNaN(a)){n.productList[t].discount=e.toString();var o=r*(a/100)+r;o-=o*(e/100),n.productList[t].retailPrice=o.toFixed(2).toString(),n.productList[t].indivisualUpdate=!0}}},n.changeMarkUpAndDiscount=function(e){for(var t=0;t<n.productList.length;t++)if(e.variantAttributeName==n.productList[t].variantAttributeName||e.productId==n.productList[t].productId){var r=parseFloat(e.markupPrct);if(!isNaN(r)){var a=parseFloat(n.productList[t].supplyPriceExclTax);n.productList[t].markupPrct=r.toString();var o=a*(r/100)+a,s=e.discount;isNaN(s)||(o-=o*(s/100),n.productList[t].discount=s),n.productList[t].retailPrice=o.toFixed(2).toString(),n.productList[t].indivisualUpdate=!0}}},n.setRetailPrice=function(){for(var e=0;e<n.productList.length;e++){var t=parseFloat(n.productList[e].markupPrct);if(!isNaN(t)){var r=parseFloat(n.productList[e].supplyPriceExclTax);n.productList[e].markupPrct=t.toString();var a=r*(t/100)+r,o=n.productList[e].discount;isNaN(o)||(a-=a*(o/100)),n.productList[e].retailPrice=a.toFixed(2).toString()}}},n.manageProductsInPriceBook=function(){n.priceBookSuccess=!1,n.priceBookError=!1,n.loading=!0,o.post("managePriceBook/manageProductsInPriceBook/"+n._s_tk_com+"/"+n.priceBookBean.priceBookId,n.productList).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.loading=!0,n.priceBookSuccess=!0,n.priceBookSuccessMessage=e.data,c(function(){n.priceBookSuccess=!1,n.loading=!1,n.priceBookBean={},s.location=e.layOutPath},1e3)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus?(n.priceBookError=!0,n.priceBookErrorMessage=e.data,s.location=e.layOutPath):(n.priceBookError=!0,n.priceBookErrorMessage=e.data)}).error(function(){n.loading=!1,n.priceBookError=!0,n.priceBookErrorMessage=n.systemBusy})},n.sessionValidation()}],ManageProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","ManageProductControllerPreLoad",function(i,o,s,e,a,n,c,t,r,l){function u(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function d(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",n(function(){i.variantError=!1},1e3),!0;return!1}function p(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function B(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.tempproductBean={},i.productPriceHistoryBean={},i.compositProduct.compositQunatity="1",i.tagList=[],i.tagDisplayList=[],a.MainSideBarhideit=!1,a.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.hideAddVariantAttributesPanel=!1,i.gui.shwoProductTag=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productVariantValuesCollectionOldOne=[],i.productVariantValuesCollectionOldTwo=[],i.productVariantValuesCollectionOldThree=[],i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="-1",i.productVariantsCollection.push(i.myObj),i.addCompositProductDynamically=function(){i.compositProductTemp={};for(var e=i.compositProduct.productId.split(":"),t=!1,r=0;r<i.compositProductCollection.length;r++)e[2]==i.compositProductCollection[r].productVariantName&&(t=!0);t?alert("Product already added."):(i.compositProductTemp.id=(i.compositProductCollection.length+1).toString(),i.compositProductTemp.productId=e[0],i.compositProductTemp.productName=e[1],i.compositProductTemp.productVariantName=e[2],i.compositProductTemp.productVariantId=e[3],i.compositProductTemp.uuid=p(),i.compositProductTemp.compositQunatity=i.compositProduct.compositQunatity,i.compositProductCollection.push(i.compositProductTemp),i.compositProductTemp={},i.compositProduct={},i.compositProduct.compositQunatity="1",i.compositProduct.productId="0")},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct(),i.verifyVariantsInfoCompleted()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree);var t=function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var s=0;s<t[0].length;s++)r.push(t[0][s]+"/"+a[o]);return r}}(e);i.verifyVariantsInfoCompleted(),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=p();i.temp={},i.temp.uUid=o;var s=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=s[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0])," "!=s[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1])," "!=s[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1]+"/"+s[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={}}if(0<i.productBean.productVariantsBeans.length)for(var n=0;n<i.productBean.productVariantsBeans.length;n++)for(r=0;r<i.productVariantValuesCollection.length;r++)i.productVariantValuesCollection[r].varientName==i.productBean.productVariantsBeans[n].variantAttributeName&&i.productVariantValuesCollection.splice(r,1);i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}(t);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="-1",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(s)&&(s=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var n=(o*(s/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=n.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=B(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(n)&&(n=0),n=B(parseFloat(100*(o-s)/s),2),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=n.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax;i.updateAllProductVariantsPriceByChangeOfProductPrice1()},i.sesssionValidation=function(){r.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.fetchData())},i.fetchData=function(){if(i.data=l.loadControllerData(),"NORECORDFOUND"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",s.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){null!=i.data.productBean.outletBeans?i.outletList=i.data.productBean.outletBeans:i.outletList=i.data.outletBeans;for(var e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0;if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans;else for(e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]);break}}if(null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap),null!=i.data.productBean){if(i.productBean={},i.tempproductBean={},i.productBean=i.data.productBean,i.tempproductBean=angular.copy(i.data.productBean),i.compositProductCollection=angular.copy(i.productBean.compositProductCollection),0<i.productBean.productVariantsBeans.length){var t=u(i.productBean.productVariantsBeans[0].variantAttributeName,"/");if(1==t){i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2;for(e=0;e<i.productBean.productVariantsBeans.length;e++){var r=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,r[0])||(i.tempObject={},i.tempObject.value=r[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,r[1])||(i.tempObject.value=r[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={})}}else if(2==t){i.addAttributeDynamically(),i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2,i.productVariantsCollection[2].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId3;for(e=0;e<i.productBean.productVariantsBeans.length;e++){r=i.productBean.productVariantsBeans[e].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,r[0])||(i.tempObject={},i.tempObject.value=r[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,r[1])||(i.tempObject.value=r[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionThree,r[2])||(i.tempObject.value=r[2],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),i.valueCollectionThree.push(i.tempObject.value),i.tempObject={})}}else{i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1;for(e=0;e<i.productBean.productVariantsBeans.length;e++)i.tempObject={},i.tempObject.value=i.productBean.productVariantsBeans[e].variantAttributeName,i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}}}i.productVariantValuesCollectionOldOne=angular.copy(i.productVariantValuesCollectionOne),i.productVariantValuesCollectionOldTwo=angular.copy(i.productVariantValuesCollectionTwo),i.productVariantValuesCollectionOldThree=angular.copy(i.productVariantValuesCollectionThree),"true"==i.productBean.productCanBeSold?i.gui.productCanBeSold=!0:i.gui.productCanBeSold=!1,"true"==i.productBean.trackingProduct?i.gui.trackingProduct=!0:i.gui.trackingProduct=!1,"true"==i.productBean.varientProducts?i.gui.varientProducts=!0:i.gui.varientProducts=!1,"true"==i.productBean.standardProduct?i.gui.standardProduct=!0:i.gui.standardProduct=!1,null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productBean.productTagBeanList&&(i.tagDisplayList=i.data.productBean.productTagBeanList),i.evaluateRetailPrice(!1)}}a.manageProductLoadedFully=!1,a.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.standardProduct=!1,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="",i.selectedItem.item.productId="-1";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||(i.tagDisplayList.push(i.selectedItem.item),i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addProductTag/"+i._s_tk_com+"/"+i.productBean.productId,i.tagDisplayList).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,n(function(){i.tagSuccess=!1,n(function(){c.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy}))}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++){if(i.tagDisplayList[t].tagId==e.tagId&&"-1"==i.tagDisplayList[t].productId){i.tagDisplayList.splice(t,1);break}if(i.tagDisplayList[t].tagId==e.tagId&&"-1"!=i.tagDisplayList[t].productId){i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/deleteProductTag/"+i._s_tk_com,i.tagDisplayList[t]).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,n(function(){i.tagSuccess=!1,n(function(){c.reload()},500)},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy});break}}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.tagError=!0,i.tagErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void n(function(){i.tagError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,o.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",n(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void n(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,o.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),n(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){o.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,s.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){a.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){o.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,s.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,o.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.productBean.productTypeId=i.tempproductBean.productTypeId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,s.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,o.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){i.loading=!1,i.productBean.supplierId=i.tempproductBean.supplierId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.supplierBean={},i.supplierList=null,i.supplierList=e.data,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,n(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,s.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,o.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.productBean.brandId=i.tempproductBean.brandId,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",n(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,s.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(e){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0,i.productBean.markupPrct="0");parseFloat(i.productBean.retailPriceExclTax);var a=t*(r/100)+t;if(i.productBean.retailPriceExclTax=a.toFixed(2).toString(),null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var s=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=s.toFixed(2).toString(),i.outletList[o].retailPrice=(s+a).toFixed(2).toString()}e&&i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=B(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var s=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=s.toFixed(2).toString(),i.outletList[o].retailPrice=(s+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.evaluateVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),a=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(a)&&(a=0,i.productBean.productVariantsBeans[t].markupPrct="0");var o=(r*(a/100)+r).toFixed(2);i.productBean.productVariantsBeans[t].retailPriceExclTax=o.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice1=function(e){for(var t=0;t<i.productBean.productVariantsBeans.length;t++)if(i.productBean.productVariantsBeans[t].productVariantId==e.productVariantId){var r=parseFloat(i.productBean.productVariantsBeans[t].retailPriceExclTax);if(!isNaN(r)){var a=parseFloat(i.productBean.productVariantsBeans[t].supplyPriceExclTax),o=parseFloat(i.productBean.productVariantsBeans[t].markupPrct);isNaN(o)&&(o=0),o=B(100*(r-a)/a,5),i.productBean.productVariantsBeans[t].markupPrct=o.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice1=function(){if(null!=i.productBean.productVariantsBeans&&0<i.productBean.productVariantsBeans.length)for(var e=0;e<i.productBean.productVariantsBeans.length;e++)i.productBean.productVariantsBeans[e].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productBean.productVariantsBeans[e].markupPrct=i.productBean.markupPrct,i.productBean.productVariantsBeans[e].retailPriceExclTax=i.productBean.retailPriceExclTax},i.deleteProductVariant=function(e){i.productVariantId=angular.copy(e.productVariantId),i.alertMessage="Are you sure,you want to delete Product Variant?",$("#alertBox1").modal("show")},i.markInActiveProductVariant=function(){o.post("manageProduct/markInActiveProductVariant/"+i._s_tk_com+"/"+i.productVariantId).success(function(e){$("#alertBox1").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1,c.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,s.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox1").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.deleteCompositeProductVariant=function(e){i.compositeProductVariantUuid=angular.copy(e.uuid),i.alertMessage="Are you sure,you want to delete Composite product Variant?",$("#alertBox2").modal("show")},i.markInActiveCompositeProductVariant=function(){o.post("manageProduct/markInActiveCompositeProductVariant/"+i._s_tk_com+"/"+i.compositeProductVariantUuid).success(function(e){$("#alertBox2").modal("hide"),i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1,c.reload()},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,s.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){$("#alertBox2").modal("hide"),i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.updateProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(0<i.productBean.productVariantsBeans.length){i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree;for(var r=0;r<i.productBean.productVariantsBeans.length;r++)for(var a=0;a<i.productVariantValuesCollection.length;a++)i.productVariantValuesCollection[a].varientName==i.productBean.productVariantsBeans[r].variantAttributeName&&i.productVariantValuesCollection.splice(a,1);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection}else i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection;i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.setDefaultDutyCalcuation(),i.loading=!0,o.post("manageProduct/updateProduct/"+i._s_tk_com,i.productBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,n(function(){i.productSuccess=!1,s.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,s.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.fetchAllProducts=function(){o.post("newProduct/getAllProductsForDropDown/"+i._s_tk_com).success(function(e){i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productsList=null,i.productsList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,s.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=B(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=B(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.addAverageSupplierPrice=function(){var e=B(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2);i.productBean.supplyPriceExclTax=B(parseFloat(i.productBean.supplyPriceExclTax+e)/2,2),i.evaluateRetailPrice(!1),i.showDutyCalculationModal=!1},i.sesssionValidation()}],ManageRegisterController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","ManageRegisterControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.registerSuccess=!1,t.registerError=!1,t.registerBean={},t.systemBusy="System is Busy Please try again",t.cashManagement={value:"No"},t.userNextSale={value:"No"},t.receiptEmail={value:"No"},t.receiptPrint={value:"Yes"},t.receiptPrintNotes={value:"No"},t.discountsOnReceipt={value:"Yes"},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.manageRegisterLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.registerBean=t.data,t.cashManagement.value=t.registerBean.cacheManagementEnable,t.userNextSale.value=t.registerBean.selectNextUserForSale,t.receiptEmail.value=t.registerBean.emailReceipt,t.receiptPrint.value=t.registerBean.printReceipt,t.receiptPrintNotes.value=t.registerBean.printNotesOnReceipt,t.discountsOnReceipt.value=t.registerBean.showDiscountOnReceipt),o.globalPageLoader=!1},t.sesstionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.registerBean=a.get("_e_cOr_gra"),t.cashManagement.value=t.registerBean.cacheManagementEnable,t.userNextSale.value=t.registerBean.selectNextUserForSale,t.receiptEmail.value=t.registerBean.emailReceipt,t.receiptPrint.value=t.registerBean.printReceipt,t.receiptPrintNotes.value=t.registerBean.printNotesOnReceipt,t.discountsOnReceipt.value=t.registerBean.showDiscountOnReceipt)},t.updateRegister=function(){t.registerSuccess=!1,t.registerError=!1,t.loading=!0,t.registerBean.cacheManagementEnable=t.cashManagement.value,t.registerBean.selectNextUserForSale=t.userNextSale.value,t.registerBean.emailReceipt=t.receiptEmail.value,t.registerBean.printReceipt=t.receiptPrint.value,t.registerBean.printNotesOnReceipt=t.receiptPrintNotes.value,t.registerBean.showDiscountOnReceipt=t.discountsOnReceipt.value,e.post("manageRegister/updateRegister/"+t._s_tk_com,t.registerBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.registerSuccess=!0,t.registerSuccessMessage=e.data,s(function(){t.registerSuccess=!1,r.location=e.layOutPath},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.registerError=!0,t.registerErrorMessage=e.data,r.location=e.layOutPath):(t.registerError=!0,t.registerErrorMessage=e.data)}).error(function(){t.loading=!1,t.registerError=!0,t.registerErrorMessage=t.systemBusy})},t.sessionValidation()}],ManageRoleController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","ManageRoleControllerPreLoad",function(r,e,t,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.showAddSalesTaxModal=!1,r.manageRoleSuccess=!1,r.manageRoleError=!1,r.isCashAdded=!1,r.isCreditCardAdded=!1,r.manageRoleAddError=!1,r.loadingUpdate=!1,r.loading=!1,r.manageRoleBean={},r.systemBusy="System is Busy Please try again",r.sessionValidation=function(){if(i.validate()){r._s_tk_com=a.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData();var e=a.get("_m_rd_gra");"1"==e&&(r.roleName="Administrator"),"2"==e&&(r.roleName="Manager"),"3"==e&&(r.roleName="Cashier")}},r.fetchData=function(){o.manageRoleLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(r.menuBeanList=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},r.selectUnselectAll=function(e){if(null!=r.menuBeanList&&0<r.menuBeanList.length)for(var t=0;t<r.menuBeanList.length;t++)r.menuBeanList[t].activeIndicatior=e},r.updatePageRights=function(){r.manageRoleSuccess=!1,r.manageRoleError=!1,r.loadingUpdate=!0,e.post("manageRole/updatePageRightsByRoleId/"+r._s_tk_com,r.menuBeanList).success(function(e){r.loadingUpdate=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.companyBean={},r.manageRoleSuccess=!0,r.manageRoleSuccessMessage=e.data,r.showUpdatemanageRoleModal=!1,s(function(){r.manageRoleSuccess=!1,s(function(){n.reload()},500)},2e3)):"INVALIDSESSION"==r.responseStatus||"SYSTEMBUSY"==r.responseStatus?(r.manageRoleError=!0,r.manageRoleErrorMessage=e.data,t.location=e.layOutPath):(r.manageRoleError=!0,r.manageRoleErrorMessage=e.data)}).error(function(){r.loadingUpdate=!1,r.manageRoleError=!0,r.manageRoleErrorMessage=r.systemBusy})},r.sessionValidation()}],ManageUserController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","ManageUserControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.userSuccess=!1,t.userError=!1,t.userBean={},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.outletBeans&&(t.outletsList=t.data.outletBeans),null!=t.data.rolesBeanList&&(t.rolesList=t.data.rolesBeanList),null!=t.data.userBean&&(t.userBean=t.data.userBean)),o.globalPageLoader=!1},t.updateUser=function(){t.userSuccess=!1,t.userError=!1,t.loading=!0,e.post("manageUser/updateUser/"+t._s_tk_com,t.userBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.userBean={},t.userSuccess=!0,t.userSuccessMessage=e.data,s(function(){t.userSuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.userError=!0,t.userErrorMessage=e.data,r.location=e.layOutPath):(t.userError=!0,t.userErrorMessage=e.data)}).error(function(){t.loading=!1,t.userError=!0,t.userErrorMessage=t.systemBusy})},t.sessionValidation()}],NewCompositeProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","NewCompositeProductControllerPreLoad",function(i,r,a,e,o,s,t,n,c,l){function u(e,t){if(0<i.productList.length)for(var r=0;r<i.productList.length;r++)if(e){if(i.productList[r].productId==t)return!0}else if(i.productList[r].productVariantId==t)return!0;return!1}function d(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function p(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",s(function(){i.variantError=!1},1e3),!0;return!1}function B(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function y(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.productBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.productPriceHistoryBean={},i.compositProduct.compositeQunatity="1",i.tagList=[],i.tagDisplayList=[],o.MainSideBarhideit=!1,o.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.gui.shwoProductTag=!1,i.gui.compositeQunatity=0,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.gui.isConsumeCompositeQunatity=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.outletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productList=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="",i.productVariantsCollection.push(i.myObj),i.dynamicError=!1,i.calculateCompositeProductQuantity=function(){i.gui.compositePrduct&&0<i.productList.length&&i.calculateProductSupplierPrice()},i.addCompositeProductDynamically=function(){if(i.dynamicError=!1,i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)isNaN(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory)||null==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||"null"==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||""==i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[e].varientsOutletList[t].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if("true"==i.productVariantBean.isProduct.toString())if(i.temp={},u(!0,i.productVariantBean.productId))i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" already added.",s(function(){i.dynamicError=!1},2e3);else{if(i.temp=angular.copy(i.productVariantBean),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void s(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){var r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product "+i.productVariantBean.variantAttributeName+" cousume quantity can not be greater than available quantity."+i.productVariantBean.currentInventory,s(function(){i.dynamicError=!1},2e3);else{r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}else for(e=0;e<i.productVariantBeanList.length;e++)if(i.productVariantBean.productVariantId==i.productVariantBeanList[e].productVariantId)if(u(!(i.temp={}),i.productVariantBeanList[e].productVariantId))i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" already added.",s(function(){i.dynamicError=!1},2e3);else{if(i.temp=angular.copy(i.productVariantBeanList[e]),0==parseInt(i.temp.currentInventory)&&i.gui.isConsumeCompositeQunatity)return i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" current inventory is 0.You can not add it.",void s(function(){i.dynamicError=!1},2e3);if(i.gui.isConsumeCompositeQunatity&&parseInt(i.temp.uniteQunatity)<=parseInt(i.temp.currentInventory)&&parseInt(i.temp.uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.temp.currentInventory)){r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}else if(i.gui.isConsumeCompositeQunatity)i.dynamicError=!0,i.dynamicErrorMessage="Product Variant "+i.productVariantBean.variantAttributeName+" cousume quantity can not be great than available quantity."+i.productVariantBean.currentInventory,s(function(){i.dynamicError=!1},2e3);else{var a;r=(a=parseFloat(i.temp.supplyPriceExclTax))*(parseFloat(i.temp.markupPrct)/100)+a;i.temp.retailPrice=r.toFixed(2).toString(),i.temp.discount="0.00",i.temp.compositeQunatityConsumed=i.temp.uniteQunatity*i.gui.compositeQunatity,i.productList.push(i.temp)}i.temp={}}i.airportName=[],i.productVariantBean={},i.productVariantBean.uniteQunatity="1",i.calculateProductSupplierPrice()},i.removeProduct=function(e){if(0<i.productList.length)for(var t=0;t<i.productList.length;t++)i.productList[t].productVariantId==e.productVariantId&&i.productList.splice(t,1)},i.calculateProductSupplierPrice=function(){var e=0;if(i.gui.compositeQunatity=0,i.gui.varientProducts){if(i.gui.varientProducts&&i.gui.trackingProduct&&0<i.productVariantValuesCollection.length)for(var t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)isNaN(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory)||null==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||"null"==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||""==i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory||(i.gui.compositeQunatity=i.gui.compositeQunatity+parseInt(i.productVariantValuesCollection[t].varientsOutletList[r].currentInventory))}else isNaN(i.outletList[0].currentInventory)||null==i.outletList[0].currentInventory||"null"==i.outletList[0].currentInventory||""==i.outletList[0].currentInventory||(i.gui.compositeQunatity=parseInt(i.outletList[0].currentInventory));if(0<i.productList.length)for(t=0;t<i.productList.length;t++){if(!isNaN(i.productList[t].uniteQunatity))if(i.gui.isConsumeCompositeQunatity&&parseInt(i.productList[t].uniteQunatity)<=parseInt(i.productList[t].currentInventory)&&parseInt(i.productList[t].uniteQunatity*i.gui.compositeQunatity)<=parseInt(i.productList[t].currentInventory))i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity);else if(i.gui.isConsumeCompositeQunatity){i.dynamicError=!0,i.dynamicErrorMessage="Product/Variant "+i.productList[t].variantAttributeName+" cousume quantity can not be great than available quantity..",s(function(){i.dynamicError=!1},2e3),i.productList[t].compositeQunatityConsumed="0",e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].compositeQunatityConsumed)}else{i.productList[t].compositeQunatityConsumed=i.productList[t].uniteQunatity*i.gui.compositeQunatity,e+=parseFloat(i.productList[t].retailPrice)*parseFloat(i.productList[t].uniteQunatity*i.gui.compositeQunatity)}}i.productBean.supplyPriceExclTax=e/i.gui.compositeQunatity,i.evaluateRetailPrice()},i.addCompositProductDynamically_old=function(){i.compositProductTemp={};for(var e=i.compositProduct.productId.split(":"),t=!1,r=0;r<i.compositProductCollection.length;r++)e[2]==i.compositProductCollection[r].productVariantName&&(t=!0);t?alert("Product already added."):(i.compositProductTemp.id=(i.compositProductCollection.length+1).toString(),i.compositProductTemp.productId=e[0],i.compositProductTemp.productName=e[1],i.compositProductTemp.productVariantName=e[2],i.compositProductTemp.productVariantId=e[3],i.compositProductTemp.uuid=B(),i.compositProductTemp.compositeQunatity=i.compositProduct.compositeQunatity,i.compositProductCollection.push(i.compositProductTemp),i.compositProductTemp={},i.compositProduct={},i.compositProduct.compositeQunatity="1",i.compositProduct.productId="0")},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.sku=e.productName,i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<d(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=d(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){p(i.tagList,e)||(i.tempTag={},i.tempTag.value=e,i.tempTag.tagId=(i.tagList.length+1).toString(),i.tagList.push(i.tempTag),i.tempTag={},i.tagBean={})},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=B();i.temp={},i.temp.uUid=o;var s=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=s[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0])," "!=s[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1])," "!=s[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1]+"/"+s[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={},i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}}(function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var s=0;s<t[0].length;s++)r.push(t[0][s]+"/"+a[o]);return r}}(e)),i.verifyVariantsInfoCompleted();for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(i.variantError=!1,t.includes("/")||1<e.value.split("/").length)return i.variantError=!0,i.variantErrorMessage="Value never contains '/'",void s(function(){i.variantError=!1},1e3);if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(p(i.productVariantValuesCollectionOne,t[a])||p(i.productVariantValuesCollectionTwo,t[a])||p(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.manageVariantsBarCodePrefix=function(){for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++){var r=i.productVariantValuesCollection[e].varientName.split("/");if(" "!=r[0])if(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",(i.gui.sku+"-"+r[0]).length<=15)i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0];else{var a=i.gui.sku+"-"+r[0];i.productVariantValuesCollection[e].varientsOutletList[t].sku=a.substr(0,14)}" "!=r[1]&&1<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1])," "!=r[2]&&2<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1]+"-"+r[2]),i.checkProductVariantSkuExist(i.productVariantValuesCollection[e].varientsOutletList[t].sku)&&(i.productVariantValuesCollection[e].varientsOutletList[t].isDuplicateBarCode="true")}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(s)&&(s=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var n=(o*(s/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=n.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=y(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(n)&&(n=0),n=y(parseFloat(100*(o-s)/s),5),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=n.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax},i.sesssionValidation=function(){c.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.data=l.loadControllerData(),i.fetchData())},i.fetchData=function(){if("NORECORDFOUND"==i.data||"No record found !"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.consumeCompositeQunatity&&(i.data.consumeCompositeQunatity?i.gui.isConsumeCompositeQunatity=!0:i.gui.isConsumeCompositeQunatity=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans,i.outletList=i.data.outletBeans;else for(var e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]),i.outletList.push(i.data.outletBeans[e]);break}for(e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0}null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantBeanList&&(i.productVariantBeanList=null,i.productVariantBeanList=i.data.productVariantBeanList),null!=i.data.productBeansList&&(i.productBeansList=null,i.productBeansList=i.data.productBeansList),null!=i.data.sku&&(i.sku=1e3,i.sku=i.data.sku,i.productBean.sku=i.sku),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap)}o.newProductLoadedFully=!1,o.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.gui.compositePrduct=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.compositePrduct?i.gui.compositePrduct=!1:i.gui.compositePrduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1,i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:n.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||i.tagDisplayList.push(i.selectedItem.item)}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++)if(i.tagDisplayList[t].tagId==e.tagId){i.tagDisplayList.splice(t,1);break}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.variantError=!0,i.variantErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void s(function(){i.variantError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,r.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",s(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void s(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,r.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),s(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){r.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.getAllSuppliers=function(){r.post("suppliers/getAllSuppliers/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.supplierList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllProductTypes=function(){r.post("productType/getAllProductTypes/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.productTypeList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllBrands=function(){r.post("brands/getAllBrands/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.brandList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchOutlets=function(){r.post("outlets/getOutlets/"+i._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.outletList=e.data,i.verientsOutletList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){r.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,r.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productBean.productTypeId=i.productTypeList[i.productTypeList.length-1].productTypeId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,a.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,r.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.supplierBean={},i.supplierList=null,i.supplierList=e.data;var t=i.supplierList.length;i.productBean.supplierId=i.supplierList[t-1].supplierId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,s(function(){i.productSuccess=!1},1e3)}else"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,a.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,r.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.productBean.brandId=i.brandList[i.brandList.length-1].brandId,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",s(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,a.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(){var e=parseFloat(i.productBean.supplyPriceExclTax),t=parseFloat(i.productBean.markupPrct);isNaN(t)&&(t=0,i.productBean.markupPrct="0");var r=e*(t/100)+e;if(i.productBean.retailPriceExclTax=r.toFixed(2).toString(),null!=i.outletList&&0<r)for(var a=0;a<i.outletList.length;a++){var o=r*(parseFloat(i.outletList[a].defaultTax)/100);i.outletList[a].taxAmount=o.toFixed(2).toString(),i.outletList[a].retailPrice=(o+r).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=y(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var s=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=s.toFixed(2).toString(),i.outletList[o].retailPrice=(s+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.addProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(i.gui.trackingProduct&&("-1"==i.varientAttributeBean.varientAttributeId||"0"==i.varientAttributeBean.varientAttributeId||""==i.varientAttributeBean.varientAttributeId))return i.productAddError=!0,i.productAddErrorMessage="Please chose variant.",void s(function(){i.productAddError=!1},1e3);if(i.gui.compositePrduct&&0==i.productList.length)return i.productAddError=!0,i.productAddErrorMessage="Please add atleast one product to create composite product.",void s(function(){i.productAddError=!1},1e3);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.tagList=i.tagDisplayList,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.isComposite=i.gui.compositePrduct,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.productBean.productList=i.productList,i.setDefaultDutyCalcuation(),i.loading=!0,r.post("newCompositeProduct/addProduct/"+i._s_tk_com,i.productBean).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1,i.loading=!1,a.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data,a.location=e.layOutPath):(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.upload=function(e,t){i.imageData={file:e,id:t},r.post("photo/processImage",i.imageData).success(function(){i.successMsg="Selfie uploaded Succesfuly !",i.photoSuccess=!0,o.userImage="/app/resources/images/selfie_"+i.user+".jpg",a.location.reload()}).error(function(){i.errorMsg="Could not upload selfie !",i.photoError=!0})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=y(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=y(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=y(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=y(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(),i.showDutyCalculationModal=!1},i.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),i.productVariantBean={},i.productVariantBean.uniteQunatity="1";var e=_.filter(i.productVariantBeanList,function(e){return e.variantAttributeName.toLowerCase().includes(t)}),r=_.filter(i.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)});return e.concat(r)},renderItem:function(e){return{value:e.variantAttributeName,label:n.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}},itemSelected:function(e){i.productVariantBean=e.item,i.productVariantBean.uniteQunatity="1"}},i.sesssionValidation()}],NewCustomerController=["$scope","$http","$filter","$timeout","$window","$cookieStore","$rootScope","SessionService","NewCustomerControllerPreLoad",function(t,e,r,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,t.loading=!1,t.customerBean={},t.customerBean.addressBeanList=[],t.customerBean.addressBeanList[0]={},t.customerBean.addressBeanList[1]={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=s.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){n.newCustomerLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):null!=t.data&&(t.customerGroupList=t.data),n.globalPageLoader=!1},t.populatePosatlAddress=function(){angular.copy(t.customerBean.addressBeanList[0],t.customerBean.addressBeanList[1])},t.fetchAllCustomerGroups=function(){e.post("newCustomer/getAllCustomerGroups").success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.customerGroupList=e.data:"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,o.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.addNewCustomer=function(){t.newCustomerSuccess=!1,t.newCustomerError=!1,t.addNewCustomerButton=!0,t.customerBean.addressBeanList[0].addressType="Physical Address",t.customerBean.addressBeanList[1].addressType="Postal Address",t.loading=!0,e.post("newCustomer/addNewCustomer/"+t._s_tk_com,t.customerBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.addNewCustomerButton=!1,t.newCustomerSuccess=!0,t.newCustomerSuccessMessage="Request Processed successfully!",a(function(){t.newCustomerSuccess=!1,t.loading=!1,t.customerBean={},o.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.newCustomerError=!0,t.newCustomerErrorMessage=e.data,o.location=e.layOutPath):(t.newCustomerError=!0,t.newCustomerErrorMessage=e.data)}).error(function(){t.loading=!1,t.newCustomerError=!0,t.newCustomerErrorMessage=t.systemBusy})},t.sessionValidation()}],NewPriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","$filter","$timeout","SessionService","NewPriceBookControllerPreLoad",function(n,t,r,a,e,o,s,i,c){e.MainSideBarhideit=!1,e.MainHeaderideit=!1,n.priceBookSuccess=!1,n.priceBookError=!1,n.priceBookBean={},n.priceBookBean.flatDiscount="0.00",n.gui={},n.displayOutletsList=[],n.gui.flatSale=!1,n.gui.activePriceBook=!0,n.validOn={value:"Yes"},n.sessionValidation=function(){i.validate()&&(n._s_tk_com=a.get("_s_tk_com"),n.data=c.loadControllerData(),n.fetchData(),n.setDefaultDates())},n.toggle=function(){n.gui.flatSale=!n.gui.flatSale},n.fetchData=function(){"NORECORDFOUND"==n.data||"No record found !"==n.data?(n.error=!0,n.errorMessage="No record found"):"SYSTEMBUSY"==n.data?(n.error=!0,n.errorMessage=n.systemBusy):"INVALIDSESSION"==n.data?(n.error=!0,n.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=n.data&&(null!=n.data.outletBeans&&(n.outletsList=angular.copy(n.data.outletBeans)),null!=n.data.customerGroupBeansList&&(n.customerGroupList=n.data.customerGroupBeansList)),e.globalPageLoader=!1},n.setDefaultDates=function(){var e=new Date,t=e.getUTCMonth()+1;t<10&&(t="0"+t);var r=e.getDate();r<10&&(r="0"+r);var a=new Date;a.setDate(a.getDate()+30);var o=a.getUTCMonth()+1;t<10&&(o="0"+o);var s=a.getDate();s<10&&(s="0"+s),n.priceBookBean.validFrom=e.getFullYear()+"-"+t+"-"+r,n.priceBookBean.validTo=a.getFullYear()+"-"+o+"-"+s},$("#startDate").on("change",function(e){var t=document.getElementById("startDate1").value;n.priceBookBean.validFrom=t,n.$apply()}),$("#endDate").on("change",function(e){var t=document.getElementById("endDate1").value;n.priceBookBean.validTo=t,n.$apply()}),n.addPriceBook=function(){if(n.priceBookSuccess=!1,n.priceBookError=!1,o("date")(n.priceBookBean.validFrom,"yyyy-MM-dd")>o("date")(n.priceBookBean.validTo,"yyyy-MM-dd"))return n.alertMessage="From Date should be before Valid To Date.",void $("#alertBox").modal("show");if(o("date")(n.priceBookBean.validFrom,"yyyy-MM-dd")<o("date")(new Date,"yyyy-MM-dd"))return n.alertMessage="From Date should be today or future Date.",void $("#alertBox").modal("show");if("Yes"==n.validOn.value?(n.priceBookBean.isValidOnStore="true",n.priceBookBean.isValidOnEcom="false"):(n.priceBookBean.isValidOnStore="false",n.priceBookBean.isValidOnEcom="true"),n.gui.flatSale?n.priceBookBean.flatSale="true":n.priceBookBean.flatSale="false",n.gui.activePriceBook){if(n.priceBookBean.active="true",n.gui.flatSale){var e=parseFloat(n.priceBookBean.flatDiscount);if(isNaN(e))return n.alertMessage="Discount not in valid format. Valid formats e.g (1.00,1)",void $("#alertBox").modal("show")}}else n.priceBookBean.active="false";n.priceBookBean.outletBeans=angular.copy(n.displayOutletsList),n.loading=!0,t.post("newPriceBook/addPriceBook/"+n._s_tk_com,n.priceBookBean).success(function(e){n.loading=!1,n.responseStatus=e.status,"SUCCESSFUL"==n.responseStatus?(n.loading=!0,n.priceBookSuccess=!0,n.priceBookSuccessMessage="Request Processed successfully!",s(function(){n.priceBookSuccess=!1,n.loading=!1,n.priceBookBean={},a.put("_e_cPri_gra",e.data),r.location="/app/#/managePriceBook"},1e3)):"INVALIDSESSION"==n.responseStatus||"SYSTEMBUSY"==n.responseStatus||"ADDRESTRICATION"==n.responseStatus?(n.priceBookError=!0,n.priceBookErrorMessage=e.data,"INVALIDSESSION"==n.responseStatus&&(r.location=e.layOutPath)):(n.priceBookError=!0,n.priceBookErrorMessage=e.data)}).error(function(){n.loading=!1,n.priceBookError=!0,n.priceBookErrorMessage=n.systemBusy})},n.removeOutletFromDisplayOutletList=function(e){for(var t=0;t<n.displayOutletsList.length;t++)if(n.displayOutletsList[t].outletId==e.outletId){n.displayOutletsList.splice(t,1);break}},n.addOutletToDisplayOutletList=function(e){if("-1"==e)return n.displayOutletsList=[],void(n.displayOutletsList=angular.copy(n.outletsList));for(var t=0;t<n.outletsList.length;t++)if(n.outletsList[t].outletId==e){for(var r=0;r<n.displayOutletsList.length;r++)if(n.displayOutletsList[r].outletId==e)return;n.displayOutletsList.push(n.outletsList[t]);break}},n.sessionValidation()}],NewProductController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","$sce","SessionService","NewProductControllerPreLoad",function(i,r,a,e,o,s,t,n,c,l){function u(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}function d(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",s(function(){i.variantError=!1},1e3),!0;return!1}function p(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function B(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}i.tagBean={},i.productBean={},i.gui={},i.varientAttributeBean={},i.compositProduct={},i.productTypeBean={},i.supplierBean={},i.brandBean={},i.productPriceHistoryBean={},i.compositProduct.compositQunatity="1",i.tagList=[],i.tagDisplayList=[],o.MainSideBarhideit=!1,o.MainHeaderideit=!1,i.productSuccess=!1,i.productError=!1,i.loading=!1,i.loadingVarient=!1,i.productAddError=!1,i.gui.productCanBeSold=!0,i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.gui.shwoProductTag=!1,i.showNewVarientAttriubuteModal=!1,i.checkDuplicate=!1,i.RateArea=!0,i.gui.showDutyCalculator=!1,i.showHideRateText="Hide Assessment",i.varientWarningMessage="Please select Varient Attribute",i.verientsOutletList=[],i.outletList=[],i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.compositProductCollection=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="",i.productVariantsCollection.push(i.myObj),i.addCompositProductDynamically=function(){i.compositProductTemp={};for(var e=i.compositProduct.productId.split(":"),t=!1,r=0;r<i.compositProductCollection.length;r++)e[2]==i.compositProductCollection[r].productVariantName&&(t=!0);t?alert("Product already added."):(i.compositProductTemp.id=(i.compositProductCollection.length+1).toString(),i.compositProductTemp.productId=e[0],i.compositProductTemp.productName=e[1],i.compositProductTemp.productVariantName=e[2],i.compositProductTemp.productVariantId=e[3],i.compositProductTemp.uuid=p(),i.compositProductTemp.compositQunatity=i.compositProduct.compositQunatity,i.compositProductCollection.push(i.compositProductTemp),i.compositProductTemp={},i.compositProduct={},i.compositProduct.compositQunatity="1",i.compositProduct.productId="0")},i.checkSkuExist=function(){i.checkDuplicate=!0,null!=i.productBean.sku&&""==!i.productBean.sku&&(1==i.productBarCodeMap[i.productBean.sku]?i.barCode=!0:i.barCode=!1),i.checkDuplicate=!1},i.changeHandler=function(e){i.productBean.sku=e.productName,i.productBean.productHandler=e.productName},i.removeFromOne=function(e){for(var t=0;t<i.productVariantValuesCollectionOne.length;t++)if(i.productVariantValuesCollectionOne[t].value==e){i.productVariantValuesCollectionOne.splice(t,1);for(var r=0;r<i.valueCollectionOne.length;r++)i.valueCollectionOne[r]==e&&i.valueCollectionOne.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e+"/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e+"-","")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromTwo=function(e){for(var t=0;t<i.productVariantValuesCollectionTwo.length;t++)if(i.productVariantValuesCollectionTwo[t].value==e){i.productVariantValuesCollectionTwo.splice(t,1);for(var r=0;r<i.valueCollectionTwo.length;r++)i.valueCollectionTwo[r]==e&&i.valueCollectionTwo.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.removeFromThree=function(e){for(var t=0;t<i.productVariantValuesCollectionThree.length;t++)if(i.productVariantValuesCollectionThree[t].value==e){i.productVariantValuesCollectionThree.splice(t,1);for(var r=0;r<i.valueCollectionThree.length;r++)i.valueCollectionThree[r]==e&&i.valueCollectionThree.splice(r,1)}if(1<i.productVariantValuesCollection.length||1==i.productVariantValuesCollection.length&&1<u(i.productVariantValuesCollection[0].varientName,"/"))i.preparcartesianProduct();else for(var a=0;a<i.productVariantValuesCollection.length;a++)if(i.productVariantValuesCollection[a].varientName.includes(e))if(i.productVariantValuesCollection[a].varientName.includes("/")){var o=u(i.productVariantValuesCollection[a].varientName,"/");if(1==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,""),i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/","");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace(e,""),i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-","")}else if(2==o){i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace("/"+e,"");for(t=0;t<i.productVariantValuesCollection[a].varientsOutletList.length;t++)i.productVariantValuesCollection[a].varientsOutletList[t].sku=i.productVariantValuesCollection[a].varientsOutletList[t].sku.replace("-"+e,"")}else i.productVariantValuesCollection[a].varientName=i.productVariantValuesCollection[a].varientName.replace(e,"")}else i.productVariantValuesCollection.splice(a,1),a--},i.addTagDynamically=function(e){d(i.tagList,e)||(i.tempTag={},i.tempTag.value=e,i.tempTag.tagId=(i.tagList.length+1).toString(),i.tagList.push(i.tempTag),i.tempTag={},i.tagBean={})},i.hidePanel=function(e){"2"==e&&(0<i.productVariantValuesCollectionThree.length&&(i.valueCollectionTwo=angular.copy(i.valueCollectionThree),i.productVariantValuesCollectionTwo=angular.copy(i.productVariantValuesCollectionThree)),i.productVariantValuesCollectionThree=[],i.valueCollectionThree=[]);for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].id==e&&i.productVariantsCollection.splice(t,1);for(var r=0;r<i.productVariantsCollection.length;r++)i.productVariantsCollection[r].id=r+1;(0<i.productVariantValuesCollectionThree.length||0<i.productVariantValuesCollectionTwo.length)&&i.preparcartesianProduct()},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree),function(e){i.productVariantValuesCollection=[];for(var t=i.gui.sku,r=0;r<i.verientsOutletList.length;r++)i.verientsOutletList[r].supplierCode=i.productBean.supplierId,""==i.productBean.supplyPriceExclTax||void 0===i.productBean.supplyPriceExclTax?i.verientsOutletList[r].supplyPriceExclTax="0":i.verientsOutletList[r].supplyPriceExclTax=i.productBean.supplyPriceExclTax,""==i.productBean.markupPrct||void 0===i.productBean.markupPrct?i.verientsOutletList[r].markupPrct="0":i.verientsOutletList[r].markupPrct=i.productBean.markupPrct,""==i.productBean.retailPriceExclTax||void 0===i.productBean.retailPriceExclTax?i.verientsOutletList[r].retailPriceExclTax="0":i.verientsOutletList[r].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var a=0;a<e.length;a++){var o=p();i.temp={},i.temp.uUid=o;var s=e[a].split("/");for(r=0;r<i.verientsOutletList.length;r++)" "!=s[0]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0])," "!=s[1]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1])," "!=s[2]&&(i.productBean.productName?i.verientsOutletList[r].sku=i.productBean.productName.substr(0,5)+"-"+t:i.verientsOutletList[r].sku="SKU-"+t,i.temp.varientName=s[0]+"/"+s[1]+"/"+s[2]),t+=1;i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={},i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()}}(function e(t){{if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var s=0;s<t[0].length;s++)r.push(t[0][s]+"/"+a[o]);return r}}(e)),i.verifyVariantsInfoCompleted();for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].value=""},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={},i.verifyVariantsInfoCompleted()},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(i.variantError=!1,t.includes("/")||1<e.value.split("/").length)return i.variantError=!0,i.variantErrorMessage="Value never contains '/'",void s(function(){i.variantError=!1},1e3);if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.manageVariantsBarCodePrefix=function(){for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++){var r=i.productVariantValuesCollection[e].varientName.split("/");if(" "!=r[0])if(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",(i.gui.sku+"-"+r[0]).length<=15)i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0];else{var a=i.gui.sku+"-"+r[0];i.productVariantValuesCollection[e].varientsOutletList[t].sku=a.substr(0,14)}" "!=r[1]&&1<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1])," "!=r[2]&&2<r.length&&(i.productVariantValuesCollection[e].varientsOutletList[t].sku="",i.productVariantValuesCollection[e].varientsOutletList[t].sku=i.gui.sku+"-"+r[0]+"-"+r[1]+"-"+r[2]),i.checkProductVariantSkuExist(i.productVariantValuesCollection[e].varientsOutletList[t].sku)&&(i.productVariantValuesCollection[e].varientsOutletList[t].isDuplicateBarCode="true")}},i.checkProductVariantSkuExist=function(e){if(null!=e&&""==!e)return 1==i.productVariantBarCodeMap[e]&&(i.disableAddproductButton=!0)},i.checkDuplicateVariantBarCode=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){if(""==t.sku||void 0===t.sku)return void(i.productVariantValuesCollection[r].varientsOutletList[a].sku="");i.checkProductVariantSkuExist(i.productVariantValuesCollection[r].varientsOutletList[a].sku)?i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="true":i.productVariantValuesCollection[r].varientsOutletList[a].isDuplicateBarCode="false"}i.verifyDuplicateBarCodeForAllVariants()},i.verifyDuplicateBarCodeForAllVariants=function(){for(var e=!1,t=0;t<i.productVariantValuesCollection.length;t++)for(var r=0;r<i.productVariantValuesCollection[t].varientsOutletList.length;r++)i.checkProductVariantSkuExist(i.productVariantValuesCollection[t].varientsOutletList[r].sku)&&(i.productVariantValuesCollection[t].varientsOutletList[r].isDuplicateBarCode="true",e=!0);i.disableAddproductButton=e},i.deleteProductVerientValue=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId&&delete i.productVariantValuesCollection[r].varientsOutletList[a]},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(s)&&(s=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var n=(o*(s/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=n.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=B(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(n)&&(n=0),n=B(parseFloat(100*(o-s)/s),5),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=n.toString()}}},i.updateAllProductVariantsPriceByChangeOfProductPrice=function(){if(null!=i.productVariantValuesCollection&&0<i.productVariantValuesCollection.length)for(var e=0;e<i.productVariantValuesCollection.length;e++)for(var t=0;t<i.productVariantValuesCollection[e].varientsOutletList.length;t++)i.productVariantValuesCollection[e].varientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.productVariantValuesCollection[e].varientsOutletList[t].markupPrct=i.productBean.markupPrct,i.productVariantValuesCollection[e].varientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax},i.sesssionValidation=function(){c.validate()&&(i._s_tk_com=e.get("_s_tk_com"),i.data=l.loadControllerData(),i.fetchData())},i.fetchData=function(){if("NORECORDFOUND"==i.data||"No record found !"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=i.data){if(null!=i.data.tagBeanList&&(i.tagList=i.data.tagBeanList),null!=i.data.productConfigurationBean&&(i.productConfigurationBean=i.data.productConfigurationBean),null!=i.data.showProductTag&&("true"==i.data.showProductTag?i.gui.shwoProductTag=!0:i.gui.shwoProductTag=!1),null!=i.data.showDutyCalculator&&("true"==i.data.showDutyCalculator?i.gui.showDutyCalculator=!0:i.gui.showDutyCalculator=!1),null!=i.data.supplierBeans&&(i.supplierList=i.data.supplierBeans),null!=i.data.productTypeBeanList&&(i.productTypeList=i.data.productTypeBeanList),null!=i.data.brandBeanList&&(i.brandList=i.data.brandBeanList),null!=i.data.outletBeans){if("true"==i.data.productTemplateForAllOutlets)i.verientsOutletList=i.data.outletBeans,i.outletList=i.data.outletBeans;else for(var e=0;e<i.data.outletBeans.length;e++)if("true"==i.data.outletBeans[e].isHeadOffice){i.verientsOutletList.push(i.data.outletBeans[e]),i.outletList.push(i.data.outletBeans[e]);break}for(e=0;e<i.outletList.length;e++)i.outletList[e].taxAmount=0,i.outletList[e].retailPrice=0}null!=i.data.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.data.variantAttributeBeanList),null!=i.data.productVariantBeanList&&(i.productVariantBeanList=null,i.productVariantBeanList=i.data.productVariantBeanList),null!=i.data.sku&&(i.sku=1e3,i.sku=i.data.sku,i.productBean.sku=i.sku),null!=i.data.productVariantSku&&(i.gui.sku=i.data.productVariantSku),null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap),null!=i.data.productVariantBarCodeMap&&(i.productVariantBarCodeMap=i.data.productVariantBarCodeMap)}o.newProductLoadedFully=!1,o.globalPageLoader=!1,i.setDefaultDutyCalcuation()},i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1,i.trackInventory=!0,i.mutltiProduct=function(){i.gui.standardProduct=!1,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1},i.singleProduct=function(){i.gui.standardProduct=!0,i.gui.varientProducts=!0,i.verifyVariantsInfoCompleted()},i.trackingInventory=function(){i.gui.trackingProduct?i.gui.trackingProduct=!1:i.gui.trackingProduct=!0},i.productVariants=function(){i.gui.varientProducts?(i.gui.varientProducts=!1,i.gui.trackingProduct=!0,i.disableAddproductButton=!1,i.sameProductVariantAttribute=!1):(i.gui.varientProducts=!0,i.gui.trackingProduct=!1,i.verifyVariantsInfoCompleted())},i.showHidePrice=function(){"Hide taxes by outlet"==i.showHidePriceText?(i.showHidePriceText="Show taxes by outlet",i.showHidePriceFlag=!0):(i.showHidePriceText="Hide taxes by outlet",i.showHidePriceFlag=!1)},i.showDutyCalcuator=function(){i.showDutyCalculationModal=!0},i.verifyVariantsInfoCompleted=function(){i.gui.varientProducts?(i.sameProductVariantAttribute=!1,1==i.productVariantsCollection.length?""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||i.productVariantValuesCollectionOne.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1:2==i.productVariantsCollection.length?i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1):3==i.productVariantsCollection.length&&(i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[1].varientAttributeId||i.productVariantsCollection[0].varientAttributeId==i.productVariantsCollection[2].varientAttributeId||i.productVariantsCollection[1].varientAttributeId==i.productVariantsCollection[2].varientAttributeId?(i.sameProductVariantAttribute=!0,i.disableAddproductButton=!0):(i.sameProductVariantAttribute=!1,""==i.productVariantsCollection[0].varientAttributeId||"0"==i.productVariantsCollection[0].varientAttributeId||"-1"==i.productVariantsCollection[0].varientAttributeId||""==i.productVariantsCollection[1].varientAttributeId||"0"==i.productVariantsCollection[1].varientAttributeId||"-1"==i.productVariantsCollection[1].varientAttributeId||""==i.productVariantsCollection[2].varientAttributeId||"0"==i.productVariantsCollection[2].varientAttributeId||"-1"==i.productVariantsCollection[2].varientAttributeId||i.productVariantValuesCollectionOne.length<1||i.productVariantValuesCollectionTwo.length<1||i.productVariantValuesCollectionThree.length<1?i.disableAddproductButton=!0:i.disableAddproductButton=!1))):i.disableAddproductButton=!1,i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants()},i.autoCompleteOptionsTags={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(i.tagList,function(e){if(e.tagName)return e.tagName.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.tagName,label:n.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.tagName+"</td><td style='width: 10%'>Tag</td></tr></tbody></table>")}},itemSelected:function(e){i.selectedItem=e,i.CustomerName="";for(var t=i.selectTag=!1,r=0;r<i.tagDisplayList.length;r++)if(i.tagDisplayList[r].tagId==i.selectedItem.item.tagId){t=!0;break}t||i.tagDisplayList.push(i.selectedItem.item)}},i.removeFromDisplayTagList=function(e){for(var t=0;t<i.tagDisplayList.length;t++)if(i.tagDisplayList[t].tagId==e.tagId){i.tagDisplayList.splice(t,1);break}},i.addTag=function(){if(null!=i.tagBean&&""!=i.tagBean&&i.tagBean){for(var e=!1,t=0;t<i.tagList.length;t++)if(i.tagList[t].tagName.toLowerCase()==i.tagBean.tagName.toLowerCase()){e=!0;break}if(e)return i.variantError=!0,i.variantErrorMessage="Tag "+i.tagBean.tagName+" alreday exist",void s(function(){i.variantError=!1},1e3);i.productSuccess=!1,i.productError=!1,i.loading=!0,r.post("productTags/addTag/"+i._s_tk_com,i.tagBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.tagBean={},i.productSuccess=!0,i.tagList=null,i.tagList=e.data,i.productSuccessMessage="Request Processed Successfully!",s(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.addVarientAttribute=function(e){if(i.variantAttributeAddError=!1,null!=i.varientAttributesList)for(var t=0;t<i.varientAttributesList.length;t++)if(i.varientAttributesList[t].attributeName.toLowerCase()==e.attributeName.toLowerCase())return i.variantAttributeAddError=!0,i.variantAttributeAddErrorMessage="Attribute Already exist.",void s(function(){i.variantAttributeAddError=!1},900);i.varientAttributeBean=angular.copy(e),e=null,i.productSuccess=!1,i.productError=!1,i.loadingVarient=!0,r.post("newProduct/addVariantAttribute/"+i._s_tk_com,i.varientAttributeBean).success(function(e){i.loadingVarient=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.varientAttributeBean={},i.productSuccess=!0,i.productSuccessMessage=e.data,i.fetchAllVarientAttributes(),s(function(){i.productSuccess=!1},2e3)):("INVALIDSESSION"==i.responseStatus||i.responseStatus,i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loadingVarient=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.fetchAllTags=function(){r.post("productTags/getAllTags/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.tagList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.getAllSuppliers=function(){r.post("suppliers/getAllSuppliers/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.supplierList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllProductTypes=function(){r.post("productType/getAllProductTypes/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.productTypeList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllBrands=function(){r.post("brands/getAllBrands/"+i._s_tk_com).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.brandList=e.data:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchOutlets=function(){r.post("outlets/getOutlets/"+i._s_tk_com).success(function(e){o.emergencyInfoLoadedFully=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.outletList=e.data,i.verientsOutletList=e.data):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.fetchAllVarientAttributes=function(){r.post("newProduct/getAllVariantAttributes/"+i._s_tk_com).success(function(e){if(i.showNewVarientAttriubuteModal=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.varientAttributesList=null,i.varientAttributesList=e.data;for(var t=0;t<i.productVariantsCollection.length;t++)"0"==i.productVariantsCollection[t].varientAttributeId&&(i.productVariantsCollection[t].varientAttributeId=i.varientAttributesList[i.varientAttributesList.length-1].varientAttributeId);i.verifyVariantsInfoCompleted()}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,a.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){i.showNewVarientAttriubuteModal=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showAddVarientAttributePopup=function(e){i.productSuccess=!1,i.variantAttributeAddError=!1,"0"==e?i.showNewVarientAttriubuteModal=!0:i.verifyVariantsInfoCompleted()},i.showAddProductTypePopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddProducTypeModal=!0)},i.showAddSupplierPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddSupplierModal=!0)},i.showAddBrandPopup=function(e){i.productSuccess=!1,"0"==e&&(i.showAddBrandModal=!0)},i.addProductType=function(){i.productSuccess=!1,i.productTypeError=!1,i.loading=!0,r.post("productType/addProductType/"+i._s_tk_com,i.productTypeBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.showAddProducTypeModal=!1,i.productTypeBean={},i.productTypeList=null,i.productTypeList=e.data,i.productBean.productTypeId=i.productTypeList[i.productTypeList.length-1].productTypeId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productTypeError=!0,i.productTypeErrorMessage=e.data,a.location=e.layOutPath):(i.productTypeError=!0,i.productTypeErrorMessage=e.data)}).error(function(){i.loading=!1,i.productTypeError=!0,i.productTypeErrorMessage=i.systemBusy})},i.addSupplier=function(){i.productSuccess=!1,i.Error=!1,i.loading=!0,r.post("newProduct/addSupplier/"+i._s_tk_com,i.supplierBean).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){i.supplierBean={},i.supplierList=null,i.supplierList=e.data;var t=i.supplierList.length;i.productBean.supplierId=i.supplierList[t-1].supplierId,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",i.showAddSupplierModal=!1,s(function(){i.productSuccess=!1},1e3)}else"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.Error=!0,i.ErrorMessage=e.data,a.location=e.layOutPath):(i.Error=!0,i.ErrorMessage=e.data)}).error(function(){i.loading=!1,i.Error=!0,i.ErrorMessage=i.systemBusy})},i.addBrand=function(){i.productSuccess=!1,i.brandError=!1,i.loading=!0,r.post("newProduct/addBrand/"+i._s_tk_com,i.brandBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.brandBean={},i.brandList=null,i.brandList=e.data,i.productBean.brandId=i.brandList[i.brandList.length-1].brandId,i.showAddBrandModal=!1,i.productSuccess=!0,i.productSuccessMessage="Request Processed successfully!",s(function(){i.productSuccess=!1},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.brandError=!0,i.brandErrorMessage=e.data,a.location=e.layOutPath):(i.brandError=!0,i.brandErrorMessage=e.data)}).error(function(){i.loading=!1,i.brandError=!0,i.brandErrorMessage=i.systemBusy})},i.evaluateRetailPrice=function(){var e=parseFloat(i.productBean.supplyPriceExclTax),t=parseFloat(i.productBean.markupPrct);isNaN(t)&&(t=0,i.productBean.markupPrct="0");var r=e*(t/100)+e;if(i.productBean.retailPriceExclTax=r.toFixed(2).toString(),null!=i.outletList&&0<r)for(var a=0;a<i.outletList.length;a++){var o=r*(parseFloat(i.outletList[a].defaultTax)/100);i.outletList[a].taxAmount=o.toFixed(2).toString(),i.outletList[a].retailPrice=(o+r).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()},i.adjustMarkUpByChangeOfRetailPrice=function(){var e=parseFloat(i.productBean.retailPriceExclTax);if(!isNaN(e)){var t=parseFloat(i.productBean.supplyPriceExclTax),r=parseFloat(i.productBean.markupPrct);isNaN(r)&&(r=0),r=B(100*(e-t)/t,5),i.productBean.markupPrct=r.toString();var a=t*(r/100)+t;if(null!=i.outletList&&0<a)for(var o=0;o<i.outletList.length;o++){var s=a*(parseFloat(i.outletList[o].defaultTax)/100);i.outletList[o].taxAmount=s.toFixed(2).toString(),i.outletList[o].retailPrice=(s+a).toFixed(2).toString()}i.updateAllProductVariantsPriceByChangeOfProductPrice()}},i.addProduct=function(e,t){if(i.imageData={file:e,id:t},i.productSuccess=!1,i.productError=!1,i.productAddError=!1,!i.gui.varientProducts||(i.verifyVariantsInfoCompleted(),i.disableAddproductButton||i.verifyDuplicateBarCodeForAllVariants(),!i.disableAddproductButton)){if(i.gui.trackingProduct&&("-1"==i.varientAttributeBean.varientAttributeId||"0"==i.varientAttributeBean.varientAttributeId||""==i.varientAttributeBean.varientAttributeId))return i.productAddError=!0,i.productAddErrorMessage="Please chose variant.",void s(function(){i.productAddError=!1},1e3);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.tagList=i.tagDisplayList,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.productBean.productPriceHistoryBean=i.productPriceHistoryBean,i.setDefaultDutyCalcuation(),i.loading=!0,r.post("newProduct/addProduct/"+i._s_tk_com,i.productBean).success(function(e){i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddSalesTaxModal=!1,s(function(){i.productSuccess=!1,i.loading=!1,a.location=e.layOutPath},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data,a.location=e.layOutPath):(i.productError=!0,i.loading=!1,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})}},i.upload=function(e,t){i.imageData={file:e,id:t},r.post("photo/processImage",i.imageData).success(function(){i.successMsg="Selfie uploaded Succesfuly !",i.photoSuccess=!0,o.userImage="/app/resources/images/selfie_"+i.user+".jpg",a.location.reload()}).error(function(){i.errorMsg="Could not upload selfie !",i.photoError=!0})},i.showHideRateArea=function(){"Hide Assessment"==i.showHideRateText?(i.showHideRateText="Show Assessment",i.RateArea=!1):(i.showHideRateText="Hide Assessment",i.RateArea=!0)},i.setDefaultDutyCalcuation=function(){isNaN(i.productPriceHistoryBean.dollarRate)&&(i.productPriceHistoryBean.dollarRate=0),isNaN(i.productPriceHistoryBean.dUnitValueDeclared)&&(i.productPriceHistoryBean.dUnitValueDeclared=0),isNaN(i.productPriceHistoryBean.dUnitValueAssessed)&&(i.productPriceHistoryBean.dUnitValueAssessed=0),isNaN(i.productPriceHistoryBean.dTotalValueDeclared)&&(i.productPriceHistoryBean.dTotalValueDeclared=0),isNaN(i.productPriceHistoryBean.dTotalValueAssessed)&&(i.productPriceHistoryBean.dTotalValueAssessed=0),isNaN(i.productPriceHistoryBean.pCustomValueDeclared)&&(i.productPriceHistoryBean.pCustomValueDeclared=0),isNaN(i.productPriceHistoryBean.pCustomValueAssessed)&&(i.productPriceHistoryBean.pCustomValueAssessed=0),isNaN(i.productPriceHistoryBean.numberOfUnits)&&(i.productPriceHistoryBean.numberOfUnits=0),isNaN(i.productPriceHistoryBean.customDutyPrct)&&(i.productPriceHistoryBean.customDutyPrct=0),isNaN(i.productPriceHistoryBean.customDutyValue)&&(i.productPriceHistoryBean.customDutyValue=0),isNaN(i.productPriceHistoryBean.salesTaxPrct)&&(i.productPriceHistoryBean.salesTaxPrct=0),isNaN(i.productPriceHistoryBean.salesTaxValue)&&(i.productPriceHistoryBean.salesTaxValue=0),isNaN(i.productPriceHistoryBean.regularityDutyPrct)&&(i.productPriceHistoryBean.regularityDutyPrct=0),isNaN(i.productPriceHistoryBean.regularityDutyValue)&&(i.productPriceHistoryBean.regularityDutyValue=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyPrct)&&(i.productPriceHistoryBean.additionalCustomDutyPrct=0),isNaN(i.productPriceHistoryBean.additionalCustomDutyValue)&&(i.productPriceHistoryBean.additionalCustomDutyValue=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxPrct)&&(i.productPriceHistoryBean.additionalSalesTaxPrct=0),isNaN(i.productPriceHistoryBean.additionalSalesTaxValue)&&(i.productPriceHistoryBean.additionalSalesTaxValue=0),isNaN(i.productPriceHistoryBean.excisePrct)&&(i.productPriceHistoryBean.excisePrct=0),isNaN(i.productPriceHistoryBean.exciseValue)&&(i.productPriceHistoryBean.exciseValue=0),isNaN(i.productPriceHistoryBean.totalValue)&&(i.productPriceHistoryBean.totalValue=0),isNaN(i.productPriceHistoryBean.itPrct)&&(i.productPriceHistoryBean.itPrct=0),isNaN(i.productPriceHistoryBean.itValue)&&(i.productPriceHistoryBean.itValue=0),isNaN(i.productPriceHistoryBean.ftaPrct)&&(i.productPriceHistoryBean.ftaPrct=0),isNaN(i.productPriceHistoryBean.ftaValue)&&(i.productPriceHistoryBean.ftaValue=0)},i.calculateAssessedValues=function(){i.setDefaultDutyCalcuation(),i.productPriceHistoryBean.dTotalValueAssessed=i.productPriceHistoryBean.dUnitValueAssessed*i.productPriceHistoryBean.numberOfUnits,i.productPriceHistoryBean.pCustomValueAssessed=i.productPriceHistoryBean.dTotalValueAssessed*i.productPriceHistoryBean.dollarRate,i.productPriceHistoryBean.customDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.customDutyPrct)/100,2),i.productPriceHistoryBean.regularityDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.regularityDutyPrct)/100,2),i.productPriceHistoryBean.additionalCustomDutyValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.additionalCustomDutyPrct)/100,2),i.productPriceHistoryBean.additionalSalesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.additionalSalesTaxPrct)/100,2),i.productPriceHistoryBean.salesTaxValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.salesTaxPrct)/100,2),i.productPriceHistoryBean.itValue=B(parseFloat((i.productPriceHistoryBean.pCustomValueAssessed+i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.regularityDutyValue)*i.productPriceHistoryBean.itPrct)/100,2),i.productPriceHistoryBean.exciseValue=B(parseFloat(i.productPriceHistoryBean.pCustomValueAssessed*i.productPriceHistoryBean.excisePrct)/100,2),i.productPriceHistoryBean.totalValue=B(parseFloat(i.productPriceHistoryBean.customDutyValue+i.productPriceHistoryBean.salesTaxValue+i.productPriceHistoryBean.additionalSalesTaxValue+i.productPriceHistoryBean.itValue+i.productPriceHistoryBean.additionalCustomDutyValue+i.productPriceHistoryBean.regularityDutyValue),2)},i.addSupplierPrice=function(){i.productBean.supplyPriceExclTax=B(parseFloat((i.productPriceHistoryBean.totalValue+i.productPriceHistoryBean.pCustomValueAssessed)/i.productPriceHistoryBean.numberOfUnits),2),i.evaluateRetailPrice(),i.showDutyCalculationModal=!1},i.sesssionValidation()}],NewSupplierController=["$scope","$http","$window","$cookieStore","$route","$rootScope","SessionService","$timeout","NewSupplierControllerPreLoad",function(t,e,r,a,o,s,n,i,c){function l(e){if("Physical Address"==e.addressType)return e}function u(e){if("Postal Address"==e.addressType)return e}s.MainSideBarhideit=!1,s.MainHeaderideit=!1,t.Success=!1,t.Error=!1,t.supplierBean={},t.addressList=[],t.tempAddress=[],t.physicalAddressBean=null,t.postalAddressBean=null,t.supplierScreenMode="New Supplier",t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData(),t.cookieSupplierBean=a.get("supplier"),t.cookieSupplierBean&&(t.supplierBean=t.cookieSupplierBean,t.supplierScreenMode="Manage Supplier",t.cookieSupplierBean.addresses&&(t.tempAddress=t.cookieSupplierBean.addresses.filter(l),null!=t.tempAddress&&0<t.tempAddress.length&&(t.physicalAddressBean=t.tempAddress[0]),t.tempAddress=[],t.tempAddress=t.cookieSupplierBean.addresses.filter(u),null!=t.tempAddress&&0<t.tempAddress.length&&(t.postalAddressBean=t.tempAddress[0]))))},t.fetchData=function(){s.newSupplierLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data&&(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),s.globalPageLoader=!1},t.sessionValidation(),t.addSupplier=function(){t.Success=!1,t.Error=!1,t.loading=!0,t.physicalAddressBean&&(t.physicalAddressBean.addressType="Physical Address",t.addressList.push(t.physicalAddressBean)),t.postalAddressBean&&(t.postalAddressBean.addressType="Postal Address",t.addressList.push(t.postalAddressBean)),t.supplierBean.addresses=angular.copy(t.addressList),e.post("newSupplier/addSupplier/"+t._s_tk_com,t.supplierBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.Success=!0,t.SuccessMessage=e.data,i(function(){t.loading=!1,t.Success=!1,t.supplierBean={},t.addressList=[],r.location=e.layOutPath},1500),t.physicalAddressBean=null,t.postalAddressBean=null):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.Error=!0,t.ErrorMessage=e.data,r.location=e.layOutPath):(t.Error=!0,t.ErrorMessage=e.data)}).error(function(){t.loading=!1,t.Error=!0,t.ErrorMessage=t.systemBusy})},t.updateSupplier=function(){t.Success=!1,t.Error=!1,t.loading=!0,t.physicalAddressBean&&(t.physicalAddressBean.addressType="Physical Address",t.addressList.push(t.physicalAddressBean)),t.postalAddressBean&&(t.postalAddressBean.addressType="Postal Address",t.addressList.push(t.postalAddressBean)),t.supplierBean.addresses=angular.copy(t.addressList),e.post("newSupplier/updateSupplier/"+t._s_tk_com,t.supplierBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.Success=!0,t.SuccessMessage=e.data,i(function(){t.Success=!1,t.loading=!1,t.supplierBean={},t.addressList=[],r.location=e.layOutPath},1500),t.physicalAddressBean=null,t.postalAddressBean=null):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.Error=!0,t.ErrorMessage=e.data,r.location=e.layOutPath):(t.Error=!0,t.ErrorMessage=e.data)}).error(function(){t.loading=!1,t.Error=!0,t.ErrorMessage=t.systemBusy})},t.cancelClick=function(){r.location="/app/#/suppliers"},t.populatePhysicalAddress=function(){null==t.postalAddressBean&&(t.postalAddressBean={}),t.physicalAddressBean&&(t.postalAddressBean.contactName=t.physicalAddressBean.contactName,t.postalAddressBean.firstName=t.physicalAddressBean.firstName,t.postalAddressBean.lastName=t.physicalAddressBean.lastName,t.postalAddressBean.email=t.physicalAddressBean.email,t.postalAddressBean.phone=t.physicalAddressBean.phone,t.postalAddressBean.fax=t.physicalAddressBean.fax,t.postalAddressBean.website=t.physicalAddressBean.website,t.postalAddressBean.twitter=t.physicalAddressBean.twitter,t.postalAddressBean.street=t.physicalAddressBean.street,t.postalAddressBean.suburb=t.physicalAddressBean.suburb,t.postalAddressBean.city=t.physicalAddressBean.city,t.postalAddressBean.postalCode=t.physicalAddressBean.postalCode,t.postalAddressBean.state=t.physicalAddressBean.state,t.postalAddressBean.countryId=t.physicalAddressBean.countryId,t.postalAddressBean.addressType="Postal Address")}}],NewUserController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","NewUserControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.userSuccess=!1,t.userError=!1,t.userBean={},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.newUserLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.outletBeans&&(t.outletsList=t.data.outletBeans),null!=t.data.rolesBeanList&&(t.rolesList=t.data.rolesBeanList)),o.globalPageLoader=!1},t.addUser=function(){t.userSuccess=!1,t.userError=!1,t.loading=!0,e.post("newUser/addUser/"+t._s_tk_com,t.userBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.userBean={},t.userSuccess=!0,t.userSuccessMessage=e.data,s(function(){t.userSuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.userError=!0,t.userErrorMessage=e.data,r.location=e.layOutPath):(t.userError=!0,t.userErrorMessage=e.data)}).error(function(){t.loading=!1,t.userError=!0,t.userErrorMessage=t.systemBusy})},t.sessionValidation()}],NotificationsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","NotificationsControllerPreLoad",function(r,t,a,e,o,s,n,i,c){function l(e){if("undefined"!=r.comparisonNotificationBeanList&&null!=r.comparisonNotificationBeanList&&0<r.comparisonNotificationBeanList.length)for(var t=0;t<r.comparisonNotificationBeanList.length;t++)if(r.comparisonNotificationBeanList[t].notificationId==e.notificationId)return!0;return!1}o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.success=!1,r.error=!1,r.dataLoading=!1,r.tagBean={},r.notificationBeanList=[],r.comparisonNotificationBeanList=[],r.readLoader=!1,r.notificationsId=null,r.processing=!1,r.userRoll,r.unReadMessagesCount="",r.sessionValidation=function(){i.validate()&&(r._s_tk_com=e.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData(),r.getAllUnReadNotifications())},r.fetchData=function(){o.productTagsLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found",e.put("countNotifications",0),o.countNotifications=e.get("countNotifications")):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.notificationBeanList=r.data,e.put("countNotifications",r.notificationBeanList.length),o.countNotifications=e.get("countNotifications"),r.comparisonNotificationBeanList=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},r.lodAllNotificationsAsynchrnously=function(){t.post("notifications/getAllNotifications/"+e.get("_s_tk_com")+"/true").success(function(e){r.responseStatus=e.status,r.dataLoading=!0,"SUCCESSFUL"==r.responseStatus?(r.data=e.data,r.success=!0,r.sucessMessage=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.activeInactiveAll=function(e){r.loading=!0,t.get("notifications/activeInactiveAllNotifications/"+r._s_tk_com+"/"+e).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(notifications=e.data,localforage.setItem("_e_cOt_jir",notifications),a.location="/app/#/manageNoftifications"):a.location=e.layOutPath}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.editNotification=function(e){r.notificationsId=e.notificationId,r.readLoader=!0,t.get("notifications/updateSelectedNotifications/"+r._s_tk_com+"/"+e.notificationId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.successMessage=e.data,s(function(){r.success=!1,r.readLoader=!1,n.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,s(function(){r.error=!1,n.reload()},1500)):"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){r.loading=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.loadAllNotifications=function(){r.dataLoading=!1;for(var e=0;e<r.data.length;e++)l(r.data[e])||r.notificationBeanList.push(r.data[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:o.buttonsView})},1),r.dataLoading=!0},r.markAllAsRead=function(){r.processing=!0,r.userRoll,t.get("notifications/markAllAsReadByOutletIdCompanyId/"+r._s_tk_com).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.successMessage=e.data,s(function(){r.success=!1,n.reload()},1e3)):a.location=e.layOutPath}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.getAllUnReadNotifications=function(){r.unReadNotifications=0,t.get("notifications/getAllUnReadNotifications/"+r._s_tk_com).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus&&(r.unReadNotifications=e.data)}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.sessionValidation()}],NotificationsReadedController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","NotificationsReadedControllerPreLoad",function(r,t,a,e,o,s,n,i,c){function l(e){if("undefined"!=r.comparisonNotificationBeanList&&null!=r.comparisonNotificationBeanList&&0<r.comparisonNotificationBeanList.length)for(var t=0;t<r.comparisonNotificationBeanList.length;t++)if(r.comparisonNotificationBeanList[t].notificationId==e.notificationId)return!0;return!1}o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.success=!1,r.error=!1,r.dataLoading=!1,r.tagBean={},r.notificationBeanList=[],r.comparisonNotificationBeanList=[],r.readLoader=!1,r.notificationsId=null,r.processing=!1,r.userRoll,r.readedMessagesCount="",r.sessionValidation=function(){i.validate()&&(r._s_tk_com=e.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData(),r.getAllReadedNotifications())},r.fetchData=function(){o.productTagsLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found !"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.notificationBeanList=r.data,r.comparisonNotificationBeanList=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},r.lodAllNotificationsAsynchrnously=function(){t.post("notificationsReaded/getAllNotifications/"+e.get("_s_tk_com")+"/true").success(function(e){r.responseStatus=e.status,r.dataLoading=!0,"SUCCESSFUL"==r.responseStatus?(r.data=e.data,r.success=!0,r.sucessMessage=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.activeInactiveAll=function(e){r.loading=!0,t.get("notificationsReaded/activeInactiveAllNotifications/"+r._s_tk_com+"/"+e).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(notifications=e.data,localforage.setItem("_e_cOt_jir",notifications),a.location="/app/#/manageNoftificationsReaded"):a.location=e.layOutPath}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.loadAllNotifications=function(){r.dataLoading=!1;for(var e=0;e<r.data.length;e++)l(r.data[e])||r.notificationBeanList.push(r.data[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:o.buttonsView})},1),r.dataLoading=!0},r.getAllReadedNotifications=function(){r.readedNotifications=0,t.get("notificationsReaded/getAllReadedNotifications/"+r._s_tk_com).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus&&(r.readedNotifications=e.data)}).error(function(){r.loading=!1,r.outletError=!0,r.outletErrorMessage=r.systemBusy})},r.sessionValidation()}],OrdersController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","OrdersControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){o.ordersLoadedFully=!1,"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.orderMainBeansList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.sessionValidation()}],OutletController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","OutletControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.outletSuccess=!1,t.outletError=!1,t.companyBean={},t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.outletLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.timeZoneBeans&&(t.timeZonesList=t.data.timeZoneBeans),null!=t.data.countryListBeans&&(t.countryList=t.data.countryListBeans),null!=t.data.salesTaxListBeans&&(t.salesTaxList=t.data.salesTaxListBeans)),o.globalPageLoader=!1},t.addOutlet=function(){t.outletSuccess=!1,t.outletError=!1,t.loading=!0,e.post("outlet/addOutlet/"+t._s_tk_com,t.outletBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.outletSuccess=!0,t.outletSuccessMessage=e.data,s(function(){t.outletSuccess=!1,r.location=e.layOutPath},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.outletError=!0,t.outletErrorMessage=e.data,r.location=e.layOutPath):(t.outletError=!0,t.outletErrorMessage=e.data)}).error(function(){t.loading=!1,t.outletError=!0,t.outletErrorMessage=t.systemBusy})},t.sessionValidation()}],OutletPaymentDetailsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","OutletPaymentDetailsControllerPreLoad",function(r,e,t,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.stockOrderBeansList=[],r.supplierBean={},r.oId=o.get("sp_oto"),r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=c.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.supplierBean&&(r.supplierBean=r.data.supplierBean,r.sId=r.supplierBean.supplierId),null!=r.data.supplierPaymentsBeanList&&(r.supplierPaymentBeansList=r.data.supplierPaymentsBeanList,setTimeout(function(){$("#myTable1").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"asc"]],bInfo:!0})},10)),null!=r.data.stockOrderBeansList&&(r.stockOrderBeansList=r.data.stockOrderBeansList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"desc"]],bInfo:!0})},10))),n.globalPageLoader=!1},r.isHeadOffice=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.showUpdatePaymentModal=!1,r.addPayment=function(){r.showUpdatePaymentModal=!0,r.supplierPaymentBean={},r.supplierPaymentBean.createdDate=new Date,r.supplierPaymentBean.supplierBalance=angular.copy(r.supplierBean.supplierBalance),r.supplierPaymentBean.supplierNewBalance=r.supplierPaymentBean.supplierBalance,r.supplierPaymentBean.supplier=r.sId,r.supplierPaymentBean.orderRefNum="-1",r.supplierPaymentBean.adjustmentType="Cash In",r.supplierPaymentBean.paymentCash="0",r.supplierPaymentBean.paymentAmount="0",r.supplierPaymentBean.paymentCreditCard="0",r.supplierPaymentBean.paymentOtherType="0",r.supplierPaymentBean.cashReturn="0"},r.addSuppliersPayment=function(){r.success=!1,r.error=!1,r.loading=!0,e.post("supplierDetails/addSupplierPayment/"+r._s_tk_com,r.supplierPaymentBean).success(function(e){r.responseStatus=e.status,r.loading=!1,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage=e.data,r.showUpdatePaymentModal=!1,a(function(){r.success=!1,r.showUpdatePaymentModal=!1,s.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplier=function(){r.success=!1,r.error=!1,e.post("supplierDetails/getSupplier/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierBean=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchStockOrders=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getAllStockOrdersBySupplierId/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.stockOrderBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplierPayments=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getSupplierPayments/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierPaymentBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.populateOrderAmount=function(){angular.forEach(r.stockOrderBeansList,function(e,t){e.stockOrderId==r.supplierPaymentBean.orderRefNum&&(r.supplierPaymentBean.paymentAmount=angular.copy(e.totalCost))})},r.calculateNewBalance=function(){r.totalPayment=parseInt(r.supplierPaymentBean.paymentCash)+parseInt(r.supplierPaymentBean.paymentOtherType)+parseInt(r.supplierPaymentBean.paymentCreditCard)-parseInt(r.supplierPaymentBean.cashReturn),"Cash Out"==r.supplierPaymentBean.adjustmentType?r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)-parseInt(r.totalPayment)).toString():"Cash In"==r.supplierPaymentBean.adjustmentType&&(r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)+parseInt(r.totalPayment)).toString()),isNaN(r.supplierPaymentBean.supplierNewBalance)&&(r.supplierPaymentBean.supplierNewBalance="")},r.sessionValidation()}],OutletSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","OutletSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],OutletsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","OutletsControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.systemBusy="System is Busy Please try again",t.addOutlet=function(){r.location="/app/#/outlet"},t.addRegister=function(e){localforage.setItem("_r_cO_gra",e),r.location="/app/#/register"},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.roleId=a.get("_s_tk_rId"),t.userOutletId=a.get("_s_tk_oId"),t.headOffice=a.get("_s_tk_iho"),t.data=i.loadControllerData(),t.fetchData())},t.isHeadOffice=function(){return null==t.headOffice||""==t.headOffice.toString()||"true"!=t.headOffice.toString()},t.showDetails=function(e){null!=t.headOffice&&""!=t.headOffice.toString()&&"true"==t.headOffice.toString()?(a.put("sp_oto",e.outletId),"false"==e.isHeadOffice&&(r.location="/app/#/outletPaymentDetails")):e.outletId==t.userOutletId&&(a.put("sp_oto",e.outletId),"false"==e.isHeadOffice&&(r.location="/app/#/outletPaymentDetails"))},t.fetchData=function(){o.outletsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.outletsList=t.data),o.globalPageLoader=!1},t.editOutlet=function(e){a.put("_e_cOt_gra",e.outletId),r.location="/app/#/manageOutlet"},t.updateRegister=function(e){a.put("_e_cOr_gra",e.registerId),r.location="/app/#/manageRegister"},t.sessionValidation()}],PaymentReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","PaymentReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],PaymentTypeController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","PaymentTypeControllerPreLoad",function(t,r,a,e,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.showAddSalesTaxModal=!1,t.paymentTypeSuccess=!1,t.paymentTypeError=!1,t.isCashAdded=!1,t.isCreditCardAdded=!1,t.paymentTypeAddError=!1,t.loadingUpdate=!1,t.loading=!1,t.paymentTypeBean={},t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){i.validate()&&(t._s_tk_com=e.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.paymentTypeLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=t.data&&(t.paymentTypeList=t.data),o.globalPageLoader=!1},t.showAddPaymentTypePopup=function(){t.paymentTypeAddError=!1,t.showAddPaymentTypeModal=!0},t.showUpdatePaymentTypePopup=function(e){t.updatePaymentTypeBean=angular.copy(e),t.showUpdatePaymentTypeModal=!0},t.addPaymentType=function(){if(t.paymentTypeSuccess=!1,t.paymentTypeError=!1,t.paymentTypeAddError=!1,null!=t.paymentTypeList)for(var e=0;e<t.paymentTypeList.length;e++){if("Cash"==t.paymentTypeList[e].paymentTypeValue&&"Cash"==t.paymentTypeBean.paymentTypeValue)return t.paymentTypeAddError=!0,t.paymentTypeAddErrorMessage="Payment type Cash already added.",void s(function(){t.paymentTypeAddError=!1},1e3);if("Credit Card"==t.paymentTypeList[e].paymentTypeValue&&"Credit Card"==t.paymentTypeBean.paymentTypeValue)return t.paymentTypeAddError=!0,t.paymentTypeAddErrorMessage="Payment type Credit Card already added.",void s(function(){t.paymentTypeAddError=!1},1e3)}t.loading=!0,r.post("paymentType/addPaymentType/"+t._s_tk_com,t.paymentTypeBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.paymentTypeSuccess=!0,t.paymentTypeSuccessMessage=e.data,t.showAddPaymentTypeModal=!1,s(function(){t.paymentTypeSuccess=!1,n.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data,a.location=e.layOutPath):(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data)}).error(function(){t.loading=!1,t.paymentTypeError=!0,t.paymentTypeErrorMessage=t.systemBusy})},t.updatePaymentType=function(){t.paymentTypeSuccess=!1,t.paymentTypeError=!1,t.loadingUpdate=!0,r.post("paymentType/updatePaymentType/"+t._s_tk_com,t.updatePaymentTypeBean).success(function(e){t.loadingUpdate=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.paymentTypeSuccess=!0,t.paymentTypeSuccessMessage=e.data,t.showUpdatePaymentTypeModal=!1,s(function(){t.paymentTypeSuccess=!1,s(function(){n.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data,a.location=e.layOutPath):(t.paymentTypeError=!0,t.paymentTypeErrorMessage=e.data)}).error(function(){t.loadingUpdate=!1,t.paymentTypeError=!0,t.paymentTypeErrorMessage=t.systemBusy})},t.sessionValidation()}],POCreateandReceiveController=["$sce","$filter","$scope","$http","$timeout","$window","$route","$cookieStore","$rootScope","SessionService","POCreateandReceiveControllerPreLoad",function(t,e,i,r,a,o,s,n,c,l,u){function d(e,t){i.variantError=!1;for(var r=0;r<e.length;r++)if(e[r].value.toLowerCase()==t.toLowerCase())return i.variantError=!0,i.variantErrorMessage="Value "+t+" alreday exist",a(function(){i.variantError=!1},1e3),!0;return!1}function p(){var r=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)})}function B(e,t){return Number(Math.round(e+"e"+t)+"e-"+t)}c.MainSideBarhideit=!1,c.MainHeaderideit=!1,i.stockOrderId="",i.grandTotal="0",i.stockOrderBean={},i.stockOrderBean.diliveryDueDate=new Date,i.HHMM=e("date")(new Date,"HH:mm"),i.stockOrderBean.orderNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+i.HHMM,i.stockOrderBean.stockRefNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+i.HHMM,i.showConfirmDeletePopup=!1,i.productVariantBean={},i.productVariantBeansList=[],i.stockOrderDetailBean={},i.delStockOrderDetailBean={},i.stockOrderDetailBeansList=[],i.counter=1,i.gui={},i.gui.trackingProduct=!0,i.gui.varientProducts=!1,i.gui.standardProduct=!0,i.hideRefValues=!1,i.productVariantMap=[],i.productMap=[],i.productSKU="",i.skudisable=!1,i.inputTypeScan=!0,i.update=!1,i.sessionValidation=function(){l.validate()&&(i._s_tk_com=n.get("_s_tk_com"),i.roleId=n.get("_s_tk_rId"),i.userOutletId=n.get("_s_tk_oId"),i.data=u.loadControllerData(),i.fetchData(),i.stockOrderBean.outletId=i.userOutletId,i.stockOrderBean.itemCount=0,i.itemCountTotal=0,i.stockOrderBean.recItemCount=0,i.AllInOne())},i.fetchData=function(){if(c.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==i.data)i.error=!0,i.errorMessage="No record found";else if("SYSTEMBUSY"==i.data)i.error=!0,i.errorMessage=i.systemBusy;else if("INVALIDSESSION"==i.data)i.error=!0,i.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=i.data.productVariantBeansList&&(i.productVariantBeansList=i.data.productVariantBeansList),null!=i.data.productBeansList){i.productBeansList=i.data.productBeansList;for(var e=0;e<i.productVariantBeansList.length;e++)i.productBeansList.push(i.productVariantBeansList[e])}null!=i.data.productVariantMap&&(i.productVariantMap=i.data.productVariantMap),null!=i.data.productMap&&(i.productMap=i.data.productMap),null!=i.data.outletBeansList&&(i.outletList=i.data.outletBeansList),null!=i.data.stockOrderTypeBeansList&&(i.stockOrderTypeBeansList=i.data.stockOrderTypeBeansList),null!=i.data.supplierBeansList&&(i.supplierList=i.data.supplierBeansList)}c.globalPageLoader=!1},i.addStockOrderUpdate=function(){i.success=!1,i.error=!1,i.loading=!0,i.stockOrderBean.statusId="1",i.stockOrderBean.stockOrderTypeId="1",0==i.update?r.post("purchaseOrder/addStockOrder/"+i._s_tk_com,i.stockOrderBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productTypeBean={},i.success=!0,i.successMessage="Request Processed successfully!",i.stockOrderId=e.data,i.stockOrderBean.stockOrderId=angular.copy(i.stockOrderId),n.put("_ct_bl_ost",i.stockOrderBean),i.update=!0,i.updateStockOrderDetail()):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy}):r.post("purchaseOrder/updateStockOrder/"+i._s_tk_com,i.stockOrderBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productTypeBean={},i.success=!0,i.successMessage="Request Processed successfully!",i.stockOrderId=e.data,i.stockOrderBean.stockOrderId=angular.copy(i.stockOrderId),n.put("_ct_bl_ost",i.stockOrderBean),i.updateStockOrderDetail()):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.showConfirmReceiveStockOrder=function(){i.showConfirmReceivePopup=!0},i.addStockOrderUpdateandReceive=function(){i.success=!1,i.error=!1,i.loading=!0,i.stockOrderBean.statusId="1",i.stockOrderBean.stockOrderTypeId="1",r.post("purchaseOrder/addStockOrder/"+i._s_tk_com,i.stockOrderBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productTypeBean={},i.success=!0,i.successMessage="Request Processed successfully!",i.stockOrderId=e.data,i.showConfirmReceivePopup=!1,i.stockOrderBean.stockOrderId=angular.copy(i.stockOrderId),n.put("_ct_bl_ost",i.stockOrderBean),i.updateAndReceiveStockOrderDetails()):"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})},i.checkProductStatus=function(){var e=i.stockOrderDetailBean.orderProdQty;if("true"==i.productVariantBean.isVariant.toString())i.addProduct();else{if(i.hit=0,"true"==i.productVariantBean.isProduct.toString())i.addProduct(),i.hit++;else for(var t=0;t<i.productVariantBeansList.length;t++){var r=null;i.productVariantBean.productVariantId==i.productVariantBeansList[t].productId&&(r=angular.copy(i.productVariantBean),i.productVariantBean=angular.copy(i.productVariantBeansList[t]),i.stockOrderDetailBean.orderProdQty=angular.copy(e),i.addProduct(),i.productVariantBean=angular.copy(r),i.hit++)}i.hit<1&&(i.productVariantBean.isProduct="true",i.addProduct())}i.AllInOne()},i.addProduct=function(){i.dualEntry=!1;var a=i.productVariantBean,o={};0<i.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(i.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(i.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=i.stockOrderDetailBeansList.indexOf(e);i.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,i.stockOrderDetailBeansList.unshift(o),i.dualEntry=!0}}):angular.forEach(i.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(i.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=i.stockOrderDetailBeansList.indexOf(e);i.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,i.stockOrderDetailBeansList.unshift(o),i.dualEntry=!0}}),1!=i.dualEntry&&(i.stockOrderDetailBean.productVariantId=a.productVariantId,i.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,i.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,i.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(i.stockOrderDetailBean.ordrSupplyPrice="",i.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),i.stockOrderDetailBean.total=i.stockOrderDetailBean.ordrSupplyPrice*i.stockOrderDetailBean.orderProdQty,isNaN(i.stockOrderDetailBean.total)&&(i.stockOrderDetailBean.total="0"),i.stockOrderDetailBean.order=i.counter,i.counter++,i.stockOrderDetailBean.stockOrderId=i.stockOrderBean.stockOrderId,i.stockOrderDetailBean.isDirty=!0,i.stockOrderDetailBeansList.unshift(i.stockOrderDetailBean),i.dualEntry=!1)):(i.stockOrderDetailBean.productVariantId=a.productVariantId,i.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,i.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,i.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(i.stockOrderDetailBean.ordrSupplyPrice="",i.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),i.stockOrderDetailBean.total=i.stockOrderDetailBean.ordrSupplyPrice*i.stockOrderDetailBean.orderProdQty,i.stockOrderDetailBean.order=i.counter,i.counter++,i.stockOrderDetailBean.stockOrderId=i.stockOrderBean.stockOrderId,i.stockOrderDetailBean.isDirty=!0,i.stockOrderDetailBeansList.unshift(i.stockOrderDetailBean)),i.stockOrderDetailBean={},i.airportName=[]},i.showConfirmDelete=function(e){i.delStockOrderDetailBean={},i.delStockOrderDetailBean=angular.copy(e),i.showConfirmDeletePopup=!0},i.delStockOrderDetail=function(){void 0!==i.delStockOrderDetailBean.stockOrderDetailId&&(i.error=!1,i.loading=!0,r.post("purchaseOrderDetails/deleteStockOrderDetail/"+i._s_tk_com,i.delStockOrderDetailBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?i.loading=!1:"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})),angular.forEach(i.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==i.delStockOrderDetailBean.productVariantId&&e.isProduct==i.delStockOrderDetailBean.isProduct){var r=i.stockOrderDetailBeansList.indexOf(e);i.stockOrderDetailBeansList.splice(r,1)}}),i.showConfirmDeletePopup=!1,i.delStockOrderDetailBean={},i.AllInOne()},i.AllInOne=function(){if(i.counter=1,i.stockOrderBean.itemCount=0,i.grandTotal="0",i.stockOrderBean.recItemCount=0,i.grandTotal="0",0<i.stockOrderDetailBeansList.length)for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].order=i.counter,i.counter++,i.stockOrderDetailBeansList[e].total=i.stockOrderDetailBeansList[e].ordrSupplyPrice*i.stockOrderDetailBeansList[e].orderProdQty,isNaN(i.stockOrderDetailBeansList[e].total)&&(i.stockOrderDetailBeansList[e].total="0"),i.stockOrderBean.itemCount=parseInt(i.stockOrderBean.itemCount)+parseInt(i.stockOrderDetailBeansList[e].orderProdQty),isNaN(i.stockOrderBean.itemCount)&&(i.stockOrderBean.itemCount="0"),i.stockOrderDetailBeansList[e].recvTotal=i.stockOrderDetailBeansList[e].recvSupplyPrice*i.stockOrderDetailBeansList[e].recvProdQty,isNaN(i.stockOrderDetailBeansList[e].recvTotal)&&(i.stockOrderDetailBeansList[e].recvTotal="0"),i.stockOrderBean.recItemCount=parseInt(i.stockOrderBean.recItemCount)+parseInt(i.stockOrderDetailBeansList[e].recvProdQty),!isNaN(i.stockOrderBean.recItemCount)&&""!=i.stockOrderBean.recItemCount||(i.stockOrderBean.recItemCount="0"),i.grandTotal=parseFloat(i.grandTotal)+parseFloat(i.stockOrderDetailBeansList[e].recvTotal),isNaN(i.grandTotal)&&(i.grandTotal="0")},i.calculateTotalforItem=function(r){angular.forEach(i.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),e.isDirty=!0)}),i.AllInOne()},i.calculateRecvTotalforItem=function(r){angular.forEach(i.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.recvTotal=e.recvSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),e.isDirty=!0)}),i.AllInOne()},i.checkStockOrderDetailListforRec=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++){if(""==i.stockOrderDetailBeansList[e].recvProdQty||null==i.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==i.stockOrderDetailBeansList[e].recvSupplyPrice||null==i.stockOrderDetailBeansList[e].recvSupplyPrice)return!1}return!0}return!1},i.checkStockOrderDetailList=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++){if(""==i.stockOrderDetailBeansList[e].orderProdQty||null==i.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==i.stockOrderDetailBeansList[e].ordrSupplyPrice||null==i.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},i.markAllReceive=function(){if(0<i.stockOrderDetailBeansList.length)for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].recvProdQty="",i.stockOrderDetailBeansList[e].recvProdQty=angular.copy(i.stockOrderDetailBeansList[e].orderProdQty),i.stockOrderDetailBeansList[e].recvSupplyPrice="",i.stockOrderDetailBeansList[e].recvSupplyPrice=angular.copy(i.stockOrderDetailBeansList[e].ordrSupplyPrice),i.stockOrderDetailBeansList[e].recvTotal=i.stockOrderDetailBeansList[e].recvSupplyPrice*i.stockOrderDetailBeansList[e].recvProdQty,i.stockOrderDetailBeansList[e].isDirty=!0,isNaN(i.stockOrderDetailBeansList[e].total)&&(i.stockOrderDetailBeansList[e].total="0");i.AllInOne()},i.updateStockOrderDetail=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].stockOrderId=i.stockOrderId;i.success=!1,i.error=!1,i.loading=!0,r.post("purchaseOrderDetails/updateStockOrderDetail/"+i._s_tk_com+"/"+i.grandTotal+"/"+i.stockOrderBean.itemCount,i.stockOrderDetailBeansList).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){if(i.success=!0,i.stockOrderDetailBeansList=e.data,0<i.stockOrderDetailBeansList.length)for(var t=0;t<i.stockOrderDetailBeansList.length;t++)i.stockOrderDetailBeansList[t].isDirty=!1;i.AllInOne(),n.put("_e_cOt_pio",""),a(function(){i.success=!1,o.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||i.responseStatus,i.error=!0,i.errorMessage=e.data}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})}},i.updateAndReceiveStockOrderDetails=function(){if(0<i.stockOrderDetailBeansList.length){for(var e=0;e<i.stockOrderDetailBeansList.length;e++)i.stockOrderDetailBeansList[e].stockOrderId=i.stockOrderId;i.success=!1,i.error=!1,i.loading=!0,r.post("purchaseOrderDetails/updateAndReceiveStockOrderDetails/"+i._s_tk_com+"/"+i.grandTotal+"/"+i.stockOrderBean.recItemCount,i.stockOrderDetailBeansList).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.success=!0,i.successMessage=e.data,n.put("_e_cOt_pio",""),a(function(){i.success=!1,o.location=e.layOutPath},2e3)):("SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||i.responseStatus,i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy})}},i.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return i.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();i.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(i.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(i.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(i.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(i.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(i.hideRefValues=!0,i.stockOrderDetailBean.orderProdQty=1,i.productVariantBean=r[0],i.checkProductStatus(),i.selectedItem={},i.selectedItem.item=r[0],i.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(i.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),i.hideRefValues=!1),e},renderItem:function(e){return 0==i.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){i.productVariantBean=e.item}},i.editVariant=function(){console.log(i.productVariantBean),null!=i.productVariantBean&&null!=i.productVariantBean.productId&&null!=i.productVariantBean.outletId&&(i.loading=!0,r.post("newProduct/getNewProductControllerData/"+n.get("_s_tk_com")+"/"+i.productVariantBean.productId+"/"+i.productVariantBean.outletId).success(function(e){if(i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus){if(i.response=e.data,i.productVariantsCollection=[],i.productVariantValuesCollection=[],i.productVariantValuesCollectionOne=[],i.productVariantValuesCollectionTwo=[],i.productVariantValuesCollectionThree=[],i.valueCollectionOne=[],i.valueCollectionTwo=[],i.valueCollectionThree=[],i.productVariantValuesCollectionOldOne=[],i.productVariantValuesCollectionOldTwo=[],i.productVariantValuesCollectionOldThree=[],i.myObj={},i.myObj.id="1",i.myObj.value="",i.myObj.varientAttributeId="",i.addVariantsEntertained=!1,i.productVariantsCollection.push(i.myObj),null!=i.response){if(null!=i.response.supplierBeans&&(i.supplierList=i.response.supplierBeans),null!=i.response.productTypeBeanList&&(i.productTypeList=i.response.productTypeBeanList),null!=i.response.brandBeanList&&(i.brandList=i.response.brandBeanList),null!=i.response.outletBeans){null!=i.response.productBean.outletBeans?i.outletList=i.response.productBean.outletBeans:i.outletList=i.response.outletBeans;for(var t=0;t<i.outletList.length;t++)i.outletList[t].taxAmount=0,i.outletList[t].retailPrice=0;i.verientsOutletList=i.response.outletBeans}if(null!=i.response.variantAttributeBeanList&&(i.varientAttributesList=null,i.varientAttributesList=i.response.variantAttributeBeanList),null!=i.response.productBean){if(i.productBean={},i.tempproductBean={},i.productBean=i.response.productBean,i.tempproductBean=angular.copy(i.response.productBean),i.compositProductCollection=angular.copy(i.productBean.compositProductCollection),0<i.productBean.productVariantsBeans.length){var r=function(e,t){for(var r=0,a=0;a<e.length;a++){var o=e.indexOf(t,a);-1<o&&(r++,a=o)}return r}(i.productBean.productVariantsBeans[0].variantAttributeName,"/");if(1==r){i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2;for(t=0;t<i.productBean.productVariantsBeans.length;t++){var a=i.productBean.productVariantsBeans[t].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,a[0])||(i.tempObject={},i.tempObject.value=a[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,a[1])||(i.tempObject.value=a[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={})}}else if(2==r){i.addAttributeDynamically(),i.addAttributeDynamically(),i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1,i.productVariantsCollection[1].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId2,i.productVariantsCollection[2].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId3;for(t=0;t<i.productBean.productVariantsBeans.length;t++){a=i.productBean.productVariantsBeans[t].variantAttributeName.split("/");d(i.productVariantValuesCollectionOne,a[0])||(i.tempObject={},i.tempObject.value=a[0],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionTwo,a[1])||(i.tempObject.value=a[1],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),i.valueCollectionTwo.push(i.tempObject.value),i.tempObject={}),d(i.productVariantValuesCollectionThree,a[2])||(i.tempObject.value=a[2],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),i.valueCollectionThree.push(i.tempObject.value),i.tempObject={})}}else{i.productVariantsCollection[0].varientAttributeId=i.productBean.productVariantsBeans[0].variantAttributeId1;for(t=0;t<i.productBean.productVariantsBeans.length;t++)i.tempObject={},i.tempObject.value=i.productBean.productVariantsBeans[t].variantAttributeName,i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),i.valueCollectionOne.push(i.tempObject.value),i.tempObject={}}}i.productVariantValuesCollectionOldOne=angular.copy(i.productVariantValuesCollectionOne),i.productVariantValuesCollectionOldTwo=angular.copy(i.productVariantValuesCollectionTwo),i.productVariantValuesCollectionOldThree=angular.copy(i.productVariantValuesCollectionThree),"true"==i.productBean.productCanBeSold?i.gui.productCanBeSold=!0:i.gui.productCanBeSold=!1,"true"==i.productBean.trackingProduct?i.gui.trackingProduct=!0:i.gui.trackingProduct=!1,"true"==i.productBean.varientProducts?i.gui.varientProducts=!0:i.gui.varientProducts=!1,"true"==i.productBean.standardProduct?i.gui.standardProduct=!0:i.gui.standardProduct=!1,null!=i.data.productBarCodeMap&&(i.productBarCodeMap=i.data.productBarCodeMap)}}i.evaluateRetailPrice(),i.variantError=!1,i.showAddVariantsModal=!0}else"SYSTEMBUSY"==i.responseStatus||"INVALIDUSER"==i.responseStatus||"ERROR"==i.responseStatus||"INVALIDSESSION"==i.responseStatus?(i.error=!0,i.errorMessage=e.data,o.location=e.layOutPath):(i.error=!0,i.errorMessage=e.data)}).error(function(){c.emergencyInfoLoadedFully=!1,i.error=!0,i.errorMessage=i.systemBusy}))},i.addAttributeDynamically=function(){var e=i.productVariantsCollection.length;i.tempObj={},i.tempObj.value="",i.tempObj.varientAttributeId="",i.tempObj.id=(e+1).toString(),i.productVariantsCollection.push(i.tempObj),i.tempObj={}},i.addVarientValuesDynamically=function(e){var t=e.value.split(",");if(null!=t&&0<t.length){for(var r=!1,a=0;a<t.length;a++)""!=t[a]&&(i.tempObject={},"1"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionOne.length+1,i.productVariantValuesCollectionOne.push(i.tempObject),r=!0," "==i.valueCollectionOne[0]&&i.valueCollectionOne.splice(0,1),i.valueCollectionOne.push(t[a]))),"2"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionTwo.length+1,i.productVariantValuesCollectionTwo.push(i.tempObject),r=!0," "==i.valueCollectionTwo[0]&&i.valueCollectionTwo.splice(0,1),i.valueCollectionTwo.push(t[a]))),"3"==e.id&&(d(i.productVariantValuesCollectionOne,t[a])||d(i.productVariantValuesCollectionTwo,t[a])||d(i.productVariantValuesCollectionThree,t[a])||(i.tempObject.value=t[a],i.tempObject.varientAttributeValueId=i.productVariantValuesCollectionThree.length+1,i.productVariantValuesCollectionThree.push(i.tempObject),r=!0," "==i.valueCollectionThree[0]&&i.valueCollectionThree.splice(0,1),i.valueCollectionThree.push(t[a]))),i.tempObject={});r&&i.preparcartesianProduct()}},i.preparcartesianProduct=function(){var e=[];i.valueCollectionOne.length<1&&i.valueCollectionOne.push(" "),i.valueCollectionTwo.length<1&&i.valueCollectionTwo.push(" "),i.valueCollectionThree.length<1&&i.valueCollectionThree.push(" "),e.push(i.valueCollectionOne),e.push(i.valueCollectionTwo),e.push(i.valueCollectionThree),function(e){i.productVariantValuesCollection=[];for(var t=0;t<i.verientsOutletList.length;t++)i.verientsOutletList[t].supplierCode=i.productBean.supplierId,i.verientsOutletList[t].supplyPriceExclTax=i.productBean.supplyPriceExclTax,i.verientsOutletList[t].markupPrct=i.productBean.markupPrct,i.verientsOutletList[t].retailPriceExclTax=i.productBean.retailPriceExclTax;i.sku=i.data.sku+1;for(var r=0;r<e.length;r++){var a=p();i.temp={},i.temp.uUid=a;var o=e[r].split("/");for(t=0;t<i.verientsOutletList.length;t++)i.sku=i.sku+1," "!=o[0]&&(i.verientsOutletList[t].sku=i.productBean.sku+"-"+o[0],i.temp.varientName=o[0])," "!=o[1]&&(i.verientsOutletList[t].sku=i.productBean.sku+"-"+o[0]+"-"+o[1],i.temp.varientName=o[0]+"/"+o[1])," "!=o[2]&&(i.verientsOutletList[t].sku=i.productBean.sku+"-"+o[0]+"-"+o[1]+"-"+o[2],i.temp.varientName=o[0]+"/"+o[1]+"/"+o[2]);i.temp.varientsOutletList=angular.copy(i.verientsOutletList),i.temp.varientId=i.productVariantValuesCollection.length+1,i.productVariantValuesCollection.push(i.temp),i.temp={}}if(0<i.productBean.productVariantsBeans.length)for(var s=0;s<i.productBean.productVariantsBeans.length;s++)for(t=0;t<i.productVariantValuesCollection.length;t++)i.productVariantValuesCollection[t].varientName==i.productBean.productVariantsBeans[s].variantAttributeName&&i.productVariantValuesCollection.splice(t,1);i.addVariantsEntertained=!0}(function e(t){if(0===t.length)return[];if(1===t.length)return t[0];var r=[],a=e(t.slice(1));for(var o in a)for(var s=0;s<t[0].length;s++)r.push(t[0][s]+"/"+a[o]);return r}(e));for(var t=0;t<i.productVariantsCollection.length;t++)i.productVariantsCollection[t].value=""},i.updateProduct=function(){if(i.productSuccess=!1,i.productError=!1,i.productAddError=!1,0<i.productBean.productVariantsBeans.length){i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree;for(var e=0;e<i.productBean.productVariantsBeans.length;e++)for(var t=0;t<i.productVariantValuesCollection.length;t++)i.productVariantValuesCollection[t].varientName==i.productBean.productVariantsBeans[e].variantAttributeName&&i.productVariantValuesCollection.splice(t,1);i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection}else i.productBean.productVariantValuesCollectionOne=i.productVariantValuesCollectionOne,i.productBean.productVariantValuesCollectionTwo=i.productVariantValuesCollectionTwo,i.productBean.productVariantValuesCollectionThree=i.productVariantValuesCollectionThree,i.productBean.productVariantValuesCollection=i.productVariantValuesCollection,i.productBean.productVariantAttributeCollection=i.productVariantsCollection;i.productBean.varientAttributeId=i.productVariantsCollection[0].varientAttributeId,i.productBean.tagList=i.tagList,i.productBean.outletList=i.outletList,i.productBean.productCanBeSold=i.gui.productCanBeSold,i.productBean.trackingProduct=i.gui.trackingProduct,i.productBean.varientProducts=i.gui.varientProducts,i.productBean.standardProduct=i.gui.standardProduct,i.productBean.compositProductCollection=i.compositProductCollection,i.productBean.imageData=i.imageData,i.loading=!0,r.post("manageProduct/updateProduct/"+i._s_tk_com,i.productBean).success(function(e){i.loading=!1,i.responseStatus=e.status,"SUCCESSFUL"==i.responseStatus?(i.productSuccess=!0,i.productSuccessMessage=e.data,i.showAddVariantsModal=!1,a(function(){i.productSuccess=!1,a(function(){s.reload()},500)},1e3)):"INVALIDSESSION"==i.responseStatus||"SYSTEMBUSY"==i.responseStatus?(i.productError=!0,i.productErrorMessage=e.data,o.location=e.layOutPath):(i.productError=!0,i.productErrorMessage=e.data)}).error(function(){i.loading=!1,i.productError=!0,i.productErrorMessage=i.systemBusy})},i.evaluateVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct);isNaN(s)&&(s=0,i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct="0");var n=(o*(s/100)+o).toFixed(2);i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax=n.toString()}},i.adjustMarkUpByChangeOfVariantRetailPrice=function(e,t){for(var r=0;r<i.productVariantValuesCollection.length;r++)if(e.varientId==i.productVariantValuesCollection[r].varientId)for(var a=0;a<i.productVariantValuesCollection[r].varientsOutletList.length;a++)if(t.outletId==i.productVariantValuesCollection[r].varientsOutletList[a].outletId){var o=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].retailPriceExclTax);if(!isNaN(o)){var s=parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].supplyPriceExclTax),n=B(parseFloat(i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct),5);isNaN(n)&&(n=0),n=B(100*(o-s)/s,5),i.productVariantValuesCollection[r].varientsOutletList[a].markupPrct=n.toString()}}},i.evaluateRetailPrice=function(){var e=parseFloat(i.productBean.supplyPriceExclTax),t=parseFloat(i.productBean.markupPrct);isNaN(t)&&(t=0,i.productBean.markupPrct="0");var r=e*(t/100)+e;if(i.productBean.retailPriceExclTax=r.toFixed(2).toString(),null!=i.outletList&&0<r)for(var a=0;a<i.outletList.length;a++){var o=r*(parseFloat(i.outletList[a].defaultTax)/100);i.outletList[a].taxAmount=o.toFixed(2).toString(),i.outletList[a].retailPrice=(o+r).toFixed(2).toString()}},i.skuinput=function(){(i.productSKU.includes("-")||6<i.productSKU.length)&&(null!=i.productVariantMap[i.productSKU.toLowerCase()]?(i.skudisable=!0,i.stockOrderDetailBean.orderProdQty=1,i.productVariantBean=i.productVariantMap[i.productSKU.toLowerCase()],i.checkProductStatus(),i.productSKU="",i.skudisable=!1):15<i.productSKU.length&&(i.productSKU="",i.skudisable=!1))},i.sessionValidation()}],POCreateandReceiveEditController=["$sce","$filter","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","POCreateandReceiveEditControllerPreLoad",function(t,e,s,r,a,o,n,i,c,l){i.MainSideBarhideit=!1,i.MainHeaderideit=!1,s.stockOrderId="",s.grandTotal="0",s.stockOrderBean={},s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){c.validate()&&(s._s_tk_com=n.get("_s_tk_com"),s.data=l.loadControllerData(),s.fetchData(),s.stockOrderBean=n.get("_ct_bl_ost"),s.stockOrderBean.diliveryDueDate=new Date(s.stockOrderBean.diliveryDueDate),s.stockOrderBean.itemCount=0,s.itemCountTotal=0,s.stockOrderBean.recItemCount=0,s.AllInOne())},s.fetchData=function(){if(i.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap),null!=s.data.outletBeansList&&(s.outletList=s.data.outletBeansList),null!=s.data.stockOrderTypeBeansList&&(s.stockOrderTypeBeansList=s.data.stockOrderTypeBeansList),null!=s.data.supplierBeansList&&(s.supplierList=s.data.supplierBeansList),null!=s.data.stockOrderDetailBeansList&&(s.stockOrderDetailBeansList=s.data.stockOrderDetailBeansList)}i.globalPageLoader=!1},s.addStockOrderUpdate=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="2",s.stockOrderBean.stockOrderTypeId="1",r.post("purchaseOrder/updateStockOrder/"+s._s_tk_com,s.stockOrderBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderId=e.data,s.stockOrderBean.stockOrderId=angular.copy(s.stockOrderId),n.put("_ct_bl_ost",s.stockOrderBean),s.updateStockOrderDetail()):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,o.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.showConfirmReceiveStockOrder=function(){s.showConfirmReceivePopup=!0},s.addStockOrderUpdateandReceive=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",s.stockOrderBean.stockOrderTypeId="1",r.post("purchaseOrder/updateStockOrder/"+s._s_tk_com,s.stockOrderBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderId=e.data,s.showConfirmReceivePopup=!1,s.stockOrderBean.stockOrderId=angular.copy(s.stockOrderId),n.put("_ct_bl_ost",s.stockOrderBean),s.updateAndReceiveStockOrderDetails()):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,o.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,r.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,o.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",s.stockOrderBean.recItemCount=0,s.grandTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].recvSupplyPrice*s.stockOrderDetailBeansList[e].recvProdQty,isNaN(s.stockOrderDetailBeansList[e].recvTotal)&&(s.stockOrderDetailBeansList[e].recvTotal="0"),s.stockOrderBean.recItemCount=parseInt(s.stockOrderBean.recItemCount)+parseInt(s.stockOrderDetailBeansList[e].recvProdQty),!isNaN(s.stockOrderBean.recItemCount)&&""!=s.stockOrderBean.recItemCount||(s.stockOrderBean.recItemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].recvTotal),isNaN(s.grandTotal)&&(s.grandTotal="0")},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),e.isDirty=!0)}),s.AllInOne()},s.calculateRecvTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.recvTotal=e.recvSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailListforRec=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].recvProdQty||null==s.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].recvSupplyPrice||null==s.stockOrderDetailBeansList[e].recvSupplyPrice)return!1}return!0}return!1},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},s.markAllReceive=function(){if(0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].recvProdQty="",s.stockOrderDetailBeansList[e].recvProdQty=angular.copy(s.stockOrderDetailBeansList[e].orderProdQty),s.stockOrderDetailBeansList[e].recvSupplyPrice="",s.stockOrderDetailBeansList[e].recvSupplyPrice=angular.copy(s.stockOrderDetailBeansList[e].ordrSupplyPrice),s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].recvSupplyPrice*s.stockOrderDetailBeansList[e].recvProdQty,s.stockOrderDetailBeansList[e].isDirty=!0,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0");s.AllInOne()},s.updateStockOrderDetail=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].stockOrderId=s.stockOrderId;s.success=!1,s.error=!1,s.loading=!0,r.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),n.put("_e_cOt_pio",""),a(function(){s.success=!1},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){i.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})}},s.updateAndReceiveStockOrderDetails=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].stockOrderId=s.stockOrderId;s.success=!1,s.error=!1,s.loading=!0,r.post("purchaseOrderDetails/updateAndReceiveStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.recItemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,n.put("_e_cOt_pio",""),a(function(){s.success=!1,o.location=e.layOutPath},2e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){i.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})}},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],PriceBookController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","PriceBookControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.priceBookList=e.data,e.roledId=a.get("_s_tk_rId"),setTimeout(function(){$("#myTable").DataTable({responsive:!0,order:[[6,"Created At"]],paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.addPriceBook=function(){r.location="/app/#/newPriceBook"},e.editPriceBook=function(e){a.put("_e_cPri_gra",e.priceBookId),r.location="/app/#/managePriceBook"},e.sessionValidation()}],PrintLabelsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","PrintLabelsControllerPreLoad","$timeout","$sce",function(n,e,t,a,o,s,i,c,r){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,n.products=[],n.product={},n.airportName=[],c(function(){n.printCount=n.printCounting,JsBarcode(".barcode").init()},1500),n.productVaraintDetailBeanList=[],n.sessionValidation=function(){for(var e=0;e<40;e++)n.product={},n.product.id=e,n.products.push(n.product);if(o.globalPageLoader=!1,s.validate()){n._s_tk_com=a.get("_s_tk_com"),n.data=i.loadControllerData(),n.companyName=n.data.companyName,n.allProducts=n.data.productsBean;for(var t=0;t<n.allProducts.length;t++)if(n.allProducts[t].productVariantsBeans)for(var r=0;r<n.allProducts[t].productVariantsBeans.length;r++)n.productVaraintDetailBeanList.push(n.allProducts[t].productVariantsBeans[r])}},n.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),n.productVariantsBeans=[],_.filter(n.productVaraintDetailBeanList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)})},renderItem:function(e){if(void 0===e.firstName){if(n.variantSkuFound)return void(n.variantSkuFound=!1);var t={value:e.variantAttributeName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 100%'>"+e.variantAttributeName+"</td></tr></tbody></table>")}}else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};return t},itemSelected:function(e){n.selectedItem={},n.selectedItem=e,n.selectProduct=!0,n.printLabelsFunc(n.selectedItem.item)}},n.fetchData=function(){o.roleDetailsLoadedFully=!1,"NORECORDFOUND"==n.data?(n.error=!0,n.errorMessage="No record found"):"SYSTEMBUSY"==n.data?(n.error=!0,n.errorMessage=n.systemBusy):"INVALIDSESSION"==n.data&&(n.error=!0,n.errorMessage="An exception occured while validating session !",t.location="/app/#/login")},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},n.printCountChange=function(){var e=n.selectedItem.item;n.printCount=n.printCounting;for(var t=0;t<n.printCount;t++){if(n.printLabelsProduct={},n.printLabelsProduct.sku=e.sku,e.variantAttributeName){var r=e.variantAttributeName.split("/");n.printLabelsProduct.productName=""+e.variantAttributeName.replaceAll("/","-"),n.printLabelsProduct.productNameOnly=e.productName,n.printLabelsProduct.variantAttributeValue1=r[1],n.printLabelsProduct.variantAttributeValue2=r[2],n.printLabelsProduct.productDesc=e.productDesc}else n.printLabelsProduct.productName=e.productName;n.printLabelsProduct.price=e.netPrice,n.printLabelsProduct.id=t,n.layoutproducts.push(n.printLabelsProduct)}c(function(){JsBarcode(".barcode").init(),n.printLabels=!1,n.printCounting=""},1500)},n.layoutproducts=[],n.layoutproduct={},n.printLoading=!1,n.printList=[],n.printLabelsFunc=function(e){if(n.printLabelsProduct={},n.printLoading=!0,n.printLabelsProduct.sku=e.sku,e.variantAttributeName){var t=e.variantAttributeName.split("/");n.printLabelsProduct.productName=""+e.variantAttributeName.replaceAll("/","-"),n.printLabelsProduct.productNameOnly=e.productName,n.printLabelsProduct.variantAttributeValue1=t[1],n.printLabelsProduct.variantAttributeValue2=t[2],n.printLabelsProduct.productDesc=e.productDesc}else n.printLabelsProduct.productName=e.productName;n.printLabelsProduct.price=e.netPrice,e.varientProducts;for(var r=0;r<1;r++){n.layoutproduct={},n.layoutproduct.id=r;var a=n.layoutproducts.length;0==a&&(n.layoutproducts.push(n.printLabelsProduct),n.printList.push(e.sku));for(var o=!0,s=0;s<a;s++)o=!(!n.layoutproducts[s]||n.layoutproducts[s].productName!=n.printLabelsProduct.productName)}o||(n.layoutproducts.push(n.printLabelsProduct),n.printList.push(e.sku)),c(function(){JsBarcode(".barcode").init(),n.printLabels=!1,n.printLoading=!1},1500)},n.printThisElementA4="printThisElement",n.printOptionsA4=!0,n.changePrinter=function(){"A4"==n.printOptions?(n.printOptionsA4=!0,n.printOptionsContinous=!1,n.printOptionsContinousLarge=!1,n.printOptionsContinousNew=!1,n.printOptionsContinousNewZebra=!1,n.printThisElementA4="printThisElement",n.printThisElementContinous="",n.printThisElementContinousLarge="",n.printThisElementContinousNew="",n.printThisElementContinousNewZebra=""):"Continous"==n.printOptions?(n.printOptionsA4=!1,n.printOptionsContinous=!0,n.printOptionsContinousLarge=!1,n.printOptionsContinousNew=!1,n.printOptionsContinousNewZebra=!1,n.printThisElementA4="",n.printThisElementContinous="printThisElement",n.printThisElementContinousLarge="",n.printThisElementContinousNew="",n.printThisElementContinousNewZebra=""):"ContinousNew"==n.printOptions?(n.printOptionsA4=!1,n.printOptionsContinous=!1,n.printOptionsContinousLarge=!1,n.printOptionsContinousNew=!0,n.printOptionsContinousNewZebra=!1,n.printThisElementA4="",n.printThisElementContinousNew="printThisElement",n.printThisElementContinousLarge="",n.printThisElementContinous="",n.printThisElementContinousNewZebra=""):"ContinousLarge"==n.printOptions?(n.printOptionsA4=!1,n.printOptionsContinous=!1,n.printOptionsContinousLarge=!0,n.printOptionsContinousNew=!1,n.printOptionsContinousNewZebra=!1,n.printThisElementA4="",n.printThisElementContinous="",n.printThisElementContinousLarge="printThisElement",n.printThisElementContinousNew="",n.printThisElementContinousNewZebra=""):"ContinousNewZebra"==n.printOptions&&(n.printOptionsA4=!1,n.printOptionsContinous=!1,n.printOptionsContinousLarge=!1,n.printOptionsContinousNew=!1,n.printOptionsContinousNewZebra=!0,n.printThisElementA4="",n.printThisElementContinousNew="",n.printThisElementContinousLarge="",n.printThisElementContinous="",n.printThisElementContinousNewZebra="printThisElement")},n.sessionValidation()}],ProductDetailsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","ProductDetailsControllerPreLoad","$timeout",function(o,e,r,t,a,s,n,i){a.MainSideBarhideit=!1,a.MainHeaderideit=!1,o.gui=[],o.productHistoryBeansList=[],o.gui.dataLoading=!0,o.gui.dataLoadingCompleted=!1,o.printCount=40,o.roledId=t.get("_s_tk_rId"),o.bc={format:"CODE128",width:1,height:44,displayValue:!1,marginRight:10},o.sesssionValidation=function(){s.validate()&&(o._s_tk_com=t.get("_s_tk_com"),o.fetchData())},o.loadProductHistory=function(){o.gui.dataLoading=!1,e.post("productDetails/getProductHistoryByProductUuid/"+o._s_tk_com+"/"+o.product.productUuid).success(function(e){if(o.gui.dataLoading=!0,o.responseStatus=e.status,"SUCCESSFUL"==o.responseStatus&&(o.gui.dataLoadingCompleted=!0,null!=e.data)){o.productHistoryBeansList=e.data;var t=$("#myTable1").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable1").DataTable({responsive:!0})},100)}}).error(function(){o.gui.dataLoading=!0,o.outletError=!0,o.outletErrorMessage=o.systemBusy})},o.printLabels=!0,o.fetchData=function(){if(o.data=n.loadControllerData(),a.productDetailsLoadedFully=!1,"NORECORDFOUND"==o.data)o.error=!0,o.errorMessage="No record found";else if("SYSTEMBUSY"==o.data)o.error=!0,o.errorMessage=o.systemBusy;else if("INVALIDSESSION"==o.data)o.error=!0,o.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=o.data){if(null!=o.data.productBean)if(o.product={},o.product=o.data.productBean,null!==o.product.productVariantsBeans&&0<o.product.productVariantsBeans.length){for(var e=0,t=0;t<o.product.productVariantsBeans.length;t++)e+=parseFloat(o.product.productVariantsBeans[t].netPrice);o.averagePrice=(e/o.product.productVariantsBeans.length).toFixed(2).toString()}else o.averagePrice=o.product.netPrice;null!=o.data.productHistoryBeans&&(o.productHistoryBeansList=o.data.productHistoryBeans)}a.globalPageLoader=!1},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},o.editProduct=function(){t.put("_e_cPi_gra",o.product.productId),t.put("_e_cOi_gra",o.product.outletId),r.location="/app/#/manageProduct"},o.printCountChange=function(){o.printCount=o.printCounting,o.layoutproducts=[];for(var e=0;e<o.printCount;e++)o.layoutproduct={},o.layoutproduct.id=e,o.layoutproduct.productName=o.printLabelsProduct.productName,o.layoutproduct.sku=o.printLabelsProduct.sku,o.layoutproduct.price=o.printLabelsProduct.price,o.layoutproducts.push(o.layoutproduct);i(function(){JsBarcode(".barcode").init(),o.printLabels=!1},1500)},o.layoutproducts=[],o.layoutproduct={},o.printLoading=!1,o.printLabelsProduct={},o.printLabelsAll=function(e){o.printLoading=!0;for(var t=0;t<e.productVariantsBeans.length;t++){var r=e.productVariantsBeans[t];r.variantAttributeName&&(r.productName=r.productName+" "+r.variantAttributeName.replaceAll("/","-"));for(var a=0;a<r.printCount;a++)o.layoutproduct={},o.layoutproduct.id=a,o.layoutproduct.productName=r.productName,o.layoutproduct.sku=r.sku,o.layoutproduct.price=r.netPrice,o.layoutproduct.productNameOnly=r.productName,o.layoutproduct.variantAttributeValue1=r.variantAttributeValue1,o.layoutproduct.variantAttributeValue2=r.variantAttributeValue2,o.layoutproducts.push(o.layoutproduct)}i(function(){JsBarcode(".barcode").init(),o.printLabels=!1,o.printLoading=!1,o.hideCount=!0},1500)},o.hideCount=!1,o.printLabels=function(e){o.printLoading=!0,o.printLabelsProduct.sku=e.sku,o.printLabelsProduct.productName=e.productName,e.variantAttributeName&&(o.printLabelsProduct.productName=o.printLabelsProduct.productName+" "+e.variantAttributeName.replaceAll("/","-")),o.printLabelsProduct.price=e.netPrice;for(var t=0;t<e.printCount;t++)o.layoutproduct={},o.layoutproduct.id=t,o.layoutproduct.productName=o.printLabelsProduct.productName,o.layoutproduct.productNameOnly=e.productName,o.layoutproduct.sku=o.printLabelsProduct.sku,o.layoutproduct.price=o.printLabelsProduct.price,o.layoutproduct.variantAttributeValue1=e.variantAttributeValue1,o.layoutproduct.variantAttributeValue2=e.variantAttributeValue2,o.layoutproducts.push(o.layoutproduct);i(function(){JsBarcode(".barcode").init(),o.printLabels=!1,o.printLoading=!1},1500)},o.printThisElementA4="printThisElement",o.printOptionsA4=!0,o.changePrinter=function(){"A4"==o.printOptions?(o.printOptionsA4=!0,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="printThisElement",o.printThisElementContinous="",o.printThisElementContinousLarge="",o.printThisElementContinousNew="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"Continous"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!0,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinous="printThisElement",o.printThisElementContinousLarge="",o.printThisElementContinousNew="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"ContinousNew"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!0,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinousNew="printThisElement",o.printThisElementContinousLarge="",o.printThisElementContinous="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"ContinousLarge"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!0,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinous="",o.printThisElementContinousLarge="printThisElement",o.printThisElementContinousNew="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble=""):"ContinousNewZebra"==o.printOptions?(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!0,o.printOptionsContinousDouble=!1,o.printThisElementA4="",o.printThisElementContinousNew="",o.printThisElementContinousLarge="",o.printThisElementContinous="",o.printThisElementContinousNewZebra="printThisElement",o.printThisElementContinousDouble=""):"ContinousDouble"==o.printOptions&&(o.printOptionsA4=!1,o.printOptionsContinous=!1,o.printOptionsContinousLarge=!1,o.printOptionsContinousNew=!1,o.printOptionsContinousNewZebra=!1,o.printOptionsContinousDouble=!0,o.printThisElementA4="",o.printThisElementContinousNew="",o.printThisElementContinousLarge="",o.printThisElementContinous="",o.printThisElementContinousNewZebra="",o.printThisElementContinousDouble="printThisElement")},o.sesssionValidation()}],ProductPriceHistoryController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","ProductPriceHistoryControllerPreLoad",function(e,t,r,a,o,s,n,i){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,e.roledId=o.get("_s_tk_rId"),e.dataLoading=!1,e.sessionValidation=function(){n.validate()&&(e._s_tk_com=o.get("_s_tk_com"),e.productName=o.get("_e_cPiN_gra"),e.data=i.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found",e.dataLoading=!0):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy,e.dataLoading=!0):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=e.data&&(e.productPriceHistoryList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,pageLength:10,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:s.buttonsView})},1)),e.dataLoading=!0),s.globalPageLoader=!1},e.sessionValidation()}],ProductsController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","ProductsControllerPreLoad",function(r,e,t,a,o,s,n,i){function c(e){if("undefined"!=r.comparisonProductsList&&null!=r.comparisonProductsList&&0<r.comparisonProductsList.length)for(var t=0;t<r.comparisonProductsList.length;t++)if(r.comparisonProductsList[t].productId==e.productId)return!0;return!1}s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.gui={},r.gui.showProductPriceHistory=!1,r.roledId=o.get("_s_tk_rId"),r.dataLoading=!1,r.addProduct=function(){a.location="/app/#/newProduct"},r.addCompositeProduct=function(){a.location="/app/#/newCompositeProduct"},r.showProduct=function(e){o.put("_d_cPi_gra",e.productId),a.location="/app/#/productDetails"},r.editProduct=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cOi_gra",e.outletId),"true"==e.isComposite?a.location="/app/#/manageCompositeProduct":a.location="/app/#/manageProduct"},r.showProductPriceHistory=function(e){o.put("_e_cPi_gra",e.productId),o.put("_e_cPiN_gra",e.productName),a.location="/app/#/productPriceHistory"},r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.fetchData())},r.fetchData=function(){i.loadControllerData(),"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(r.productsList=null,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/false").success(function(e){r.data=e.data,null!=r.data.productBeanList&&(r.productsList=r.data.productBeanList),null!=r.data.showProductPriceHistory&&("true"==r.data.showProductPriceHistory?r.gui.showProductPriceHistory=!0:r.gui.showProductPriceHistory=!1),r.comparisonProductsList=r.data.productBeanList,r.lodAllProductsAsynchrnously(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,pageLength:5,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:s.buttonsView})},1),r.dataLoading=!0}).error(function(){a.location="/app/#/login"}),r.lodAllProductsGraph()),s.globalPageLoader=!1},r.lodAllProductsGraph=function(){r.dataLoading=!1,e.post("products/getProductDashBoard/"+o.get("_s_tk_com")).success(function(e){r.data=e.data,r.chartCustomerCount=new CanvasJS.Chart("chartContainerProductCount",{theme:"theme1",height:150,axisY:{labelFontSize:10},axisX:{labelFontSize:10,labelAngle:-45},data:[{type:"area",color:"rgba(40,175,101,0.6)",dataPoints:r.data.dataPointsCustomerCount}]}),r.chartCustomerCount.render(),r.dataLoadingGraph=!0}).error(function(){})},r.lodAllProductsAsynchrnously=function(){r.dataLoading=!1,e.post("products/getAllProducts/"+o.get("_s_tk_com")+"/true").success(function(e){r.data=e.data,r.dataLoading=!0}).error(function(){a.location="/app/#/login"})},r.lodAllProducts=function(){r.dataLoading=!1;for(var e=0;e<r.data.productBeanList.length;e++)c(r.data.productBeanList[e])||r.productsList.push(r.data.productBeanList[e]);var t=$("#myTable").DataTable();t&&t.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,pageLength:5,bInfo:!0,dom:"Bfrtip",buttons:s.buttonsView})},1),r.dataLoading=!0},r.autoCompleteOptionsProducts={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),r.Product=[],_.filter(r.data.productBeanList,function(e){if(e.productName)return e.productName.toLowerCase().includes(t)||e.brandName.toLowerCase().includes(t)||e.createdDate.toLowerCase().includes(t)})},renderItem:function(e){return{value:e.productName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 30%'>"+e.productName+"</td><td style='width: 20%'>"+e.createdDate+"</td><td style='width: 10%'>"+e.brandName+"</td><td style='width: 10%'>"+e.supplierName+"</td><td style='width: 10%'>"+e.varinatsCount+"</td><td style='width: 10%'>"+e.netPrice+"</td><td style='width: 10%'>"+e.inventoryCount+"</td></tr></tbody></table>")}},itemSelected:function(e){r.selectedItem=e,r.CustomerName=r.selectedItem,r.showProduct(r.selectedItem.item)}},r.sessionValidation()}],ProductStockHistoryReportController=["$scope","$http","$sce","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","ProductStockHistoryReportControllerPreLoad",function(a,r,t,o,s,e,n,i,c,l,u,d){e.MainSideBarhideit=!1,e.MainHeaderideit=!1,a.productStockHistoryReportSuccess=!1,a.productStockHistoryReportError=!1,a.productStockHistoryReportError=!1,a.productStockHistoryReportBean={},a.productBean={},a.productVariantSelList=[],a.productVariantBeansList=[],a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[];var p={buttons:[{extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}},B=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=B,a.sessionValidation=function(){n.validate()&&(a._s_tk_com=s.get("_s_tk_com"),a.data=d.loadControllerData(),a.fetchData())},a.fetchData=function(){if(a.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=a.data.productVariantBeansList&&(a.productVariantBeansList=a.data.productVariantBeansList),null!=a.data.productBeansList){a.productBeansList=a.data.productBeansList;for(var e=0;e<a.productVariantBeansList.length;e++)a.productBeansList.push(a.productVariantBeansList[e])}a.stockOrder=!0,a.stockTransfer=!0,a.stockReturn=!0,a.stockReturnToWarehouse=!0}a.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.checkProductStatus()}),a.changeReportDataType=function(){a.productStockHistoryReportType=a.reportType},a.changeOutletName=function(){a.inventoryReportOutletName=a.outletName},a.checkProductStatus=function(){if(null!=a.productVariantBean)if("true"==a.productVariantBean.isVariant.toString())a.productVariantSelList.push(a.productVariantBean),a.fetchProductStockHistoryReportByDateRange();else{if(a.hit=0,"true"==a.productVariantBean.isProduct.toString())a.productVariantSelList.push(a.productVariantBean),a.fetchProductStockHistoryReportByDateRange(),a.hit++;else{for(var e=0;e<a.productVariantBeansList.length;e++){var t=null;a.productVariantBean.productVariantId==a.productVariantBeansList[e].productId&&(t=angular.copy(a.productVariantBean),a.productVariantBean=angular.copy(a.productVariantBeansList[e]),a.productVariantSelList.push(a.productVariantBean),a.productVariantBean=angular.copy(t),a.hit++)}a.fetchProductStockHistoryReportByDateRange()}a.hit<1&&(a.productVariantBean.isProduct="true",a.fetchProductStockHistoryReportByDateRange())}},a.fetchProductStockHistoryReportByDateRange=function(){if(0<a.productVariantSelList.length&&null!=a.productStockHistoryReportType&&""!=a.productStockHistoryReportType){a.productStockHistoryReportSuccess=!1,a.productStockHistoryReportError=!1,a.loading=!0;var e,t=a.dateRange.split("-");if(a.productStockHistoryReportStartDate=t[0].trim(),a.productStockHistoryReportEndDate=t[1].trim(),a.productBean.totalReceived=0,a.productBean.totalReturn=0,a.productBean.totalTransfered=0,a.productBean.totalRtw=0,a.productBean.totalItems=0,a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[],0==a.stockOrderDetailBeansList.length)(e=$("#myTable").DataTable())&&e.destroy();if(0==a.stockOrderDetailBeansList1.length)(e=$("#myTable2").DataTable())&&e.destroy();if(0==a.stockOrderDetailBeansList2.length)(e=$("#myTable1").DataTable())&&e.destroy();if(0==a.stockOrderDetailBeansList3.length)(e=$("#myTable3").DataTable())&&e.destroy();r.post("productStockHistoryReport/getProductStockHistoryReportByDateRange/"+s.get("_s_tk_com")+"/"+a.productStockHistoryReportStartDate+"/"+a.productStockHistoryReportEndDate+"/"+a.productStockHistoryReportType,a.productVariantSelList).success(function(e){0==a.stockOrderDetailBeansList.length&&(r=$("#myTable").DataTable())&&r.destroy();0==a.stockOrderDetailBeansList1.length&&(r=$("#myTable2").DataTable())&&r.destroy();0==a.stockOrderDetailBeansList2.length&&(r=$("#myTable1").DataTable())&&r.destroy();0==a.stockOrderDetailBeansList3.length&&(r=$("#myTable3").DataTable())&&r.destroy();if("1"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList=e.data,a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[],null!=a.stockOrderDetailBeansList)for(var t=0;t<a.stockOrderDetailBeansList.length;t++)a.productBean.totalReceived=parseInt(a.productBean.totalReceived)+parseInt(a.stockOrderDetailBeansList[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList[t].recvProdQty);a.stockOrder=!1,a.stockTransfer=!0,a.stockReturn=!0,a.stockReturnToWarehouse=!0,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}else if("2"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList1=e.data,a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList3=[],null!=a.stockOrderDetailBeansList1)for(t=0;t<a.stockOrderDetailBeansList1.length;t++)a.productBean.totalReturn=parseInt(a.productBean.totalReturn)+parseInt(a.stockOrderDetailBeansList1[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList1[t].orderProdQty);a.stockOrder=!0,a.stockReturn=!1,a.stockTransfer=!0,a.stockReturnToWarehouse=!0,(r=$("#myTable2").DataTable())&&r.destroy(),setTimeout(function(){$("#myTable2").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}else if("3"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList2=e.data,a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList=[],a.stockOrderDetailBeansList3=[],null!=a.stockOrderDetailBeansList2)for(t=0;t<a.stockOrderDetailBeansList2.length;t++)a.productBean.totalTransfered=parseInt(a.productBean.totalTransfered)+parseInt(a.stockOrderDetailBeansList2[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList2[t].orderProdQty);a.stockOrder=!0,a.stockReturn=!0,a.stockTransfer=!1,a.stockReturnToWarehouse=!0,(r=$("#myTable1").DataTable())&&r.destroy(),setTimeout(function(){$("#myTable1").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}else if("4"==a.productStockHistoryReportType){if(a.stockOrderDetailBeansList3=e.data,a.stockOrderDetailBeansList1=[],a.stockOrderDetailBeansList2=[],a.stockOrderDetailBeansList=[],null!=a.stockOrderDetailBeansList3)for(t=0;t<a.stockOrderDetailBeansList3.length;t++)a.productBean.totalRtw=parseInt(a.productBean.totalRtw)+parseInt(a.stockOrderDetailBeansList3[t].total),a.productBean.totalItems=parseInt(a.productBean.totalItems)+parseInt(a.stockOrderDetailBeansList3[t].orderProdQty);var r;a.stockOrder=!0,a.stockReturn=!0,a.stockTransfer=!0,a.stockReturnToWarehouse=!1,(r=$("#myTable3").DataTable())&&r.destroy(),setTimeout(function(){$("#myTable3").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0,dom:"Bfrtip",buttons:p})},10)}a.loading=!1,a.productVariantSelList=[],a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?a.success=!0:"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,o.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){a.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})}},a.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),a.productVariantsBeans=[];var e=_.filter(a.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(a.productBeansList,function(e){return e.sku.toLowerCase()==t});return r&&0<r.length&&(a.productVariantBean=r[0],a.checkProductStatus(),a.selectedItem={},a.selectedItem.item=r[0]),e},renderItem:function(e){return{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}},itemSelected:function(e){a.productVariantBean=e.item}},a.sessionValidation()}],ProductTagsController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","ProductTagsControllerPreLoad",function(t,r,a,e,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.tagSuccess=!1,t.tagError=!1,t.tagBean={},t.tagList=[],t.sessionValidation=function(){i.validate()&&(t._s_tk_com=e.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.productTagsLoadedFully=!1,"NORECORDFOUND"==t.data||"No record found !"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=t.data&&(t.tagList=t.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},t.showAddTagPopup=function(){t.tagBean={},t.showNewTagModal=!0},t.addTag=function(){t.tagSuccess=!1,t.tagError=!1,t.loading=!0;for(var e=0;e<t.tagList.length;e++)if(t.tagList[e].tagName.toLowerCase()==t.tagBean.tagName.toLowerCase())return t.tagError=!0,t.tagErrorMessage="Tag already exist with name: "+t.tagBean.tagName,t.showNewTagModal=!1,t.loading=!1,void s(function(){t.tagError=!1},2e3);r.post("productTags/addTag/"+t._s_tk_com,t.tagBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.tagBean={},t.tagSuccess=!0,t.tagSuccessMessage="Request Processed Successfully!",t.showNewTagModal=!1,s(function(){t.tagSuccess=!1,s(function(){n.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.tagError=!0,t.tagErrorMessage=e.data,a.location=e.layOutPath):(t.tagError=!0,t.tagErrorMessage=e.data)}).error(function(){t.loading=!1,t.tagError=!0,t.tagErrorMessage=t.systemBusy})},t.showUpdateTagPopup=function(e){t.updateTagBean={},t.updateTagBean=angular.copy(e),t.showUpdateTagModal=!0},t.updateTag=function(){t.tagSuccess=!1,t.tagError=!1,t.loading=!0;for(var e=0;e<t.tagList.length;e++)if(t.tagList[e].tagName.toLowerCase()==t.updateTagBean.tagName.toLowerCase())return t.tagError=!0,t.tagErrorMessage="Tag already exist with name: "+t.updateTagBean.tagName,t.showUpdateTagModal=!1,t.loading=!1,void s(function(){t.tagError=!1},2e3);r.post("productTags/updateTag/"+t._s_tk_com,t.updateTagBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updateTagBean={},t.tagSuccess=!0,t.tagSuccessMessage=e.data,t.showUpdateTagModal=!1,s(function(){t.tagSuccess=!1,s(function(){n.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.tagError=!0,t.tagErrorMessage=e.data,a.location=e.layOutPath):(t.tagError=!0,t.tagErrorMessage=e.data)}).error(function(){t.loading=!1,t.tagError=!0,t.tagErrorMessage=t.systemBusy})},t.fetchAllTags=function(){r.post("productTags/getAllTags/"+t._s_tk_com).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.tagList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,a.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){o.emergencyInfoLoadedFully=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sessionValidation()}],ProductTypeController=["$scope","$http","$timeout","$route","$window","$cookieStore","$rootScope","SessionService","ProductTypeControllerPreLoad",function(t,e,r,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,t.showAddProducTypeModal=!1,t.showUpdateProductTypeModal=!1,t.productTypeBean={},t.sessionValidation=function(){i.validate()&&(t._s_tk_com=s.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){n.productTypeLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",o.location="/app/#/login"):null!=t.data&&(t.productTypeList=t.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),n.globalPageLoader=!1},t.showAddProductTypePopup=function(){t.productTypeBean={},t.showAddProducTypeModal=!0},t.addProductType=function(){t.productTypeSuccess=!1,t.productTypeError=!1,t.loading=!0,e.post("productType/addProductType/"+t._s_tk_com,t.productTypeBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.productTypeBean={},t.productTypeSuccess=!0,t.productTypeSuccessMessage="Request Processed successfully!",t.showAddProducTypeModal=!1,r(function(){t.productTypeSuccess=!1,r(function(){a.reload()},500)},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.productTypeError=!0,t.productTypeErrorMessage=e.data,o.location=e.layOutPath):(t.productTypeError=!0,t.productTypeErrorMessage=e.data)}).error(function(){t.loading=!1,t.productTypeError=!0,t.productTypeErrorMessage=t.systemBusy})},t.showUpdateProductTypePopup=function(e){t.updateProductTypeBean={},t.updateProductTypeBean=angular.copy(e),t.showUpdateProductTypeModal=!0},t.updateProductType=function(){t.productTypeSuccess=!1,t.productTypeError=!1,t.loading=!0,e.post("productType/updateProductType/"+t._s_tk_com,t.updateProductTypeBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.updateProductTypeBean={},t.productTypeSuccess=!0,t.productTypeSuccessMessage=e.data,t.showUpdateProductTypeModal=!1,r(function(){t.productTypeSuccess=!1,r(function(){a.reload()},500)},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.productTypeError=!0,t.productTypeErrorMessage=e.data,o.location=e.layOutPath):(t.productTypeError=!0,t.productTypeErrorMessage=e.data)}).error(function(){t.loading=!1,t.productTypeError=!0,t.productTypeErrorMessage=t.systemBusy})},t.sessionValidation()}],ProductTypeSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","ProductTypeSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],PurchaseOrderActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","PurchaseOrderActionsControllerPreLoad",function(r,e,a,t,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.disableProcess=!1,r.showConfirmCancelPopup=!1,r.stockOrderDetailBeansList=[],r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.stockOrderBean=o.get("_ct_bl_ost"),r.data=c.loadControllerData(),r.fetchData(),"3"!=r.stockOrderBean.statusId&&"8"!=r.stockOrderBean.statusId||(r.disableProcess=!0),r.isAdmin(),r.stockOrderBean.itemCount=0,r.stockOrderBean.recItemCount=0,r.calculateItemCount(),r.calculateRecItemCount(),r.calculateGrandrecvTotal())},r.fetchData=function(){if(n.purchaseOrderActionsLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=r.data){"No record found !"!=r.data&&(r.stockOrderDetailBeansList=r.data,r.calculateGrandTotal());var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+r.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Order from: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.supplierName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delievr to: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+r.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.calculateGrandTotal=function(){if(r.grandTotal="0",0<r.stockOrderDetailBeansList.length)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)isNaN(r.stockOrderDetailBeansList[e].total)&&(r.stockOrderDetailBeansList[e].total="0"),r.grandTotal=parseFloat(r.grandTotal)+parseFloat(r.stockOrderDetailBeansList[e].total),isNaN(r.grandTotal)&&(r.grandTotal="0")},r.calculateGrandrecvTotal=function(){if(r.grandrecvTotal="0",0<r.stockOrderDetailBeansList.length)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)isNaN(r.stockOrderDetailBeansList[e].recvTotal)&&(r.stockOrderDetailBeansList[e].recvTotal="0"),r.grandrecvTotal=parseFloat(r.grandrecvTotal)+parseFloat(r.stockOrderDetailBeansList[e].recvTotal),isNaN(r.grandrecvTotal)&&(r.grandrecvTotal="0")},r.calculateItemCount=function(){if(r.stockOrderBean.itemCount=0,null!=r.stockOrderDetailBeansList)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)r.stockOrderBean.itemCount=parseInt(r.stockOrderBean.itemCount)+parseInt(r.stockOrderDetailBeansList[e].orderProdQty),isNaN(r.stockOrderBean.itemCount)&&(r.stockOrderBean.itemCount="0")},r.calculateRecItemCount=function(){if(r.stockOrderBean.recItemCount=0,null!=r.stockOrderDetailBeansList)for(var e=0;e<r.stockOrderDetailBeansList.length;e++)r.stockOrderBean.recItemCount=parseInt(r.stockOrderBean.recItemCount)+parseInt(r.stockOrderDetailBeansList[e].recvProdQty),isNaN(r.stockOrderBean.recItemCount)&&(r.stockOrderBean.recItemCount="0")},r.showCancelStockOrder=function(){r.showConfirmCancelPopup=!0},r.cancelStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="8",r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,r.showConfirmCancelPopup=!1,t(function(){r.success=!1,a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.purchaseOrderReceive=function(){a.location="/app/#/poCreateandReceiveEdit"},r.purchaseOrderEditProducts=function(){a.location="/app/#/purchaseOrderEditProducts"},r.purchaseOrderEditDetails=function(){a.location="/app/#/poCreateandReceiveEdit"},r.sessionValidation(),n.globalPageLoader=!1}],PurchaseOrderController=["$scope","$filter","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","PurchaseOrderControllerPreLoad",function(r,e,t,a,o,s,n,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=e("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="PO-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.data=c.loadControllerData(),r.fetchData(),r.stockOrderBean.outletId=r.userOutletId)},r.fetchData=function(){s.purchaseOrderLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),s.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="1",t.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,n(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],PurchaseOrderDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderDetailsControllerPreLoad",function(t,s,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.hideRefValues=!1,s.counter=1,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.data=c.loadControllerData(),s.fetchData(),s.stockOrderBean=o.get("_e_cOt_pio");var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},s.fetchData=function(){if(n.purchaseOrderDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data&&(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList)){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}n.globalPageLoader=!1},s.addProduct=function(){s.dualEntry=!1;var a={},o=JSON.parse(s.productVariantBean);0<s.stockOrderDetailBeansList.length?("true"!=o.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"!=e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(a),s.arrangeOrder(),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(a),s.arrangeOrder(),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=o.productVariantId,s.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,s.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=o.productVariantId,s.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,s.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={}},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.arrangeOrder()},s.arrangeOrder=function(){if(s.counter=1,0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++},s.calculateTotal=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"))})},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},s.addStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),r(function(){s.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.sessionValidation()}],PurchaseOrderEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderEditDetailsControllerPreLoad",function(r,e,t,a,o,s,n,i){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.data=i.loadControllerData(),r.fetchData(),r.stockOrderBean=o.get("_ct_bl_ost"),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate))},r.fetchData=function(){s.purchaseOrderEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),s.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="1",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],PurchaseOrderEditProductsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderEditProductsControllerPreLoad",function(s,e,t,r,o,a,n,i){a.MainSideBarhideit=!1,a.MainHeaderideit=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.hideRefValues=!1,s.sessionValidation=function(){if(n.validate()){s._s_tk_com=o.get("_s_tk_com"),s.data=i.loadControllerData(),s.fetchData(),s.stockOrderBean=o.get("_ct_bl_ost");var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},s.fetchData=function(){a.purchaseOrderEditProductsLoadedFully=!1,"NORECORDFOUND"==s.data?(s.error=!0,s.errorMessage="No record found"):"SYSTEMBUSY"==s.data?(s.error=!0,s.errorMessage=s.systemBusy):"INVALIDSESSION"==s.data?(s.error=!0,s.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=s.data.stockOrderDetailBeansList&&(s.stockOrderDetailBeansList=s.data.stockOrderDetailBeansList,s.arrangeOrder()),null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList)),a.globalPageLoader=!1},s.addProduct=function(){s.dualEntry=!1;var a={},o=JSON.parse(s.productVariantBean);0<s.stockOrderDetailBeansList.length?("true"!=o.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"!=e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(a),s.arrangeOrder(),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(a),s.arrangeOrder(),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=o.productVariantId,s.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,s.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=o.productVariantId,s.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,s.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={}},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.arrangeOrder()},s.arrangeOrder=function(){if(s.counter=1,0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++},s.calculateTotal=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"))})},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},s.updateStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,o.put("_e_cOt_pio",""),t(function(){s.success=!1},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,r.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){a.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.sessionValidation()}],PurchaseOrderReceiveController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","PurchaseOrderReceiveControllerPreLoad",function(s,t,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.counter=1,s.hideRefValues=!1,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.data=c.loadControllerData(),s.fetchData(),s.stockOrderBean=o.get("_ct_bl_ost");var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}s.grandTotal="0"},s.fetchData=function(){if(n.purchaseOrderReceiveLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}null!=s.data.outletBeansList&&(s.outletList=s.data.outletBeansList),null!=s.data.stockOrderTypeBeansList&&(s.stockOrderTypeBeansList=s.data.stockOrderTypeBeansList),null!=s.data.supplierBeansList&&(s.supplierList=s.data.supplierBeansList),null!=s.data.stockOrderDetailBeansList&&(s.stockOrderDetailBeansList=s.data.stockOrderDetailBeansList,s.arrangeOrder(),s.calculateGrandTotal())}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}},s.addProduct=function(){s.dualEntry=!1;var a={},o=s.productVariantBean;0<s.stockOrderDetailBeansList.length?("true"!=o.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"!=e.isProduct&&"true"!=o.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(a),s.arrangeOrder(),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==o.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",a=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(a),s.arrangeOrder(),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=o.productVariantId,s.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,s.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=o.productVariantId,s.stockOrderDetailBean.variantAttributeName=o.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=o.currentInventory,s.stockOrderDetailBean.isProduct=o.isProduct,null!=o.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(o.supplyPriceExclTax)),s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.calculateItemCount(),s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.arrangeOrder(),s.calculateGrandTotal(),s.calculateItemCount(),s.calculateRecItemCount()},s.arrangeOrder=function(){if(s.counter=1,0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++},s.calculateTotal=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"))}),s.calculateItemCount()},s.calculateItemCount=function(){if(s.stockOrderBean.itemCount=0,null!=s.stockOrderDetailBeansList)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0")},s.calculateRecItemCount=function(){if(s.stockOrderBean.recItemCount=0,null!=s.stockOrderDetailBeansList)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderBean.recItemCount=parseInt(s.stockOrderBean.recItemCount)+parseInt(s.stockOrderDetailBeansList[e].recvProdQty),isNaN(s.stockOrderBean.recItemCount)&&(s.stockOrderBean.recItemCount="0")},s.calculateRecvTotal=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(e.recvTotal=e.recvSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"))}),s.calculateGrandTotal()},s.calculateGrandTotal=function(){if(s.grandTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)isNaN(s.stockOrderDetailBeansList[e].recvTotal)&&(s.stockOrderDetailBeansList[e].recvTotal="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].recvTotal),isNaN(s.grandTotal)&&(s.grandTotal="0");s.calculateRecItemCount()},s.checkStockOrderDetailListforRec=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].recvProdQty||null==s.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].recvSupplyPrice||null==s.stockOrderDetailBeansList[e].recvSupplyPrice)return!1}return!0}return!1},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1}return!0}return!1},s.markAllReceive=function(){if(0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].recvProdQty="",s.stockOrderDetailBeansList[e].recvProdQty=angular.copy(s.stockOrderDetailBeansList[e].orderProdQty),s.stockOrderDetailBeansList[e].recvSupplyPrice="",s.stockOrderDetailBeansList[e].recvSupplyPrice=angular.copy(s.stockOrderDetailBeansList[e].ordrSupplyPrice),s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].recvSupplyPrice*s.stockOrderDetailBeansList[e].recvProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0");s.calculateGrandTotal()},s.updateStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,r(function(){s.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.showConfirmReceiveStockOrder=function(){s.showConfirmReceivePopup=!0},s.updateAndReceiveStockOrderDetails=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateAndReceiveStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,s.showConfirmReceivePopup=!1,o.put("_e_cOt_pio",""),r(function(){s.success=!1,a.location=e.layOutPath},2e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.sessionValidation()}],RegisterCloseController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RegisterCloseControllerPreLoad","$timeout","$route",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.registerOpen=!1,t.sesssionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.controllerBean=n.loadControllerData(),"No record found !"==t.controllerBean?t.registerOpen=!0:(t.dailyRegisterBean=t.controllerBean.dailyRegisterBean,t.cashManagmenBeans=t.controllerBean.cashManagmenBeans,t.lastDayilyRegisterExist=t.controllerBean.lastDayilyRegisterExist,t.registerOpen=!t.controllerBean.openDayilyRegisterExist,o.registerCloseLoadedFully=!1),o.globalPageLoader=!1)},t.closeRegister=function(){t.success=!1,t.error=!1,t.loading=!0,e.post("registerClose/closeRegister/"+t._s_tk_com,t.dailyRegisterBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success=!0,t.success=!0,t.successMessage=e.data,i(function(){t.success=!1,c.reload()},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.openRegister=function(){t.success=!1,t.error=!1,t.loadingOpenRegister=!0,e.post("sell/openRegister/"+t._s_tk_com).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.successOpen=!0,t.registerOpen=!1,t.loadingOpenRegister=!1,t.successMessage=e.data,i(function(){t.successOpen=!1,t.showCashModal=!0},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sesssionValidation(),t.cashManagmentBean={},t.cashManagmentBean.cashType="Cash",t.cashManagmentBean.cashManagmentType="IN",t.cashManagmentBean.notes="Opening float",t.cashInOut=function(){t.addCashProcessingButton=!0,e.post("cashManagement/cashInOut/"+t._s_tk_com,t.cashManagmentBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.showCashModal=!1,t.cashManagmentList=e.data,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.error=!0,t.errorMessage=t.systemBusy})}}],RegisterController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","RegisterControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.registerSuccess=!1,t.registerError=!1,t.registerBean={},t.outletBean={},t.systemBusy="System is Busy Please try again",t._s_tk_com=a.get("_s_tk_com"),t.cashManagement={value:"No"},t.userNextSale={value:"No"},t.receiptEmail={value:"No"},t.receiptPrint={value:"Yes"},t.receiptPrintNotes={value:"No"},t.discountsOnReceipt={value:"Yes"},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),o.registerLoadedFully=!1,t.outletBean=t.data)},t.addRegister=function(){t.registerSuccess=!1,t.registerError=!1,t.loading=!0,t.registerBean.outletId=t.outletBean.outletId,t.registerBean.cacheManagementEnable=t.cashManagement.value,t.registerBean.selectNextUserForSale=t.userNextSale.value,t.registerBean.emailReceipt=t.receiptEmail.value,t.registerBean.printReceipt=t.receiptPrint.value,t.registerBean.printNotesOnReceipt=t.receiptPrintNotes.value,t.registerBean.showDiscountOnReceipt=t.discountsOnReceipt.value,e.post("register/addRegister/"+t._s_tk_com,t.registerBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.registerSuccess=!0,t.registerSuccessMessage=e.data,s(function(){t.registerSuccess=!1,r.location=e.layOutPath},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.registerError=!0,t.registerErrorMessage=e.data,r.location=e.layOutPath):(t.registerError=!0,t.registerErrorMessage=e.data)}).error(function(){t.loading=!1,t.registerError=!0,t.registerErrorMessage=t.systemBusy})},t.sessionValidation(),o.globalPageLoader=!1}],RegisterDetailController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RegisterDetailControllerPreLoad","$timeout","$route",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.registerOpen=!1,t.sesssionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.controllerBean=n.loadControllerData(),"No record found !"==t.controllerBean?t.registerOpen=!0:(t.dailyRegisterBean=t.controllerBean.dailyRegisterBean,t.cashManagmenBeans=t.controllerBean.cashManagmenBeans,t.lastDayilyRegisterExist=t.controllerBean.lastDayilyRegisterExist,t.registerOpen=!t.controllerBean.openDayilyRegisterExist,o.registerCloseLoadedFully=!1),o.globalPageLoader=!1)},t.closeRegister=function(){t.success=!1,t.error=!1,t.loading=!0,e.post("registerClose/closeRegister/"+t._s_tk_com,t.dailyRegisterBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.success=!0,t.success=!0,t.successMessage=e.data,i(function(){t.success=!1,c.reload()},1500)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.openRegister=function(){t.success=!1,t.error=!1,t.loadingOpenRegister=!0,e.post("sell/openRegister/"+t._s_tk_com).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.successOpen=!0,t.registerOpen=!1,t.loadingOpenRegister=!1,t.successMessage=e.data,i(function(){t.successOpen=!1,t.showCashModal=!0},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.loading=!1,t.error=!0,t.errorMessage=t.systemBusy})},t.sesssionValidation(),t.cashManagmentBean={},t.cashManagmentBean.cashType="Cash",t.cashManagmentBean.cashManagmentType="IN",t.cashManagmentBean.notes="Opening float",t.cashInOut=function(){t.addCashProcessingButton=!0,e.post("cashManagement/cashInOut/"+t._s_tk_com,t.cashManagmentBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.showCashModal=!1,t.cashManagmentList=e.data,t.addCashProcessingButton=!1,t.removeCashProcessingButton=!1,i(function(){c.reload()},1e3)):"SYSTEMBUSY"==t.responseStatus||"INVALIDUSER"==t.responseStatus||"ERROR"==t.responseStatus||"INVALIDSESSION"==t.responseStatus?(t.error=!0,t.errorMessage=e.data,r.location=e.layOutPath):(t.error=!0,t.errorMessage=e.data)}).error(function(){t.error=!0,t.errorMessage=t.systemBusy})}}],RegisterReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","RegisterReportControllerPreLoad",function(e,t,r,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.inventoryReportSuccess=!1,e.inventoryReportError=!1,e.inventoryReportError=!1,e.isHeadOffice=!1,e.registerReport=[],e.outlets=[],e.outletSelected=o.inventoryReportOutletName,e.sesssionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=u.loadControllerData(),e.fetchData())},e.fetchData=function(){"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(null!=e.data.registerReportBeansList&&(e.registerReport=e.data.registerReportBeansList),null!=e.data.outletBeans&&(e.outlets=e.data.outletBeans),null!=e.data.headOffice&&(e.isHeadOffice=e.data.headOffice)),o.globalPageLoader=!1},e.changeOutletName=function(){o.inventoryReportOutletName=e.outletName,c.reload()},e.showRegisterDetail=function(e){a.put("_d_Ri_gra",e.dailyRegisterId),r.location="/app/#/registerDetail"},e.sesssionValidation()}],RoleDetailsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RoleDetailsControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){o.roleDetailsLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data&&(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"),o.globalPageLoader=!1},e.sessionValidation()}],RolesController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","RolesControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,s.validate(),e.roleDetails=function(e){a.put("_m_rd_gra",e),r.location="/app/#/manageRole"},e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){o.rolesLoadedFully=!1,"NORECORDFOUND"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.rolesList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.sessionValidation()}],SalesDetailReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesDetailReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],SalesLedgerController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","SalesLedgerControllerPreLoad",function(e,t,r,a,o,s,n,i,c,l){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.sesssionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),l.loadControllerData(),o.globalPageLoader=!1)},e.sesssionValidation(),e.LoadAllSales=function(){o.limit=0,c.reload()}}],SalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesReportControllerPreLoad",function(a,e,t,r,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.salesReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),s.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.salesReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],SalesReportWithOutSaleController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesReportWithOutSaleControllerPreLoad",function(a,e,t,r,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.salesReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),s.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.salesReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],SalesReportWithSaleController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SalesReportWithSaleControllerPreLoad",function(a,e,t,r,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,a.salesReportSuccess=!1,a.salesReportError=!1,a.salesReportError=!1,a.salesReportBean={},a.outlets=[],a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1,a.reportTypeSelect=o.salesReportType,a.outletSelected=o.inventoryReportOutletName,a.sesssionValidation=function(){"weekly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox2=!0):"monthly"==o.salesReportDateType?(a.checkbox1=!1,a.checkbox3=!0):"yearly"==o.salesReportDateType&&(a.checkbox1=!1,a.checkbox4=!0),s.validate()&&(a._s_tk_com=r.get("_s_tk_com"),a.data=u.loadControllerData(),a.fetchData())},a.fetchData=function(){"NORECORDFOUND"==a.data||"No record found !"==a.data?(a.error=!0,a.errorMessage="No record found"):"SYSTEMBUSY"==a.data?(a.error=!0,a.errorMessage=a.systemBusy):"INVALIDSESSION"==a.data?(a.error=!0,a.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=a.data&&(null!=a.data.tableData&&(a.salesReport=a.data.tableData),null!=a.data.outletBeans&&(a.outlets=a.data.outletBeans),a.hideSalesDetails=a.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t,a.$apply(),a.fetchSalesReportByDateRange()}),a.changeReportDataType=function(){o.salesReportType=a.reportType,c.reload()},a.changeOutletName=function(){o.inventoryReportOutletName=a.outletName,c.reload()},a.fetchSalesReportByDateRange=function(){a.salesReportSuccess=!1,a.salesReportError=!1,a.loading=!0;var e=a.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},a.changeReportType=function(e){var t=document.getElementById("reportrange").innerText;a.dateRange="",a.dateRange=t;var r=a.dateRange.split("-");"Daily"==e?(a.checkbox1=!0,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!1):"Weekly"==e?(a.checkbox1=!1,a.checkbox2=!0,a.checkbox3=!1,a.checkbox4=!1):"Monthly"==e?(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!0,a.checkbox4=!1):"Yearly"==e&&(a.checkbox1=!1,a.checkbox2=!1,a.checkbox3=!1,a.checkbox4=!0),o.salesReportStartDate=r[0].trim(),o.salesReportEndDate=r[1].trim(),o.salesReportDateType=e,c.reload()},a.sesssionValidation()}],SalesTaxController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","SalesTaxControllerPreLoad",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.showAddSalesTaxModal=!1,t.showUpdateSalesTaxModal=!1,t.salesTaxSuccess=!1,t.salesTaxError=!1,t.salesTaxBean={},t.updateSalesTax={},t.roledId=a.get("_s_tk_rId"),t.systemBusy="System is Busy Please try again",t.sessionValidation=function(){i.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.salesTaxLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(null!=t.data.salesTaxListBeans&&(t.salesTaxList=t.data.salesTaxListBeans),null!=t.data.outletBeans&&(t.outletsList=t.data.outletBeans,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!1,searching:!1,bInfo:!1})},10))),o.globalPageLoader=!1},t.showModalForAddSalesTax=function(){t.showAddSalesTaxModal=!0},t.showModalForUpdateSalesTax=function(e){t.updateSalesTax=angular.copy(e),t.showUpdateSalesTaxModal=!0},t.addSalesTax=function(){t.salesTaxSuccess=!1,t.salesTaxError=!1,t.loading=!0,e.post("salesTax/addSalesTax/"+t._s_tk_com,t.salesTaxBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.salesTaxSuccess=!0,t.salesTaxSuccessMessage=e.data,t.showAddSalesTaxModal=!1,s(function(){t.salesTaxSuccess=!1,s(function(){n.reload()},500)},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data,r.location=e.layOutPath):(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data)}).error(function(){t.loading=!1,t.salesTaxError=!0,t.salesTaxErrorMessage=t.systemBusy})},t.editSalesTax=function(){t.salesTaxSuccess=!1,t.salesTaxError=!1,t.loading=!0,e.post("salesTax/updateSalesTax/"+t._s_tk_com,t.updateSalesTax).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companyBean={},t.salesTaxSuccess=!0,t.salesTaxSuccessMessage=e.data,t.showUpdateSalesTaxModal=!1,s(function(){t.salesTaxSuccess=!1,r.location=e.layOutPath,s(function(){n.reload()},500)},1e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data,r.location=e.layOutPath):(t.salesTaxError=!0,t.salesTaxErrorMessage=e.data)}).error(function(){t.loading=!1,t.salesTaxError=!0,t.salesTaxErrorMessage=t.systemBusy})},t.editOutlet=function(e){a.put("_e_cOt_gra",e.outletId),r.location="/app/#/manageOutlet"},t.sessionValidation()}],SellController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$sce","SellControllerPreLoad","$route",function(s,n,i,e,c,t,l,r,a,o){s.printReceipt=!0,s.cashloading=!1,s.creditloading=!1,s.laybyloading=!1,s.showPaymentSale=!1,s.readonlyInvoiceDiscount=!1,s.addCustomerProcessingButton=!1,c.MainSideBarhideit=!1,c.MainHeaderideit=!1,s.makePayment=!1,s.parkDiscard=!0,s.changeamount=0,s.parkDiscard=!0,s.showDiscount=!1,s.success=!1,s.error=!1,s.itemDetailDisable=!1,s.returnvalue=parseFloat(1),s.listPayments=[],s.payment={},s.gobackenable=!0,s.InvoiceMainBean={},s.InvoiceMainBean.invoiceDetails=[],s.InvoiceMainBean.invoiceGivenAmt=parseFloat(0),s.InvoiceMainBean.invoiceNetAmt=parseFloat(0),s.InvoiceMainBean.invoiceAmt=parseFloat(0),s.InvoiceMainBean.invoiceTax=parseFloat(0),s.InvoiceMainBean.invoiceSubTotal=parseFloat(0),s.productVaraintDetailBeanList=[],s.pricebook={},s.isReturnEnableonSell=!0,s.totallineItemDiscount=parseFloat(0),s.isInvoiceLevelDiscountEnable=!1,s.isInvoiceDetailLevelDiscountEnable=!0,c.globalPageLoader=!0,s.InvoiceMainBean.itemsCount=parseFloat(0),s.isValidInvoice=!0,s.outletId=e.get("_s_tk_oId"),console.log("$scope.outletId"+s.outletId),Number.prototype.padLeft=function(e,t){var r=String(e||10).length-String(this).length+1;return 0<r?new Array(r).join(t||"0")+this:this};var u=["January","February","March","April","May","June","July","August","September","October","November","December"];s.sesssionValidation=function(){s._s_tk_com=e.get("_s_tk_com"),s.sellControllerBean=a.loadControllerData(),s.getAllProducts(),c.globalPageLoader=!1,s.loadSalesDataAjax()},s.processData=function(t){c.sellLoadedFully=!1,"true"==s.sellControllerBean.isReturnEnableonSell?s.isReturnEnableonSell=!0:s.isReturnEnableonSell=!1,"true"==s.sellControllerBean.isInvoiceLevelDiscountEnable?s.isInvoiceLevelDiscountEnable=!0:s.isInvoiceLevelDiscountEnable=!1,"true"==s.sellControllerBean.isInvoiceDetailLevelDiscountEnable?s.isInvoiceDetailLevelDiscountEnable=!0:s.isInvoiceDetailLevelDiscountEnable=!1,null!=s.sellControllerBean.priceBookBean&&0<s.sellControllerBean.priceBookBean.length?s.pricebook=s.sellControllerBean.priceBookBean[0]:s.pricebook=null,s.allProducts=s.sellControllerBean.productsBean,s.allCustomers=s.sellControllerBean.customersBean,s.allUsers=s.sellControllerBean.users,s.displayProductsBean=s.sellControllerBean.displayProductsBean,s.customerGroupBeansList=s.sellControllerBean.customerGroupBeansList,s.companyName=s.sellControllerBean.companyName,s.companyAddress=s.sellControllerBean.companyAddress,s.outletAddress=s.sellControllerBean.outletAddress,s.phoneNumber=s.sellControllerBean.phoneNumber;for(var e=0;e<s.allProducts.length;e++)if(s.allProducts[e].productVariantsBeans)for(var r=0;r<s.allProducts[e].productVariantsBeans.length;r++)s.productVaraintDetailBeanList.push(s.allProducts[e].productVariantsBeans[r]);s.showProductLayout(),s.invoiceDetails=[],localforage.getItem("_s_tk_sell").then(function(e){e&&(s.InvoiceMainBean=e),localforage.setItem("_s_tk_sell",""),s.InvoiceMainBean&&(s.InvoiceMainBean.settledAmt=s.InvoiceMainBean.settledAmt?s.InvoiceMainBean.settledAmt:0,s.InvoiceMainBean.invoiceGivenAmt=parseFloat(s.InvoiceMainBean.invoiceNetAmt)-parseFloat(s.InvoiceMainBean.settledAmt),s.invoiceDetails=s.InvoiceMainBean.invoiceDetails,s.InvoiceMainBean.customerId&&(s.selectCustomer=!0,s.selectCustomerName=s.InvoiceMainBean.customername,s.InvoiceMainBean.laybyamount=parseFloat(s.InvoiceMainBean.laybyamount))),s.InvoiceMainBean&&"10"==s.InvoiceMainBean.status&&"false"==t&&(s.returnvalue=parseFloat(-1),s.InvoiceMainBean.invoiceGivenAmt=s.returnvalue*parseFloat(s.InvoiceMainBean.invoiceNetAmt),s.itemDetailDisable=!0,s.readonlyInvoiceDiscount=!0),s.InvoiceMainBean&&"9"==s.InvoiceMainBean.status&&(s.itemDetailDisable=!0,s.showPaymentSale=!0,s.readonlyInvoiceDiscount=!0,s.isReturnEnableonSell=!1),s.returnvalue<0&&(s.isReturnEnableonSell=!1),""!=s.InvoiceMainBean&&void 0!==s.InvoiceMainBean||(s.InvoiceMainBean={})}),s.loadingSalePageComplete=!1,c.globalPageLoader=!1},s.loadSalesDataAjax=function(){s.loadingSalePageComplete=!0,c.globalPageLoader=!0,c.online?n.get("sell/getAllProductsOnly/"+s._s_tk_com).success(function(e){s.sellControllerBean=e,localforage.removeItem("allProducts").then(function(){localforage.setItem("allProducts",s.sellControllerBean),console.log("allProducts is cleared!"),s.fetchAllCustomers()}).catch(function(e){console.log(e)}),s.processData("false")}).error(function(e){s.loading=!1,s.error=!0,s.errorMessage=s.systemBusy}):s.processData("false")},s.loadSalesProductDataOnlyAjax=function(){console.log("$scope.loadSalesProductDataOnlyAjax"),c.online?n.get("sell/getAllProductsOnly/"+s._s_tk_com).success(function(e){s.sellControllerBean=e,localforage.removeItem("allProducts").then(function(){localforage.setItem("allProducts",s.sellControllerBean),console.log("allProducts is cleared!")}).catch(function(e){console.log(e)}),s.processData("true")}).error(function(e){s.loading=!1,s.error=!0,s.errorMessage=s.systemBusy}):s.processData("true")},s.systemBusy="System is Busy Please try again",s.parkSale=function(){localforage.setItem("_s_tk_sell",""),i.location="/app/#/salesLedger"},s.showCustomerModal=!1,s.customerModal=function(){s.showCustomerModal=!0,s.searchCustomer=!0},s.createNewCustomerShow=function(){s.searchCustomer=!1},s.discounts=function(){s.showDiscount?s.showDiscount=!1:s.showDiscount=!0},s.layoutProducts=[],s.layoutProduct={},s.showProductLayout=function(){s.layoutProducts=[],s.layoutProduct={};for(var e=0;e<s.displayProductsBean.length;e++)s.layoutProduct={},s.layoutProduct.productName=s.displayProductsBean[e].productName,s.layoutProduct.productId=s.displayProductsBean[e].productId,s.layoutProduct.currentInventory=s.displayProductsBean[e].currentInventory,s.layoutProduct.supplyPriceExclTax=s.displayProductsBean[e].supplyPriceExclTax,s.layoutProduct.retailPriceExclTax=s.displayProductsBean[e].retailPriceExclTax,s.layoutProduct.retailPriceInclTax=s.displayProductsBean[e].retailPriceInclTax,s.layoutProduct.orignalPrice=s.displayProductsBean[e].orignalPrice,s.layoutProduct.taxAmount=s.displayProductsBean[e].taxAmount,s.layoutProduct.varientProducts=s.displayProductsBean[e].varientProducts,s.layoutProduct.css=s.displayProductsBean[e].css,s.layoutProducts.push(s.layoutProduct)},s.showProductItemDetails=function(e){for(var t=0;t<s.InvoiceMainBean.invoiceDetails.length;t++)s.InvoiceMainBean.invoiceDetails[t].productVarientName==e.productVarientName&&(s.InvoiceMainBean.invoiceDetails[t].showDetails?s.InvoiceMainBean.invoiceDetails[t].showDetails=!1:s.InvoiceMainBean.invoiceDetails[t].showDetails=!0)},s.invoiceDetail={},s.selectProductFunc=function(e){for(var t=0;t<s.displayProductsBean.length;t++)e.productId==s.displayProductsBean[t].productId&&(s.productVaraintDetailBean=s.displayProductsBean[t].productVaraintDetailBean,s.productVariantsBeans=s.displayProductsBean[t].productVariantsBeans,s.productVariantsBeans?s.selectProduct=!0:s.addProduct(e))},s.addProduct=function(e){s.duplicateProduct=!1,s.invoiceDetail={},s.parkDiscard=!1,s.invoiceDetail={},s.invoiceDetail.productName=e.productName,s.invoiceDetail.productVarientName=e.variantAttributeName,s.invoiceDetail.productVarientId=e.productVariantId,s.invoiceDetail.productId=e.productId,s.invoiceDetail.productInventoryCount=e.currentInventory,s.invoiceDetail.productQuantity=1,s.invoiceDetail.itemDiscountPrct=0,s.invoiceDetail.itemNetPrice=0,"false"==e.varientProducts&&(e.tax=e.taxAmount),s.invoiceDetail.itemTaxAmount=e.tax,s.invoiceDetail.itemRetailPrice=e.retailPriceExclTax,s.invoiceDetail.itemSalePrice=s.invoiceDetail.itemRetailPrice,s.invoiceDetail.itemNetPrice=s.invoiceDetail.itemSalePrice,s.invoiceDetail.orignalPrice=e.orignalPrice,s.applyPriceBook(s.invoiceDetail,e);for(var t=0;t<s.InvoiceMainBean.invoiceDetails.length;t++){if("false"==e.varientProducts&&s.invoiceDetails[t].productId==e.productId){s.invoiceDetails[t].productQuantity=parseFloat(s.invoiceDetails[t].productQuantity)+1,s.invoiceDetail=s.invoiceDetails[t],s.duplicateProduct=!0;break}if("true"==e.varientProducts&&s.invoiceDetails[t].productVarientId==e.productVariantId){s.invoiceDetails[t].productQuantity=parseFloat(s.invoiceDetails[t].productQuantity)+1,s.invoiceDetail=s.invoiceDetails[t],s.duplicateProduct=!0;break}}0==s.duplicateProduct&&(s.invoiceDetails.push(s.invoiceDetail),s.InvoiceMainBean.invoiceDetails=s.invoiceDetails),s.calculateBill(!0,s.invoiceDetail,"add"),s.productquantityzero=!1},s.applyPriceBook=function(e,t){if(null!=s.pricebook&&null!=s.pricebook.priceBookDetailBeans&&0<s.pricebook.priceBookDetailBeans.length){s.productBookDetail={},s.productBookDetail=null;for(var r=0;r<s.pricebook.priceBookDetailBeans.length;r++){if(null!=s.pricebook.priceBookDetailBeans[r].productVariantId&&""!=s.pricebook.priceBookDetailBeans[r].productVariantId&&s.pricebook.priceBookDetailBeans[r].uuId==t.productVariantUuid){s.productBookDetail=s.pricebook.priceBookDetailBeans[r];break}if(s.pricebook.priceBookDetailBeans[r].uuId==t.productUuid){s.productBookDetail=s.pricebook.priceBookDetailBeans[r];break}}null!=s.productBookDetail?s.invoiceDetail.itemDiscountPrct=parseFloat(s.productBookDetail.discount).toFixed(2):"true"==s.pricebook.flatSale&&(s.invoiceDetail.itemDiscountPrct=parseFloat(s.pricebook.flatDiscount).toFixed(2))}else null!=s.pricebook&&"true"==s.pricebook.flatSale?s.invoiceDetail.itemDiscountPrct=parseFloat(s.pricebook.flatDiscount).toFixed(2):s.invoiceDetail.itemDiscountPrct=0},s.CalculateReturn=function(e){0==e.isreturn?(s.calculateBill(!0,e,"add"),s.InvoiceMainBean.invcTypeCde=""):(s.calculateBill(!1,e,"remove"),s.InvoiceMainBean.invcTypeCde="00000")},s.calculateBill=function(e,t,r){if(s.InvoiceMainBean.itemsCount=parseFloat(0),s.totallineItemDiscount=parseFloat(0),Number(t.productInventoryCount)<Number(t.productQuantity)&&"add"==r&&(void 0===t.isreturn||0==t.isreturn))t.productQuantity=t.productInventoryCount,s.productquantityzero=!0,s.produtquantitymsg="Available Product Quantiy is : "+t.productQuantity,l(function(){s.productquantityzero=!1},1500);else if(Number(t.productInventoryCount)>=Number(t.productQuantity)||"remove"==r||-1==s.returnvalue||1==t.isreturn){s.InvoiceMainBean.invoiceAmt=parseFloat(0),s.InvoiceMainBean.invoiceDiscountAmt=s.InvoiceMainBean.invoiceDiscountAmt?s.InvoiceMainBean.invoiceDiscountAmt:parseFloat(0),s.InvoiceMainBean.invoiceTax=parseFloat(0),s.InvoiceMainBean.invoiceSubTotal=parseFloat(0),s.InvoiceMainBean.invoiceNetAmt=s.InvoiceMainBean.invoiceGivenAmt=parseFloat(0);for(var a=0,o=0;o<s.InvoiceMainBean.invoiceDetails.length;o++)s.InvoiceMainBean.invoiceDetails[o].productVarientName==t.productVarientName&&(a+=parseFloat(s.InvoiceMainBean.invoiceDetails[o].orignalPrice),s.InvoiceMainBean.invoiceDetails[o].itemSalePrice||(s.InvoiceMainBean.invoiceDetails[o].itemSalePrice=0),s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice||(s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice=0),s.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct||(s.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct=0),s.InvoiceMainBean.invoiceDetails[o].productQuantity&&0!=s.InvoiceMainBean.invoiceDetails[o].productQuantity||(s.InvoiceMainBean.invoiceDetails[o].productQuantity=1),1==e||1==s.InvoiceMainBean.invoiceDetails[o].isreturn?s.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct?(s.InvoiceMainBean.invoiceDetails[o].itemSalePrice=parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)-(parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)*parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct)/100).toFixed(2),s.InvoiceMainBean.invoiceDetails[o].itemDiscountAmount=parseFloat((parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)*parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct)/100).toFixed(2))*parseFloat(s.InvoiceMainBean.invoiceDetails[o].productQuantity)):s.InvoiceMainBean.invoiceDetails[o].itemSalePrice=parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice).toFixed(2):s.InvoiceMainBean.invoiceDetails[o].itemDiscountPrct=(100-(100*parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemSalePrice)/parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice)).toFixed(2)).toFixed(2),s.InvoiceMainBean.invoiceDetails[o].itemNetPrice=(parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemSalePrice)*parseFloat(s.InvoiceMainBean.invoiceDetails[o].productQuantity)).toFixed(2),1==s.InvoiceMainBean.invoiceDetails[o].isreturn&&(s.InvoiceMainBean.invoiceDetails[o].itemNetPrice=-1*s.InvoiceMainBean.invoiceDetails[o].itemNetPrice,s.InvoiceMainBean.invoiceDetails[o].itemSalePrice=-1*s.InvoiceMainBean.invoiceDetails[o].itemSalePrice)),0<parseFloat(s.InvoiceMainBean.invoiceDetails[o].productQuantity)&&(s.InvoiceMainBean.invoiceAmt=(parseFloat(s.InvoiceMainBean.invoiceAmt)+parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemNetPrice)).toFixed(2)),s.InvoiceMainBean.invoiceSubTotal=((parseFloat(s.InvoiceMainBean.invoiceSubTotal)+parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemRetailPrice))*parseFloat(s.InvoiceMainBean.invoiceDetails[o].productQuantity)).toFixed(2),s.InvoiceMainBean.invoiceTax=((parseFloat(s.InvoiceMainBean.invoiceTax)+parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemTaxAmount))*parseFloat(s.InvoiceMainBean.invoiceDetails[o].productQuantity)).toFixed(2),s.InvoiceMainBean.invoiceNetAmt=(parseFloat(s.InvoiceMainBean.invoiceAmt)-parseFloat(s.InvoiceMainBean.invoiceDiscountAmt)+parseFloat(s.InvoiceMainBean.invoiceTax)).toFixed(2),s.InvoiceMainBean.settledAmt=s.InvoiceMainBean.settledAmt?s.InvoiceMainBean.settledAmt:0,s.InvoiceMainBean.invoiceGivenAmt=parseFloat(s.InvoiceMainBean.invoiceNetAmt)-parseFloat(s.InvoiceMainBean.settledAmt),"remove"!=r&&-1!=s.returnvalue||(s.InvoiceMainBean.invoiceGivenAmt=s.returnvalue*parseFloat(s.InvoiceMainBean.invoiceNetAmt),Number(t.productQuantity)>Number(t.orignalProductQuantity)?(s.returnerrormsg="Cannot return more than purchased items.",s.returnerrormsgvisible=!0,l(function(){s.returnerrormsgvisible=!1},1500),t.productQuantity=t.orignalProductQuantity):s.returnerrormsgvisible=!1);for(o=0;o<s.InvoiceMainBean.invoiceDetails.length;o++)null!=s.InvoiceMainBean.invoiceDetails[o].itemDiscountAmount&&(s.totallineItemDiscount=parseFloat(s.totallineItemDiscount)+parseFloat(s.InvoiceMainBean.invoiceDetails[o].itemDiscountAmount));s.InvoiceMainBean.orignalPrice=a,s.InvoiceMainBean.invoiceDiscountAmt||(s.InvoiceMainBean.invoiceDiscountAmt=0),s.totallineItemDiscount||(s.totallineItemDiscount=0)}for(o=0;o<s.InvoiceMainBean.invoiceDetails.length;o++)1!=s.InvoiceMainBean.invoiceDetails[o].isreturn&&(s.InvoiceMainBean.itemsCount=parseFloat(s.InvoiceMainBean.itemsCount)+parseFloat(s.InvoiceMainBean.invoiceDetails[o].productQuantity))},s.pay=function(){s.makePayment?s.makePayment=!1:(s.ValidateInvoiceItems(),s.isValidInvoice&&(s.makePayment=!0))},s.ResetSale=function(){s.InvoiceMainBean&&(s.InvoiceMainBean={},s.InvoiceMainBean.invoiceDetails=[],s.listPayments=[],s.InvoiceMainBean.invoiceNetAmt=0,s.InvoiceMainBean.invoiceAmt=0,s.InvoiceMainBean.invoiceGivenAmt=0,s.InvoiceMainBean.settledAmt=0,s.InvoiceMainBean.invoiceTax=0,s.InvoiceMainBean.invoiceSubTotal=parseFloat(0)),s.InvoiceMainBean.itemsCount=parseFloat(0),s.invoiceDetails=[],s.airportName=[],localforage.setItem("_s_tk_sell",""),s.returnvalue=parseFloat(1),s.itemDetailDisable=!1,s.gobackenable=!0,s.searchCustomerSelected=!1,s.selectCustomer=!1,s.searchCustomer=!0,s.selectCustomerName="",s.InvoiceMainBean.customerId="",s.readonlyInvoiceDiscount=!1,"true"==s.sellControllerBean.isReturnEnableonSell?s.isReturnEnableonSell=!0:s.isReturnEnableonSell=!1},s.ReceiptingDone=function(){s.ResetSale(),s.makePayment=!1,s.salesComplete=!1,s.error=!1,s.success=!1,s.showDiscount=!1,s.invoiceGenerationDteFE="",s.fetchAllCustomers()},s.calculateDiscount=function(e){1==e?void 0!==s.InvoiceMainBean.invoiceDiscount&&s.InvoiceMainBean.invoiceDiscount?s.InvoiceMainBean.invoiceDiscountAmt=(parseFloat(s.InvoiceMainBean.invoiceAmt)*parseFloat(s.InvoiceMainBean.invoiceDiscount)/100).toFixed(2):(s.InvoiceMainBean.invoiceDiscount=parseFloat(0),s.InvoiceMainBean.invoiceDiscountAmt=parseFloat(0)):0==e&&(s.InvoiceMainBean.invoiceDiscountAmt&&void 0!==s.InvoiceMainBean.invoiceDiscountAmt||(s.InvoiceMainBean.invoiceDiscountAmt=parseFloat(0)),s.InvoiceMainBean.invoiceDiscount=(parseFloat(s.InvoiceMainBean.invoiceDiscountAmt)/parseFloat(s.InvoiceMainBean.invoiceAmt)*100).toFixed(2)),s.InvoiceMainBean.invoiceNetAmt=(parseFloat(s.InvoiceMainBean.invoiceAmt)-parseFloat(s.InvoiceMainBean.invoiceDiscountAmt)+parseFloat(s.InvoiceMainBean.invoiceTax)).toFixed(2),s.InvoiceMainBean.invoiceGivenAmt=s.InvoiceMainBean.invoiceNetAmt-parseFloat(s.InvoiceMainBean.settledAmt)},s.removeProduct=function(t){t&&(s.InvoiceMainBean.invoiceDetails=s.InvoiceMainBean.invoiceDetails.filter(function(e){return e!==t}),s.invoiceDetails=s.invoiceDetails.filter(function(e){return e!==t}),s.calculateBill(!1,t,"remove"))},s.salesComplete=!1,s.barcodeValues={selectproduct:""},s.InvoiceMainBeanList=[],s.payCash=function(t){if(s.success=!1,s.error=!1,s.loading=!0,s.InvoiceMainBean.dailyRegesterId=s.dailyRegesterId,s.InvoiceMainBean.settledAmt=s.InvoiceMainBean.settledAmt?s.InvoiceMainBean.settledAmt:0,parseFloat(s.InvoiceMainBean.invoiceGivenAmt)>parseFloat(s.InvoiceMainBean.invoiceNetAmt)-parseFloat(s.InvoiceMainBean.settledAmt)?(s.InvoiceMainBean.settledAmt=parseFloat(s.InvoiceMainBean.invoiceNetAmt)-parseFloat(s.InvoiceMainBean.settledAmt),s.balance=0):parseFloat(s.InvoiceMainBean.invoiceGivenAmt)<=parseFloat(s.InvoiceMainBean.invoiceNetAmt)-parseFloat(s.InvoiceMainBean.settledAmt)&&(s.InvoiceMainBean.settledAmt=parseFloat(s.InvoiceMainBean.invoiceGivenAmt)),s.payment={},!s.InvoiceMainBean.invoiceRefNbr){var e=new Date,r="SAL-"+e.getDate()+ +(e.getMonth()+1)+ +e.getFullYear()+ +e.getHours()+ +e.getMinutes()+ +e.getSeconds();s.InvoiceMainBean.invoiceRefNbr=r;var a=new Date,o=[u[a.getMonth()],a.getDate().padLeft(),a.getFullYear()].join(", ")+" "+[a.getHours()%12==0?12:a.getHours()%12,a.getMinutes().padLeft(),a.getSeconds().padLeft(),12<=a.getHours()?"PM":"AM"].join(":");s.invoiceGenerationDteFE=o}"cash"==t?(s.payment.type="Payment (Cash)",s.InvoiceMainBean.paymentTypeId=1,s.cashloading=!0):"creditcard"==t&&(s.payment.type="Payment (Credit Card)",s.InvoiceMainBean.paymentTypeId=2,s.creditloading=!0),s.payment.amount=parseFloat(s.InvoiceMainBean.invoiceGivenAmt),s.listPayments.push(s.payment),s.returnvalue<=0?(s.InvoiceMainBean.returnvalue="returnsale",s.salesComplete=!0,s.InvoiceMainBean.invoiceNetAmt=s.InvoiceMainBean.invoiceGivenAmt,s.InvoiceMainBean.settledAmt=s.InvoiceMainBean.invoiceNetAmt,s.InvoiceMainBean.invoiceGivenAmt=s.InvoiceMainBean.invoiceGivenAmt,s.InvoiceMainBean.invoiceAmt=s.InvoiceMainBean.invoiceGivenAmt):s.InvoiceMainBean.returnvalue="sale",n.post("sell/payCash/"+s._s_tk_com,s.InvoiceMainBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.payCashSuccess(e),s.loadSalesProductDataOnlyAjax(),"cash"==t?s.cashloading=!1:"creditcard"==t&&(s.creditloading=!1),s.sendMessage(s.InvoiceMainBean.invoiceNetAmt)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,i.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(e){var t;c.online=!1,s.InvoiceMainBean.status="Completed",t=(t=new Date).getUTCFullYear()+"-"+("00"+(t.getUTCMonth()+1)).slice(-2)+"-"+("00"+t.getUTCDate()).slice(-2)+" "+("00"+t.getUTCHours()).slice(-2)+":"+("00"+t.getUTCMinutes()).slice(-2)+":"+("00"+t.getUTCSeconds()).slice(-2),s.InvoiceMainBean.invoiceGenerationDte=t,s.invoiceGenerationDteFE=t,localforage.getItem("InvoiceMainBeanList").then(function(e){s.InvoiceMainBeanList=null==e?[]:e,s.InvoiceMainBeanList.push(s.InvoiceMainBean),localforage.setItem("InvoiceMainBeanList",s.InvoiceMainBeanList),localforage.setItem("invoiceMainBeanNewList",s.InvoiceMainBeanList),c.InvoiceMainBeanList=e}),s.payCashSuccess(e),s.cashloading=!1,s.creditloading=!1,s.loading=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.payCashSuccess=function(e){s.gobackenable=!1,null!=e&&(s.successMessage=e.data,s.InvoiceMainBean=e.data),localforage.setItem("_s_tk_sell",""),s.balance=parseFloat(s.InvoiceMainBean.invoiceNetAmt)-parseFloat(s.InvoiceMainBean.settledAmt),s.change=parseFloat(s.InvoiceMainBean.invoiceGivenAmt)-parseFloat(s.InvoiceMainBean.settledAmt),s.InvoiceMainBean.invoiceGivenAmt=parseFloat(s.balance),0==s.balance?s.salesComplete=!0:s.salesComplete=!1,s.barcodeValues.selectproduct=s.InvoiceMainBean.invoiceRefNbr,JsBarcode(".barcode").init()},s.salenoncash=function(e){if(s.success=!1,s.error=!1,s.laybyloading=!0,s.InvoiceMainBean.dailyRegesterId=s.dailyRegesterId,s.InvoiceMainBean.transactionType=e,s.InvoiceMainBean.laybyamount=parseFloat(s.InvoiceMainBean.invoiceNetAmt)-parseFloat(s.InvoiceMainBean.settledAmt),null!=s.InvoiceMainBean.laybyamount||0<s.selectedItem.item.customerBalance?s.totalBalance=parseFloat(s.InvoiceMainBean.laybyamount)+parseFloat(s.selectedItem.item.customerBalance):null==s.InvoiceMainBean.laybyamount?s.totalBalance=s.selectedItem.item.customerBalance:null==s.selectedItem.item.customerBalance&&(s.selectedItem.item.customerBalance=0),s.InvoiceMainBean.settledAmt=0,!s.InvoiceMainBean.invoiceRefNbr){var t=new Date,r="SAL-"+t.getDate()+ +(t.getMonth()+1)+ +t.getFullYear()+ +t.getHours()+ +t.getMinutes()+ +t.getSeconds();s.InvoiceMainBean.invoiceRefNbr=r;var a=new Date,o=[u[a.getMonth()+1],a.getDate().padLeft(),a.getFullYear()].join(", ")+" "+[a.getHours()%12,a.getMinutes().padLeft(),a.getSeconds().padLeft(),12<=a.getHours()?"PM":"AM"].join(":");s.invoiceGenerationDteFE=o}n.post("sell/salenoncash/"+s._s_tk_com,s.InvoiceMainBean).success(function(e){s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.salenoncashSuccess(e),s.loadSalesProductDataOnlyAjax(),s.laybyloading=!1,s.sendMessage(s.InvoiceMainBean.invoiceNetAmt)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,i.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(e){c.online&&(s.InvoiceMainBeanList.push(s.InvoiceMainBean),localforage.setItem("InvoiceMainBeanList",s.InvoiceMainBeanList),localforage.setItem("invoiceMainBeanNewList",s.InvoiceMainBeanList),s.salenoncashSuccess(e)),s.loading=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.salenoncashSuccess=function(e){s.gobackenable=!1,localforage.setItem("_s_tk_sell",""),s.salesComplete=!0,s.balance=parseFloat(s.InvoiceMainBean.invoiceGivenAmt),null!=e&&(s.InvoiceMainBean=e.data),s.listPayments=[],s.barcodeValues.selectproduct=s.InvoiceMainBean.invoiceMainId,JsBarcode(".barcode").init()},s.parkSale=function(){if(s.success=!1,s.error=!1,s.loading=!0,s.InvoiceMainBean.dailyRegesterId=s.dailyRegesterId,!s.InvoiceMainBean.invoiceRefNbr){var e=new Date,t="SAL-"+e.getDate()+ +(e.getMonth()+1)+ +e.getFullYear()+ +e.getHours()+ +e.getMinutes()+ +e.getSeconds();s.InvoiceMainBean.invoiceRefNbr=t}n.post("sell/parkSale/"+s._s_tk_com,s.InvoiceMainBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.success=!0,s.successMessage=e.data,s.ResetSale(),l(function(){s.success=!1,i.location=e.layOutPath},1500)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,i.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){c.online&&(s.InvoiceMainBeanList.push(s.InvoiceMainBean),localforage.setItem("InvoiceMainBeanList",s.InvoiceMainBeanList),localforage.setItem("invoiceMainBeanNewList",s.InvoiceMainBeanList),s.success=!0,s.successMessage=Response.data,s.ResetSale(),l(function(){s.success=!1,i.location=Response.layOutPath},1500)),s.loading=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.openRegister=function(){s.success=!1,s.error=!1,s.loadingOpenRegister=!0,s.showCashModal=!1,n.post("sell/openRegister/"+s._s_tk_com).success(function(e){s.loading=!1,s.responseData=e.data,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.getAllProducts(),s.registerOpen=!0,s.loadingOpenRegister=!1,localforage.setItem("_s_tk_sell",""),"You don't have rights to perform current operation!"!=s.responseData&&(s.showCashModal=!0)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,i.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){s.loading=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.allProducts=[],s.registerOpen=!1,s.dailyRegesterId="",s.getAllProducts=function(){void 0!==s.sellControllerBean.registerStatus&&("true"==s.sellControllerBean.registerStatus?(s.dailyRegesterId=s.sellControllerBean.dailyRegisterId,s.registerOpen=!0):s.registerOpen=!1)},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)},s.productVaraintDetailBean={},s.productVaraintAttrName="",s.attribute1Level=!1,s.attribute2Level=!0,s.attribute3Level=!0,s.attribute1LevelFunc=function(e){if(s.productVaraintAttrName=e+"/",s.attribute1Level=!0,s.attribute2Level=!1,s.attribute3Level=!0,null==s.productVaraintDetailBean.arrtibute2Values||0==s.productVaraintDetailBean.arrtibute2Values.length){for(var t=0;t<s.productVariantsBeans.length;t++)s.productVariantsBeans[t].variantAttributeName.replaceAll("/","").replaceAll(" ","")==s.productVaraintAttrName.replaceAll("/","").replaceAll(" ","")&&(s.addProduct(s.productVariantsBeans[t]),s.attribute2Level=!0,s.attribute1Level=!1),s.selectProduct=!1;s.attribute2Level||(s.attribute2Level=!0,s.attribute1Level=!1,s.produtquantitymsg="Product not avilable, please contact Admin!",s.productquantityzero=!0,l(function(){s.productquantityzero=!1},2e3))}},s.attribute1Leve2Func=function(e){if(s.productVaraintAttrName=s.productVaraintAttrName+e+"/",s.attribute1Level=!0,s.attribute2Level=!0,s.attribute3Level=!1,null==s.productVaraintDetailBean.arrtibute3Values||0==s.productVaraintDetailBean.arrtibute3Values.length){for(var t=0;t<s.productVariantsBeans.length;t++)s.productVariantsBeans[t].variantAttributeName.replaceAll("/","").replaceAll(" ","")==s.productVaraintAttrName.replaceAll("/","").replaceAll(" ","")&&(s.addProduct(s.productVariantsBeans[t]),s.attribute3Level=!0,s.attribute1Level=!1),s.selectProduct=!1;s.attribute3Level||(s.attribute3Level=!0,s.attribute1Level=!1,s.produtquantitymsg="Product not avilable, please contact Admin!",s.productquantityzero=!0,l(function(){s.productquantityzero=!1},2e3))}},s.aattribute1Leve3Func=function(e){s.attribute1Level=!1,s.attribute2Level=!0,s.attribute3Level=!0,s.productNotFound=!0,s.productVaraintAttrName=s.productVaraintAttrName+e;for(var t=0;t<s.productVariantsBeans.length;t++)s.productVariantsBeans[t].variantAttributeName.replaceAll("/","").replaceAll(" ","")==s.productVaraintAttrName.replaceAll("/","").replaceAll(" ","")&&(s.addProduct(s.productVariantsBeans[t]),s.productNotFound=!1),s.selectProduct=!1;s.productNotFound&&(s.produtquantitymsg="Product not avilable, please contact Admin!",s.productquantityzero=!0,l(function(){s.productquantityzero=!1},2e3))},s.productVariantsBeans=[],s.variantSkuFound=!1,s.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){t=t.toLowerCase(),s.productVariantsBeans=[];var e=_.filter(s.allProducts,function(e){return e.productName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allCustomers,function(e){return e.phoneNumber?e.firstName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t):e.firstName?e.firstName.toLowerCase().includes(t):void 0}),a=_.filter(s.productVaraintDetailBeanList,function(e){return e.sku.toLowerCase()==t});return a&&0<a.length&&(s.addProduct(a[0]),s.variantSkuFound=!0,s.airportName=[]),e.concat(r).concat(a)},renderItem:function(e){if(void 0===e.firstName){if(s.variantSkuFound)return void(s.variantSkuFound=!1);var t={value:e.productName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.productName+"</td><td style='width: 10%'>"+e.retailPriceExclTax+"</td></tr></tbody></table>")}}else if(e.firstName&&e.lastName&&e.phoneNumber)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else if(e.firstName&&e.lastName)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+" "+e.lastName+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};return t},itemSelected:function(e){if(s.selectedItem=e,void 0===s.selectedItem.item.firstName){for(var t=0;t<s.allProducts.length;t++)s.selectedItem.item.productId==s.allProducts[t].productId&&(s.productVaraintDetailBean=s.allProducts[t].productVaraintDetailBean,s.productVariantsBeans=s.allProducts[t].productVariantsBeans);if(s.airport=e,null==s.productVaraintDetailBean.arrtibute1Values||0==s.productVaraintDetailBean.arrtibute1Values.length)for(t=0;t<s.allProducts.length;t++)s.allProducts[t].productName.replaceAll(" ","")==s.selectedItem.item.productName.replaceAll(" ","")&&s.addProduct(s.allProducts[t]);else"true"==s.sellControllerBean.autoCreateStandardVariant&&s.productVaraintDetailBean.arrtibute1Values[0]==s.sellControllerBean.defaultVariantName?s.addProduct(s.productVariantsBeans[0]):s.selectProduct=!0}else s.selectCustomer=!0,s.selectCustomerName=s.selectedItem.item.firstName+" "+s.selectedItem.item.lastName,s.selectCustomerPhoneNumber=s.selectedItem.item.phoneNumber,s.InvoiceMainBean.customerId=s.selectedItem.item.customerId;s.airportName=[]}},s.selectCustomer=!1,s.autoCompleteOptionsCustomers={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),s.productVariantsBeans=[],_.filter(s.allCustomers,function(e){return e.phoneNumber?e.firstName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t):e.firstName.toLowerCase().includes(t)})},renderItem:function(e){if(e.firstName&&e.lastName&&e.phoneNumber)var t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else if(e.firstName&&e.lastName)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+" "+e.lastName+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};return t},itemSelected:function(e){s.selectedItem=e,s.CustomerName="",s.selectCustomer=!0,s.selectCustomerName=s.selectedItem.item.firstName+" "+s.selectedItem.item.lastName,s.selectCustomerPhoneNumber=s.selectedItem.item.phoneNumber,s.InvoiceMainBean.customerId=s.selectedItem.item.customerId,s.customerBalance=s.selectedItem.item.customerBalance,s.customerLayBy=s.selectedItem.item.customerlaybyAmount,null!=s.selectedItem.item.customerBalance&&0<s.selectedItem.item.customerBalance?s.totalPayable=parseFloat(s.InvoiceMainBean.invoiceNetAmt)+parseFloat(s.selectedItem.item.customerBalance)-parseFloat(s.InvoiceMainBean.invoiceGivenAmt):(s.selectedItem.item.customerBalance=null)&&(s.totalPayable=parseFloat(s.selectedItem.item.invoiceNetAmt))}},s.salesUserBean=[],s.autoCompleteOptionsUsers={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(s.allUsers,function(e){return e.firstName.toLowerCase().includes(t)||e.lastName.toLowerCase().includes(t)})},renderItem:function(e){if(e.firstName&&e.lastName&&e.phoneNumber)var t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")};else if(e.firstName&&e.lastName)t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.firstName+" "+e.lastName+"</td><td style='width: 10%'>User</td></tr></tbody></table>")};else t={value:e.firstName,label:r.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>User</td></tr></tbody></table>")};return t},itemSelected:function(e){s.selectedItem=e,s.selectUserName=s.selectedItem.item.firstName+" "+s.selectedItem.item.lastName,s.InvoiceMainBean.salesUser=s.selectedItem.item.userId,s.salesUserBean=[]}},s.cancelCustomer=function(){s.showCustomerModal=!1},s.cancelUserAdd=function(){s.showUserModal=!1},s.sesssionValidation(),s.newCustomerSuccessMessage="Customer Added Successfuly!",s.customerBean={},s.customerBean.addressBeanList=[],s.customerBean.addressBeanList[0]={},s.customerBean.addressBeanList[1]={},s.searchCustomerSelected=!0,s.addNewUserSelected=function(){s.showUserModal=!1},s.addNewCustomerSelected=function(){s.customerBean={},s.customerBean.addressBeanList=[],s.customerBean.addressBeanList[0]={},s.customerBean.addressBeanList[1]={},s.newCustomerSuccess=!0,s.showCustomerModal=!1,l(function(){s.newCustomerSuccess=!1},2e3)},s.addNewCustomer=function(){s.newCustomerSuccess=!1,s.newCustomerError=!1,s.loading=!0,s.customerFound=!1,s.addCustomerProcessingButton=!0;for(var e=0;e<s.allCustomers.length;e++)s.allCustomers[e].phoneNumber==s.customerBean.addressBeanList[0].phone&&(s.customerFound=!0);s.customerFound?(s.newCustomerError=!0,s.newCustomerErrorMessage="Customer already exist with same Phone Number!",l(function(){s.newCustomerError=!1,s.searchCustomer=!0,s.addCustomerProcessingButton=!1,s.loading=!1,s.customerBean={},s.customerBean.addressBeanList=[],s.customerBean.addressBeanList[0]={},s.customerBean.addressBeanList[1]={}},2e3)):(s.customerBean.addressBeanList[0].addressType="Physical Address",s.customerBean.addressBeanList[1].addressType="Postal Address",n.post("newCustomer/addNewCustomer/"+s._s_tk_com,s.customerBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(""!=s.InvoiceMainBean&&void 0!==s.InvoiceMainBean||(s.InvoiceMainBean={}),s.newCustomerSuccess=!0,s.fetchAllCustomers(),s.selectCustomer=!0,s.selectCustomerName=s.customerBean.firstName+" "+s.customerBean.lastName,s.selectCustomerPhoneNumber=s.customerBean.addressBeanList[0].phone,"undefined undefined"==s.selectCustomerName&&(s.selectCustomerName="Customer"),s.InvoiceMainBean.customerId=e.data.customerId,s.customerBean={},s.customerBean.addressBeanList=[],s.customerBean.addressBeanList[0]={},s.customerBean.addressBeanList[1]={},l(function(){s.newCustomerSuccess=!1,s.showCustomerModal=!1,s.searchCustomerSelected=!1,s.addCustomerProcessingButton=!1,s.searchCustomer=!0},2e3)):"INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?(s.newCustomerError=!0,s.addCustomerProcessingButton=!1,s.newCustomerErrorMessage=e.data,i.location=e.layOutPath):(s.newCustomerError=!0,s.addCustomerProcessingButton=!1,s.newCustomerErrorMessage=e.data)}).error(function(){s.loading=!1,s.addCustomerProcessingButton=!1,s.newCustomerError=!0,s.newCustomerErrorMessage=s.systemBusy}))},s.fetchAllCustomers=function(){n.post("customers/getAllCustomersOrderBYPhone/"+s._s_tk_com).success(function(e){s.allCustomers=e.data,localforage.getItem("allProducts").then(function(e){var t=e;t.customersBean=s.allCustomers,localforage.removeItem("allProducts").then(function(){localforage.setItem("allProducts",t),console.log("allProducts customer added!")}).catch(function(e){console.log(e)}),c.InvoiceMainBeanList=e})}).error(function(){})},s.selectCustomerOrCreate=function(){s.searchCustomer=!0,s.showCustomerModal=!0},s.selectSalesUser=function(){s.showUserModal=!0},s.cashManagmentBean={},s.cashManagmentBean.cashType="Cash",s.cashManagmentBean.cashManagmentType="IN",s.cashManagmentBean.notes="Opening float",s.cashInOut=function(){n.post("cashManagement/cashInOut/"+s._s_tk_com,s.cashManagmentBean).success(function(e){s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.showCashModal=!1,s.cashManagmentList=e.data,s.addCashProcessingButton=!1,s.removeCashProcessingButton=!1,l(function(){o.reload()},1e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,i.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){s.error=!0,s.errorMessage=s.systemBusy})},s.ValidateInvoiceItems=function(){s.isValidInvoice=!0;for(var e=0;e<s.InvoiceMainBean.invoiceDetails.length;e++)if(0==s.InvoiceMainBean.invoiceDetails[e].productQuantity){s.isValidInvoice=!1;break}s.isValidInvoice||(s.productquantityzero=!0,s.produtquantitymsg="Sale of Product with Zero Quantity Not Allowed",l(function(){s.productquantityzero=!1},1500))},s.sendMessage=function(e){s.loading=!0,s.sendSMSBean={},s.sendSMSBean.customerSmsBeans=s.selectedCustomers,s.sendSMSBean.message=s.message,s.sendSMSBean.sendAllSms=s.sendAllSms,s.sendSingleSmsBean={},s.sendSingleSmsBean.customerId=s.InvoiceMainBean.customerId,s.sendSingleSmsBean.amount=e,s.sendSingleSmsBean.user=c.clientName,s.InvoiceMainBean.customerId&&n.post("sendSms/sendSingleMessage/"+s._s_tk_com,s.sendSingleSmsBean).success(function(e){s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus||("INVALIDSESSION"==s.responseStatus||"SYSTEMBUSY"==s.responseStatus?i.location=e.layOutPath:s.newCustomerErrorMessage=e.data)}).error(function(){s.newCustomerErrorMessage=s.systemBusy})},s.deleteCustomerOrCreate=function(){s.selectCustomer=!1,s.CustomerName=[],s.selectCustomerName=""}}],SendSmsController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$sce","SendSmsControllerPreLoad","$route",function(r,e,t,a,o,s,n,i,c,l){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.successMessage="Message Sent Successfuly!",r.errorMessage="Message Sent Error Occurred!",r.success=!1,r.error=!1,r.message="",r.sendAllSms=!1,r.sesssionValidation=function(){r._s_tk_com=a.get("_s_tk_com"),r.controllerBean=c.loadControllerData(),o.globalPageLoader=!1,r.smsUsedCount=r.controllerBean.smsUsedCount,r.smsRemained=r.controllerBean.smsRemained,r.isExpired=r.controllerBean.isExpired},r.selectedCustomers=[],r.autoCompleteOptions={minimumChars:1,dropdownHeight:"200px",data:function(t){return t=t.toLowerCase(),_.filter(r.controllerBean.customersBean,function(e){return e.firstName?e.firstName.toLowerCase().includes(t)||e.phoneNumber.toLowerCase().includes(t):e.phoneNumber?e.phoneNumber.toLowerCase().includes(t):void 0})},renderItem:function(e){return{value:e.firstName,label:i.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 60%'>"+e.firstName+" "+e.lastName+"</td> <td style='width: 30%'> Mob:   "+e.phoneNumber+"</td><td style='width: 10%'>Customer</td></tr></tbody></table>")}},itemSelected:function(e){if(r.selectedItem=e,r.selectedCustomer={},r.selectedCustomer.customerId=r.selectedItem.item.customerId,r.selectedCustomer.firstName=r.selectedItem.item.firstName,r.selectedCustomer.lastName=r.selectedItem.item.lastName,r.selectedCustomer.companyId=r.selectedItem.item.companyId,r.selectedCustomer.phoneNumber=r.selectedItem.item.phoneNumber,0==r.selectedCustomers.length)r.selectedCustomers.push(r.selectedCustomer);else for(var t=0;t<r.selectedCustomers.length;t++)r.selectedCustomers[t].customerId!=r.selectedCustomer.customerId&&r.selectedCustomers.push(r.selectedCustomer);r.airportName=[]}},r.loading=!1,r.removeCustomer=function(e){for(var t=0;t<r.selectedCustomers.length;t++)r.selectedCustomers[t].customerId==e&&r.selectedCustomers.splice(t,1)},r.sendMessage=function(){r.loading=!0,r.sendSMSBean={},r.sendSMSBean.customerSmsBeans=r.selectedCustomers,r.sendSMSBean.message=r.message,r.sendSMSBean.sendAllSms=r.sendAllSms,r.sendSMSBean.user=o.clientName,"true"==r.isExpired?(r.error=!0,r.loading=!1,r.message="",r.selectedCustomers=[],n(function(){r.error=!1},2500),r.errorMessage="Message Package Time Expired!"):r.sendAllSms?r.controllerBean.customersBean.length>r.smsRemained?(r.error=!0,r.loading=!1,r.message="",r.selectedCustomers=[],n(function(){r.error=!1},2500),r.errorMessage="Message Package Limit Expired!"):(n(function(){r.loading=!1,r.sendAllSms=!1,r.message="",r.success=!0,r.selectedCustomers=[],r.smsUsedCount=r.controllerBean.customersBean.length+parseInt(r.smsUsedCount),r.smsRemained=r.smsRemained-r.controllerBean.customersBean.length},2500),n(function(){r.success=!1},4500)):r.sendSMSBean.customerSmsBeans.length>r.smsRemained?(r.error=!0,r.loading=!1,r.message="",r.selectedCustomers=[],n(function(){r.error=!1},2500),r.errorMessage="Message Package Limit Expired!"):(n(function(){r.loading=!1,r.sendAllSms=!1,r.message="",r.success=!0,r.selectedCustomers=[],r.smsUsedCount=r.sendSMSBean.customerSmsBeans.length+parseInt(r.smsUsedCount),r.smsRemained=r.smsRemained-r.sendSMSBean.customerSmsBeans.length},2500),n(function(){r.success=!1},4500)),e.post("sendSms/sendMessage/"+r._s_tk_com,r.sendSMSBean).success(function(e){r.responseStatus=e.status,r.responseStatus}).error(function(){r.error=!0,r.loading=!1,r.newCustomerErrorMessage=r.systemBusy})},r.sesssionValidation()}],SmsDetailController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","SmsDetailControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,e.roledId=a.get("_s_tk_rId"),e.addProduct=function(){r.location="/app/#/newProduct"},e.showProduct=function(e){a.put("_d_cPi_gra",e.productId),r.location="/app/#/productDetails"},e.editProduct=function(e){a.put("_e_cPi_gra",e.productId),a.put("_e_cOi_gra",e.outletId),r.location="/app/#/manageProduct"},e.sesssionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.fetchData())},e.fetchData=function(){e.data=n.loadControllerData(),"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.productsList=null,e.productsList=e.data.smsReportBeanList,e.smsUsedCount=e.data.smsUsedCount,e.smsRemained=e.data.smsRemained),o.globalPageLoader=!1},e.sesssionValidation()}],SmsReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SmsReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],StatusController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","$route","SessionService","StatusControllerPreLoad",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.brandSuccess=!1,t.brandError=!1,t.brandBean={},t.sessionValidation=function(){t.fetchData()},t.fetchData=function(){t._s_tk_com=a.get("_s_tk_com"),t.invoiceMainBeanStatusList=c.loadControllerData(),null==t.invoiceMainBeanStatusList&&localforage.getItem("invoiceMainBeanNewList").then(function(e){t.invoiceMainBeanStatusList=e,localforage.setItem("InvoiceMainBeanList",t.invoiceMainBeanStatusList),null!=e&&n.reload()}),o.globalPageLoader=!1},t.showAddBrandPopup=function(){t.brandBean={},t.showNewBrandModal=!0},t.sessionValidation()}],StockControlController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","StockControlControllerPreLoad",function(r,e,a,o,t,s,n){t.MainSideBarhideit=!1,t.MainHeaderideit=!1,r.dataLoading=!1,r.loadAll=!0,r.sesssionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"))},r.addReceiveOrder=function(){a.location="/app/#/poCreateandReceive"},r.addPurchaseOrder=function(){a.location="/app/#/purchaseOrder"},r.addStockReturn=function(){a.location="/app/#/stockReturn"},r.addStockSupplierTransfer=function(){a.location="/app/#/stockSupplierTransfer"},r.addStockTransfer=function(){a.location="/app/#/stockTransfer"},r.addStockReturntoWarehouse=function(){a.location="/app/#/stockReturntoWarehouse"},r.addInventoryCount=function(){a.location="/app/#/inventoryCount"},r.purchaseOrderActions=function(e){if(o.put("_ct_bl_ost",e),"1"==e.stockOrderTypeId)a.location="/app/#/purchaseOrderActions";else if("2"==e.stockOrderTypeId||"7"==e.stockOrderTypeId){if(1!=r.roleId){var t=e.outletName;e.outletName=e.supplierName,e.supplierName=t}o.put("_ct_bl_ost",e),a.location="/app/#/stockReturnActions"}else if("5"==e.stockOrderTypeId){if(1!=r.roleId){t=e.outletName;e.outletName=e.supplierName,e.supplierName=t}o.put("_ct_bl_ost",e),a.location="/app/#/stockSupplierTransferActions"}else"3"==e.stockOrderTypeId?a.location="/app/#/stockTransferActions":"4"==e.stockOrderTypeId&&(a.location="/app/#/stockReturntoWarehouseActions")},r.purchaseOrderEditDetails=function(e){if("3"==e.statusId||"8"==e.statusId);else if("1"==e.stockOrderTypeId)o.put("_ct_bl_ost",e),a.location="/app/#/poCreateandReceiveEdit";else if("2"==e.stockOrderTypeId){if(1!=r.roleId){var t=e.outletName;e.outletName=e.supplierName,e.supplierName=t}o.put("_ct_bl_ost",e),a.location="/app/#/stockReturnEditDetails"}else"3"==e.stockOrderTypeId?(o.put("_ct_bl_ost",e),a.location="/app/#/stockTransferEditDetails"):"4"==e.stockOrderTypeId&&(o.put("_ct_bl_ost",e),a.location="/app/#/stockReturntoWarehouseEditDetails")},r.sessionValidation=function(){s.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=n.loadControllerData(),r.fetchData(),r.isAdmin())},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.fetchData=function(){t.stockControlLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.stockTransferToSupplier=r.data.stockTransferToSupplier,r.stockOrderBeansList=r.data.stockOrderBeansList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),r.lodAllStockOrdersAsynchrnously(),t.globalPageLoader=!1},r.lodAllStockOrdersAsynchrnously=function(){r.dataLoading=!1,e.post("stockControl/getAllStockOrders/"+o.get("_s_tk_com")+"/true").success(function(e){r.data=e.data,r.dataLoading=!0}).error(function(){a.location="/app/#/login"})},r.loadAllStockOrders=function(){r.dataLoading=!1,r.stockOrderBeansList=[],r.stockOrderBeansList=r.data.stockOrderBeansList;var e=$("#myTable").DataTable();e&&e.destroy(),setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10),r.dataLoading=!0,r.loadAll=!1},r.sessionValidation()}],StockReturnActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockReturnActionsControllerPreLoad",function(a,e,r,t,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),"true"==a.stockOrderBean.retailPriceBill?a.stockOrderBean.retailPriceBill=!0:a.stockOrderBean.retailPriceBill=!1,a.isAdmin(),a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null!=a.headOffice&&""!=a.headOffice.toString()&&"false"==a.headOffice.toString()},a.fetchData=function(){if(n.stockReturnActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll()),null!=a.stockOrderBean.sourceOutletAddress&&"null"!=a.stockOrderBean.sourceOutletAddress||(a.stockOrderBean.sourceOutletAddress=" ");var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.supplierName+' </h4></div> <div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Return from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}n.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.showSendReturnStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockReturnEditProducts":a.showConfirmSendReturnPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return a.calculateGrandTotal(),!0}return!1},a.returnStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+a._s_tk_com+"/"+a.grandTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendReturnPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockReturnEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockReturnEditDetails"},a.sessionValidation()}],StockReturnController=["$scope","$http","$filter","$window","$cookieStore","$rootScope","$timeout","SessionService","StockReturnControllerPreLoad",function(r,e,t,a,o,s,n,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=t("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="SR-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="SR-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=c.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),"1"!=r.sReturn?a.location="/app/#/home":(r.stockOrderBean.supplierId="-1",r.stockOrderBean.outletId=r.userOutletId))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){s.stockReturnLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),s.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="2",e.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,n(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_e_cOt_pio",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturnDetailsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturnDetailsControllerPreLoad",function(s,t,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.itemCountTotal=0,s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.stockOrderBean=o.get("_e_cOt_pio"),s.roleId=o.get("_s_tk_rId"),s.headOffice=o.get("_s_tk_iho"),s.stockOrderBean.itemCount=0,s.data=c.loadControllerData(),s.fetchData(),s.isAdmin();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},s.isAdmin=function(){return null!=s.headOffice&&""!=s.headOffice.toString()&&"false"==s.headOffice.toString()},s.fetchData=function(){if(n.stockReturnDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data){if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap)}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0")},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.addStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.showSendReturnStockOrder=function(){s.showConfirmSendReturnPopup=!0},s.returnStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendReturnPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StockReturnEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturnEditDetailsControllerPreLoad",function(r,e,t,a,o,s,n,i){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate),"1"!=r.sReturn&&(a.location="/app/#/home"))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){s.stockReturnEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),s.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="2",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturnEditProductsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturnEditProductsControllerPreLoad",function(t,s,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.roleId=o.get("_s_tk_rId"),s.stockOrderBean=o.get("_ct_bl_ost"),s.stockOrderBean.itemCount=0,null!=s.stockOrderBean.retailPriceBill&&("true"==s.stockOrderBean.retailPriceBill.toString()?s.stockOrderBean.retailPriceBill=!0:s.stockOrderBean.retailPriceBill=!1),s.data=c.loadControllerData(),s.fetchData();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),s.stockOrderBean.itemCount=0,s.AllInOne()}},s.fetchData=function(){if(n.stockReturnEditProductsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=s.data.stockOrderDetailBeansList&&(s.stockOrderDetailBeansList=s.data.stockOrderDetailBeansList),null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap)}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0")},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.updateStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,o.put("_e_cOt_pio",""),0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.showSendTransferStockOrder=function(){s.showConfirmSendTransferPopup=!0},s.transferStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendTransferPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.showSendReturnStockOrder=function(){s.showConfirmSendReturnPopup=!0},s.returnStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendReturnPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StockReturntoWarehouseActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockReturntoWarehouseActionsControllerPreLoad",function(a,e,r,t,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),"true"==a.stockOrderBean.retailPriceBill?a.stockOrderBean.retailPriceBill=!0:a.stockOrderBean.retailPriceBill=!1,a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.isAdmin(),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null==a.headOffice||""==a.headOffice.toString()||"true"!=a.headOffice.toString()},a.fetchData=function(){if(n.stockReturntoWarehouseActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll()),0==a.isAdmin()&&a.calculateTotalAllAdmin();var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Order from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}n.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.calculateItemCountAdmin=function(){if(a.stockOrderBean.itemCountRecv=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCountRecv=parseInt(a.stockOrderBean.itemCountRecv)+parseInt(a.stockOrderDetailBeansList[e].recvProdQty),!isNaN(a.stockOrderBean.itemCountRecv)&&""!=a.stockOrderBean.itemCountRecv||(a.stockOrderBean.itemCountRecv="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAdmin=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.recvProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateItemCountAdmin(),a.calculateGrandrecvTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateTotalAllAdmin=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotalAdmin(a.stockOrderDetailBeansList[e].productVariantId);a.calculateItemCountAdmin()},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.calculateGrandrecvTotal=function(){if(a.grandrecvTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].recvTotal)&&(a.stockOrderDetailBeansList[e].recvTotal="0"),a.grandrecvTotal=parseFloat(a.grandrecvTotal)+parseFloat(a.stockOrderDetailBeansList[e].recvTotal),isNaN(a.grandrecvTotal)&&(a.grandrecvTotal="0")},a.showSendTransferStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockReturntoWarehouseEditProducts":a.showConfirmSendTransferPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},a.transferStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.calculateGrandTotal(),a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturntoHeadOffice/"+a._s_tk_com+"/"+a.grandrecvTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendTransferPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockReturntoWarehouseEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockReturntoWarehouseEditDetails"},a.sessionValidation()}],StockReturntoWarehouseController=["$scope","$filter","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseControllerPreLoad",function(r,e,t,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=e("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="SRW-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="SRW-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){if(i.validate()){r._s_tk_com=s.get("_s_tk_com"),r.roleId=s.get("_s_tk_rId"),r.userOutletId=s.get("_s_tk_oId"),r.headOffice=s.get("_s_tk_iho"),null!=r.headOffice&&""!=r.headOffice.toString()?"true"==r.headOffice.toString()&&(o.location="/app/#/home"):o.location="/app/#/home",r.data=c.loadControllerData(),r.fetchData(),r.stockOrderBean.sourceOutletId=r.userOutletId,r.isAdmin();for(var e=0;e<r.destOutletList.length;e++)null!=r.destOutletList[e].isHeadOffice&&""!=r.destOutletList[e].isHeadOffice&&"null"!=r.destOutletList[e].isHeadOffice.toString()&&"true"==r.destOutletList[e].isHeadOffice.toString()&&(r.stockOrderBean.outletId=r.destOutletList[e].outletId)}},r.fetchData=function(){if(n.stockReturntoWarehouseLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=r.data.outletBeansList){r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList);for(var e=0;e<r.destOutletList.length;e++)r.destOutletList[e].outletId==r.userOutletId&&r.destOutletList.splice(e,1)}null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList),null!=r.data.retailPriceBill&&("true"==r.data.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1)}n.globalPageLoader=!1},r.isAdmin=function(){return null==r.headOffice||""==r.headOffice.toString()||"true"!=r.headOffice.toString()},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="4",t.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,a(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),s.put("_e_cOt_pio",r.stockOrderBean),e.layOutPath="/app/#/stockReturntoWarehouseDetails",o.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,o.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturntoWarehouseDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseDetailsControllerPreLoad",function(t,s,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.stockTransferDetailBeansList=[],s.stockTransferOrderBean={},s.counter=1,s.returnAllProducts=!1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.stockOrderBean=o.get("_e_cOt_pio"),s.roleId=o.get("_s_tk_rId"),s.headOffice=o.get("_s_tk_iho"),s.data=c.loadControllerData(),s.fetchData();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),s.AllInOne()}},s.isAdmin=function(){return null==s.headOffice||""==s.headOffice.toString()||"true"!=s.headOffice.toString()},s.fetchData=function(){if(n.stockReturntoWarehouseDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data){if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}if(null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap),null!=s.data.stockTransferOrderBeansList){s.stockTransferOrderBeansList=s.data.stockTransferOrderBeansList;for(e=0;e<s.stockTransferOrderBeansList.length;e++)s.stockOrderBean.stockOrderId==s.stockTransferOrderBeansList[e].stockOrderId&&s.stockTransferOrderBeansList.splice(e,1)}}n.globalPageLoader=!1},s.returnAllProducts=function(){"1"==s.returnAllProductsBean?(s.stockOrderDetailBeansList=[],s.copyAllProducts()):s.stockOrderDetailBeansList=[]},s.copyAllProducts=function(){if(s.globalPageLoader=!0,null!=s.productVariantBeansList&&0<s.productVariantBeansList.length){s.counter=1;for(var e=0;e<s.productVariantBeansList.length;e++)null!=s.productVariantBeansList[e].productVariantId&&(s.productVariantBean={},s.productVariantBean=angular.copy(s.productVariantBeansList[e]),s.stockOrderDetailBean.orderProdQty=angular.copy(s.productVariantBeansList[e].currentInventory),s.checkProductStatusAllProducts());for(e=0;e<s.productBeansList.length;e++)if(null!=s.productBeansList[e].productVariantId){s.productVariantBean={},s.productVariantBean.productVariantId=angular.copy(s.productBeansList[e].productId),s.hitVariant=!1;for(var t=0;t<s.productVariantBeansList.length;t++)s.productVariantBeansList[t].productId==s.productVariantBean.productVariantId&&(s.hitVariant=!0);0==s.hitVariant&&(s.productVariantBean={},s.productVariantBean=angular.copy(s.productBeansList[e]),s.stockOrderDetailBean.orderProdQty=angular.copy(s.productBeansList[e].currentInventory),s.checkProductStatusAllProducts())}s.globalPageLoader=!1}else s.globalPageLoader=!1;s.AllInOne()},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.checkProductStatusAllProducts=function(){s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var e=0;e<s.productVariantBeansList.length;e++){var t=null;s.productVariantBean.productVariantId==s.productVariantBeansList[e].productId&&(t=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[e]),s.stockOrderDetailBean.orderProdQty=s.productVariantBeansList[e].currentInventory,s.addProduct(),s.productVariantBean=angular.copy(t),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",s.stockOrderBean.itemCountRecv=0,s.grandrecvTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0"),0==s.isAdmin()&&(1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].recvProdQty:s.stockOrderDetailBeansList[e].recvTotal=value.ordrSupplyPrice*s.stockOrderDetailBeansList[e].recvProdQty,isNaN(s.stockOrderDetailBeansList[e].recvTotal)&&(s.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].recvProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCountRecv=parseInt(s.stockOrderBean.itemCountRecv)+parseInt(s.stockOrderDetailBeansList[e].recvProdQty),!isNaN(s.stockOrderBean.itemCountRecv)&&""!=s.stockOrderBean.itemCountRecv||(s.stockOrderBean.itemCountRecv="0"),s.grandrecvTotal=parseFloat(s.grandrecvTotal)+parseFloat(s.stockOrderDetailBeansList[e].recvTotal),isNaN(s.grandrecvTotal)&&(s.grandrecvTotal="0"))},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.calculateTotalAdminforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.recvProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.checkStockOrderDetailListAdmin=function(){if("true"!=s.headOffice.toString())return!1;if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.addStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),s.isAdmin()},s.showSendTransferStockOrder=function(){s.showConfirmSendTransferPopup=!0},s.transferStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturntoHeadOffice/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendTransferPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StockReturntoWarehouseEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseEditDetailsControllerPreLoad",function(r,e,t,a,o,s,n,i){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate))},r.fetchData=function(){s.stockReturntoWarehouseEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList)),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),s.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="4",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),e.layOutPath="/app/#/stockReturntoWarehouseEditProducts",a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockReturntoWarehouseEditProductsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockReturntoWarehouseEditProductsControllerPreLoad",function(s,t,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.loading=!1,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.roleId=o.get("_s_tk_rId"),s.stockOrderBean=o.get("_ct_bl_ost"),s.headOffice=o.get("_s_tk_iho"),null!=s.stockOrderBean.retailPriceBill&&("true"==s.stockOrderBean.retailPriceBill.toString()?s.stockOrderBean.retailPriceBill=!0:s.stockOrderBean.retailPriceBill=!1),s.data=c.loadControllerData(),s.fetchData();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),s.isAdmin(),s.AllInOne()}},s.isAdmin=function(){return null==s.headOffice||""==s.headOffice.toString()||"true"!=s.headOffice.toString()},s.fetchData=function(){if(n.stockReturntoWarehouseEditProductsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=s.data.stockOrderDetailBeansList&&(s.stockOrderDetailBeansList=s.data.stockOrderDetailBeansList),null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap)}n.globalPageLoader=!1},s.checkProductStatus=function(){if(1==s.isAdmin()){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}}else{e=s.stockOrderDetailBean.orderProdQty;if(s.stockOrderDetailBean.recvProdQty=s.stockOrderDetailBean.orderProdQty,"true"==s.productVariantBean.isVariant.toString())s.addProductAdmin();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProductAdmin(),s.hit++;else for(t=0;t<s.productVariantBeansList.length;t++){r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.recvProdQty=angular.copy(e),s.addProductAdmin(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProductAdmin())}}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.addProductAdmin=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.recvProdQty)&&(e.recvProdQty="0"),e.recvProdQty=parseInt(e.recvProdQty)+parseInt(s.stockOrderDetailBean.recvProdQty),0<e.ordrSupplyPrice?(e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,1==s.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.total)&&(e.recvTotal="0")):e.recvTotal="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.recvTotal=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.recvProdQty:s.stockOrderDetailBean.recvTotal=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.recvProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.recvTotal="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.orderProdQty="0",s.stockOrderDetailBean.total="0",s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.recvProdQty)&&(e.recvProdQty="0"),e.recvProdQty=parseInt(e.recvProdQty)+parseInt(s.stockOrderDetailBean.recvProdQty),0<e.ordrSupplyPrice?(e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,1==s.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0")):e.recvTotal="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.recvTotal=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.recvProdQty:s.stockOrderDetailBean.recvTotal=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.recvProdQty,isNaN(s.stockOrderDetailBean.recvTotal)&&(s.stockOrderDetailBean.recvTotal="0"),s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.orderProdQty="0",s.stockOrderDetailBean.total="0",s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.recvTotal=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.recvProdQty:s.stockOrderDetailBean.recvTotal=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.recvProdQty,s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.orderProdQty="0",s.stockOrderDetailBean.total="0",s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.stockOrderDetailBean.isDirty=!0,s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",s.stockOrderBean.itemCountRecv=0,s.grandrecvTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0"),0==s.isAdmin()&&(1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].recvProdQty:s.stockOrderDetailBeansList[e].recvTotal=value.ordrSupplyPrice*s.stockOrderDetailBeansList[e].recvProdQty,isNaN(s.stockOrderDetailBeansList[e].recvTotal)&&(s.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].recvProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCountRecv=parseInt(s.stockOrderBean.itemCountRecv)+parseInt(s.stockOrderDetailBeansList[e].recvProdQty),!isNaN(s.stockOrderBean.itemCountRecv)&&""!=s.stockOrderBean.itemCountRecv||(s.stockOrderBean.itemCountRecv="0"),s.grandrecvTotal=parseFloat(s.grandrecvTotal)+parseFloat(s.stockOrderDetailBeansList[e].recvTotal),isNaN(s.grandrecvTotal)&&(s.grandrecvTotal="0"))},s.markAllReceive=function(){if(0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].recvProdQty="",s.stockOrderDetailBeansList[e].recvProdQty=angular.copy(s.stockOrderDetailBeansList[e].orderProdQty),s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].recvProdQty,s.stockOrderDetailBeansList[e].isDirty=!0,isNaN(s.stockOrderDetailBeansList[e].recvTotal)&&(s.stockOrderDetailBeansList[e].recvTotal="0");s.AllInOne()},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.calculateTotalAdminforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.recvTotal=e.retailPrice*e.recvProdQty:e.recvTotal=e.ordrSupplyPrice*e.recvProdQty,isNaN(e.recvTotal)&&(e.recvTotal="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.recvProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.checkStockOrderDetailListAdmin=function(){if("true"!=s.headOffice.toString())return!1;if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].recvProdQty||null==s.stockOrderDetailBeansList[e].recvProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.updateStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,o.put("_e_cOt_pio",""),0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),s.isAdmin()},s.showSendTransferStockOrder=function(){s.showConfirmSendTransferPopup=!0},s.transferStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.AllInOne(),s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturntoHeadOffice/"+s._s_tk_com+"/"+s.grandrecvTotal+"/"+s.stockOrderBean.itemCountRecv,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendTransferPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StockSupplierTransferActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockSupplierTransferActionsControllerPreLoad",function(a,e,r,t,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),a.stockOrderBean.retailPriceBill=!0,a.isAdmin(),a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null!=a.headOffice&&""!=a.headOffice.toString()&&"false"==a.headOffice.toString()},a.fetchData=function(){if(n.stockReturnActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll()),null!=a.stockOrderBean.sourceOutletAddress&&"null"!=a.stockOrderBean.sourceOutletAddress||(a.stockOrderBean.sourceOutletAddress=" ");var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.supplierName+' </h4></div> <div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Return from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Remarks: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.remarks+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}n.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.showSendReturnStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockReturnEditProducts":a.showConfirmSendReturnPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return a.calculateGrandTotal(),!0}return!1},a.returnStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndReturnStockOrderDetails/"+a._s_tk_com+"/"+a.grandTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendReturnPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockSupplierTransferEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockSupplierTransferEditDetails"},a.sessionValidation()}],StockSupplierTransferController=["$scope","$http","$filter","$window","$cookieStore","$rootScope","$timeout","SessionService","StockSupplierTransferControllerPreLoad",function(r,e,t,a,o,s,n,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=t("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="SST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="SST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.data=c.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),"1"!=r.sReturn?a.location="/app/#/home":(r.stockOrderBean.supplierId="-1",r.stockOrderBean.outletId=r.userOutletId))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){s.stockReturnLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList),r.stockOrderBean.stockOrderTypeId="5",e.post("purchaseOrder/stockSupplierTransferRetailPrice/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?null!=e.data&&"true"==e.data?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1:"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})),s.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="5",e.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,n(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_e_cOt_pio",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockSupplierTransferDetailsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockSupplierTransferDetailsControllerPreLoad",function(s,t,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.stockOrderBean=o.get("_e_cOt_pio"),s.roleId=o.get("_s_tk_rId"),s.headOffice=o.get("_s_tk_iho"),s.data=c.loadControllerData(),s.fetchData(),s.isAdmin();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),s.AllInOne()}},s.isAdmin=function(){return null!=s.headOffice&&""!=s.headOffice.toString()&&"false"==s.headOffice.toString()},s.fetchData=function(){if(n.stockReturnDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data){if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap)}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",s.stockOrderBean.itemCountRecv=0,s.grandrecvTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0"),0==s.isAdmin()&&(1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].recvProdQty:s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].recvProdQty,isNaN(s.stockOrderDetailBeansList[e].recvTotal)&&(s.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].recvProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCountRecv=parseInt(s.stockOrderBean.itemCountRecv)+parseInt(s.stockOrderDetailBeansList[e].recvProdQty),!isNaN(s.stockOrderBean.itemCountRecv)&&""!=s.stockOrderBean.itemCountRecv||(s.stockOrderBean.itemCountRecv="0"),s.grandrecvTotal=parseFloat(s.grandrecvTotal)+parseFloat(s.stockOrderDetailBeansList[e].recvTotal),isNaN(s.grandrecvTotal)&&(s.grandrecvTotal="0"))},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.addStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.showSendReturnStockOrder=function(){s.showConfirmSendReturnPopup=!0},s.returnStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferToSupplierStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendReturnPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"205px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StockSupplierTransferEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockSupplierTransferEditDetailsController",function(r,e,t,a,o,s,n,i){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.headOffice=o.get("_s_tk_iho"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.sReturn="1",r.isAdmin(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate),"1"!=r.sReturn&&(a.location="/app/#/home"))},r.isAdmin=function(){return null!=r.headOffice&&""!=r.headOffice.toString()&&"false"==r.headOffice.toString()?(r.sReturn="0",!0):!(r.sReturn="1")},r.fetchData=function(){s.stockReturnEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):(null!=r.data.outletBeansList&&(r.outletList=r.data.outletBeansList),null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)),s.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="5",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.supplierList,function(e,t){e.supplierId==r.stockOrderBean.supplierId&&(r.stockOrderBean.supplierName=e.supplierName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockSupplierTransferEditProductsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockSupplierTransferEditProductsControllerPreLoad",function(t,s,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.roleId=o.get("_s_tk_rId"),s.stockOrderBean=o.get("_ct_bl_ost"),null!=s.stockOrderBean.retailPriceBill&&("true"==s.stockOrderBean.retailPriceBill.toString()?s.stockOrderBean.retailPriceBill=!0:s.stockOrderBean.retailPriceBill=!1),s.data=c.loadControllerData(),s.fetchData();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),s.AllInOne()}},s.isAdmin=function(){return null!=s.headOffice&&""!=s.headOffice.toString()&&"false"==s.headOffice.toString()},s.fetchData=function(){if(n.stockReturnEditProductsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=s.data.stockOrderDetailBeansList&&(s.stockOrderDetailBeansList=s.data.stockOrderDetailBeansList),null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap)}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",o=angular.copy(e);var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),o.isDirty=!0,s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",s.stockOrderBean.itemCountRecv=0,s.grandrecvTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0"),0==s.isAdmin()&&(1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].recvProdQty:s.stockOrderDetailBeansList[e].recvTotal=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].recvProdQty,isNaN(s.stockOrderDetailBeansList[e].recvTotal)&&(s.stockOrderDetailBeansList[e].recvTotal="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].recvProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCountRecv=parseInt(s.stockOrderBean.itemCountRecv)+parseInt(s.stockOrderDetailBeansList[e].recvProdQty),!isNaN(s.stockOrderBean.itemCountRecv)&&""!=s.stockOrderBean.itemCountRecv||(s.stockOrderBean.itemCountRecv="0"),s.grandrecvTotal=parseFloat(s.grandrecvTotal)+parseFloat(s.stockOrderDetailBeansList[e].recvTotal),isNaN(s.grandrecvTotal)&&(s.grandrecvTotal="0"))},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.updateStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,o.put("_e_cOt_pio",""),0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.showSendTransferStockOrder=function(){s.showConfirmSendTransferPopup=!0},s.transferStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferToSupplierStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendTransferPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.showSendReturnStockOrder=function(){s.showConfirmSendReturnPopup=!0},s.returnStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferToSupplierStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendReturnPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StockTransferActionsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","StockTransferActionsControllerPreLoad",function(a,e,r,t,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,a.disableProcess=!1,a.showConfirmCancelPopup=!1,a.showConfirmSendReturnPopup=!1,a.stockOrderDetailBeansList=[],a.sessionValidation=function(){i.validate()&&(a._s_tk_com=o.get("_s_tk_com"),a.roleId=o.get("_s_tk_rId"),a.userOutletId=o.get("_s_tk_oId"),a.headOffice=o.get("_s_tk_iho"),a.stockOrderBean=o.get("_ct_bl_ost"),"true"==a.stockOrderBean.retailPriceBill?a.stockOrderBean.retailPriceBill=!0:a.stockOrderBean.retailPriceBill=!1,a.data=c.loadControllerData(),a.fetchData(),"3"!=a.stockOrderBean.statusId&&"8"!=a.stockOrderBean.statusId||(a.disableProcess=!0),a.isAdmin(),a.stockOrderBean.itemCount=0,a.calculateItemCount())},a.isAdmin=function(){return null==a.headOffice||""==a.headOffice.toString()||"true"!=a.headOffice.toString()},a.fetchData=function(){if(n.stockTransferActionsLoadedFully=!1,"NORECORDFOUND"==a.data)a.error=!0,a.errorMessage="No record found";else if("SYSTEMBUSY"==a.data)a.error=!0,a.errorMessage=a.systemBusy;else if("INVALIDSESSION"==a.data)a.error=!0,a.errorMessage="An exception occured while validating session !",r.location="/app/#/login";else if(null!=a.data){"No record found !"!=a.data&&(a.stockOrderDetailBeansList=a.data,a.calculateTotalAll());var t='<div style="margin-left: 10px  !important;"><div class="row !important;"><div class="col-md-2 !important;"></div> <div class="col-md-2 !important;"><h4><label> Order No: </label> </h4></div><div class="col-md-2 !important;"><h4>'+a.stockOrderBean.orderNo+' </h4></div> <div class="col-md-6 !important;"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Delivery due: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.diliveryDueDate+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Order from: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.sourceOutletAddress+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Deliver to: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletName+' </h4></div> <div class="col-md-6"></div> </div><div class="row"><div class="col-md-2"></div> <div class="col-md-2"><h4><label> Address: </label> </h4></div><div class="col-md-2"><h4>'+a.stockOrderBean.outletAddress+' </h4></div> <div class="col-md-6"></div> </div> <div>';setTimeout(function(){$("#myTable1").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100),setTimeout(function(){$("#myTable").DataTable({responsive:!0,dom:"Bfrtip",caption:"Mike Smith",buttons:{buttons:[{customize:function(e){$(e.document.body).css("font-size","10pt").prepend(t)},extend:"print",text:'<i class="fa fa-print"></i> Print',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!0},{extend:"excel",text:'<i class="fa fa-book"></i> Excel',title:$("h1").text(),key:{key:"p",altkey:!0},exportOptions:{columns:":not(.no-print)"},footer:!0,autoPrint:!1},{extend:"pdf",text:'<i class="fa fa-file-pdf-o"></i> PDF',title:$("h1").text(),exportOptions:{columns:":not(.no-print)"},footer:!0}],dom:{container:{className:"dt-buttons"},button:{className:"btn btn-default"}}}})},100)}n.globalPageLoader=!1},a.calculateItemCount=function(){if(a.stockOrderBean.itemCount=0,null!=a.stockOrderDetailBeansList)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.stockOrderBean.itemCount=parseInt(a.stockOrderBean.itemCount)+parseInt(a.stockOrderDetailBeansList[e].orderProdQty),isNaN(a.stockOrderBean.itemCount)&&(a.stockOrderBean.itemCount="0")},a.showCancelStockOrder=function(){a.showConfirmCancelPopup=!0},a.cancelStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.stockOrderBean.statusId="8",a.stockOrderBean.diliveryDueDate=new Date(a.stockOrderBean.diliveryDueDate),e.post("purchaseOrder/updateStockOrder/"+a._s_tk_com,a.stockOrderBean).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmCancelPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.calculateTotal=function(r){angular.forEach(a.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==a.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1)}),a.calculateGrandTotal()},a.calculateTotalAll=function(){if(0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)a.calculateTotal(a.stockOrderDetailBeansList[e].productVariantId)},a.calculateGrandTotal=function(){if(a.grandTotal="0",0<a.stockOrderDetailBeansList.length)for(var e=0;e<a.stockOrderDetailBeansList.length;e++)isNaN(a.stockOrderDetailBeansList[e].total)&&(a.stockOrderDetailBeansList[e].total="0"),a.grandTotal=parseFloat(a.grandTotal)+parseFloat(a.stockOrderDetailBeansList[e].total),isNaN(a.grandTotal)&&(a.grandTotal="0")},a.showSendTransferStockOrder=function(){0==a.checkStockOrderDetailList()?r.location="/app/#/stockTransferEditProducts":a.showConfirmSendTransferPopup=!0},a.checkStockOrderDetailList=function(){if(0<a.stockOrderDetailBeansList.length){for(var e=0;e<a.stockOrderDetailBeansList.length;e++){if(""==a.stockOrderDetailBeansList[e].orderProdQty||null==a.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==a.stockOrderDetailBeansList[e].ordrSupplyPrice||null==a.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==a.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},a.transferStockOrder=function(){a.success=!1,a.error=!1,a.loading=!0,a.calculateGrandTotal(),a.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+a._s_tk_com+"/"+a.grandTotal,a.stockOrderDetailBeansList).success(function(e){a.loading=!1,a.responseStatus=e.status,"SUCCESSFUL"==a.responseStatus?(a.productTypeBean={},a.success=!0,a.successMessage="Request Processed successfully!",a.stockOrderBean.stockOrderId=e.data,a.showConfirmSendTransferPopup=!1,t(function(){a.success=!1,r.location=e.layOutPath},1e3)):"SYSTEMBUSY"==a.responseStatus||"INVALIDUSER"==a.responseStatus||"ERROR"==a.responseStatus||"INVALIDSESSION"==a.responseStatus?(a.error=!0,a.errorMessage=e.data,r.location=e.layOutPath):(a.error=!0,a.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,a.error=!0,a.errorMessage=a.systemBusy})},a.purchaseOrderReceive=function(){r.location="/app/#/purchaseOrderReceive"},a.purchaseOrderEditProducts=function(){r.location="/app/#/stockTransferEditProducts"},a.purchaseOrderEditDetails=function(){r.location="/app/#/stockTransferEditDetails"},a.sessionValidation()}],StockTransferController=["$scope","$filter","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferControllerPreLoad",function(r,e,t,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.stockOrderBean={},r.stockOrderBean.diliveryDueDate=new Date,r.HHMM=e("date")(new Date,"HH:mm"),r.stockOrderBean.orderNo="ST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.stockOrderBean.stockRefNo="ST-"+String(parseInt((new Date).getMonth())+1)+"/"+(new Date).getDate()+"/"+(new Date).getFullYear()+" "+r.HHMM,r.sessionValidation=function(){i.validate()&&(r._s_tk_com=s.get("_s_tk_com"),r.roleId=s.get("_s_tk_rId"),r.userOutletId=s.get("_s_tk_oId"),r.data=c.loadControllerData(),r.fetchData(),r.stockOrderBean.sourceOutletId=r.userOutletId)},r.fetchData=function(){if(n.stockTransferLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",o.location="/app/#/login";else{if(null!=r.data.outletBeansList){r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList);for(var e=0;e<r.destOutletList.length;e++)r.destOutletList[e].outletId==r.userOutletId&&r.destOutletList.splice(e,1)}null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList),null!=r.data.retailPriceBill&&("true"==r.data.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1)}n.globalPageLoader=!1},r.addStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="3",t.post("purchaseOrder/addStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,a(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),s.put("_e_cOt_pio",r.stockOrderBean),o.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,o.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockTransferDetailsController=["$sce","$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferDetailsControllerPreLoad",function(t,s,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.showConfirmDeletePopup=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.stockTransferDetailBeansList=[],s.stockTransferOrderBean={},s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.stockOrderBean=o.get("_e_cOt_pio"),s.roleId=o.get("_s_tk_rId"),s.headOffice=o.get("_s_tk_iho"),s.data=c.loadControllerData(),s.fetchData();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString()}},s.isAdmin=function(){return null==s.headOffice||""==s.headOffice.toString()||"true"!=s.headOffice.toString()},s.fetchData=function(){if(n.stockTransferDetailsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data){if(null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}if(null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap),null!=s.data.stockTransferOrderBeansList){s.stockTransferOrderBeansList=s.data.stockTransferOrderBeansList;for(e=0;e<s.stockTransferOrderBeansList.length;e++)s.stockOrderBean.stockOrderId==s.stockTransferOrderBeansList[e].stockOrderId&&s.stockTransferOrderBeansList.splice(e,1)}}n.globalPageLoader=!1},s.copyPreviousStockOrderDetails=function(){null!=s.stockTransferOrderBean&&(angular.forEach(s.stockTransferOrderBeansList,function(e,t){e.stockOrderId==s.stockTransferOrderBean.stockOrderId&&(s.stockTransferOrderBean.stockOrderTypeId=angular.copy(e.stockOrderTypeId))}),"3"==s.stockTransferOrderBean.stockOrderTypeId&&"-1"!=s.stockTransferOrderBean.stockOrderId.toString()&&(s.globalPageLoader=!0,e.post("purchaseOrderActions/getAllDetailsByStockOrderId/"+s._s_tk_com,s.stockTransferOrderBean).success(function(e){if(s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.stockOrderDetailBeansList=[],s.stockTransferDetailBeansList=e.data,null!=s.stockTransferDetailBeansList&&0<s.stockTransferDetailBeansList.length){s.counter=1;for(var t=0;t<s.stockTransferDetailBeansList.length;t++)if(null!=s.stockTransferDetailBeansList[t].productVariantId){if(s.productVariantBean={},s.productVariantBean.productVariantId=angular.copy(s.stockTransferDetailBeansList[t].productVariantId),s.stockOrderDetailBean.orderProdQty=angular.copy(s.stockTransferDetailBeansList[t].orderProdQty),s.productVariantBean.isProduct=angular.copy(s.stockTransferDetailBeansList[t].isProduct),1==s.productVariantBean.isProduct){for(var r=0;r<s.productBeansList.length;r++)if(s.productVariantBean.productVariantId==s.productBeansList[r].productVariantId){s.productVariantBean=angular.copy(s.productBeansList[r]);break}}else for(r=0;r<s.productVariantBeansList.length;r++)if(s.productVariantBean.productVariantId==s.productVariantBeansList[r].productVariantId){s.productVariantBean=angular.copy(s.productVariantBeansList[r]);break}s.addProduct()}s.globalPageLoader=!1}else s.globalPageLoader=!1;s.AllInOne()}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):"NORECORDFOUND"==s.responseStatus?s.globalPageLoader=!1:(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),"4"==s.stockTransferOrderBean.stockOrderTypeId&&"-1"!=s.stockTransferOrderBean.stockOrderId.toString()&&(s.globalPageLoader=!0,e.post("purchaseOrderActions/getAllDetailsByStockOrderIdforWarehouse/"+s._s_tk_com,s.stockTransferOrderBean).success(function(e){if(s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus)if(s.stockOrderDetailBeansList=[],s.stockTransferDetailBeansList=e.data,null!=s.stockTransferDetailBeansList&&0<s.stockTransferDetailBeansList.length){s.counter=1;for(var t=0;t<s.stockTransferDetailBeansList.length;t++)if(null!=s.stockTransferDetailBeansList[t].productVariantId){if(s.productVariantBean={},s.productVariantBean.productVariantId=angular.copy(s.stockTransferDetailBeansList[t].productVariantId),s.stockOrderDetailBean.orderProdQty=angular.copy(s.stockTransferDetailBeansList[t].orderProdQty),s.productVariantBean.isProduct=angular.copy(s.stockTransferDetailBeansList[t].isProduct),1==s.productVariantBean.isProduct){for(var r=0;r<s.productBeansList.length;r++)if(s.productVariantBean.productVariantId==s.productBeansList[r].productVariantId){s.productVariantBean=angular.copy(s.productBeansList[r]);break}}else for(r=0;r<s.productVariantBeansList.length;r++)if(s.productVariantBean.productVariantId==s.productVariantBeansList[r].productVariantId){s.productVariantBean=angular.copy(s.productVariantBeansList[r]);break}s.addProduct()}s.globalPageLoader=!1}else s.globalPageLoader=!1;else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):"NORECORDFOUND"==s.responseStatus?s.globalPageLoader=!1:(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})))},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?"true"!=a.isProduct?(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBean.isDirty=!0,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0")},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.addStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,s.stockOrderDetailBeansList=e.data,o.put("_ct_bl_ost",o.get("_e_cOt_pio")),o.put("_e_cOt_pio",""),0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1,a.location=e.layOutPath},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.saveAndTransferStockOrderDetail=function(){s.addStockOrderDetail(),a.location="/app/#/stockTransfer"},s.showSendTransferStockOrder=function(){s.showConfirmSendTransferPopup=!0},s.transferStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendTransferPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StockTransferEditDetailsController=["$scope","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferEditDetailsControllerPreLoad",function(r,e,t,a,o,s,n,i){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.sessionValidation=function(){n.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.roleId=o.get("_s_tk_rId"),r.userOutletId=o.get("_s_tk_oId"),r.stockOrderBean=o.get("_ct_bl_ost"),"true"==r.stockOrderBean.retailPriceBill?r.stockOrderBean.retailPriceBill=!0:r.stockOrderBean.retailPriceBill=!1,r.data=i.loadControllerData(),r.fetchData(),r.stockOrderBean.diliveryDueDate=new Date(r.stockOrderBean.diliveryDueDate))},r.fetchData=function(){if(s.stockTransferEditDetailsLoadedFully=!1,"NORECORDFOUND"==r.data)r.error=!0,r.errorMessage="No record found";else if("SYSTEMBUSY"==r.data)r.error=!0,r.errorMessage=r.systemBusy;else if("INVALIDSESSION"==r.data)r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else{if(null!=r.data.outletBeansList){r.outletList=r.data.outletBeansList,r.destOutletList=angular.copy(r.outletList);for(var e=0;e<r.destOutletList.length;e++)r.destOutletList[e].outletId==r.userOutletId&&r.destOutletList.splice(e,1)}null!=r.data.stockOrderTypeBeansList&&(r.stockOrderTypeBeansList=r.data.stockOrderTypeBeansList),null!=r.data.supplierBeansList&&(r.supplierList=r.data.supplierBeansList)}s.globalPageLoader=!1},r.updateStockOrder=function(){r.success=!1,r.error=!1,r.loading=!0,r.stockOrderBean.statusId="1",r.stockOrderBean.stockOrderTypeId="3",e.post("purchaseOrder/updateStockOrder/"+r._s_tk_com,r.stockOrderBean).success(function(e){r.loading=!1,r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage="Request Processed successfully!",r.stockOrderBean.stockOrderId=e.data,t(function(){r.success=!1,angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.outletId&&(r.stockOrderBean.outletName=e.outletName)}),angular.forEach(r.outletList,function(e,t){e.outletId==r.stockOrderBean.sourceOutletId&&(r.stockOrderBean.sourceOutletName=e.outletName)}),angular.forEach(r.stockOrderTypeBeansList,function(e,t){e.stockOrderTypeId==r.stockOrderBean.stockOrderTypeId&&(r.stockOrderBean.stockOrderTypeDesc=e.stockOrderTypeDesc)}),o.put("_ct_bl_ost",""),o.remove("_ct_bl_ost"),o.put("_ct_bl_ost",r.stockOrderBean),a.location=e.layOutPath},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.sessionValidation()}],StockTransferEditProductsController=["$scope","$sce","$http","$timeout","$window","$cookieStore","$rootScope","SessionService","StockTransferEditProductsControllerPreLoad",function(s,t,e,r,a,o,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,s.productVariantBean={},s.productVariantBeansList=[],s.stockOrderDetailBean={},s.delStockOrderDetailBean={},s.stockOrderDetailBeansList=[],s.counter=1,s.hideRefValues=!1,s.productVariantMap=[],s.productMap=[],s.productSKU="",s.skudisable=!1,s.inputTypeScan=!0,s.sessionValidation=function(){if(i.validate()){s._s_tk_com=o.get("_s_tk_com"),s.roleId=o.get("_s_tk_rId"),s.stockOrderBean=o.get("_ct_bl_ost"),s.headOffice=o.get("_s_tk_iho"),null!=s.stockOrderBean.retailPriceBill&&("true"==s.stockOrderBean.retailPriceBill.toString()?s.stockOrderBean.retailPriceBill=!0:s.stockOrderBean.retailPriceBill=!1),s.data=c.loadControllerData(),s.fetchData();var e=new Date(s.stockOrderBean.diliveryDueDate),t=e.getDate(),r=e.getMonth()+1,a=e.getFullYear();s.stockOrderBean.diliveryDueDate=r.toString()+"/"+t.toString()+"/"+a.toString(),s.isAdmin(),s.stockOrderBean.itemCount=0,s.AllInOne()}},s.isAdmin=function(){return null==s.headOffice||""==s.headOffice.toString()||"true"!=s.headOffice.toString()},s.fetchData=function(){if(n.stockTransferEditProductsLoadedFully=!1,"NORECORDFOUND"==s.data)s.error=!0,s.errorMessage="No record found";else if("SYSTEMBUSY"==s.data)s.error=!0,s.errorMessage=s.systemBusy;else if("INVALIDSESSION"==s.data)s.error=!0,s.errorMessage="An exception occured while validating session !",a.location="/app/#/login";else if(null!=s.data.stockOrderDetailBeansList&&(s.stockOrderDetailBeansList=s.data.stockOrderDetailBeansList,0<s.stockOrderDetailBeansList.length?console.log(s.stockOrderDetailBeansList[0].variantAttributeName):console.log("No data found")),null!=s.data.productVariantBeansList&&(s.productVariantBeansList=s.data.productVariantBeansList),null!=s.data.productVariantMap&&(s.productVariantMap=s.data.productVariantMap),null!=s.data.productMap&&(s.productMap=s.data.productMap),null!=s.data.productBeansList){s.productBeansList=s.data.productBeansList;for(var e=0;e<s.productVariantBeansList.length;e++)s.productBeansList.push(s.productVariantBeansList[e])}n.globalPageLoader=!1},s.checkProductStatus=function(){var e=s.stockOrderDetailBean.orderProdQty;if("true"==s.productVariantBean.isVariant.toString())s.addProduct();else{if(s.hit=0,"true"==s.productVariantBean.isProduct.toString())s.addProduct(),s.hit++;else for(var t=0;t<s.productVariantBeansList.length;t++){var r=null;s.productVariantBean.productVariantId==s.productVariantBeansList[t].productId&&(r=angular.copy(s.productVariantBean),s.productVariantBean=angular.copy(s.productVariantBeansList[t]),s.stockOrderDetailBean.orderProdQty=angular.copy(e),s.addProduct(),s.productVariantBean=angular.copy(r),s.hit++)}s.hit<1&&(s.productVariantBean.isProduct="true",s.addProduct())}s.AllInOne()},s.addProduct=function(){s.dualEntry=!1;var a=s.productVariantBean,o={};0<s.stockOrderDetailBeansList.length?("true"!=a.isProduct?angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"!=e.isProduct&&"true"!=a.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}):angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==a.productVariantId&&"true"==e.isProduct){isNaN(e.orderProdQty)&&(e.orderProdQty="0"),e.orderProdQty=parseInt(e.orderProdQty)+parseInt(s.stockOrderDetailBean.orderProdQty),0<e.ordrSupplyPrice?(e.total=e.ordrSupplyPrice*e.orderProdQty,1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0")):e.total="0",(o=angular.copy(e)).isDirty=!0;var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1),s.stockOrderDetailBeansList.unshift(o),s.dualEntry=!0}}),1!=s.dualEntry&&(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,isNaN(s.stockOrderDetailBean.total)&&(s.stockOrderDetailBean.total="0"),s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean),s.dualEntry=!1)):(s.stockOrderDetailBean.productVariantId=a.productVariantId,s.stockOrderDetailBean.variantAttributeName=a.variantAttributeName,s.stockOrderDetailBean.productVariantCurrInventory=a.currentInventory,s.stockOrderDetailBean.productVariantRecvOutletInventory=a.recCurrentInventory,s.stockOrderDetailBean.isProduct=a.isProduct,null!=a.supplyPriceExclTax&&(s.stockOrderDetailBean.ordrSupplyPrice="",s.stockOrderDetailBean.ordrSupplyPrice=angular.copy(a.supplyPriceExclTax)),null!=a.retailPriceExclTax&&(s.stockOrderDetailBean.retailPrice="",s.stockOrderDetailBean.retailPrice=angular.copy(a.retailPriceExclTax)),1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBean.total=s.stockOrderDetailBean.retailPrice*s.stockOrderDetailBean.orderProdQty:s.stockOrderDetailBean.total=s.stockOrderDetailBean.ordrSupplyPrice*s.stockOrderDetailBean.orderProdQty,s.stockOrderDetailBean.order=s.counter,s.stockOrderDetailBean.isDirty=!0,s.counter++,s.stockOrderDetailBean.stockOrderId=s.stockOrderBean.stockOrderId,s.stockOrderDetailBeansList.unshift(s.stockOrderDetailBean)),s.stockOrderDetailBean={},s.airportName=[]},s.showConfirmDelete=function(e){s.delStockOrderDetailBean={},s.delStockOrderDetailBean=angular.copy(e),s.showConfirmDeletePopup=!0},s.delStockOrderDetail=function(){void 0!==s.delStockOrderDetailBean.stockOrderDetailId&&(s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/deleteStockOrderDetail/"+s._s_tk_com,s.delStockOrderDetailBean).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?s.loading=!1:"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||"INVALIDSESSION"==s.responseStatus?(s.error=!0,s.errorMessage=e.data,a.location=e.layOutPath):(s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})),angular.forEach(s.stockOrderDetailBeansList,function(e,t){if(e.productVariantId==s.delStockOrderDetailBean.productVariantId&&e.isProduct==s.delStockOrderDetailBean.isProduct){var r=s.stockOrderDetailBeansList.indexOf(e);s.stockOrderDetailBeansList.splice(r,1)}}),s.showConfirmDeletePopup=!1,s.delStockOrderDetailBean={},s.AllInOne()},s.AllInOne=function(){if(s.counter=1,s.stockOrderBean.itemCount=0,s.grandTotal="0",0<s.stockOrderDetailBeansList.length)for(var e=0;e<s.stockOrderDetailBeansList.length;e++)s.stockOrderDetailBeansList[e].order=s.counter,s.counter++,1==s.stockOrderBean.retailPriceBill?s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].retailPrice*s.stockOrderDetailBeansList[e].orderProdQty:s.stockOrderDetailBeansList[e].total=s.stockOrderDetailBeansList[e].ordrSupplyPrice*s.stockOrderDetailBeansList[e].orderProdQty,isNaN(s.stockOrderDetailBeansList[e].total)&&(s.stockOrderDetailBeansList[e].total="0"),parseInt(s.stockOrderDetailBeansList[e].productVariantCurrInventory)<parseInt(s.stockOrderDetailBeansList[e].orderProdQty)?s.stockOrderDetailBeansList[e].greaterThanStock=!0:s.stockOrderDetailBeansList[e].greaterThanStock=!1,s.stockOrderBean.itemCount=parseInt(s.stockOrderBean.itemCount)+parseInt(s.stockOrderDetailBeansList[e].orderProdQty),isNaN(s.stockOrderBean.itemCount)&&(s.stockOrderBean.itemCount="0"),s.grandTotal=parseFloat(s.grandTotal)+parseFloat(s.stockOrderDetailBeansList[e].total),isNaN(s.grandTotal)&&(s.grandTotal="0")},s.calculateTotalforItem=function(r){angular.forEach(s.stockOrderDetailBeansList,function(e,t){e.productVariantId==r&&(1==s.stockOrderBean.retailPriceBill?e.total=e.retailPrice*e.orderProdQty:e.total=e.ordrSupplyPrice*e.orderProdQty,isNaN(e.total)&&(e.total="0"),parseInt(e.productVariantCurrInventory)<parseInt(e.orderProdQty)?e.greaterThanStock=!0:e.greaterThanStock=!1,e.isDirty=!0)}),s.AllInOne()},s.checkStockOrderDetailList=function(){if(0<s.stockOrderDetailBeansList.length){for(var e=0;e<s.stockOrderDetailBeansList.length;e++){if(""==s.stockOrderDetailBeansList[e].orderProdQty||null==s.stockOrderDetailBeansList[e].orderProdQty)return!1;if(""==s.stockOrderDetailBeansList[e].ordrSupplyPrice||null==s.stockOrderDetailBeansList[e].ordrSupplyPrice)return!1;if(1==s.stockOrderDetailBeansList[e].greaterThanStock)return!1}return!0}return!1},s.updateStockOrderDetail=function(){0<s.stockOrderDetailBeansList.length&&(s.success=!1,s.error=!1,s.loading=!0,e.post("purchaseOrderDetails/updateStockOrderDetail/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){if(s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus){if(s.success=!0,o.put("_e_cOt_pio",""),s.stockOrderDetailBeansList=e.data,0<s.stockOrderDetailBeansList.length)for(var t=0;t<s.stockOrderDetailBeansList.length;t++)s.stockOrderDetailBeansList[t].isDirty=!1;s.AllInOne(),r(function(){s.success=!1},2e3)}else"SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy}))},s.saveAndTransferStockOrderDetail=function(){s.updateStockOrderDetail(),a.location="/app/#/stockTransfer"},s.showSendTransferStockOrder=function(){s.showConfirmSendTransferPopup=!0},s.transferStockOrder=function(){s.success=!1,s.error=!1,s.loading=!0,s.stockOrderBean.statusId="3",e.post("purchaseOrderDetails/updateAndTransferStockOrderDetails/"+s._s_tk_com+"/"+s.grandTotal+"/"+s.stockOrderBean.itemCount,s.stockOrderDetailBeansList).success(function(e){s.loading=!1,s.responseStatus=e.status,"SUCCESSFUL"==s.responseStatus?(s.productTypeBean={},s.success=!0,s.successMessage="Request Processed successfully!",s.stockOrderBean.stockOrderId=e.data,s.showConfirmSendTransferPopup=!1,r(function(){s.success=!1,a.location=e.layOutPath},1e3)):("SYSTEMBUSY"==s.responseStatus||"INVALIDUSER"==s.responseStatus||"ERROR"==s.responseStatus||s.responseStatus,s.error=!0,s.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,s.error=!0,s.errorMessage=s.systemBusy})},s.autoCompleteOptions={minimumChars:1,dropdownHeight:"105px",data:function(t){if(15<(t=t.toLowerCase()).length)return s.airportName=[],document.getElementById("lov").disabled=!1,void document.getElementById("lov").focus();s.productVariantsBeans=[],document.getElementById("lov").disabled=!0;var e=_.filter(s.productBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.productBeansList,function(e){return e.sku.toLowerCase()==t});return 0==e.length&&(e=_.filter(s.allProductBeansList,function(e){return e.variantAttributeName.toLowerCase().includes(t)||e.sku.toLowerCase().includes(t)}),r=_.filter(s.allProductBeansList,function(e){return e.sku.toLowerCase()==t})),r&&0<r.length?(s.hideRefValues=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=r[0],s.checkProductStatus(),s.selectedItem={},s.selectedItem.item=r[0],s.airportName=[],document.getElementById("lov").disabled=!1,document.getElementById("lov").focus()):(15<t.length&&(s.airportName=[]),document.getElementById("lov").disabled=!1,document.getElementById("lov").focus(),s.hideRefValues=!1),e},renderItem:function(e){return 0==s.hideRefValues?{value:e.variantAttributeName,label:t.trustAsHtml("<table class='auto-complete'><tbody><tr><td style='width: 90%'>"+e.variantAttributeName+"</td><td style='width: 10%'></td></tr></tbody></table>")}:null},itemSelected:function(e){s.productVariantBean=e.item}},s.skuinput=function(){(s.productSKU.includes("-")||6<s.productSKU.length)&&(null!=s.productVariantMap[s.productSKU.toLowerCase()]?(s.skudisable=!0,s.stockOrderDetailBean.orderProdQty=1,s.productVariantBean=s.productVariantMap[s.productSKU.toLowerCase()],s.checkProductStatus(),s.productSKU="",s.skudisable=!1):15<s.productSKU.length&&(s.productSKU="",s.skudisable=!1))},s.sessionValidation()}],StoreController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$route","StoreControllerPreLoad",function(t,e,r,a,o,s,n,i,c){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.companyBean={},t.sessionValidation=function(){s.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=c.loadControllerData(),t.fetchData())},t.fetchData=function(){o.storeLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):(null!=t.data.timeZoneBeans&&(t.timeZonesList=t.data.timeZoneBeans),null!=t.data.currencyBeans&&(t.currencyList=t.data.currencyBeans),null!=t.data.printerFormatBeans&&(t.printerFormatsList=t.data.printerFormatBeans),null!=t.data.companyBean&&(t.companyBean=t.data.companyBean)),o.globalPageLoader=!1},t.updateCompany=function(){t.companySuccess=!1,t.companyError=!1,t.loading=!0,e.post("store/updateCompany/"+t._s_tk_com,t.companyBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companySuccess=!0,t.companyBean={},t.companyBean=e.data,t.companySuccessMessage="Request Processed successfully!",n(function(){t.companySuccess=!1,i.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.loading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy})},t.updateContactInformation=function(){t.companySuccess=!1,t.companyError=!1,t.contactInformationloading=!0,e.post("store/updateContactInformation/"+t._s_tk_com,t.companyBean).success(function(e){t.contactInformationloading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companySuccess=!0,t.companySuccessMessage="Request Processed successfully!",n(function(){t.companySuccess=!1,i.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.contactInformationloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy})},t.updateAddress=function(){t.companySuccess=!1,t.companyError=!1,t.addressInformationloading=!0,e.post("store/updateAddress/"+t._s_tk_com,t.companyBean).success(function(e){t.addressInformationloading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.companySuccess=!0,t.companySuccessMessage="Request Processed successfully!",n(function(){t.companySuccess=!1,i.reload()},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.companyError=!0,t.companyErrorMessage=e.data,r.location=e.layOutPath):(t.companyError=!0,t.companyErrorMessage=e.data)}).error(function(){t.addressInformationloading=!1,t.companyError=!0,t.companyErrorMessage=t.systemBusy})},t.cancelClick=function(){r.location="/app/#"},t.populatePhysicalAddress=function(){null!=t.companyBean&&null!=t.companyBean.addresses&&0<t.companyBean.addresses.length&&(t.companyBean.addresses[1].contactName=t.companyBean.addresses[0].contactName,t.companyBean.addresses[1].firstName=t.companyBean.addresses[0].firstName,t.companyBean.addresses[1].lastName=t.companyBean.addresses[0].lastName,t.companyBean.addresses[1].email=t.companyBean.addresses[0].email,t.companyBean.addresses[1].phone=t.companyBean.addresses[0].phone,t.companyBean.addresses[1].fax=t.companyBean.addresses[0].fax,t.companyBean.addresses[1].website=t.companyBean.addresses[0].website,t.companyBean.addresses[1].twitter=t.companyBean.addresses[0].twitter,t.companyBean.addresses[1].street=t.companyBean.addresses[0].street,t.companyBean.addresses[1].suburb=t.companyBean.addresses[0].suburb,t.companyBean.addresses[1].city=t.companyBean.addresses[0].city,t.companyBean.addresses[1].postalCode=t.companyBean.addresses[0].postalCode,t.companyBean.addresses[1].state=t.companyBean.addresses[0].state,t.companyBean.addresses[1].countryId=t.companyBean.addresses[0].countryId,t.companyBean.addresses[1].addressType="Physcial Address")},t.sessionValidation()}],StoreCreditController=["$scope","$http","$window","$cookieStore","$rootScope","$timeout","SessionService","StoreCreditControllerPreLoad",function(t,e,r,a,o,s,n,i){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.loading=!1,t.companyBean={},t.enableStoreCreditShow={},t.sessionValidation=function(){n.validate()&&(t._s_tk_com=a.get("_s_tk_com"),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){o.storeCreditLoadedFully=!1,"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage=t.systemBusy):"INVALIDSESSION"==t.data?(t.error=!0,t.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=t.data&&(t.companyBean=t.data,"true"==t.companyBean.enableStoresCredit?t.enableStoreCreditShow.value=!0:t.enableStoreCreditShow.value=!1),o.globalPageLoader=!1},t.updateStoreCredit=function(){t.storeCreditSuccess=!1,t.storeCreditError=!1,t.companyBean.enableStoresCredit=t.enableStoreCreditShow.value,t.loading=!0,e.post("storeCredit/updateStoreCreditbyCompany/"+t._s_tk_com,t.companyBean).success(function(e){t.loading=!1,t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.storeCreditSuccess=!0,t.storeCreditSuccessMessage=e.data,s(function(){t.storeCreditSuccess=!1},2e3)):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.storeCreditError=!0,t.storeCreditErrorMessage=e.data,r.location=e.layOutPath):(t.storeCreditError=!0,t.storeCreditErrorMessage=e.data)}).error(function(){t.loading=!1,t.storeCreditError=!0,t.storeCreditErrorMessage=t.systemBusy})},t.sessionValidation()}],SupplierDetailsController=["$scope","$http","$window","$timeout","$cookieStore","$route","$rootScope","SessionService","SupplierDetailsControllerPreLoad",function(r,e,t,a,o,s,n,i,c){n.MainSideBarhideit=!1,n.MainHeaderideit=!1,r.stockOrderBeansList=[],r.supplierBean={},r.sId=o.get("sp_cto"),r.sessionValidation=function(){i.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.supplierBean&&(r.supplierBean=r.data.supplierBean),null!=r.data.supplierPaymentsBeanList&&(r.supplierPaymentBeansList=r.data.supplierPaymentsBeanList,setTimeout(function(){$("#myTable1").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"asc"]],bInfo:!0})},10)),null!=r.data.stockOrderBeansList&&(r.stockOrderBeansList=r.data.stockOrderBeansList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,order:[[1,"desc"]],bInfo:!0})},10))),n.globalPageLoader=!1},r.showUpdatePaymentModal=!1,r.addPayment=function(){r.showUpdatePaymentModal=!0,r.supplierPaymentBean={},r.supplierPaymentBean.createdDate=new Date,r.supplierPaymentBean.supplierBalance=angular.copy(r.supplierBean.supplierBalance),r.supplierPaymentBean.supplierNewBalance=r.supplierPaymentBean.supplierBalance,r.supplierPaymentBean.supplier=r.sId,r.supplierPaymentBean.orderRefNum="-1",r.supplierPaymentBean.adjustmentType="Cash Out",r.supplierPaymentBean.paymentCash="0",r.supplierPaymentBean.paymentAmount="0",r.supplierPaymentBean.paymentCreditCard="0",r.supplierPaymentBean.paymentOtherType="0",r.supplierPaymentBean.cashReturn="0"},r.addSuppliersPayment=function(){r.success=!1,r.error=!1,r.loading=!0,e.post("supplierDetails/addSupplierPayment/"+r._s_tk_com,r.supplierPaymentBean).success(function(e){r.responseStatus=e.status,r.loading=!1,"SUCCESSFUL"==r.responseStatus?(r.productTypeBean={},r.success=!0,r.successMessage=e.data,r.showUpdatePaymentModal=!1,a(function(){r.success=!1,r.showUpdatePaymentModal=!1,s.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplier=function(){r.success=!1,r.error=!1,e.post("supplierDetails/getSupplier/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierBean=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchStockOrders=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getAllStockOrdersBySupplierId/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.stockOrderBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchSupplierPayments=function(){r.success=!1,r.error=!1,r.sId=o.get("sp_cto"),e.post("supplierDetails/getSupplierPayments/"+r._s_tk_com,r.sId).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.supplierPaymentBeansList=e.data):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,t.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){n.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.populateOrderAmount=function(){angular.forEach(r.stockOrderBeansList,function(e,t){e.stockOrderId==r.supplierPaymentBean.orderRefNum&&(r.supplierPaymentBean.paymentAmount=angular.copy(e.totalCost))})},r.calculateNewBalance=function(){r.totalPayment=parseInt(r.supplierPaymentBean.paymentCash)+parseInt(r.supplierPaymentBean.paymentOtherType)+parseInt(r.supplierPaymentBean.paymentCreditCard)-parseInt(r.supplierPaymentBean.cashReturn),"Cash Out"==r.supplierPaymentBean.adjustmentType?r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)-parseInt(r.totalPayment)).toString():"Cash In"==r.supplierPaymentBean.adjustmentType&&(r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)+parseInt(r.totalPayment)).toString()),isNaN(r.supplierPaymentBean.supplierNewBalance)&&(r.supplierPaymentBean.supplierNewBalance="")},r.sessionValidation()}],SupplierSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","SupplierSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],SuppliersController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$route","SuppliersControllerPreLoad",function(r,t,a,o,s,e,n,i,c){s.MainSideBarhideit=!1,s.MainHeaderideit=!1,r.showUpdatePaymentModal=!1,o.put("supplier",""),r.supplierBean={},r.sessionValidation=function(){e.validate()&&(r._s_tk_com=o.get("_s_tk_com"),r.data=c.loadControllerData(),r.fetchData())},r.showDetails=function(e){o.put("sp_cto",e),a.location="/app/#/supplierDetails"},r.fetchData=function(){s.suppliersLoadedFully=!1,"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",a.location="/app/#/login"):null!=r.data&&(r.supplierBean=r.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),s.globalPageLoader=!1},r.addSupplier=function(){a.location="/app/#/newSupplier"},r.EditRecord=function(e){o.put("supplier",e),a.location="/app/#/newSupplier"},r.showUpdatePaymentModal=!1,r.addPayment=function(e,t){r.fetchStockOrders(e),r.showUpdatePaymentModal=!0,r.supplierPaymentBean={},r.supplierPaymentBean.createdDate=new Date,r.supplierPaymentBean.supplierBalance=angular.copy(t),r.supplierPaymentBean.supplierNewBalance=r.supplierPaymentBean.supplierBalance,r.supplierPaymentBean.supplier=e,r.supplierPaymentBean.orderRefNum="-1",r.supplierPaymentBean.adjustmentType="Cash Out",r.supplierPaymentBean.paymentCash="0",r.supplierPaymentBean.paymentAmount="0",r.supplierPaymentBean.paymentCreditCard="0",r.supplierPaymentBean.paymentOtherType="0",r.supplierPaymentBean.cashReturn="0"},r.addSuppliersPayment=function(){r.success=!1,r.error=!1,r.loading=!0,t.post("supplierDetails/addSupplierPayment/"+r._s_tk_com,r.supplierPaymentBean).success(function(e){r.responseStatus=e.status,r.loading=!1,"SUCCESSFUL"==r.responseStatus?(r.success=!0,r.successMessage=e.data,r.showUpdatePaymentModal=!1,n(function(){r.success=!1,r.showUpdatePaymentModal=!1,i.reload()},1e3)):"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.fetchStockOrders=function(e){r.success=!1,r.error=!1,t.post("supplierDetails/getAllStockOrdersBySupplierId/"+r._s_tk_com+"/"+e).success(function(e){r.responseStatus=e.status,"SUCCESSFUL"==r.responseStatus?r.stockOrderBeansList=e.data:"SYSTEMBUSY"==r.responseStatus||"INVALIDUSER"==r.responseStatus||"ERROR"==r.responseStatus||"INVALIDSESSION"==r.responseStatus?(r.error=!0,r.errorMessage=e.data,a.location=e.layOutPath):(r.error=!0,r.errorMessage=e.data)}).error(function(){s.emergencyInfoLoadedFully=!1,r.error=!0,r.errorMessage=r.systemBusy})},r.populateOrderAmount=function(){angular.forEach(r.stockOrderBeansList,function(e,t){e.stockOrderId==r.supplierPaymentBean.orderRefNum&&(r.supplierPaymentBean.paymentAmount=angular.copy(e.totalCost))})},r.calculateNewBalance=function(){r.totalPayment=parseInt(r.supplierPaymentBean.paymentCash)+parseInt(r.supplierPaymentBean.paymentOtherType)+parseInt(r.supplierPaymentBean.paymentCreditCard)-parseInt(r.supplierPaymentBean.cashReturn),"Cash Out"==r.supplierPaymentBean.adjustmentType?r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)-parseInt(r.totalPayment)).toString():"Cash In"==r.supplierPaymentBean.adjustmentType&&(r.supplierPaymentBean.supplierNewBalance=(parseInt(r.supplierPaymentBean.supplierBalance)+parseInt(r.totalPayment)).toString()),isNaN(r.supplierPaymentBean.supplierNewBalance)&&(r.supplierPaymentBean.supplierNewBalance="")},r.sessionValidation()}],SupportController=["$scope","$http","$window","$cookieStore","$rootScope","$route","SessionService","SupportControllerPreLoad",function(t,r,a,o,e,s,n,i){e.MainSideBarhideit=!1,e.MainHeaderideit=!1,t.showProcessing=!1,t.dasBoard="Documentation",t.controlPanel="Product Help",t.home="Home",t.pageName="Support",t.manageTicket="Manage Tickets",t.addOrManageTickets="Add or Manage Ticket",t.createTicket="Create Ticket",t.selectSeverityText="Select Severity",t.describeIssuePlaceHolder="Ticket Detail...",t.ticketNamePlaceHolder="Ticket Description...",t.ticketButtonText="Add Ticket",t.systemBusy="System is Busy Please try again",t.ticketId="Id",t.ticketName="Ticket Description",t.severity="Severity",t.status="Status",t.createdBy="Created By",t.createdDate="Created Date",t.tickets=[],t.ticket={},o.put("redirectedThroughManageEmployee",!1),t.sessionValidation=function(){n.validate()&&(t._s_tk_com=o.get("_s_tk_com"),e.supportProcessing=!1,o.put("supportProcessing",e.supportProcessing),t.data=i.loadControllerData(),t.fetchData())},t.fetchData=function(){e.supportLoadedFully=!1,e.supportProcessing=!1,o.put("supportProcessing",e.supportProcessing),"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage="System Busy"):"INVALIDSESSION"==t.data?(t.error=!0,a.location="/app/#/login"):null!=t.data&&(null!=t.data.ticketsList&&(t.tickets=t.data.ticketsList,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),null!=t.data.severityList&&(t.severities=t.data.severityList)),e.globalPageLoader=!1},t.addTicket=function(e){if("-1"==e.severityAssociationId)return t.alertMessage="Please select severity.",void $("#alertBox").modal("show");t.showProcessing=!0,r.post("support/addTicket/"+t._s_tk_com,e).success(function(e){t.showProcessing=!1,t.ticket={},t.ticket.severityAssociationId="-1",t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?s.reload():"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.showProcessing=!1,t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.getTicketActivities=function(e){o.put("_t_tob_gra",e.ticketId),a.location="/app/#/ticketActivity"},t.sessionValidation()}],TagSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","TagSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans)),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],TicketActivityController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","TicketActivityControllerPreLoad",function(t,r,a,e,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,t.dasBoard="Documentation",t.controlPanel="Product Help",t.home="Home",t.support="Support",t.pageName="Ticket Activity",t.manageTicketActivity="Manage Ticket",t.addOrManageTickets="Ticket Activities",t.ticketInfo="Ticket Information",t.selectSeverityText="Select Severity",t.describeIssue="Describe Issue...",t.ticketButtonText="Close Ticket",t.ticketReOpenButtonText="Reopen Ticket",t.severityText="Severity",t.statusText="Status",t.ticketDetailText="Detail",t.systemBusy="System is Busy Please try again",e.put("redirectedThroughManageEmployee",!1),e.put("isLogin",""),e.put("EmployeeInfo",""),e.put("isUpdateCall",""),e.put("CompanyInfo",""),e.put("isCompanyUpdateCall",""),e.put("WorkplaceInfo",""),e.put("isWorkplaceUpdateCall",""),e.put("departmentsInfo",""),e.put("invoiceNo",""),e.put("ScheduleInfo",""),e.put("isScheduleUpdateCall",""),e.put("ScheduleEmployeesListInfo",""),t.sessionValidation=function(){s.validate()&&(t._s_tk_com=e.get("_s_tk_com"),o.ticketActivityLoadedFully=!0,t.data=n.loadControllerData(),o.ticketActivityLoadedFully=!1,t.fetchData())},t.fetchData=function(){o.supportLoadedFully=!1,o.supportProcessing=!1,e.put("supportProcessing",o.supportProcessing),"NORECORDFOUND"==t.data?(t.error=!0,t.errorMessage="No record found"):"SYSTEMBUSY"==t.data?(t.error=!0,t.errorMessage="System Busy"):"INVALIDSESSION"==t.data?(t.error=!0,a.location="/app/#/login"):null!=t.data&&(null!=t.data.ticketActivitiesList&&(t.ticketActivities=t.data.ticketActivitiesList),null!=t.data.ticketBean&&(t.ticketBean=t.data.ticketBean,t.ticketBeanTemp=angular.copy(t.data.ticketBean))),o.globalPageLoader=!1},t.addTicketActivity=function(e){if("Closed"==t.ticketBean.ticketStatus)return t.alertMessage="Please reopen ticket if you want to add ticket activity.",void $("#myAlertBox").modal("show");t.ticketBeanTemp.description=e,t.description="",r.post("ticketActivity/addTicketActivity/"+t._s_tk_com,t.ticketBeanTemp).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.getTicketActivities(t.ticketBean.ticketId):"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.getTicketActivities=function(e){r.post("ticketActivity/getTicketActivitiesByTicketId/"+t._s_tk_com+"/"+e).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?t.ticketActivities=e.data:"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.closeTicketConfirmation=function(){t.alertMessage="Are you sure you want to close the ticket.",$("#alertBox").modal("show")},t.closeTicket=function(){r.post("ticketActivity/closeTicket/"+t._s_tk_com,t.ticketBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.getTicketActivities(t.ticketBean.ticketId),t.ticketBean.ticketStatus="Closed"):"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.reOpenTicketConformation=function(){t.alertMessage="Are you sure you want to reopn the ticket.",$("#reOpenAlertBox").modal("show")},t.reOpenTicket=function(){r.post("ticketActivity/reOpenTicket/"+t._s_tk_com,t.ticketBean).success(function(e){t.responseStatus=e.status,"SUCCESSFUL"==t.responseStatus?(t.getTicketActivities(t.ticketBean.ticketId),t.ticketBean.ticketStatus="Open"):"NORECORDFOUND"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data):"INVALIDSESSION"==t.responseStatus||"SYSTEMBUSY"==t.responseStatus?(t.scheduleError=!0,t.scheduleErrorMessage=e.data,a.location=e.layOutPath):(t.scheduleError=!0,a.location="/app/#/login")}).error(function(){t.scheduleError=!0,t.scheduleErrorMessage=t.systemBusy})},t.sessionValidation()}],UserSalesReportController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","$timeout","$interval","$route","$filter","UserSalesReportControllerPreLoad",function(r,e,t,a,o,s,n,i,c,l,u){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,r.salesReportSuccess=!1,r.salesReportError=!1,r.salesReportError=!1,r.salesReportBean={},r.outlets=[],r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1,r.reportTypeSelect=o.salesReportType,r.outletSelected=o.inventoryReportOutletName,r.sesssionValidation=function(){"weekly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox2=!0):"monthly"==o.salesReportDateType?(r.checkbox1=!1,r.checkbox3=!0):"yearly"==o.salesReportDateType&&(r.checkbox1=!1,r.checkbox4=!0),s.validate()&&(r._s_tk_com=a.get("_s_tk_com"),r.data=u.loadControllerData(),r.fetchData())},r.fetchData=function(){"NORECORDFOUND"==r.data||"No record found !"==r.data?(r.error=!0,r.errorMessage="No record found"):"SYSTEMBUSY"==r.data?(r.error=!0,r.errorMessage=r.systemBusy):"INVALIDSESSION"==r.data?(r.error=!0,r.errorMessage="An exception occured while validating session !",t.location="/app/#/login"):null!=r.data&&(null!=r.data.tableData&&(r.salesReport=r.data.tableData),null!=r.data.outletBeans&&(r.outlets=r.data.outletBeans),r.hideSalesDetails=r.data.hideSalesDetails),o.globalPageLoader=!1},$("#reportrange").on("change",function(e){var t=document.getElementById("reportrange").innerText;r.dateRange="",r.dateRange=t,r.$apply(),r.fetchSalesReportByDateRange()}),r.changeReportDataType=function(){o.salesReportType=r.reportType,c.reload()},r.changeOutletName=function(){o.inventoryReportOutletName=r.outletName,c.reload()},r.fetchSalesReportByDateRange=function(){r.salesReportSuccess=!1,r.salesReportError=!1,r.loading=!0;var e=r.dateRange.split("-");o.salesReportStartDate=e[0].trim(),o.salesReportEndDate=e[1].trim(),c.reload()},r.changeReportType=function(e){"Daily"==e?(r.checkbox1=!0,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!1):"Weekly"==e?(r.checkbox1=!1,r.checkbox2=!0,r.checkbox3=!1,r.checkbox4=!1):"Monthly"==e?(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!0,r.checkbox4=!1):"Yearly"==e&&(r.checkbox1=!1,r.checkbox2=!1,r.checkbox3=!1,r.checkbox4=!0),o.salesReportDateType=e,c.reload()},r.sesssionValidation()}],UsersController=["$scope","$http","$window","$cookieStore","$rootScope","SessionService","UsersControllerPreLoad",function(e,t,r,a,o,s,n){o.MainSideBarhideit=!1,o.MainHeaderideit=!1,s.validate(),e.newUsers=function(){r.location="/app/#/newUser"},e.sessionValidation=function(){s.validate()&&(e._s_tk_com=a.get("_s_tk_com"),e.data=n.loadControllerData(),e.fetchData())},e.fetchData=function(){o.usersLoadedFully=!1,"NORECORDFOUND"==e.data||"No record found !"==e.data?(e.error=!0,e.errorMessage="No record found"):"SYSTEMBUSY"==e.data?(e.error=!0,e.errorMessage=e.systemBusy):"INVALIDSESSION"==e.data?(e.error=!0,e.errorMessage="An exception occured while validating session !",r.location="/app/#/login"):null!=e.data&&(e.usersList=e.data,setTimeout(function(){$("#myTable").DataTable({responsive:!0,paging:!0,searching:!0,bInfo:!0})},10)),o.globalPageLoader=!1},e.editUser=function(e){a.put("_e_uob_gra",e.userId),r.location="/app/#/manageUser"},e.sessionValidation()}];